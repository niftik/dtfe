import{C as G,hJ as pt,b as O,g as L,bP as ut,hK as je,I as Vt,l as $,bS as ft,d3 as Wt,dU as qi,aq as mt,aU as W,du as Zi,e4 as Qi,e5 as Ki,bq as Oe,i as B,ar as es,bx as J,cH as F,aQ as j,hL as Le,dT as ts,ex as is,ba as X,aj as Te,g8 as ss,bJ as rs,cb as Ut,aJ as ye,hM as _t,bL as ns,e1 as $t,c7 as Me,b4 as os,bH as as,ec as ls,ed as ds,cc as Jt,ci as hs,c3 as cs,bz as Nt,bA as _,hN as ps,hO as us,eP as fs,c6 as ms,cA as tt,bR as gt,dR as gs,hP as vs,b9 as Ss,eX as vt,fX as Yt,fr as Q,dG as De,bN as ke,c4 as oe,aF as ws,r as Xt,u as ze,A as it,dH as qt,dJ as Zt,bm as Qt,cF as St,bG as bs,fR as Cs,ak as Kt,bv as Is,fg as ys,al as st,dj as Be,hc as ei,a as Rt,hQ as Ps,hR as Ts,cX as x,dO as ti,bE as Se,ef as Dt,fs as xs,hS as Es,gf as Ns,j as Rs,eb as Ds,hT as ks,hU as Fs,cd as ii,bi as rt,cj as kt,d0 as Os,h as Ls,hV as Ft,c5 as zs,hW as Ot,eL as si,hX as Bs,d$ as As,cC as Hs,aR as Lt,cV as js,at as Ms,cW as Gs,V as zt}from"./inspector-CyOA7R9n.js";import{I as ge,M as ri}from"./IsolateManager-NiMHBY0n.js";import{w as Vs}from"./ElementStatePaneWidget-6aoZ4Fwh.js";import"./utils-C4_HKhgT.js";import"./StylePropertyEditor-BEGc-Ch4.js";import"./TreeOutline-CeMGdnsP.js";import{D as Ws,g as Us,e as _s,c as ni,R as $s,f as Js,d as Ys}from"./timelineOverviewInfo.css-BT4HnMd6.js";import"./PreviewFactory-7rWtg079.js";import{P as Xs}from"./PopoverHelper-fEnxzApM.js";import"./EventListenersView-ZykD45RN.js";import"./UserVisibleError-YMOzvDSx.js";import"./cssOverview.css-C_I9lWrq.js";import"./PanelIntroductionSteps-BeLT2-qM.js";import"./PreviewToggle-D6BBIbZ3.js";import"./FloatingButton-ChdjBnjy.js";import"./Debouncer-BW_30p93.js";import"./swatchPopover.css-CdLS3b97.js";import"./BezierUI-Cu0bTMGR.js";import"./Helper-Wu6lA3aw.js";import"./WorkspaceDiff-_8IW6Oi2.js";import"./ScriptFormatter-CdcZyJ9a.js";import"./emulation-CRgKT_2f.js";import"./RootView-hYGHqrG8.js";import"./DeviceModeModel-fDJ3OPwb.js";import"./mobile_throttling-CIMam4T2.js";import"./inspectorCommon.css-gVYvLA0h.js";import"./directives-BpSiwtWR.js";import"./DropTarget-DDkHhLsd.js";class oi{#e;constructor(){this.#e=null}write(e){this.#e&&e.unshift(this.#e),this.#e=new Blob(e,{type:"text/plain"})}read(){return this.readRange()}size(){return this.#e?this.#e.size:0}async readRange(e,t){if(!this.#e)return G.instance().error("Attempt to read a temp file that was never written"),"";const i=typeof e=="number"||typeof t=="number"?this.#e.slice(e,t):this.#e,s=new FileReader;try{await new Promise((r,n)=>{s.onloadend=r,s.onerror=n,s.readAsText(i)})}catch(r){G.instance().error("Failed to read from temp file: "+r.message)}return s.result}async copyToOutputStream(e,t){if(!this.#e)return e.close(),null;const i=new pt(this.#e,10*1e3*1e3,t);return i.read(e).then(s=>s?null:i.error())}remove(){this.#e=null}}const nt={notOptimizedS:"Not optimized: {PH1}",genericTextTwoPlaceholders:"{PH1}, {PH2}"},qs=O("panels/profiler/ProfileDataGrid.ts",nt),Bt=L.bind(void 0,qs);class V extends ut{searchMatchedSelfColumn;searchMatchedTotalColumn;searchMatchedFunctionColumn;profileNode;tree;childrenByCallUID;lastComparator;callUID;self;total;functionName;deoptReason;url;linkElement;populated;savedSelf;savedTotal;savedChildren;constructor(e,t,i){super(null,i),this.searchMatchedSelfColumn=!1,this.searchMatchedTotalColumn=!1,this.searchMatchedFunctionColumn=!1,this.profileNode=e,this.tree=t,this.childrenByCallUID=new Map,this.lastComparator=null,this.callUID=e.callUID,this.self=e.self,this.total=e.total,this.functionName=je(e.functionName),this.deoptReason=e.deoptReason||"",this.url=e.url,this.linkElement=null,this.populated=!1}static sort(e,t,i){for(let s=0;s<e.length;++s){const r=e[s],n=r.length;for(let o=0;o<n;++o){const l=r[o];if(!i&&(!l.expanded||l.lastComparator===t)){l.children.length&&(l.shouldRefreshChildren=!0);continue}l.lastComparator=t;const a=l.children,h=a.length;if(h){a.sort(t);for(let m=0;m<h;++m)a[m].recalculateSiblings(m);e.push(a)}}}}static merge(e,t,i){e.self+=t.self,i||(e.total+=t.total);let s=e.children.slice();e.removeChildren();let r=s.length;for(let n=0;n<r;++n)(!i||s[n]!==t)&&e.appendChild(s[n]);s=t.children.slice(),r=s.length;for(let n=0;n<r;++n){const o=s[n],l=e.childrenByCallUID.get(o.callUID);l?l.merge(o,!1):e.appendChild(o)}}static populate(e){if(e.populated)return;e.populated=!0,e.populateChildren();const t=e.tree.lastComparator;t&&e.sort(t,!0)}createCell(e){switch(e){case"self":{const t=this.createValueCell(this.self,this.selfPercent,e);return t.classList.toggle("highlight",this.searchMatchedSelfColumn),t}case"total":{const t=this.createValueCell(this.total,this.totalPercent,e);return t.classList.toggle("highlight",this.searchMatchedTotalColumn),t}case"function":{const t=this.createTD(e);if(t.classList.toggle("highlight",this.searchMatchedFunctionColumn),this.deoptReason){t.classList.add("not-optimized");const s=new Vt;s.data={iconName:"warning-filled",color:"var(--icon-warning)",width:"14px",height:"14px"},s.classList.add("profile-warn-marker"),$.install(s,Bt(nt.notOptimizedS,{PH1:this.deoptReason})),t.appendChild(s)}if(ft(t,this.functionName),this.profileNode.scriptId==="0")return t;const i=this.tree.formatter.linkifyNode(this);return i&&(i.style.maxWidth="75%",t.appendChild(i),this.linkElement=i),t}}return super.createCell(e)}createValueCell(e,t,i){const s=document.createElement("td");s.classList.add("numeric-column");const r=s.createChild("div","profile-multiple-values"),n=r.createChild("span"),o=this.tree.formatter.formatValue(e,this);n.textContent=o;const l=r.createChild("span","percent-column"),a=this.tree.formatter.formatPercent(t,this);l.textContent=a;const h=this.tree.formatter.formatValueAccessibleText(e,this);return this.setCellAccessibleName(Bt(nt.genericTextTwoPlaceholders,{PH1:h,PH2:a}),s,i),s}sort(e,t){const i=e;return V.sort([[this]],i,t)}insertChild(e,t){const i=e;super.insertChild(i,t),this.childrenByCallUID.set(i.callUID,i)}removeChild(e){super.removeChild(e),this.childrenByCallUID.delete(e.callUID)}removeChildren(){super.removeChildren(),this.childrenByCallUID.clear()}findChild(e){return e&&this.childrenByCallUID.get(e.callUID)||null}get selfPercent(){return this.self/this.tree.total*100}get totalPercent(){return this.total/this.tree.total*100}populate(){V.populate(this)}populateChildren(){}save(){this.savedChildren||(this.savedSelf=this.self,this.savedTotal=this.total,this.savedChildren=this.children.slice())}restore(){if(!this.savedChildren)return;this.savedSelf&&this.savedTotal&&(this.self=this.savedSelf,this.total=this.savedTotal),this.removeChildren();const e=this.savedChildren,t=e.length;for(let i=0;i<t;++i)e[i].restore(),this.appendChild(e[i])}merge(e,t){V.merge(this,e,t)}}class Ge{tree;self;children;formatter;searchableView;total;lastComparator;childrenByCallUID;deepSearch;populated;searchResults;savedTotal;savedChildren;searchResultIndex=-1;constructor(e,t,i){this.tree=this,this.self=0,this.children=[],this.formatter=e,this.searchableView=t,this.total=i,this.lastComparator=null,this.childrenByCallUID=new Map,this.deepSearch=!0,this.populated=!1}static propertyComparator(e,t){let i=At[t?1:0][e];return i||(t?i=function(s,r){return s[e]<r[e]?-1:s[e]>r[e]?1:0}:i=function(s,r){return s[e]>r[e]?-1:s[e]<r[e]?1:0},At[t?1:0][e]=i),i}get expanded(){return!0}appendChild(e){this.insertChild(e,this.children.length)}focus(e){}exclude(e){}insertChild(e,t){const i=e;this.children.splice(t,0,i),this.childrenByCallUID.set(i.callUID,e)}removeChildren(){this.children=[],this.childrenByCallUID.clear()}populateChildren(){}findChild(e){return e&&this.childrenByCallUID.get(e.callUID)||null}sort(e,t){return V.sort([[this]],e,t)}save(){this.savedChildren||(this.savedTotal=this.total,this.savedChildren=this.children.slice())}restore(){if(!this.savedChildren)return;this.children=this.savedChildren,this.savedTotal&&(this.total=this.savedTotal);const e=this.children,t=e.length;for(let i=0;i<t;++i)e[i].restore();this.savedChildren=null}matchFunction(e){const t=e.query.trim();if(!t.length)return null;const i=t.startsWith(">"),s=t.startsWith("<");let r=t.startsWith("=")||(i||s)&&t.indexOf("=")===1;const n=t.endsWith("%"),o=t.length>2&&t.endsWith("ms"),l=!o&&t.endsWith("s");let a=parseFloat(t);(i||s||r)&&(r&&(i||s)?a=parseFloat(t.substring(2)):a=parseFloat(t.substring(1)));const h=l?a*1e3:a;!isNaN(a)&&!(i||s)&&(r=!0);const m=Wt(t,"i");function g(c){return c.searchMatchedSelfColumn=!1,c.searchMatchedTotalColumn=!1,c.searchMatchedFunctionColumn=!1,n?(s?(c.selfPercent<a&&(c.searchMatchedSelfColumn=!0),c.totalPercent<a&&(c.searchMatchedTotalColumn=!0)):i&&(c.selfPercent>a&&(c.searchMatchedSelfColumn=!0),c.totalPercent>a&&(c.searchMatchedTotalColumn=!0)),r&&(c.selfPercent===a&&(c.searchMatchedSelfColumn=!0),c.totalPercent===a&&(c.searchMatchedTotalColumn=!0))):(o||l)&&(s?(c.self<h&&(c.searchMatchedSelfColumn=!0),c.total<h&&(c.searchMatchedTotalColumn=!0)):i&&(c.self>h&&(c.searchMatchedSelfColumn=!0),c.total>h&&(c.searchMatchedTotalColumn=!0)),r&&(c.self===h&&(c.searchMatchedSelfColumn=!0),c.total===h&&(c.searchMatchedTotalColumn=!0))),(c.functionName.match(m)||c.url&&c.url.match(m))&&(c.searchMatchedFunctionColumn=!0),c.searchMatchedSelfColumn||c.searchMatchedTotalColumn||c.searchMatchedFunctionColumn?(c.refresh(),!0):!1}return g}performSearch(e,t,i){this.onSearchCanceled();const s=this.matchFunction(e);if(!s)return;this.searchResults=[];const r=this.deepSearch;let n;for(n=this.children[0];n;n=n.traverseNextNode(!r,null,!r)){const o=n;if(!o)break;s(o)&&this.searchResults.push({profileNode:o})}this.searchResultIndex=i?0:this.searchResults.length-1,this.searchableView.updateSearchMatchesCount(this.searchResults.length),this.searchableView.updateCurrentMatchIndex(this.searchResultIndex)}onSearchCanceled(){if(this.searchResults)for(let e=0;e<this.searchResults.length;++e){const t=this.searchResults[e].profileNode;t.searchMatchedSelfColumn=!1,t.searchMatchedTotalColumn=!1,t.searchMatchedFunctionColumn=!1,t.refresh()}this.searchResults=[],this.searchResultIndex=-1}jumpToNextSearchResult(){!this.searchResults||!this.searchResults.length||(this.searchResultIndex=(this.searchResultIndex+1)%this.searchResults.length,this.jumpToSearchResult(this.searchResultIndex))}jumpToPreviousSearchResult(){!this.searchResults||!this.searchResults.length||(this.searchResultIndex=(this.searchResultIndex-1+this.searchResults.length)%this.searchResults.length,this.jumpToSearchResult(this.searchResultIndex))}supportsCaseSensitiveSearch(){return!0}supportsRegexSearch(){return!1}jumpToSearchResult(e){const t=this.searchResults[e];if(!t)return;t.profileNode.revealAndSelect(),this.searchableView.updateCurrentMatchIndex(e)}}const At=[{},{}],rn=Object.freeze(Object.defineProperty({__proto__:null,ProfileDataGridNode:V,ProfileDataGridTree:Ge},Symbol.toStringTag,{value:"Module"}));class ae extends V{remainingNodeInfos;constructor(e,t){super(e,t,e.parent!==null&&!!e.parent.parent),this.remainingNodeInfos=[]}static sharedPopulate(e){if(e.remainingNodeInfos===void 0)return;const t=e.remainingNodeInfos,i=t.length;for(let s=0;s<i;++s){const r=t[s],n=r.ancestor,o=r.focusNode;let l=e.findChild(n);if(l){const h=r.totalAccountedFor;l.self+=o.self,h||(l.total+=o.total)}else l=new ae(n,e.tree),n!==o&&(l.self=o.self,l.total=o.total),e.appendChild(l);const a=n.parent;a&&a.parent&&(r.ancestor=a,l.remainingNodeInfos||(l.remainingNodeInfos=[]),l.remainingNodeInfos.push(r))}delete e.remainingNodeInfos}takePropertiesFromProfileDataGridNode(e){this.save(),this.self=e.self,this.total=e.total}keepOnlyChild(e){this.save(),this.removeChildren(),this.appendChild(e)}exclude(e){this.remainingNodeInfos&&this.populate(),this.save();const t=this.children;let i=this.children.length;for(;i--;)t[i].exclude(e);const s=this.childrenByCallUID.get(e);s&&this.merge(s,!0)}restore(){super.restore(),this.children.length||this.setHasChildren(this.willHaveChildren(this.profileNode))}merge(e,t){this.self-=e.self,super.merge(e,t)}populateChildren(){ae.sharedPopulate(this)}willHaveChildren(e){return!!(e.parent&&e.parent.parent)}}class ai extends Ge{deepSearch;remainingNodeInfos;constructor(e,t,i,s){super(e,t,s),this.deepSearch=!1;let r=0;const n=[[],[i]],o=new Map;this.remainingNodeInfos=[];for(let l=0;l<n.length;++l){const a=n[l],h=n[++l],m=h.length,g=new WeakMap;for(let c=0;c<m;++c){const p=h[c];if(g.get(p)||g.set(p,++r),p.parent){let P=o.get(p.callUID),y=!1;if(!P)P=new Set,o.set(p.callUID,P);else{const I=a.length;for(let T=0;T<I;++T){const A=g.get(a[T]);if(A&&P.has(A)){y=!0;break}}}const q=g.get(p);q&&P.add(q),this.remainingNodeInfos.push({ancestor:p,focusNode:p,totalAccountedFor:y})}const N=p.children;N.length&&(n.push(a.concat([p])),n.push(N))}}return V.populate(this),this}focus(e){if(!e)return;this.save();let t=e,i=e;for(;t.parent&&t instanceof ae;)t.takePropertiesFromProfileDataGridNode(e),i=t,t=t.parent,t instanceof ae&&t.keepOnlyChild(i);this.children=[i],this.total=e.total}exclude(e){if(!e)return;this.save();const t=e.callUID,i=this.childrenByCallUID.get(t);i&&qi(this.children,i);const s=this.children,r=s.length;for(let n=0;n<r;++n)s[n].exclude(t);this.lastComparator&&this.sort(this.lastComparator,!0)}populateChildren(){ae.sharedPopulate(this)}}const nn=Object.freeze(Object.defineProperty({__proto__:null,BottomUpProfileDataGridNode:ae,BottomUpProfileDataGridTree:ai},Symbol.toStringTag,{value:"Module"})),on=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),li=new CSSStyleSheet;li.replaceSync(`/*
 * Copyright (C) 2009 Google Inc. All rights reserved.
 * Copyright (C) 2010 Apple Inc. All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above
 * copyright notice, this list of conditions and the following disclaimer
 * in the documentation and/or other materials provided with the
 * distribution.
 *     * Neither the name of Google Inc. nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

.heap-snapshot-view {
  overflow: hidden;
}

.heap-snapshot-view .data-grid {
  border: none;
  flex: auto;
}

.heap-snapshot-view .data-grid tr:empty {
  height: 16px;
  visibility: hidden;
}

.heap-snapshot-view .data-grid span.percent-column {
  width: 35px !important; /* stylelint-disable-line declaration-no-important */
}

.heap-snapshot-view .object-value-object,
.object-value-node {
  display: inline;
  position: static;
}

.heap-snapshot-view .object-value-string {
  white-space: nowrap;
}

.heap-snapshot-view td.object-column .objects-count {
  margin-left: 10px;
  font-size: 11px;
  color: var(--sys-color-token-subtle);
}

.heap-snapshot-view tr:not(.selected) .object-value-id {
  color: var(--sys-color-token-subtle);
}

.profile-view .heap-tracking-overview {
  flex: 0 0 80px;
  height: 80px;
}

.heap-snapshot-view .retaining-paths-view {
  overflow: hidden;
}

.heap-snapshot-view .heap-snapshot-view-resizer {
  background-color: var(--sys-color-surface1);
  display: flex;
  flex: 0 0 21px;
}

.heap-snapshot-view td.object-column > div > span {
  margin-right: 6px;
}

.heap-snapshot-view .heap-snapshot-view-resizer .title {
  flex: 0 1 auto;
  overflow: hidden;
  white-space: nowrap;
}

.heap-snapshot-view .heap-snapshot-view-resizer .verticalResizerIcon {
  background-image: var(--image-file-toolbarResizerVertical);
  background-repeat: no-repeat;
  background-position: center;
  flex: 0 0 28px;
  margin-left: auto;
}

.heap-snapshot-view .heap-snapshot-view-resizer .title > span {
  display: inline-block;
  padding-top: 3px;
  vertical-align: middle;
  margin-left: 4px;
  margin-right: 8px;
}

.heap-snapshot-view .heap-snapshot-view-resizer * {
  pointer-events: none;
}

.heap-snapshot-view tr:not(.selected) td.object-column span.highlight {
  background-color: inherit;
}

.heap-snapshot-view td.object-column span.heap-object-source-link {
  float: right;
}

.heap-snapshot-view td.object-column span.heap-object-source-link:empty {
  animation: fadeInOut 2s infinite;
}

.heap-snapshot-view td.object-column span.heap-object-source-link:empty::before {
  content: "\\b7\\b7";
  font-weight: bold;
}

@keyframes fadeInOut {
  0% {
    transform: rotate(0);
  }

  50% {
    transform: rotate(0.5turn);
  }

  100% {
    transform: rotate(1turn);
  }
}

.heap-object-tag {
  height: 14px;
  width: 14px;
}

.heap-snapshot-view tr:not(.selected) td.object-column span.heap-object-tag,
.heap-snapshot-view tr:not(.selected) td.object-column span.grayed {
  color: var(--sys-color-token-subtle);
}

.heap-snapshot-view tr:not(.selected) .cycled-ancestor-node,
.heap-snapshot-view tr:not(.selected) .unreachable-ancestor-node {
  opacity: 60%;
}

#heap-recording-view .profile-view {
  top: 80px;
}

.heap-overview-container {
  overflow: hidden;
  position: absolute;
  top: 0;
  width: 100%;
  height: 80px;
}

#heap-recording-overview-grid .resources-dividers-label-bar {
  pointer-events: auto;
}

.heap-recording-overview-canvas {
  position: absolute;
  top: 20px;
  left: 0;
  right: 0;
  bottom: 0;
}

.heap-snapshot-statistics-view {
  overflow: auto;
}

.heap-snapshot-stats-pie-chart {
  margin: 12px 30px;
  flex-shrink: 0;
}

.heap-allocation-stack .stack-frame {
  display: flex;
  justify-content: space-between;
  border-bottom: 1px solid var(--sys-color-divider);
  padding: 2px;
}

.heap-allocation-stack .stack-frame:focus {
  background-color: var(--sys-color-tonal-container);
  color: var(--sys-color-on-tonal-container);
}

.heap-allocation-stack .stack-frame:hover:not(:focus) {
  background-color: var(--sys-color-state-hover-on-subtle);
}

.heap-allocation-stack .stack-frame .devtools-link {
  color: var(--sys-color-primary);
}

.no-heap-allocation-stack {
  padding: 5px;
}

@media (forced-colors: active) {
  .cycled-ancestor-node {
    opacity: 100%;
  }

  .heap-snapshot-view td.object-column .objects-count,
  .heap-snapshot-view tr:not(.selected) td.object-column span.heap-object-tag,
  .heap-snapshot-view tr:not(.selected) .object-value-id {
    color: ButtonText;
  }
}

.detached-elements-view {
  overflow: auto;
}

/*# sourceURL=heapProfiler.css */
`);class ce extends mt{profileTypeInternal;title;uid;fromFileInternal;tempFile;constructor(e,t){super(),this.profileTypeInternal=e,this.title=t,this.uid=e.incrementProfileUid(),this.fromFileInternal=!1,this.tempFile=null}setTitle(e){this.title=e,this.dispatchEventToListeners("ProfileTitleChanged",this)}profileType(){return this.profileTypeInternal}updateStatus(e,t){this.dispatchEventToListeners("UpdateStatus",new di(e,t))}createSidebarTreeElement(e){throw new Error("Not implemented.")}createView(e){throw new Error("Not implemented.")}removeTempFile(){this.tempFile&&this.tempFile.remove()}dispose(){}canSaveToFile(){return!1}saveToFile(){throw new Error("Not implemented.")}loadFromFile(e){throw new Error("Not implemented.")}fromFile(){return this.fromFileInternal}setFromFile(){this.fromFileInternal=!0}setProfile(e){}}class di{subtitle;wait;constructor(e,t){this.subtitle=e,this.wait=t}}class Ve extends mt{idInternal;nameInternal;profiles;profileBeingRecordedInternal;nextProfileUidInternal;constructor(e,t){super(),this.idInternal=e,this.nameInternal=t,this.profiles=[],this.profileBeingRecordedInternal=null,this.nextProfileUidInternal=1,window.opener||window.addEventListener("pagehide",this.clearTempStorage.bind(this),!1)}typeName(){return""}nextProfileUid(){return this.nextProfileUidInternal}incrementProfileUid(){return this.nextProfileUidInternal++}hasTemporaryView(){return!1}fileExtension(){return null}get buttonTooltip(){return""}get id(){return this.idInternal}get treeItemTitle(){return this.nameInternal}get name(){return this.nameInternal}buttonClicked(){return!1}get description(){return""}isInstantProfile(){return!1}isEnabled(){return!0}getProfiles(){function e(t){return this.profileBeingRecordedInternal!==t}return this.profiles.filter(e.bind(this))}customContent(){return null}setCustomContentEnabled(e){}getProfile(e){for(let t=0;t<this.profiles.length;++t)if(this.profiles[t].uid===e)return this.profiles[t];return null}loadFromFile(e){let t=e.name;const i=this.fileExtension();i&&t.endsWith(i)&&(t=t.substr(0,t.length-i.length));const s=this.createProfileLoadedFromFile(t);return s.setFromFile(),this.setProfileBeingRecorded(s),this.addProfile(s),s.loadFromFile(e)}createProfileLoadedFromFile(e){throw new Error("Not implemented")}addProfile(e){this.profiles.push(e),this.dispatchEventToListeners("add-profile-header",e)}removeProfile(e){const t=this.profiles.indexOf(e);t!==-1&&(this.profiles.splice(t,1),this.disposeProfile(e))}clearTempStorage(){for(let e=0;e<this.profiles.length;++e)this.profiles[e].removeTempFile()}profileBeingRecorded(){return this.profileBeingRecordedInternal}setProfileBeingRecorded(e){this.profileBeingRecordedInternal=e}profileBeingRecordedRemoved(){}reset(){for(const e of this.profiles.slice())this.disposeProfile(e);this.profiles=[],this.nextProfileUidInternal=1}disposeProfile(e){this.dispatchEventToListeners("remove-profile-header",e),e.dispose(),this.profileBeingRecordedInternal===e&&(this.profileBeingRecordedRemoved(),this.setProfileBeingRecorded(null))}}const an=Object.freeze(Object.defineProperty({__proto__:null,ProfileHeader:ce,ProfileType:Ve,StatusUpdate:di},Symbol.toStringTag,{value:"Module"})),z={javascriptVmInstances:"JavaScript VM instances",totalJsHeapSize:"Total JS heap size",totalPageJsHeapSizeChangeTrend:"Total page JS heap size change trend over the last {PH1} minutes.",totalPageJsHeapSizeAcrossAllVm:"Total page JS heap size across all VM instances.",changeRate:"{PH1}/s",increasingBySPerSecond:"increasing by {PH1} per second",decreasingBySPerSecond:"decreasing by {PH1} per second",heapSizeInUseByLiveJsObjects:"Heap size in use by live JS objects.",heapSizeChangeTrendOverTheLastS:"Heap size change trend over the last {PH1} minutes.",empty:"(empty)"},Zs=O("panels/profiler/IsolateSelector.ts",z),H=L.bind(void 0,Zs);class xe extends W{items;list;itemByIsolate;totalElement;totalValueDiv;totalTrendDiv;constructor(){super(!1),this.items=new Zi,this.list=new Qi(this.items,this,Ki.NonViewport),this.list.element.classList.add("javascript-vm-instances-list"),Oe(this.list.element,H(z.javascriptVmInstances)),this.contentElement.appendChild(this.list.element),this.itemByIsolate=new Map,this.totalElement=document.createElement("div"),this.totalElement.classList.add("profile-memory-usage-item"),this.totalElement.classList.add("hbox"),this.totalValueDiv=this.totalElement.createChild("div","profile-memory-usage-item-size"),this.totalTrendDiv=this.totalElement.createChild("div","profile-memory-usage-item-trend"),this.totalElement.createChild("div").textContent=H(z.totalJsHeapSize);const e=Math.round(ri/6e4);$.install(this.totalTrendDiv,H(z.totalPageJsHeapSizeChangeTrend,{PH1:e})),$.install(this.totalValueDiv,H(z.totalPageJsHeapSizeAcrossAllVm)),ge.instance().observeIsolates(this),B.instance().addEventListener("NameChanged",this.targetChanged,this),B.instance().addEventListener("InspectedURLChanged",this.targetChanged,this)}wasShown(){super.wasShown(),ge.instance().addEventListener("MemoryChanged",this.heapStatsChanged,this)}willHide(){ge.instance().removeEventListener("MemoryChanged",this.heapStatsChanged,this)}isolateAdded(e){this.list.element.tabIndex=0;const t=new hi(e),i=t.model().target()===B.instance().primaryPageTarget()?0:this.items.length;this.items.insert(i,t),this.itemByIsolate.set(e,t),i===0&&this.list.selectItem(t),this.update()}isolateChanged(e){const t=this.itemByIsolate.get(e);t&&t.updateTitle(),this.update()}isolateRemoved(e){const t=this.itemByIsolate.get(e);t&&this.items.remove(this.items.indexOf(t)),this.itemByIsolate.delete(e),this.items.length===0&&(this.list.element.tabIndex=-1),this.update()}targetChanged(e){const i=e.data.model(es);if(!i)return;const s=ge.instance().isolateByModel(i),r=s&&this.itemByIsolate.get(s);r&&r.updateTitle()}heapStatsChanged(e){const t=e.data,i=this.itemByIsolate.get(t);i&&i.updateStats(),this.updateTotal()}updateTotal(){let e=0,t=0;for(const i of ge.instance().isolates())e+=i.usedHeapSize(),t+=i.usedHeapSizeGrowRate();this.totalValueDiv.textContent=J(e),xe.formatTrendElement(t,this.totalTrendDiv)}static formatTrendElement(e,t){const i=e*1e3;if(Math.abs(i)<1e3)return;const r=J(Math.abs(i));let n,o;i>0?(n="⬆"+H(z.changeRate,{PH1:r}),t.classList.toggle("increasing",!0),o=H(z.increasingBySPerSecond,{PH1:r})):(n="⬇"+H(z.changeRate,{PH1:r}),t.classList.toggle("increasing",!1),o=H(z.decreasingBySPerSecond,{PH1:r})),t.textContent=n,Oe(t,o)}totalMemoryElement(){return this.totalElement}createElementForItem(e){return e.element}heightForItem(e){return console.assert(!1,"should not be called"),0}updateSelectedItemARIA(e,t){return!1}isItemSelectable(e){return!0}selectedItemChanged(e,t,i,s){i&&i.classList.remove("selected"),s&&s.classList.add("selected");const r=t&&t.model();F.instance().setFlavor(j,r&&r.heapProfilerModel()),F.instance().setFlavor(Le,r&&r.target().model(Le))}update(){this.updateTotal(),this.list.invalidateRange(0,this.items.length)}}class hi{isolate;element;heapDiv;trendDiv;nameDiv;constructor(e){this.isolate=e;const t=Math.round(ri/6e4);this.element=document.createElement("div"),this.element.classList.add("profile-memory-usage-item"),this.element.classList.add("hbox"),ts(this.element),this.heapDiv=this.element.createChild("div","profile-memory-usage-item-size"),$.install(this.heapDiv,H(z.heapSizeInUseByLiveJsObjects)),this.trendDiv=this.element.createChild("div","profile-memory-usage-item-trend"),$.install(this.trendDiv,H(z.heapSizeChangeTrendOverTheLastS,{PH1:t})),this.nameDiv=this.element.createChild("div","profile-memory-usage-item-name"),this.updateTitle()}model(){return this.isolate.runtimeModel()}updateStats(){this.heapDiv.textContent=J(this.isolate.usedHeapSize()),xe.formatTrendElement(this.isolate.usedHeapSizeGrowRate(),this.trendDiv)}updateTitle(){const e=new Map;for(const t of this.isolate.models()){const i=t.target(),s=B.instance().primaryPageTarget()!==i?i.name():"",r=new is(i.inspectedURL()),n=r.isValid?r.domain():"",o=i.decorateLabel(n&&s?`${n}: ${s}`:s||n||H(z.empty));e.set(o,(e.get(o)||0)+1)}this.nameDiv.removeChildren();for(const[t,i]of e){const s=i>1?`${t} (${i})`:t,r=this.nameDiv.createChild("div");r.textContent=s,$.install(r,String(s))}}}const ln=Object.freeze(Object.defineProperty({__proto__:null,IsolateSelector:xe,ListItem:hi},Symbol.toStringTag,{value:"Module"})),ci=new CSSStyleSheet;ci.replaceSync(`/*
 * Copyright 2018 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

.profile-launcher-view {
  overflow: auto;
}

.profile-launcher-view-content {
  margin: 10px 16px;
  flex: auto 1 0;
}

.profile-launcher-view-content h1 {
  font-size: 15px;
  font-weight: normal;
  margin: 6px 0 10px;
}

.profile-launcher-view-content [is="dt-radio"] {
  font-size: 13px;
}

.profile-launcher-view-content p {
  color: var(--sys-color-token-subtle);
  margin-top: 1px;
  margin-left: 22px;
}

.profile-launcher-view-content p [is="dt-checkbox"] {
  display: flex;
}

.profile-launcher-view-content button.text-button.running,
.profile-launcher-view-content button.text-button.running:focus {
  color: var(--sys-color-error);
}

.profile-launcher-view-content > div {
  flex: auto 0 0;
}

.profile-launcher-view-content > .profile-isolate-selector-block {
  flex: auto 1 0;
  overflow: hidden;
}

.profile-isolate-selector-block button {
  min-width: 110px;
}

.profile-launcher-target-list {
  margin-bottom: 6px;
  border: 1px solid var(--sys-color-divider);
  flex: 150px 1 0;
}

.profile-launcher-target-list-container {
  overflow: auto;
}

.profile-memory-usage-item {
  min-width: 100%;
  width: max-content;
  padding: 4px;
  line-height: 16px;
}

.profile-isolate-selector-block > .profile-memory-usage-item {
  margin-left: 1px;
  margin-bottom: 4px;
  font-weight: bolder;
}

.profile-memory-usage-item.selected {
  background-color: var(--sys-color-neutral-container);
}

.profile-memory-usage-item:focus {
  background-color: var(--sys-color-tonal-container);
}

.profile-launcher-target-list .profile-memory-usage-item:hover:not(.selected) {
  background-color: var(--sys-color-state-hover-on-subtle);
}

.javascript-vm-instances-list {
  width: max-content;
  min-width: 100%;
}

.javascript-vm-instances-list:focus .profile-memory-usage-item.selected {
  background-color: var(--sys-color-tonal-container);
}

.profile-memory-usage-item > div {
  flex-shrink: 0;
  margin-right: 12px;
}

.profile-memory-usage-item-size {
  width: 60px;
  text-align: right;
}

.profile-memory-usage-item-trend {
  min-width: 5em;
  color: var(--sys-color-tertiary);
}

.profile-memory-usage-item-trend.increasing {
  color: var(--sys-color-error);
}

.profile-launcher-buttons {
  flex-wrap: wrap;
  column-gap: 8px;
}

@media (forced-colors: active) {
  .profile-memory-usage-item {
    forced-color-adjust: none;
    border-left-color: transparent;
  }

  .profile-memory-usage-item-trend,
  .profile-memory-usage-item-trend.increasing,
  .profile-launcher-view-content button.running,
  body.inactive .profile-launcher-view-content button.running:not(.toolbar-item) {
    color: ButtonText;
  }

  .javascript-vm-instances-list .profile-memory-usage-item:hover:not(.selected) {
    background-color: Highlight;
    color: HighlightText;
  }

  .javascript-vm-instances-list .profile-memory-usage-item.selected .profile-memory-usage-item-trend,
  .javascript-vm-instances-list .profile-memory-usage-item.selected .profile-memory-usage-item-trend.increasing {
    color: ButtonFace;
  }

  .javascript-vm-instances-list .profile-memory-usage-item:hover:not(.selected) .profile-memory-usage-item-trend,
  .javascript-vm-instances-list .profile-memory-usage-item:hover:not(.selected) .profile-memory-usage-item-trend.increasing {
    background-color: Highlight;
    color: HighlightText;
  }

  .javascript-vm-instances-list .profile-memory-usage-item.selected {
    background-color: ButtonText;
    border-color: Highlight;
    color: ButtonFace;
  }

  .javascript-vm-instances-list:focus .profile-memory-usage-item.selected,
  .javascript-vm-instances-list:focus-visible .profile-memory-usage-item.selected {
    background-color: Highlight;
    border-color: ButtonText;
    color: HighlightText;
  }
}

/*# sourceURL=profileLauncherView.css */
`);const te={selectJavascriptVmInstance:"Select JavaScript VM instance",load:"Load profile",takeSnapshot:"Take snapshot",stop:"Stop",start:"Start",selectProfilingType:"Select profiling type"},Qs=O("panels/profiler/ProfileLauncherView.ts",te),fe=L.bind(void 0,Qs);class pi extends X(W){panel;contentElementInternal;selectedProfileTypeSetting;profileTypeHeaderElement;profileTypeSelectorForm;controlButton;loadButton;recordButtonEnabled;typeIdToOptionElementAndProfileType;isProfiling;isInstantProfile;isEnabled;constructor(e){super(),this.panel=e,this.element.classList.add("profile-launcher-view"),this.contentElementInternal=this.element.createChild("div","profile-launcher-view-content vbox");const t=this.contentElementInternal.createChild("div","vbox");this.selectedProfileTypeSetting=Te.instance().createSetting("selected-profile-type","CPU"),this.profileTypeHeaderElement=t.createChild("h1"),this.profileTypeSelectorForm=t.createChild("form"),ss(this.profileTypeSelectorForm);const i=this.contentElementInternal.createChild("div","vbox profile-isolate-selector-block");i.createChild("h1").textContent=fe(te.selectJavascriptVmInstance);const s=new xe,r=i.createChild("div","vbox profile-launcher-target-list");r.classList.add("profile-launcher-target-list-container"),s.show(r),i.appendChild(s.totalMemoryElement());const n=this.contentElementInternal.createChild("div","hbox profile-launcher-buttons");this.controlButton=rs("",this.controlButtonClicked.bind(this),{jslogContext:"profiler.heap-toggle-recording",variant:"primary"}),this.loadButton=new Ut,this.loadButton.data={iconName:"import",variant:"outlined",jslogContext:"profiler.load-from-file"},this.loadButton.textContent=fe(te.load),this.loadButton.addEventListener("click",this.loadButtonClicked.bind(this)),n.appendChild(this.loadButton),n.appendChild(this.controlButton),this.recordButtonEnabled=!0,this.typeIdToOptionElementAndProfileType=new Map}loadButtonClicked(){ye.instance().getAction("profiler.load-from-file").execute()}updateControls(){this.isEnabled&&this.recordButtonEnabled?this.controlButton.removeAttribute("disabled"):this.controlButton.setAttribute("disabled",""),$.install(this.controlButton,this.recordButtonEnabled?"":_t()),this.isInstantProfile?(this.controlButton.classList.remove("running"),this.controlButton.textContent=fe(te.takeSnapshot)):this.isProfiling?(this.controlButton.classList.add("running"),this.controlButton.textContent=fe(te.stop)):(this.controlButton.classList.remove("running"),this.controlButton.textContent=fe(te.start));for(const{optionElement:e}of this.typeIdToOptionElementAndProfileType.values())e.disabled=!!this.isProfiling}profileStarted(){this.isProfiling=!0,this.updateControls()}profileFinished(){this.isProfiling=!1,this.updateControls()}updateProfileType(e,t){this.isInstantProfile=e.isInstantProfile(),this.recordButtonEnabled=t,this.isEnabled=e.isEnabled(),this.updateControls()}addProfileType(e){const t=ns("profile-type",e.name,void 0,"profiler.profile-type");this.profileTypeSelectorForm.appendChild(t);const i=t.radioElement;this.typeIdToOptionElementAndProfileType.set(e.id,{optionElement:i,profileType:e}),i.addEventListener("change",this.profileTypeChanged.bind(this,e),!1);const s=this.profileTypeSelectorForm.createChild("p");s.textContent=e.description,$t(i,e.description);const r=e.customContent();r&&(r.setAttribute("role","group"),r.setAttribute("aria-labelledby",`${i.id}`),this.profileTypeSelectorForm.createChild("p").appendChild(r),e.setCustomContentEnabled(!1));const n=this.typeIdToOptionElementAndProfileType.size>1?fe(te.selectProfilingType):e.name;this.profileTypeHeaderElement.textContent=n,Oe(this.profileTypeSelectorForm,n)}restoreSelectedProfileType(){let e=this.selectedProfileTypeSetting.get();this.typeIdToOptionElementAndProfileType.has(e)||(e=this.typeIdToOptionElementAndProfileType.keys().next().value,this.selectedProfileTypeSetting.set(e));const t=this.typeIdToOptionElementAndProfileType.get(e);t.optionElement.checked=!0;const i=t.profileType;for(const[s,{profileType:r}]of this.typeIdToOptionElementAndProfileType){const n=s===e;r.setCustomContentEnabled(n)}this.dispatchEventToListeners("ProfileTypeSelected",i)}controlButtonClicked(){this.panel.toggleRecord()}profileTypeChanged(e){const t=this.selectedProfileTypeSetting.get();this.typeIdToOptionElementAndProfileType.get(t).profileType.setCustomContentEnabled(!1),e.setCustomContentEnabled(!0),this.dispatchEventToListeners("ProfileTypeSelected",e),this.isInstantProfile=e.isInstantProfile(),this.isEnabled=e.isEnabled(),this.updateControls(),this.selectedProfileTypeSetting.set(e.id)}wasShown(){super.wasShown(),this.registerCSSFiles([ci])}}const dn=Object.freeze(Object.defineProperty({__proto__:null,ProfileLauncherView:pi},Symbol.toStringTag,{value:"Module"})),ot={profileOptions:"Profile options"},Ks=O("panels/profiler/ProfileSidebarTreeElement.ts",ot),Ht=L.bind(void 0,Ks);class We extends Me{iconElement;titlesElement;menuElement;titleContainer;titleElement;subtitleElement;className;small;dataDisplayDelegate;profile;saveLinkElement;editing;constructor(e,t,i){super("",!1),this.iconElement=document.createElement("div"),this.iconElement.classList.add("icon"),this.titlesElement=document.createElement("div"),this.titlesElement.classList.add("titles"),this.titlesElement.classList.add("no-subtitle"),this.titlesElement.setAttribute("jslog",`${os("title").track({dblclick:!0,change:!0})}`),this.titleContainer=this.titlesElement.createChild("span","title-container"),this.titleElement=this.titleContainer.createChild("span","title"),this.subtitleElement=this.titlesElement.createChild("span","subtitle"),this.menuElement=new Ut,this.menuElement.data={variant:"icon",iconName:"dots-vertical",title:Ht(ot.profileOptions)},this.menuElement.tabIndex=-1,this.menuElement.addEventListener("click",this.handleContextMenuEvent.bind(this)),this.menuElement.setAttribute("jslog",`${as("profile-options").track({click:!0})}`),$.install(this.menuElement,Ht(ot.profileOptions)),this.titleElement.textContent=t.title,this.className=i,this.small=!1,this.dataDisplayDelegate=e,this.profile=t,t.addEventListener("UpdateStatus",this.updateStatus,this)}updateStatus(e){const t=e.data;t.subtitle!==null&&(this.subtitleElement.textContent=t.subtitle.length>0?`(${t.subtitle})`:"",this.titlesElement.classList.toggle("no-subtitle",!t.subtitle),Oe(this.listItemElement,`${this.profile.title}, ${t.subtitle}`)),typeof t.wait=="boolean"&&this.listItemElement&&(this.iconElement.classList.toggle("spinner",t.wait),this.listItemElement.classList.toggle("wait",t.wait))}ondblclick(e){return this.editing||this.startEditing(e.target),!1}startEditing(e){const t=e.enclosingNodeOrSelfWithClass("title");if(!t)return;const i=new ls(this.editingCommitted.bind(this),this.editingCancelled.bind(this));this.editing=ds.startEditing(t,i)}editingCommitted(e,t){delete this.editing,this.profile.setTitle(t)}editingCancelled(){delete this.editing}dispose(){this.profile.removeEventListener("UpdateStatus",this.updateStatus,this)}onselect(){return this.dataDisplayDelegate.showProfile(this.profile),!0}ondelete(){return this.profile.profileType().removeProfile(this.profile),!0}onattach(){this.className&&this.listItemElement.classList.add(this.className),this.small&&this.listItemElement.classList.add("small"),this.listItemElement.append(this.iconElement,this.titlesElement,this.menuElement),this.listItemElement.addEventListener("contextmenu",this.handleContextMenuEvent.bind(this),!0),$t(this.listItemElement,this.profile.profileType().name)}handleContextMenuEvent(e){const t=new Jt(e);t.appendItemsAtLocation("profilerMenu"),t.show()}setSmall(e){this.small=e,this.listItemElement&&this.listItemElement.classList.toggle("small",this.small)}setMainTitle(e){this.titleElement.textContent=e}}const hn=Object.freeze(Object.defineProperty({__proto__:null,ProfileSidebarTreeElement:We},Symbol.toStringTag,{value:"Module"})),ui=new CSSStyleSheet;ui.replaceSync(`/*
 * Copyright (C) 2006, 2007, 2008 Apple Inc.  All rights reserved.
 * Copyright (C) 2009 Anthony Ricaud <rik@webkit.org>
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *
 * 1.  Redistributions of source code must retain the above copyright
 *     notice, this list of conditions and the following disclaimer.
 * 2.  Redistributions in binary form must reproduce the above copyright
 *     notice, this list of conditions and the following disclaimer in the
 *     documentation and/or other materials provided with the distribution.
 * 3.  Neither the name of Apple Computer, Inc. ("Apple") nor the names of
 *     its contributors may be used to endorse or promote products derived
 *     from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
/* Profiler Style */

#profile-views {
  flex: auto;
  position: relative;
}

.profile-view .data-grid table.data {
  background: var(--sys-color-cdt-base-container);
}

.profile-view .data-grid tr:not(.selected) .highlight {
  background-color: var(--sys-color-tonal-container);
}

.profile-view .data-grid tr:hover td:not(.bottom-filler-td) {
  background-color: var(--sys-color-state-hover-on-subtle);
}

.profile-view .data-grid td.numeric-column {
  text-align: right;
}

.profile-view .data-grid div.profile-multiple-values {
  float: right;
}

.profile-view .data-grid span.percent-column {
  color: var(--sys-color-token-subtle);
  width: 9ex;
  display: inline-block;
}

.profile-view .data-grid tr.selected span {
  color: inherit;
}

.profiles-toolbar {
  background-color: var(--sys-color-cdt-base-container);
  border-bottom: 1px solid var(--sys-color-divider);
  flex-shrink: 0;
}

.profiles-tree-sidebar {
  flex: auto;
  overflow: hidden;
}

.profiles-sidebar-tree-box {
  overflow-y: auto;
}

.profile-view {
  display: flex;
  overflow: hidden;
}

.profile-view .data-grid {
  border: none;
  flex: auto;
}

.profile-view .data-grid th.self-column,
.profile-view .data-grid th.total-column {
  text-align: center;
}

.profile-node-file {
  float: right;
  color: var(--sys-color-token-subtle);
}

.profile-warn-marker {
  vertical-align: -1px;
  margin-right: 2px;
}

.cpu-profile-flame-chart-overview-container {
  overflow: hidden;
  position: absolute;
  top: 0;
  width: 100%;
  height: 80px;
}

#cpu-profile-flame-chart-overview-container {
  border-bottom: 1px solid var(--sys-color-divider);
  overflow: hidden;
}

.cpu-profile-flame-chart-overview-canvas {
  position: absolute;
  top: 20px;
  left: 0;
  right: 0;
  bottom: 0;
}

#cpu-profile-flame-chart-overview-grid .resources-dividers-label-bar {
  pointer-events: auto;
}

.cpu-profile-flame-chart-overview-pane {
  flex: 0 0 80px !important; /* stylelint-disable-line declaration-no-important */
}

.profile-text-view {
  padding: 10px;
  overflow: auto;
  margin: 0;
  user-select: text;
  cursor: text;
}

.empty-landing-page {
  position: absolute;
  background-color: var(--sys-color-cdt-base-container);
  justify-content: center;
  align-items: center;
  overflow: auto;
  font-size: 16px;
  color: var(--sys-color-token-subtle);
  padding: 50px;
}

@media (forced-colors: active) {
  .profile-view .data-grid tr:hover td:not(.bottom-filler-td) {
    background: Highlight;
  }

  .profile-view .data-grid table.data {
    background: transparent;
  }
}

/*# sourceURL=profilesPanel.css */
`);const fi=new CSSStyleSheet;fi.replaceSync(`/*
 * Copyright 2016 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */
:host {
  padding: var(--sys-size-3) 0;
}

.tree-outline-disclosure {
  width: 100%;
}

/* Icon-related changes */
li .icon {
  width: 20px;
  height: 20px;
  margin-right: var(--sys-size-6);
  flex: none;
}

/* Heap profiles and CPU profiles */
.heap-snapshot-sidebar-tree-item .icon,
.profile-sidebar-tree-item .icon {
  mask-image: var(--image-file-heap-snapshot);
  background: var(--icon-default);
}

.profile-group-sidebar-tree-item .icon {
  mask-image: var(--image-file-heap-snapshots);
  background: var(--icon-default);
}

li.small .icon {
  width: 16px;
  height: 16px;
}

li.wait .icon {
  content: none;
}

li devtools-button {
  min-width: var(--sys-size-12);
  visibility: hidden;
}

/* Tree outline overrides */
.heap-snapshot-sidebar-tree-item:not(:hover) devtools-button {
  visibility: hidden;
}

.heap-snapshot-sidebar-tree-item.wait .icon {
  mask-image: unset;
  background-color: inherit;
}

.heap-snapshot-sidebar-tree-item.small .icon {
  mask-image: var(--image-file-heap-snapshots);
  background: var(--icon-default);
}

.profile-sidebar-tree-item.small .icon {
  mask-image: var(--image-file-heap-snapshots);
  background: var(--icon-default);
}

.tree-outline li:not(.parent)::before {
  content: none;
}

ol.tree-outline {
  flex: auto;
  padding: 0;
}

.tree-outline li {
  height: var(--sys-size-12);
  padding-left: var(--sys-size-7);
  margin-right: var(--sys-size-5);
  color: var(--sys-color-on-surface);

  & .leading-icons {
    margin-right: var(--sys-size-6);
    flex: none;
  }

  & .selection {
    border-radius: 0 100px 100px 0;
  }
}

.tree-outline .profile-launcher-view-tree-item,
.tree-outline li.profiles-tree-section + .children > li {
  border-radius: 0 100px 100px 0;
  position: relative;

  &.selected {
    background-color: var(--app-color-navigation-drawer-background-selected);
    color: var(--app-color-navigation-drawer-label-selected);

    & devtools-icon {
      color: var(--app-color-navigation-drawer-label-selected);
    }

    & > .icon:not(.spinner) {
      background-color: var(--app-color-navigation-drawer-label-selected);
    }
  }

  &:active::before {
    background-color: var(--sys-color-state-ripple-neutral-on-subtle);
    mask-image: none;
    content: "";
    height: 100%;
    width: 100%;
    border-radius: inherit;
    position: absolute;
    top: 0;
    left: 0;
  }

  &:focus-visible {
    box-shadow: inset 0 0 0 2px var(--sys-color-state-focus-ring);
  }
}

.tree-outline li.profiles-tree-section {
  margin-top: var(--sys-size-6);
  line-height: var(--sys-size-8);

  &:hover:not(:has(span[is="dt-checkbox"])) .selection {
    background-color: transparent;
  }
}

.tree-outline li.profiles-tree-section::before {
  display: none;
}

.tree-outline ol {
  overflow: hidden;
  padding: 0;
}

/* Generic items styling */

li.wait .spinner::before {
  --dimension: 20px;

  margin: 0;
}

li.wait.small .spinner::before {
  --dimension: 14px;
  --clip-size: 9px;
  --override-spinner-size: 2px;

  margin: 1px;
}

li.wait.selected .spinner::before {
  --override-spinner-color: var(--ref-palette-neutral100);
}

@keyframes spinner-animation {
  from {
    transform: rotate(0);
  }

  to {
    transform: rotate(360deg);
  }
}

li.small {
  height: 20px;
}

li .titles {
  display: inline-flex;
  padding-right: var(--sys-size-5);
}

li .titles > .title-container {
  z-index: 1;
  text-overflow: ellipsis;
  overflow: hidden;
}

li.small .titles {
  top: 2px;
  line-height: normal;
}

li:not(.small) .title::after {
  content: "\\A";
  white-space: pre;
}

li .subtitle {
  text-overflow: ellipsis;
  overflow: hidden;
  margin-left: var(--sys-size-3);
}

li.small .subtitle {
  display: none;
}

li.selected:hover devtools-button {
  visibility: visible;
  margin-left: auto;
}

@media (forced-colors: active) {
  .tree-outline li,
  .tree-outline li.profiles-tree-section,
  .tree-outline li:hover .tree-element-title {
    forced-color-adjust: none;
    color: ButtonText;
    text-shadow: unset;
  }

  .tree-outline .profile-launcher-view-tree-item,
  .tree-outline li.profiles-tree-section + .children > li {
    &.selected {
      background-color: Highlight;
      color: HighlightText;

      & devtools-icon {
        color: HighlightText;
      }

      & > .icon:not(.spinner) {
        background-color: HighlightText;
      }
    }
  }
}

/*# sourceURL=profilesSidebarTree.css */
`);const le={cantLoadFileSupportedFile:"Can’t load file. Supported file extensions: ''{PH1}''.",cantLoadProfileWhileAnother:"Can’t load profile while another profile is being recorded.",profileLoadingFailedS:"Profile loading failed: {PH1}.",runD:"Run {PH1}",profiles:"Profiles"},er=O("panels/profiler/ProfilesPanel.ts",le),we=L.bind(void 0,er);class pe extends hs{profileTypes;profilesItemTreeElement;sidebarTree;profileViews;toolbarElement;toggleRecordAction;toggleRecordButton;#e;profileViewToolbar;profileGroups;launcherView;visibleView;profileToView;typeIdToSidebarSection;fileSelectorElement;selectedProfileType;constructor(e,t,i){super(e),this.profileTypes=t;const s=new W;this.splitWidget().setMainWidget(s),this.profilesItemTreeElement=new Si(this),this.sidebarTree=new cs,this.sidebarTree.element.classList.add("profiles-sidebar-tree-box"),this.panelSidebarElement().appendChild(this.sidebarTree.element),this.sidebarTree.appendChild(this.profilesItemTreeElement),this.sidebarTree.element.addEventListener("keydown",this.onKeyDown.bind(this),!1),this.profileViews=document.createElement("div"),this.profileViews.id="profile-views",this.profileViews.classList.add("vbox"),s.element.appendChild(this.profileViews),this.toolbarElement=document.createElement("div"),this.toolbarElement.classList.add("profiles-toolbar"),s.element.insertBefore(this.toolbarElement,s.element.firstChild),this.panelSidebarElement().classList.add("profiles-tree-sidebar");const r=document.createElement("div");r.classList.add("profiles-toolbar"),r.setAttribute("jslog",`${Nt("profiles-sidebar")}`),this.panelSidebarElement().insertBefore(r,this.panelSidebarElement().firstChild);const n=new _("",r);n.makeWrappable(!0),this.toggleRecordAction=ye.instance().getAction(i),this.toggleRecordButton=_.createActionButton(this.toggleRecordAction),n.appendToolbarItem(this.toggleRecordButton),n.appendToolbarItem(_.createActionButtonForId("profiler.clear-all")),n.appendSeparator(),n.appendToolbarItem(_.createActionButtonForId("profiler.load-from-file")),this.#e=ye.instance().getAction("profiler.save-to-file"),this.#e.setEnabled(!1),n.appendToolbarItem(_.createActionButton(this.#e)),n.appendSeparator(),n.appendToolbarItem(_.createActionButtonForId("components.collect-garbage")),this.profileViewToolbar=new _("",this.toolbarElement),this.profileViewToolbar.makeWrappable(!0),this.profileViewToolbar.element.setAttribute("jslog",`${Nt("profile-view")}`),this.profileGroups={},this.launcherView=new pi(this),this.launcherView.addEventListener("ProfileTypeSelected",this.onProfileTypeSelected,this),this.profileToView=[],this.typeIdToSidebarSection={};const o=this.profileTypes;for(let l=0;l<o.length;l++)this.registerProfileType(o[l]);this.launcherView.restoreSelectedProfileType(),this.profilesItemTreeElement.select(),this.showLauncherView(),this.createFileSelectorElement(),B.instance().addEventListener("SuspendStateChanged",this.onSuspendStateChanged,this),F.instance().addFlavorChangeListener(Le,this.updateProfileTypeSpecificUI,this),F.instance().addFlavorChangeListener(j,this.updateProfileTypeSpecificUI,this)}onKeyDown(e){const t=e;let i=!1;t.key==="ArrowDown"&&!t.altKey?i=this.sidebarTree.selectNext():t.key==="ArrowUp"&&!t.altKey&&(i=this.sidebarTree.selectPrevious()),i&&t.consume(!0)}searchableView(){const e=this.visibleView;return e&&e.searchableView?e.searchableView():null}createFileSelectorElement(){this.fileSelectorElement&&this.element.removeChild(this.fileSelectorElement),this.fileSelectorElement=ps(this.loadFromFile.bind(this)),this.element.appendChild(this.fileSelectorElement)}findProfileTypeByExtension(e){return this.profileTypes.find(t=>!!t.fileExtension()&&e.endsWith(t.fileExtension()||""))||null}async loadFromFile(e){this.createFileSelectorElement();const t=this.findProfileTypeByExtension(e.name);if(!t){const s=new Set(this.profileTypes.map(r=>r.fileExtension()).filter(r=>r));G.instance().error(we(le.cantLoadFileSupportedFile,{PH1:Array.from(s).join("', '")}));return}if(t.profileBeingRecorded()){G.instance().error(we(le.cantLoadProfileWhileAnother));return}const i=await t.loadFromFile(e);i&&"message"in i&&us.show(we(le.profileLoadingFailedS,{PH1:i.message}),void 0,"profile-loading-failed")}toggleRecord(){if(!this.toggleRecordAction.enabled())return!0;const e=fs(this.element.ownerDocument),t=this.selectedProfileType;if(!t)return!0;const i=t.buttonClicked();return this.updateToggleRecordAction(i),i?(this.launcherView.profileStarted(),t.hasTemporaryView()&&this.showProfile(t.profileBeingRecorded())):this.launcherView.profileFinished(),e&&e.focus(),!0}onSuspendStateChanged(){this.updateToggleRecordAction(this.toggleRecordAction.toggled())}updateToggleRecordAction(e){const t=!!(F.instance().flavor(Le)||F.instance().flavor(j)),i=e||!B.instance().allTargetsSuspended()&&t;this.toggleRecordAction.setEnabled(i),this.toggleRecordAction.setToggled(e),i?this.toggleRecordButton.setTitle(this.selectedProfileType?this.selectedProfileType.buttonTooltip:""):this.toggleRecordButton.setTitle(_t()),this.selectedProfileType&&this.launcherView.updateProfileType(this.selectedProfileType,i)}profileBeingRecordedRemoved(){this.updateToggleRecordAction(!1),this.launcherView.profileFinished()}onProfileTypeSelected(e){this.selectedProfileType=e.data,this.updateProfileTypeSpecificUI()}updateProfileTypeSpecificUI(){this.updateToggleRecordAction(this.toggleRecordAction.toggled())}reset(){this.profileTypes.forEach(e=>e.reset()),delete this.visibleView,this.profileGroups={},this.updateToggleRecordAction(!1),this.launcherView.profileFinished(),this.sidebarTree.element.classList.remove("some-expandable"),this.launcherView.detach(),this.profileViews.removeChildren(),this.profileViewToolbar.removeToolbarItems(),this.profilesItemTreeElement.select(),this.showLauncherView()}showLauncherView(){this.closeVisibleView(),this.profileViewToolbar.removeToolbarItems(),this.launcherView.show(this.profileViews),this.visibleView=this.launcherView,this.toolbarElement.classList.add("hidden"),this.#e.setEnabled(!1)}registerProfileType(e){this.launcherView.addProfileType(e);const t=new mi(this,e);this.typeIdToSidebarSection[e.id]=t,this.sidebarTree.appendChild(t);function i(o){this.addProfileHeader(o.data)}function s(o){this.removeProfileHeader(o.data)}function r(o){this.showProfile(o.data)}e.addEventListener("view-updated",this.updateProfileTypeSpecificUI,this),e.addEventListener("add-profile-header",i,this),e.addEventListener("remove-profile-header",s,this),e.addEventListener("profile-complete",r,this);const n=e.getProfiles();for(let o=0;o<n.length;o++)this.addProfileHeader(n[o])}showLoadFromFileDialog(){this.fileSelectorElement.click()}addProfileHeader(e){const i=e.profileType().id;this.typeIdToSidebarSection[i].addProfileHeader(e),(!this.visibleView||this.visibleView===this.launcherView)&&this.showProfile(e)}removeProfileHeader(e){e.profileType().profileBeingRecorded()===e&&this.profileBeingRecordedRemoved();const t=this.indexOfViewForProfile(e);t!==-1&&this.profileToView.splice(t,1);const i=e.profileType().id;this.typeIdToSidebarSection[i].removeProfileHeader(e)&&(this.profilesItemTreeElement.select(),this.showLauncherView())}showProfile(e){if(!e||e.profileType().profileBeingRecorded()===e&&!e.profileType().hasTemporaryView())return null;const t=this.viewForProfile(e);if(t===this.visibleView)return t;this.closeVisibleView(),F.instance().setFlavor(ce,e),this.#e.setEnabled(e.canSaveToFile()),t.show(this.profileViews),this.toolbarElement.classList.remove("hidden"),this.visibleView=t;const s=this.typeIdToSidebarSection[e.profileType().id].sidebarElementForProfile(e);return s&&s.revealAndSelect(),this.profileViewToolbar.removeToolbarItems(),t.toolbarItems().then(r=>{r.map(n=>this.profileViewToolbar.appendToolbarItem(n))}),t}showObject(e,t){}async linkifyObject(e){return null}viewForProfile(e){const t=this.indexOfViewForProfile(e);if(t!==-1)return this.profileToView[t].view;const i=e.createView(this);return i.element.classList.add("profile-view"),this.profileToView.push({profile:e,view:i}),i}indexOfViewForProfile(e){return this.profileToView.findIndex(t=>t.profile===e)}closeVisibleView(){F.instance().setFlavor(ce,null),this.#e.setEnabled(!1),this.visibleView&&this.visibleView.detach(),delete this.visibleView}focus(){this.sidebarTree.focus()}wasShown(){super.wasShown(),F.instance().setFlavor(pe,this),this.registerCSSFiles([ms,ui,li]),this.sidebarTree.registerCSSFiles([fi])}willHide(){F.instance().setFlavor(pe,null),super.willHide()}}class mi extends Me{dataDisplayDelegate;profileTreeElements;profileGroups;constructor(e,t){super(t.treeItemTitle,!0),this.selectable=!1,this.dataDisplayDelegate=e,this.profileTreeElements=[],this.profileGroups={},this.expand(),this.hidden=!0,this.setCollapsible(!1)}addProfileHeader(e){this.hidden=!1;const t=e.profileType();let i=this;const s=e.createSidebarTreeElement(this.dataDisplayDelegate);if(this.profileTreeElements.push(s),!e.fromFile()&&t.profileBeingRecorded()!==e){const r=e.title;let n=this.profileGroups[r];n||(n=new gi,this.profileGroups[r]=n),n.profileSidebarTreeElements.push(s);const o=n.profileSidebarTreeElements.length;if(o===2){n.sidebarTreeElement=new vi(this.dataDisplayDelegate,e.title);const l=n.profileSidebarTreeElements[0],a=this.children().indexOf(l);this.insertChild(n.sidebarTreeElement,a);const h=l.selected;this.removeChild(l),n.sidebarTreeElement.appendChild(l),h&&l.revealAndSelect(),l.setSmall(!0),l.setMainTitle(we(le.runD,{PH1:1})),this.treeOutline&&this.treeOutline.element.classList.add("some-expandable")}o>=2&&(i=n.sidebarTreeElement,s.setSmall(!0),s.setMainTitle(we(le.runD,{PH1:o})))}i&&i.appendChild(s)}removeProfileHeader(e){const t=this.sidebarElementIndex(e);if(t===-1)return!1;const i=this.profileTreeElements[t];this.profileTreeElements.splice(t,1);let s=this;const r=this.profileGroups[e.title];if(r){const n=r.profileSidebarTreeElements;if(n.splice(n.indexOf(i),1),n.length===1){const o=s.children().indexOf(r.sidebarTreeElement);r.sidebarTreeElement&&r.sidebarTreeElement.removeChild(n[0]),this.insertChild(n[0],o),n[0].setSmall(!1),n[0].setMainTitle(e.title),r.sidebarTreeElement&&this.removeChild(r.sidebarTreeElement)}n.length!==0&&(s=r.sidebarTreeElement)}return s&&s.removeChild(i),i.dispose(),this.childCount()?!1:(this.hidden=!0,!0)}sidebarElementForProfile(e){const t=this.sidebarElementIndex(e);return t===-1?null:this.profileTreeElements[t]}sidebarElementIndex(e){const t=this.profileTreeElements;for(let i=0;i<t.length;i++)if(t[i].profile===e)return i;return-1}onattach(){this.listItemElement.classList.add("profiles-tree-section")}}class gi{profileSidebarTreeElements;sidebarTreeElement;constructor(){this.profileSidebarTreeElements=[],this.sidebarTreeElement=null}}class vi extends Me{dataDisplayDelegate;profileTitle;toggleOnClick;constructor(e,t){super("",!0),this.selectable=!1,this.dataDisplayDelegate=e,this.profileTitle=t,this.expand(),this.toggleOnClick=!0}onselect(){const e=this.childCount()>0;if(e){const t=this.lastChild();t instanceof We&&this.dataDisplayDelegate.showProfile(t.profile)}return e}onattach(){this.listItemElement.classList.add("profile-group-sidebar-tree-item"),this.listItemElement.createChild("div","icon"),this.listItemElement.createChild("div","titles no-subtitle").createChild("span","title-container").createChild("span","title").textContent=this.profileTitle}}class Si extends Me{panel;constructor(e){super("",!1),this.selectable=!0,this.panel=e}onselect(){return this.panel.showLauncherView(),!0}onattach(){this.listItemElement.classList.add("profile-launcher-view-tree-item"),this.listItemElement.createChild("div","titles no-subtitle").createChild("span","title-container").createChild("span","title").textContent=we(le.profiles),this.setLeadingIcons([tt("tune")])}}let tr=class{handleAction(e,t){switch(t){case"profiler.clear-all":{const i=e.flavor(pe);return i!==null?(i.reset(),!0):!1}case"profiler.load-from-file":{const i=e.flavor(pe);return i!==null?(i.showLoadFromFileDialog(),!0):!1}case"profiler.save-to-file":{const i=e.flavor(ce);return i!==null?(i.saveToFile(),!0):!1}case"profiler.delete-profile":{const i=e.flavor(ce);return i!==null?(i.profileType().removeProfile(i),!0):!1}}return!1}};const pn=Object.freeze(Object.defineProperty({__proto__:null,ActionDelegate:tr,ProfileGroup:gi,ProfileGroupSidebarTreeElement:vi,ProfileTypeSidebarSection:mi,ProfilesPanel:pe,ProfilesSidebarTreeElement:Si},Symbol.toStringTag,{value:"Module"})),Fe={detachedNodes:"Detached nodes",nodeSize:"Node count",detachedElementsList:"Detached elements list"},ir=O("panels/profiler/HeapDetachedElementsDataGrid.ts",Fe),Ze=L.bind(void 0,ir);class sr extends gt{constructor(){const e=[];e.push({id:"detached-node",title:Ze(Fe.detachedNodes),sortable:!1}),e.push({id:"detached-node-count",title:Ze(Fe.nodeSize),sortable:!1,disclosure:!0}),super({displayName:Ze(Fe.detachedElementsList),columns:e,editCallback:void 0,deleteCallback:void 0,refreshCallback:void 0}),this.setStriped(!0)}}class rr extends ut{detachedElementInfo;domModel;retainedNodeIds=new Set;constructor(e,t){super(null),this.detachedElementInfo=e,this.domModel=t;for(const i of e.retainedNodeIds)this.retainedNodeIds.add(i)}createCell(e){const t=this.createTD(e);switch(e){case"detached-node":{const i=gs.create(this.domModel,null,!1,this.detachedElementInfo.treeNode);return t.appendChild(this.#t(i)),t}case"detached-node-count":{const i=this.#e(this.detachedElementInfo);return ft(t,i.toString()),t}}return t}#e(e){let t=1;const i=[];let s;for(i.push(e.treeNode);i.length>0&&(s=i.shift(),!!s);)if(s.childNodeCount&&(t+=s.childNodeCount),s.children)for(const r of s.children)i.push(r);return t}#t(e){const t=new Vs(!1,!1,!0);t.rootDOMNode=e;const i=t.firstChild();(!i||i&&!i.isExpandable())&&t.element.classList.add("single-node"),t.setVisible(!0),t.element.treeElementForTest=i,t.setShowSelectionOnKeyboardFocus(!0,!0);const s=[e];for(;s.length>0;){const r=s.shift(),n=r.children();if(n)for(const l of n)s.push(l);const o=t.findTreeElement(r);if(o)if(this.retainedNodeIds.has(r.backendNodeId())){const l=new Vt;l.data={iconName:"small-status-dot",color:"var(--icon-error)",width:"12px",height:"12px"},l.style.setProperty("vertical-align","middle"),o.setLeadingIcons([l]),o.listItemNode.classList.add("detached-elements-detached-node"),o.listItemNode.style.setProperty("display","-webkit-box"),o.listItemNode.setAttribute("title","Retained Node")}else o.listItemNode.setAttribute("title","Node")}return t.findTreeElement(e)?.listItemNode.setAttribute("title","Detached Tree Node"),t.element}}let me=null;class Ue{colorGeneratorInternal;maxStackDepthInternal;timelineDataInternal;entryNodes;#e;boldFont;constructor(){this.colorGeneratorInternal=Ue.colorGenerator(),this.maxStackDepthInternal=0,this.timelineDataInternal=null,this.entryNodes=[],this.#e=`${Ws} ${Us()}`}static colorGenerator(){return me||(me=new vs({min:30,max:330,count:void 0},{min:50,max:80,count:5},{min:80,max:90,count:3}),me.setColorForID("(idle)","hsl(0, 0%, 94%)"),me.setColorForID("(program)","hsl(0, 0%, 80%)"),me.setColorForID("(garbage collector)","hsl(0, 0%, 80%)")),me}minimumBoundary(){throw"Not implemented."}totalTime(){throw"Not implemented."}formatValue(e,t){return Ss(e,t)}maxStackDepth(){return this.maxStackDepthInternal}hasTrackConfigurationMode(){return!1}timelineData(){return this.timelineDataInternal||this.calculateTimelineData()}calculateTimelineData(){throw"Not implemented."}prepareHighlightedEntryInfo(e){throw"Not implemented."}canJumpToEntry(e){return this.entryNodes[e].scriptId!=="0"}entryTitle(e){const t=this.entryNodes[e];return je(t.functionName)}entryFont(e){const t="bold "+this.#e;return this.entryHasDeoptReason(e)?t:this.#e}entryHasDeoptReason(e){throw"Not implemented."}entryColor(e){const t=this.entryNodes[e];return this.colorGeneratorInternal.colorForID(t.url||(t.scriptId!=="0"?t.scriptId:t.functionName))}decorateEntry(e,t,i,s,r,n,o){return!1}forceDecoration(e){return!1}textColor(e){return"#333"}entryNodesLength(){return this.entryNodes.length}}class wi extends X(W){searchableView;overviewPane;mainPane;entrySelected;dataProvider;searchResults;searchResultIndex=-1;constructor(e,t){super(),this.element.id="cpu-flame-chart",this.searchableView=e,this.overviewPane=new Ci(t),this.overviewPane.show(this.element),this.mainPane=new _s(t,this.overviewPane),this.mainPane.setBarHeight(15),this.mainPane.setTextBaseline(4),this.mainPane.setTextPadding(2),this.mainPane.show(this.element),this.mainPane.addEventListener("EntrySelected",this.onEntrySelected,this),this.mainPane.addEventListener("EntryInvoked",this.onEntryInvoked,this),this.entrySelected=!1,this.mainPane.addEventListener("CanvasFocused",this.onEntrySelected,this),this.overviewPane.addEventListener("WindowChanged",this.onWindowChanged,this),this.dataProvider=t,this.searchResults=[]}focus(){this.mainPane.focus()}onWindowChanged(e){const{windowTimeLeft:t,windowTimeRight:i}=e.data;this.mainPane.setWindowTimes(t,i,!0)}selectRange(e,t){this.overviewPane.selectRange(e,t)}onEntrySelected(e){if(e.data){const t=e.data;this.mainPane.setSelectedEntry(t),t===-1?this.entrySelected=!1:this.entrySelected=!0}else this.entrySelected||(this.mainPane.setSelectedEntry(0),this.entrySelected=!0)}onEntryInvoked(e){this.onEntrySelected(e),this.dispatchEventToListeners("EntryInvoked",e.data)}update(){this.overviewPane.update(),this.mainPane.update()}performSearch(e,t,i){const s=Wt(e.query,e.caseSensitive?"":"i"),r=this.searchResultIndex!==-1?this.searchResults[this.searchResultIndex]:-1;this.searchResults=[];const n=this.dataProvider.entryNodesLength();for(let o=0;o<n;++o)this.dataProvider.entryTitle(o).match(s)&&this.searchResults.push(o);this.searchResults.length?(this.searchResultIndex=this.searchResults.indexOf(r),this.searchResultIndex===-1&&(this.searchResultIndex=i?this.searchResults.length-1:0),this.mainPane.setSelectedEntry(this.searchResults[this.searchResultIndex])):this.onSearchCanceled(),this.searchableView.updateSearchMatchesCount(this.searchResults.length),this.searchableView.updateCurrentMatchIndex(this.searchResultIndex)}onSearchCanceled(){this.mainPane.setSelectedEntry(-1),this.searchResults=[],this.searchResultIndex=-1}jumpToNextSearchResult(){this.searchResultIndex=(this.searchResultIndex+1)%this.searchResults.length,this.mainPane.setSelectedEntry(this.searchResults[this.searchResultIndex]),this.searchableView.updateCurrentMatchIndex(this.searchResultIndex)}jumpToPreviousSearchResult(){this.searchResultIndex=(this.searchResultIndex-1+this.searchResults.length)%this.searchResults.length,this.mainPane.setSelectedEntry(this.searchResults[this.searchResultIndex]),this.searchableView.updateCurrentMatchIndex(this.searchResultIndex)}supportsCaseSensitiveSearch(){return!0}supportsRegexSearch(){return!1}}let bi=class{formatter;minimumBoundaries;maximumBoundaries;xScaleFactor;constructor(e){this.formatter=e}updateBoundaries(e){this.minimumBoundaries=e.dataProvider.minimumBoundary();const t=e.dataProvider.totalTime();this.maximumBoundaries=this.minimumBoundaries+t,this.xScaleFactor=e.overviewContainer.clientWidth/t}computePosition(e){return(e-this.minimumBoundaries)*this.xScaleFactor}formatValue(e,t){return this.formatter(e-this.minimumBoundaries,t)}maximumBoundary(){return this.maximumBoundaries}minimumBoundary(){return this.minimumBoundaries}zeroTime(){return this.minimumBoundaries}boundarySpan(){return this.maximumBoundaries-this.minimumBoundaries}};class Ci extends X(W){overviewContainer;overviewCalculator;overviewGrid;overviewCanvas;dataProvider;windowTimeLeft;windowTimeRight;updateTimerId;constructor(e){super(),this.element.classList.add("cpu-profile-flame-chart-overview-pane"),this.overviewContainer=this.element.createChild("div","cpu-profile-flame-chart-overview-container"),this.overviewCalculator=new bi(e.formatValue),this.overviewGrid=new ni("cpu-profile-flame-chart",this.overviewCalculator),this.overviewGrid.element.classList.add("fill"),this.overviewCanvas=this.overviewContainer.createChild("canvas","cpu-profile-flame-chart-overview-canvas"),this.overviewContainer.appendChild(this.overviewGrid.element),this.dataProvider=e,this.overviewGrid.addEventListener("WindowChangedWithPosition",this.onWindowChanged,this)}windowChanged(e,t){this.selectRange(e,t)}updateRangeSelection(e,t){}updateSelectedGroup(e,t){}selectRange(e,t){const i=this.dataProvider.minimumBoundary(),s=this.dataProvider.totalTime();this.overviewGrid.setWindow((e-i)/s,(t-i)/s)}onWindowChanged(e){const t={windowTimeLeft:e.data.rawStartValue,windowTimeRight:e.data.rawEndValue};this.windowTimeLeft=t.windowTimeLeft,this.windowTimeRight=t.windowTimeRight,this.dispatchEventToListeners("WindowChanged",t)}timelineData(){return this.dataProvider.timelineData()}onResize(){this.scheduleUpdate()}scheduleUpdate(){this.updateTimerId||(this.updateTimerId=this.element.window().requestAnimationFrame(this.update.bind(this)))}update(){this.updateTimerId=0,this.timelineData()&&(this.resetCanvas(this.overviewContainer.clientWidth,this.overviewContainer.clientHeight-$s),this.overviewCalculator.updateBoundaries(this),this.overviewGrid.updateDividers(this.overviewCalculator),this.drawOverviewCanvas())}drawOverviewCanvas(){const e=this.overviewCanvas.width,t=this.overviewCanvas.height,i=this.calculateDrawData(e),s=this.overviewCanvas.getContext("2d");if(!s)throw new Error("Failed to get canvas context");const n=window.devicePixelRatio,o=1,l=t/(this.dataProvider.maxStackDepth()*1.1);s.lineWidth=o,s.translate(.5,.5),s.strokeStyle="rgba(20,0,0,0.4)",s.fillStyle="rgba(214,225,254,0.8)",s.moveTo(-o,t+o),s.lineTo(-o,Math.round(t-i[0]*l-n));let a=0;for(let h=0;h<e;++h)a=Math.round(t-i[h]*l-n),s.lineTo(h,a);s.lineTo(e+o,a),s.lineTo(e+o,t+o),s.fill(),s.stroke(),s.closePath()}calculateDrawData(e){const t=this.dataProvider,i=this.timelineData(),s=i.entryStartTimes,r=i.entryTotalTimes,n=i.entryLevels,o=s.length,l=this.dataProvider.minimumBoundary(),a=new Uint8Array(e),h=e/t.totalTime();for(let m=0;m<o;++m){const g=Math.floor((s[m]-l)*h),c=Math.floor((s[m]-l+r[m])*h);for(let p=g;p<=c;++p)a[p]=Math.max(a[p],n[m]+1)}return a}resetCanvas(e,t){const i=window.devicePixelRatio;this.overviewCanvas.width=e*i,this.overviewCanvas.height=t*i,this.overviewCanvas.style.width=e+"px",this.overviewCanvas.style.height=t+"px"}}const fn=Object.freeze(Object.defineProperty({__proto__:null,OverviewCalculator:bi,OverviewPane:Ci,ProfileFlameChart:wi,ProfileFlameChartDataProvider:Ue},Symbol.toStringTag,{value:"Module"}));class de extends V{remainingChildren;constructor(e,t){const i=!!(e.children&&e.children.length);super(e,t,i),this.remainingChildren=e.children}static sharedPopulate(e){const t=e.remainingChildren,i=t.length;for(let s=0;s<i;++s)e.appendChild(new de(t[s],e.tree));e.remainingChildren=[]}static excludeRecursively(e,t){e.remainingChildren.length>0&&e.populate(),e.save();const i=e.children;let s=e.children.length;for(;s--;)de.excludeRecursively(i[s],t);const r=e.childrenByCallUID.get(t);r&&V.merge(e,r,!0)}populateChildren(){de.sharedPopulate(this)}}class Ii extends Ge{remainingChildren;constructor(e,t,i,s){super(e,t,s),this.remainingChildren=i.children,V.populate(this)}focus(e){e&&(this.save(),e.savePosition(),this.children=[e],this.total=e.total)}exclude(e){e&&(this.save(),de.excludeRecursively(this,e.callUID),this.lastComparator&&this.sort(this.lastComparator,!0))}restore(){this.savedChildren&&(this.children[0].restorePosition(),super.restore())}populateChildren(){de.sharedPopulate(this)}}const mn=Object.freeze(Object.defineProperty({__proto__:null,TopDownProfileDataGridNode:de,TopDownProfileDataGridTree:Ii},Symbol.toStringTag,{value:"Module"})),R={profile:"Profile",findByCostMsNameOrFile:"Find by cost (>50ms), name or file",function:"Function",profiler:"Profiler",profileViewMode:"Profile view mode",focusSelectedFunction:"Focus selected function",excludeSelectedFunction:"Exclude selected function",restoreAllFunctions:"Restore all functions",chart:"Chart",heavyBottomUp:"Heavy (Bottom Up)",treeTopDown:"Tree (Top Down)",profileD:"Profile {PH1}",loadingD:"Loading… {PH1}%",fileSReadErrorS:"File ''{PH1}'' read error: {PH2}",loading:"Loading…",failedToReadFile:"Failed to read file",parsing:"Parsing…",loaded:"Loaded"},nr=O("panels/profiler/ProfileView.ts",R),k=L.bind(void 0,nr);class wt extends vt{profileInternal;searchableViewInternal;dataGrid;viewSelectComboBox;focusButton;excludeButton;resetButton;linkifierInternal;nodeFormatter;viewType;adjustedTotal;profileHeader;bottomUpProfileDataGridTree;topDownProfileDataGridTree;currentSearchResultIndex;dataProvider;flameChart;visibleView;searchableElement;profileDataGridTree;constructor(){super(k(R.profile)),this.profileInternal=null,this.searchableViewInternal=new Yt(this,null),this.searchableViewInternal.setPlaceholder(k(R.findByCostMsNameOrFile)),this.searchableViewInternal.show(this.element);const e=[];e.push({id:"self",title:this.columnHeader("self"),width:"120px",fixedWidth:!0,sortable:!0,sort:Q.Descending,titleDOMFragment:void 0,align:void 0,editable:void 0,nonSelectable:void 0,longText:void 0,disclosure:void 0,weight:void 0,allowInSortByEvenWhenHidden:void 0,dataType:void 0,defaultWeight:void 0}),e.push({id:"total",title:this.columnHeader("total"),width:"120px",fixedWidth:!0,sortable:!0,sort:void 0,titleDOMFragment:void 0,align:void 0,editable:void 0,nonSelectable:void 0,longText:void 0,disclosure:void 0,weight:void 0,allowInSortByEvenWhenHidden:void 0,dataType:void 0,defaultWeight:void 0}),e.push({id:"function",title:k(R.function),disclosure:!0,sortable:!0,sort:void 0,titleDOMFragment:void 0,align:void 0,editable:void 0,nonSelectable:void 0,longText:void 0,weight:void 0,allowInSortByEvenWhenHidden:void 0,dataType:void 0,defaultWeight:void 0,width:void 0,fixedWidth:void 0}),this.dataGrid=new gt({displayName:k(R.profiler),columns:e,editCallback:void 0,deleteCallback:void 0,refreshCallback:void 0}),this.dataGrid.addEventListener("SortingChanged",this.sortProfile,this),this.dataGrid.addEventListener("SelectedNode",this.nodeSelected.bind(this,!0)),this.dataGrid.addEventListener("DeselectedNode",this.nodeSelected.bind(this,!1)),this.dataGrid.setRowContextMenuCallback(this.populateContextMenu.bind(this)),this.viewSelectComboBox=new De(this.changeView.bind(this),k(R.profileViewMode),void 0,"profile-view.selected-view"),this.focusButton=new ke(k(R.focusSelectedFunction),"eye",void 0,"profile-view.focus-selected-function"),this.focusButton.setEnabled(!1),this.focusButton.addEventListener("Click",this.focusClicked,this),this.excludeButton=new ke(k(R.excludeSelectedFunction),"cross",void 0,"profile-view.exclude-selected-function"),this.excludeButton.setEnabled(!1),this.excludeButton.addEventListener("Click",this.excludeClicked,this),this.resetButton=new ke(k(R.restoreAllFunctions),"refresh",void 0,"profile-view.restore-all-functions"),this.resetButton.setEnabled(!1),this.resetButton.addEventListener("Click",this.resetClicked,this),this.linkifierInternal=new oe(yi)}static buildPopoverTable(e){const t=document.createElement("table");for(const i of e){const s=t.createChild("tr");s.createChild("td").textContent=i.title,s.createChild("td").textContent=i.value}return t}setProfile(e){this.profileInternal=e,this.bottomUpProfileDataGridTree=null,this.topDownProfileDataGridTree=null,this.changeView(),this.refresh()}profile(){return this.profileInternal}initialize(e){this.nodeFormatter=e,this.viewType=Te.instance().createSetting("profile-view","Heavy");const t=["Flame","Heavy","Tree"],i=new Map([["Flame",k(R.chart)],["Heavy",k(R.heavyBottomUp)],["Tree",k(R.treeTopDown)]]),s=new Map(t.map(o=>[o,this.viewSelectComboBox.createOption(i.get(o),o)])),r=this.viewType.get()||t[0],n=s.get(r)||s.get(t[0]);this.viewSelectComboBox.select(n),this.changeView(),this.flameChart&&this.flameChart.update()}focus(){this.flameChart?this.flameChart.focus():super.focus()}columnHeader(e){throw"Not implemented"}selectRange(e,t){this.flameChart&&this.flameChart.selectRange(e,t)}async toolbarItems(){return[this.viewSelectComboBox,this.focusButton,this.excludeButton,this.resetButton]}getBottomUpProfileDataGridTree(){return this.bottomUpProfileDataGridTree||(this.bottomUpProfileDataGridTree=new ai(this.nodeFormatter,this.searchableViewInternal,this.profileInternal.root,this.adjustedTotal)),this.bottomUpProfileDataGridTree}getTopDownProfileDataGridTree(){return this.topDownProfileDataGridTree||(this.topDownProfileDataGridTree=new Ii(this.nodeFormatter,this.searchableViewInternal,this.profileInternal.root,this.adjustedTotal)),this.topDownProfileDataGridTree}populateContextMenu(e,t){const i=t;i.linkElement&&e.appendApplicableItems(i.linkElement)}willHide(){this.currentSearchResultIndex=-1}refresh(){if(!this.profileDataGridTree)return;const e=this.dataGrid.selectedNode?this.dataGrid.selectedNode.profileNode:null;this.dataGrid.rootNode().removeChildren();const t=this.profileDataGridTree.children,i=t.length;for(let s=0;s<i;++s)this.dataGrid.rootNode().appendChild(t[s]);e&&(e.selected=!0)}refreshVisibleData(){let e=this.dataGrid.rootNode().children[0];for(;e;)e.refresh(),e=e.traverseNextNode(!1,null,!0)}searchableView(){return this.searchableViewInternal}supportsCaseSensitiveSearch(){return!0}supportsRegexSearch(){return!1}onSearchCanceled(){this.searchableElement&&this.searchableElement.onSearchCanceled()}performSearch(e,t,i){this.searchableElement&&this.searchableElement.performSearch(e,t,i)}jumpToNextSearchResult(){this.searchableElement&&this.searchableElement.jumpToNextSearchResult()}jumpToPreviousSearchResult(){this.searchableElement&&this.searchableElement.jumpToPreviousSearchResult()}linkifier(){return this.linkifierInternal}createFlameChartDataProvider(){throw"Not implemented"}ensureFlameChartCreated(){this.flameChart||(this.dataProvider=this.createFlameChartDataProvider(),this.flameChart=new wi(this.searchableViewInternal,this.dataProvider),this.flameChart.addEventListener("EntryInvoked",e=>{this.onEntryInvoked(e)}))}async onEntryInvoked(e){if(!this.dataProvider)return;const t=e.data,i=this.dataProvider.entryNodes[t],s=this.profileHeader.debuggerModel;if(!i||!i.scriptId||!s)return;const r=s.scriptForId(i.scriptId);if(!r)return;const n=s.createRawLocation(r,i.lineNumber,i.columnNumber),o=await ws.instance().rawLocationToUILocation(n);Xt(o)}changeView(){if(!this.profileInternal)return;switch(this.searchableViewInternal.closeSearch(),this.visibleView&&this.visibleView.detach(),this.viewType.set(this.viewSelectComboBox.selectedOption().value),this.viewType.get()){case"Flame":this.ensureFlameChartCreated(),this.visibleView=this.flameChart,this.searchableElement=this.flameChart;break;case"Tree":this.profileDataGridTree=this.getTopDownProfileDataGridTree(),this.sortProfile(),this.visibleView=this.dataGrid.asWidget(),this.searchableElement=this.profileDataGridTree;break;case"Heavy":this.profileDataGridTree=this.getBottomUpProfileDataGridTree(),this.sortProfile(),this.visibleView=this.dataGrid.asWidget(),this.searchableElement=this.profileDataGridTree;break}const e=this.viewType.get()==="Flame";this.focusButton.setVisible(!e),this.excludeButton.setVisible(!e),this.resetButton.setVisible(!e),this.visibleView&&this.visibleView.show(this.searchableViewInternal.element)}nodeSelected(e){this.focusButton.setEnabled(e),this.excludeButton.setEnabled(e)}focusClicked(){this.dataGrid.selectedNode&&(this.resetButton.setEnabled(!0),this.resetButton.element.focus(),this.profileDataGridTree&&this.profileDataGridTree.focus(this.dataGrid.selectedNode),this.refresh(),this.refreshVisibleData(),ze.actionTaken(it.CpuProfileNodeFocused))}excludeClicked(){const e=this.dataGrid.selectedNode;e&&(this.resetButton.setEnabled(!0),this.resetButton.element.focus(),e.deselect(),this.profileDataGridTree&&this.profileDataGridTree.exclude(e),this.refresh(),this.refreshVisibleData(),ze.actionTaken(it.CpuProfileNodeExcluded))}resetClicked(){this.viewSelectComboBox.selectElement().focus(),this.resetButton.setEnabled(!1),this.profileDataGridTree&&this.profileDataGridTree.restore(),this.linkifierInternal.reset(),this.refresh(),this.refreshVisibleData()}sortProfile(){if(!this.profileDataGridTree)return;const e=this.dataGrid.isSortOrderAscending(),t=this.dataGrid.sortColumnId(),i=t==="function"?"functionName":t||"";this.profileDataGridTree.sort(Ge.propertyComparator(i,e),!1),this.refresh()}}const yi=30;class bt extends ce{debuggerModel;fileName;jsonifiedProfile;profile;protocolProfileInternal;#e;#t=()=>{};constructor(e,t,i){super(t,i||k(R.profileD,{PH1:t.nextProfileUid()})),this.debuggerModel=e,this.#e=new Promise(s=>{this.#t=s})}onChunkTransferred(e){this.jsonifiedProfile&&this.updateStatus(k(R.loadingD,{PH1:J(this.jsonifiedProfile.length)}))}onError(e){const t=e.error();t&&this.updateStatus(k(R.fileSReadErrorS,{PH1:e.fileName(),PH2:t.message}))}async write(e){this.jsonifiedProfile+=e}async close(){}dispose(){this.removeTempFile()}createSidebarTreeElement(e){return new We(e,this,"profile-sidebar-tree-item")}canSaveToFile(){return!this.fromFile()}async saveToFile(){await this.#e;const e=new Zt;if(!this.fileName){const s=qt(new Date),r=this.profileType().fileExtension();this.fileName=`${this.profileType().typeName()}-${s}${r}`}if(!await e.open(this.fileName)||!this.tempFile)return;const i=await this.tempFile.read();i&&await e.write(i),e.close()}async loadFromFile(e){this.updateStatus(k(R.loading),!0);const t=new pt(e,1e7,this.onChunkTransferred.bind(this));if(this.jsonifiedProfile="",!await t.read(this))return this.onError(t),new Error(k(R.failedToReadFile));this.updateStatus(k(R.parsing),!0);let s=null;try{this.profile=JSON.parse(this.jsonifiedProfile),this.setProfile(this.profile),this.updateStatus(k(R.loaded),!1)}catch(r){s=r,this.profileType().removeProfile(this)}return this.jsonifiedProfile=null,this.profileType().profileBeingRecorded()===this&&this.profileType().setProfileBeingRecorded(null),s}setProtocolProfile(e){this.setProfile(e),this.protocolProfileInternal=e,this.tempFile=new oi,this.tempFile.write([JSON.stringify(e)]),this.#t()}}const gn=Object.freeze(Object.defineProperty({__proto__:null,ProfileView:wt,WritableProfileHeader:bt,maxLinkLength:yi},Symbol.toStringTag,{value:"Module"})),K={startDetachedElements:"Obtain detached elements",detachedElementsTitle:"Detached elements",detachedElementsDescription:"Detached elements shows objects that are retained by a JS reference.",detachedElementProfile:"Detached elements {PH1}"},or=O("panels/profiler/HeapDetachedElementsView.ts",K),se=L.bind(void 0,or);class ar extends vt{selectedSizeText;dataGrid;profile;parentDataDisplayDelegate;constructor(e,t){super(se(K.detachedElementsTitle)),this.element.classList.add("detached-elements-view"),this.profile=t,this.parentDataDisplayDelegate=e,this.selectedSizeText=new St,this.dataGrid=new sr,this.populateElementsGrid(t.detachedElements),this.dataGrid.asWidget().show(this.element)}showProfile(e){return this.parentDataDisplayDelegate.showProfile(e)}showObject(e,t){this.parentDataDisplayDelegate.showObject(e,t)}async linkifyObject(){return null}populateElementsGrid(e){if(!e)return;const i=this.profile.heapProfilerModel()?.target().model(Qt);if(i)for(const s of e)this.dataGrid.rootNode().appendChild(new rr(s,i))}async toolbarItems(){return[...await super.toolbarItems(),this.selectedSizeText]}}class lr extends X(Ve){constructor(e,t){super(e||se(K.detachedElementsTitle),t||se(K.detachedElementsTitle))}profileBeingRecorded(){return super.profileBeingRecorded()}get buttonTooltip(){return se(K.startDetachedElements)}buttonClicked(){return this.getDetachedElements(),!1}async getDetachedElements(){if(this.profileBeingRecorded())return;const e=F.instance().flavor(j),t=e?.target(),i=t?.model(Qt);if(!e||!t||!i)return;const s=await i.getDetachedDOMNodes(),r=new dr(e,this,s);this.addProfile(r),this.dispatchEventToListeners("profile-complete",r)}get treeItemTitle(){return se(K.detachedElementsTitle)}get description(){return se(K.detachedElementsDescription)}static TypeId="DetachedElements"}class dr extends bt{heapProfilerModelInternal;detachedElements;constructor(e,t,i,s){super(e&&e.debuggerModel(),t,s||se(K.detachedElementProfile,{PH1:t.nextProfileUid()})),this.detachedElements=i,this.heapProfilerModelInternal=e}createView(e){return new ar(e,this)}heapProfilerModel(){return this.heapProfilerModelInternal}profileType(){return super.profileType()}}class Ct extends X(W){overviewCalculator;overviewContainer;overviewGrid;overviewCanvas;windowLeft;windowRight;yScale;xScale;profileSamples;running;updateOverviewCanvas;updateGridTimerId;updateTimerId;windowWidth;constructor(){super(),this.element.id="heap-recording-view",this.element.classList.add("heap-tracking-overview"),this.element.setAttribute("jslog",`${bs("heap-tracking-overview")}`),this.overviewCalculator=new Pi,this.overviewContainer=this.element.createChild("div","heap-overview-container"),this.overviewGrid=new ni("heap-recording",this.overviewCalculator),this.overviewGrid.element.classList.add("fill"),this.overviewCanvas=this.overviewContainer.createChild("canvas","heap-recording-overview-canvas"),this.overviewContainer.appendChild(this.overviewGrid.element),this.overviewGrid.addEventListener("WindowChanged",this.onWindowChanged,this),this.windowLeft=0,this.windowRight=1,this.overviewGrid.setWindow(this.windowLeft,this.windowRight),this.yScale=new at,this.xScale=new at,this.profileSamples=new _e}start(){this.running=!0;const e=()=>{this.update(),this.running&&this.element.window().requestAnimationFrame(e)};e()}stop(){this.running=!1}setSamples(e){this.profileSamples=e,this.running||this.update()}drawOverviewCanvas(e,t){if(!this.profileSamples)return;const i=this.profileSamples,s=i.sizes,r=i.max,n=i.timestamps,o=n[0],l=this.xScale.nextScale(e/i.totalTime);let a=0;function h(I,T){let A=0,ee=0;for(let ue=1;ue<n.length;++ue){const Et=Math.floor((n[ue]-o)*l);Et!==ee&&(A&&T(ee,A),A=0,ee=Et),A+=I[ue]}T(ee,A)}function m(I,T){a=Math.max(a,T)}h(s,m);const g=this.yScale.nextScale(a?t/(a*1.1):0);this.overviewCanvas.width=e*window.devicePixelRatio,this.overviewCanvas.height=t*window.devicePixelRatio,this.overviewCanvas.style.width=e+"px",this.overviewCanvas.style.height=t+"px";const c=this.overviewCanvas.getContext("2d");if(!c)throw new Error("Failed to get canvas context");const p=c;if(p.scale(window.devicePixelRatio,window.devicePixelRatio),this.running){p.beginPath(),p.lineWidth=2,p.strokeStyle="rgba(192, 192, 192, 0.6)";const I=(Date.now()-o)*l;p.moveTo(I,t-1),p.lineTo(I,0),p.stroke(),p.closePath()}let N=0,P;const y=14;if(g){const I=(t-y)/g;P=Math.pow(1024,Math.floor(Math.log(I)/Math.log(1024))),P*=Math.pow(10,Math.floor(Math.log(I/P)/Math.LN10)),P*5<=I&&(P*=5),N=Math.round(t-P*g-.5)+.5,p.beginPath(),p.lineWidth=1,p.strokeStyle="rgba(0, 0, 0, 0.2)",p.moveTo(0,N),p.lineTo(e,N),p.stroke(),p.closePath()}function q(I,T){p.moveTo(I,t-1),p.lineTo(I,Math.round(t-T*g-1))}if(p.beginPath(),p.lineWidth=2,p.strokeStyle="rgba(192, 192, 192, 0.6)",h(r,q),p.stroke(),p.closePath(),p.beginPath(),p.lineWidth=2,p.strokeStyle="rgba(0, 0, 192, 0.8)",h(s,q),p.stroke(),p.closePath(),P){const I=J(P),T=4,A=0,ee=N-.5,ue=2*T+p.measureText(I).width;p.beginPath(),p.textBaseline="bottom",p.font="10px "+window.getComputedStyle(this.element,null).getPropertyValue("font-family"),p.fillStyle="rgba(255, 255, 255, 0.75)",p.fillRect(A,ee-y,ue,y),p.fillStyle="rgb(64, 64, 64)",p.fillText(I,A+T,ee),p.fill(),p.closePath()}}onResize(){this.updateOverviewCanvas=!0,this.scheduleUpdate()}onWindowChanged(){this.updateGridTimerId||(this.updateGridTimerId=window.setTimeout(this.updateGrid.bind(this),10))}scheduleUpdate(){this.updateTimerId||(this.updateTimerId=window.setTimeout(this.update.bind(this),10))}updateBoundaries(){this.windowLeft=this.overviewGrid.windowLeft(),this.windowRight=this.overviewGrid.windowRight(),this.windowWidth=this.windowRight-this.windowLeft}update(){this.updateTimerId=null,this.isShowing()&&(this.updateBoundaries(),this.overviewCalculator.updateBoundaries(this),this.overviewGrid.updateDividers(this.overviewCalculator),this.drawOverviewCanvas(this.overviewContainer.clientWidth,this.overviewContainer.clientHeight-20))}updateGrid(){this.updateGridTimerId=0,this.updateBoundaries();const e=this.profileSamples.ids;if(!e.length)return;const t=this.profileSamples.timestamps,i=this.profileSamples.sizes,s=t[0],r=this.profileSamples.totalTime,n=s+r*this.windowLeft,o=s+r*this.windowRight,l=Cs(t,n,st),a=Kt(t,o,st);let h=0;for(let c=l;c<a;++c)h+=i[c];const m=l>0?e[l-1]:0,g=a<e.length?e[a]:1/0;this.dispatchEventToListeners("IdsRangeChanged",{minId:m,maxId:g,size:h})}}class at{lastUpdate;currentScale;constructor(){this.lastUpdate=0,this.currentScale=0}nextScale(e){if(e=e||this.currentScale,this.currentScale){const t=Date.now(),i=t-this.lastUpdate;this.lastUpdate=t;const r=Math.pow(20,i/1e3),n=e/this.currentScale;this.currentScale*=Is(n,1/r,r)}else this.currentScale=e;return this.currentScale}}class _e{sizes;ids;timestamps;max;totalTime;constructor(){this.sizes=[],this.ids=[],this.timestamps=[],this.max=[],this.totalTime=3e4}}class Pi{maximumBoundaries;minimumBoundaries;xScaleFactor;constructor(){this.maximumBoundaries=0,this.minimumBoundaries=0,this.xScaleFactor=0}updateBoundaries(e){this.minimumBoundaries=0,this.maximumBoundaries=e.profileSamples.totalTime,this.xScaleFactor=e.overviewContainer.clientWidth/this.maximumBoundaries}computePosition(e){return(e-this.minimumBoundaries)*this.xScaleFactor}formatValue(e,t){return ys(e/1e3,!!t)}maximumBoundary(){return this.maximumBoundaries}minimumBoundary(){return this.minimumBoundaries}zeroTime(){return this.minimumBoundaries}boundarySpan(){return this.maximumBoundaries-this.minimumBoundaries}}const vn=Object.freeze(Object.defineProperty({__proto__:null,HeapTimelineOverview:Ct,OverviewCalculator:Pi,Samples:_e,SmoothScale:at},Symbol.toStringTag,{value:"Module"})),E={selectedSizeS:"Selected size: {PH1}",selfSizeBytes:"Self size (bytes)",totalSizeBytes:"Total size (bytes)",stopHeapProfiling:"Stop heap profiling",startHeapProfiling:"Start heap profiling",recording:"Recording…",heapProfilerIsRecording:"Heap profiler is recording",stopping:"Stopping…",allocationSampling:"Allocation sampling",samplingProfiles:"Sampling profiles",recordMemoryAllocations:"Approximate memory allocations by sampling long operations with minimal overhead and get a breakdown by JavaScript execution stack",profileD:"Profile {PH1}",sBytes:"{PH1} bytes",formatPercent:"{PH1} %",skb:"{PH1} kB",name:"Name",selfSize:"Self size",totalSize:"Total size",url:"URL"},hr=O("panels/profiler/HeapProfileView.ts",E),D=L.bind(void 0,hr);function jt(d){return d.profile||d.protocolProfile()}class Ti extends wt{profileHeader;profileType;adjustedTotal;selectedSizeText;timestamps;sizes;max;ordinals;totalTime;lastOrdinal;timelineOverview;constructor(e){super(),this.profileHeader=e,this.profileType=e.profileType(),this.initialize(new Ei(this));const t=new ht(jt(e));this.adjustedTotal=t.total,this.setProfile(t),this.selectedSizeText=new St,this.timestamps=[],this.sizes=[],this.max=[],this.ordinals=[],this.totalTime=0,this.lastOrdinal=0,this.timelineOverview=new Ct,Be.isEnabled("sampling-heap-profiler-timeline")&&(this.timelineOverview.addEventListener("IdsRangeChanged",this.onIdsRangeChanged.bind(this)),this.timelineOverview.show(this.element,this.element.firstChild),this.timelineOverview.start(),this.profileType.addEventListener("StatsUpdate",this.onStatsUpdate,this),this.profileType.once("profile-complete").then(()=>{this.profileType.removeEventListener("StatsUpdate",this.onStatsUpdate,this),this.timelineOverview.stop(),this.timelineOverview.updateGrid()}))}async toolbarItems(){return[...await super.toolbarItems(),this.selectedSizeText]}onIdsRangeChanged(e){const{minId:t,maxId:i}=e.data;this.selectedSizeText.setText(D(E.selectedSizeS,{PH1:J(e.data.size)})),this.setSelectionRange(t,i)}setSelectionRange(e,t){const i=jt(this.profileHeader),s=new ht(i,e,t);this.adjustedTotal=s.total,this.setProfile(s)}onStatsUpdate(e){const t=e.data;this.totalTime||(this.timestamps=[],this.sizes=[],this.max=[],this.ordinals=[],this.totalTime=3e4,this.lastOrdinal=0),this.sizes.fill(0),this.sizes.push(0),this.timestamps.push(Date.now()),this.ordinals.push(this.lastOrdinal+1);for(const r of t?.samples??[]){this.lastOrdinal=Math.max(this.lastOrdinal,r.ordinal);const n=Kt(this.ordinals,r.ordinal,st)-1;this.sizes[n]+=r.size}this.max.push(this.sizes[this.sizes.length-1]),this.timestamps[this.timestamps.length-1]-this.timestamps[0]>this.totalTime&&(this.totalTime*=2);const s={sizes:this.sizes,max:this.max,ids:this.ordinals,timestamps:this.timestamps,totalTime:this.totalTime};this.timelineOverview.setSamples(s)}columnHeader(e){switch(e){case"self":return D(E.selfSizeBytes);case"total":return D(E.totalSizeBytes)}return ei}createFlameChartDataProvider(){return new Ni(this.profile(),this.profileHeader.heapProfilerModel())}}class xi extends X(Ve){recording;clearedDuringRecording;constructor(e,t){super(e,t),this.recording=!1,this.clearedDuringRecording=!1}profileBeingRecorded(){return super.profileBeingRecorded()}typeName(){return"Heap"}fileExtension(){return".heapprofile"}get buttonTooltip(){return this.recording?D(E.stopHeapProfiling):D(E.startHeapProfiling)}buttonClicked(){return this.recording?this.stopRecordingProfile():this.startRecordingProfile(),this.recording}startRecordingProfile(){const e=F.instance().flavor(j);if(this.profileBeingRecorded()||!e)return;const t=new lt(e,this);this.setProfileBeingRecorded(t),this.addProfile(t),t.updateStatus(D(E.recording));const i=[D(E.heapProfilerIsRecording)];Rt.instance().setPanelWarnings("heap-profiler",i),this.recording=!0,this.startSampling()}async stopRecordingProfile(){this.recording=!1;const e=this.profileBeingRecorded();if(!e||!e.heapProfilerModel())return;e.updateStatus(D(E.stopping));const t=await this.stopSampling();e&&(console.assert(t!==void 0),e.setProtocolProfile(t),e.updateStatus(""),this.setProfileBeingRecorded(null)),Rt.instance().setPanelWarnings("heap-profiler",[]);const i=this.clearedDuringRecording;this.clearedDuringRecording=!1,!i&&this.dispatchEventToListeners("profile-complete",e)}createProfileLoadedFromFile(e){return new lt(null,this,e)}profileBeingRecordedRemoved(){this.clearedDuringRecording=!0,this.stopRecordingProfile()}startSampling(){throw"Not implemented"}stopSampling(){throw"Not implemented"}}let Qe;class $e extends xi{updateTimer;updateIntervalMs;constructor(){super($e.TypeId,D(E.allocationSampling)),Qe||(Qe=this),this.updateTimer=0,this.updateIntervalMs=200}static get instance(){return Qe}get treeItemTitle(){return D(E.samplingProfiles)}get description(){return[D(E.recordMemoryAllocations)].join(`
`)}hasTemporaryView(){return Be.isEnabled("sampling-heap-profiler-timeline")}startSampling(){const e=this.obtainRecordingProfile();e&&(e.startSampling(),Be.isEnabled("sampling-heap-profiler-timeline")&&(this.updateTimer=window.setTimeout(()=>{this.updateStats()},this.updateIntervalMs)))}obtainRecordingProfile(){const e=this.profileBeingRecorded();return e?e.heapProfilerModel():null}async stopSampling(){window.clearTimeout(this.updateTimer),this.updateTimer=0,this.dispatchEventToListeners("RecordingStopped");const e=this.obtainRecordingProfile();if(!e)throw new Error("No heap profiler model");const t=await e.stopSampling();if(!t)throw new Error("No sampling profile found");return t}async updateStats(){const e=this.obtainRecordingProfile();if(!e)return;const t=await e.getSamplingProfile();this.updateTimer&&(this.dispatchEventToListeners("StatsUpdate",t),this.updateTimer=window.setTimeout(()=>{this.updateStats()},this.updateIntervalMs))}static TypeId="SamplingHeap"}class lt extends bt{heapProfilerModelInternal;protocolProfileInternal;constructor(e,t,i){super(e&&e.debuggerModel(),t,i||D(E.profileD,{PH1:t.nextProfileUid()})),this.heapProfilerModelInternal=e,this.protocolProfileInternal={head:{callFrame:{functionName:"",scriptId:"",url:"",lineNumber:0,columnNumber:0},children:[],selfSize:0,id:0},samples:[],startTime:0,endTime:0,nodes:[]}}createView(){return new Ti(this)}protocolProfile(){return this.protocolProfileInternal}heapProfilerModel(){return this.heapProfilerModelInternal}profileType(){return super.profileType()}}class dt extends Ps{self;constructor(e){const t=e.callFrame||{functionName:e.functionName,scriptId:e.scriptId,url:e.url,lineNumber:e.lineNumber-1,columnNumber:e.columnNumber-1};super(t),this.self=e.selfSize}}class ht extends Ts{modules;constructor(e,t,i){super(),this.modules=e.modules||[];let s=null;if(t||i){s=new Map,t=t||0,i=i||1/0;for(const o of e.samples){if(o.ordinal<t||o.ordinal>i)continue;const l=s.get(o.nodeId)||0;s.set(o.nodeId,l+o.size)}}this.initialize(r(e.head));function r(o){const l=new dt(o),a=[o],h=[l];for(;a.length;){const m=a.pop(),g=h.pop();g.children=m.children.map(c=>{const p=new dt(c);return s&&(p.self=s.get(c.id)||0),p}),a.push(...m.children),h.push(...g.children)}return n(l),l}function n(o){return o.children=o.children.filter(n),!!(o.children.length||o.self)}}}class Ei{profileView;constructor(e){this.profileView=e}formatValue(e){return x(e)}formatValueAccessibleText(e){return D(E.sBytes,{PH1:e})}formatPercent(e,t){return D(E.formatPercent,{PH1:e.toFixed(2)})}linkifyNode(e){const t=this.profileView.profileHeader.heapProfilerModel(),i=t?t.target():null,s={className:"profile-node-file",inlineFrameIndex:0};return this.profileView.linkifier().maybeLinkifyConsoleCallFrame(i,e.profileNode.callFrame,s)}}class Ni extends Ue{profile;heapProfilerModel;constructor(e,t){super(),this.profile=e,this.heapProfilerModel=t}minimumBoundary(){return 0}totalTime(){return this.profile.root.total}entryHasDeoptReason(e){return!1}formatValue(e,t){return D(E.skb,{PH1:x(e/1e3)})}calculateTimelineData(){function e(g){return g.children.reduce((c,p)=>c+e(p),1)}const t=e(this.profile.root),i=new Array(t),s=new Uint16Array(t),r=new Float32Array(t),n=new Float64Array(t);let o=0,l=0,a=0,h=0;function m(g){const c=a;i[h]=g,s[h]=o,r[h]=g.total,n[h]=a,++h,++o,g.children.forEach(m),--o,l=Math.max(l,o),a=c+g.total}return m(this.profile.root),this.maxStackDepthInternal=l+1,this.entryNodes=i,this.timelineDataInternal=Js.create({entryLevels:s,entryTotalTimes:r,entryStartTimes:n,groups:null}),this.timelineDataInternal}prepareHighlightedEntryInfo(e){const t=this.entryNodes[e];if(!t)return null;const i=[];function s(o,l){i.push({title:o,value:l})}s(D(E.name),je(t.functionName)),s(D(E.selfSize),J(t.self)),s(D(E.totalSize),J(t.total));const r=new oe,n=r.maybeLinkifyConsoleCallFrame(this.heapProfilerModel?this.heapProfilerModel.target():null,t.callFrame);return n&&s(D(E.url),n.textContent),r.dispose(),wt.buildPopoverTable(i)}}const Sn=Object.freeze(Object.defineProperty({__proto__:null,HeapFlameChartDataProvider:Ni,HeapProfileView:Ti,NodeFormatter:Ei,SamplingHeapProfileHeader:lt,SamplingHeapProfileModel:ht,SamplingHeapProfileNode:dt,SamplingHeapProfileType:$e,SamplingHeapProfileTypeBase:xi},Symbol.toStringTag,{value:"Module"})),Mt={Update:"ProgressUpdate",BrokenSnapshot:"BrokenSnapshot"},Ri=1e8,cr=Ri*2;class pr{id;name;distance;nodeIndex;retainedSize;selfSize;type;canBeQueried;detachedDOMTreeNode;isAddedNotRemoved;ignored;constructor(e,t,i,s,r,n,o){this.id=e,this.name=t,this.distance=i,this.nodeIndex=s,this.retainedSize=r,this.selfSize=n,this.type=o,this.canBeQueried=!1,this.detachedDOMTreeNode=!1,this.isAddedNotRemoved=null,this.ignored=!1}}class Di{name;node;type;edgeIndex;isAddedNotRemoved;constructor(e,t,i,s){this.name=e,this.node=t,this.type=i,this.edgeIndex=s,this.isAddedNotRemoved=null}}class v{fieldName1;ascending1;fieldName2;ascending2;constructor(e,t,i,s){this.fieldName1=e,this.ascending1=t,this.fieldName2=i,this.ascending2=s}}class ur{startPosition;endPosition;totalLength;items;constructor(e,t,i,s){this.startPosition=e,this.endPosition=t,this.totalLength=i,this.items=s}}class ve{minNodeId;maxNodeId;allocationNodeId;filterName;constructor(e,t){this.minNodeId=e,this.maxNodeId=t}equals(e){return this.minNodeId===e.minNodeId&&this.maxNodeId===e.maxNodeId&&this.allocationNodeId===e.allocationNodeId&&this.filterName===e.filterName}}class fr{query;caseSensitive;isRegex;shouldJump;jumpBackward;constructor(e,t,i,s,r){this.query=e,this.caseSensitive=t,this.isRegex=i,this.shouldJump=s,this.jumpBackward=r}toSearchRegex(e){throw new Error("Unsupported operation on search config")}}const b={genericStringsTwoPlaceholders:"{PH1}, {PH2}",internalArray:"(internal array)[]",userObjectReachableFromWindow:"User object reachable from window",detachedFromDomTree:"Detached from DOM tree",previewIsNotAvailable:"Preview is not available",revealInSummaryView:"Reveal in Summary view",summary:"Summary",revealObjectSWithIdSInSummary:"Reveal object ''{PH1}'' with id @{PH2} in Summary view",storeAsGlobalVariable:"Store as global variable",ignoreThisRetainer:"Ignore this retainer",stopIgnoringThisRetainer:"Stop ignoring this retainer",ignored:"ignored",inElement:"in",compiledCodeSummary:"Internal data which V8 uses to run functions defined by JavaScript or WebAssembly.",concatenatedStringSummary:"A string which represents the contents of two other strings joined together.",contextSummary:"An internal object containing variables from a JavaScript scope which may be needed by a function created within that scope.",descriptorArraySummary:"A list of the property names used by a JavaScript Object.",internalArraySummary:"An internal array-like data structure (not a JavaScript Array).",internalNodeSummary:"An object allocated by a component other than V8, such as C++ objects defined by Blink.",mapSummary:"An internal object representing the shape of a JavaScript Object (not a JavaScript Map).",objectElementsSummary:"An internal object which stores the indexed properties in a JavaScript Object, such as the contents of an Array.",objectPropertiesSummary:"An internal object which stores the named properties in a JavaScript Object.",slicedStringSummary:"A string which represents some of the characters from another string."},mr=O("panels/profiler/HeapSnapshotGridNodes.ts",b),C=L.bind(void 0,mr);class gr extends ut{}class Y extends X(gr){dataGridInternal;instanceCount;savedChildren;retrievedChildrenRanges;providerObject;reachableFromWindow;populated;constructor(e,t){super(null,t),this.dataGridInternal=e,this.instanceCount=0,this.savedChildren=new Map,this.retrievedChildrenRanges=[],this.providerObject=null,this.reachableFromWindow=!1}get name(){}heapSnapshotDataGrid(){return this.dataGridInternal}createProvider(){throw new Error("Not implemented.")}comparator(){throw new Error("Not implemented.")}getHash(){throw new Error("Not implemented.")}createChildNode(e){throw new Error("Not implemented.")}retainersDataSource(){return null}provider(){return this.providerObject||(this.providerObject=this.createProvider()),this.providerObject}createCell(e){return super.createCell(e)}collapse(){super.collapse(),this.dataGridInternal.updateVisibleNodes(!0)}expand(){super.expand(),this.dataGridInternal.updateVisibleNodes(!0)}dispose(){this.providerObject&&this.providerObject.dispose();for(let e=this.children[0];e;e=e.traverseNextNode(!0,this,!0))e.dispose()}queryObjectContent(e,t){throw new Error("Not implemented.")}tryQueryObjectContent(e,t){throw new Error("Not implemented.")}populateContextMenu(e,t,i){}toPercentString(e){return e.toFixed(0)+" %"}toUIDistance(e){const t=Ri;return e>=0&&e<t?e.toString():"−"}allChildren(){return this.dataGridInternal.allChildren(this)}removeChildByIndex(e){this.dataGridInternal.removeChildByIndex(this,e)}childForPosition(e){let t=0;for(let i=0;i<this.retrievedChildrenRanges.length;i++){const s=this.retrievedChildrenRanges[i];if(s.from<=e&&e<s.to){const r=t+e-s.from;return this.allChildren()[r]}t+=s.to-s.from+1}return null}createValueCell(e){const t=ti("numeric-column").track({click:!0}),i=Se`<td class="numeric-column" jslog=${t} />`,s=this.dataGrid;if(s.snapshot&&s.snapshot.totalSize!==0){const r=document.createElement("div"),n=Se`<span>${this.data[e]}</span>`;r.appendChild(n);const o=e+"-percent";if(o in this.data){const l=Se`<span class="percent-column">${this.data[o]}</span>`;r.appendChild(l),r.classList.add("profile-multiple-values"),Dt(n),Dt(l),this.setCellAccessibleName(C(b.genericStringsTwoPlaceholders,{PH1:this.data[e],PH2:this.data[o]}),i,e)}i.appendChild(r)}return i}populate(){this.populated||(this.populated=!0,this.provider().sortAndRewind(this.comparator()).then(()=>this.populateChildren()))}expandWithoutPopulate(){return this.populated=!0,this.expand(),this.provider().sortAndRewind(this.comparator())}childHashForEntity(e){return"edgeIndex"in e?e.edgeIndex:e.id}populateChildren(e,t){return new Promise(i=>{e=e||0,t=t||e+this.dataGridInternal.defaultPopulateCount();let s=e;r.call(this,t);function r(a){if(s>=a)return;const h=Math.min(s+this.dataGridInternal.defaultPopulateCount(),a);this.provider().serializeItemsRange(s,h).then(m=>l.call(this,m,a)),s=h}function n(a,h){if(this.savedChildren){const m=this.childHashForEntity(a),g=this.savedChildren.get(m);if(g){this.dataGridInternal.insertChild(this,g,h);return}}this.dataGridInternal.insertChild(this,this.createChildNode(a),h)}function o(a,h,m){const g=new ks(this.populateChildren.bind(this),a,h,this.dataGridInternal.defaultPopulateCount());this.dataGridInternal.insertChild(this,g,m)}function l(a,h){let m=0,g=a.startPosition;const c=a.items;let p=0;if(this.retrievedChildrenRanges.length){let N=0,P=!1,y={from:0,to:0};for(;N<this.retrievedChildrenRanges.length;){if(y=this.retrievedChildrenRanges[N],y.to>=g){P=!0;break}p+=y.to-y.from,y.to<a.totalLength&&(p+=1),++N}for(!P||a.startPosition<y.from?(this.allChildren()[p-1].setEndPosition(a.startPosition),o.call(this,a.startPosition,P?y.from:a.totalLength,p),y={from:a.startPosition,to:a.startPosition},P||(N=this.retrievedChildrenRanges.length),this.retrievedChildrenRanges.splice(N,0,y)):p+=g-y.from;y.to<a.endPosition;){const q=y.to-g;p+=q,m+=q,g=y.to;const I=this.retrievedChildrenRanges[N+1];let T=I?I.from:a.totalLength;for(T>a.endPosition&&(T=a.endPosition);g<T;)n.call(this,c[m++],p++),++g;I&&T===I.from?(y.to=I.to,this.removeChildByIndex(p),this.retrievedChildrenRanges.splice(N+1,1)):(y.to=T,T===a.totalLength?this.removeChildByIndex(p):this.allChildren()[p].setStartPosition(a.endPosition))}}else{a.startPosition>0&&(this.retrievedChildrenRanges.push({from:0,to:0}),o.call(this,0,a.startPosition,p++)),this.retrievedChildrenRanges.push({from:a.startPosition,to:a.endPosition});for(let N=0,P=c.length;N<P;++N)n.call(this,c[N],p++);a.endPosition<a.totalLength&&o.call(this,a.endPosition,a.totalLength,p++)}if(this.instanceCount+=c.length,s<h&&s<a.totalLength){r.call(this,h);return}this.expanded&&this.dataGridInternal.updateVisibleNodes(!0),i(),this.dispatchEventToListeners(Y.Events.PopulateComplete)}})}saveChildren(){this.savedChildren.clear();const e=this.allChildren();for(let t=0,i=e.length;t<i;++t){const s=e[t];s.expanded&&this.savedChildren.set(s.getHash(),s)}}async sort(){this.dataGridInternal.recursiveSortingEnter(),await this.provider().sortAndRewind(this.comparator()),this.saveChildren(),this.dataGridInternal.removeAllChildren(this),this.retrievedChildrenRanges=[];const e=this.instanceCount;this.instanceCount=0,await this.populateChildren(0,e);for(const t of this.allChildren())t.expanded&&t.sort();this.dataGridInternal.recursiveSortingLeave()}}(function(d){(function(e){e.PopulateComplete="PopulateComplete"})(d.Events||(d.Events={}))})(Y||(Y={}));class Ee extends Y{referenceName;nameInternal;type;distance;shallowSize;retainedSize;snapshotNodeId;snapshotNodeIndex;detachedDOMTreeNode;linkElement;constructor(e,t){if(super(e,!1),!t)return;this.referenceName=null,this.nameInternal=t.name,this.type=t.type,this.distance=t.distance,this.shallowSize=t.selfSize,this.retainedSize=t.retainedSize,this.snapshotNodeId=t.id,this.snapshotNodeIndex=t.nodeIndex,this.type==="string"?this.reachableFromWindow=!0:this.type==="object"&&this.nameInternal.startsWith("Window")?(this.nameInternal=this.shortenWindowURL(this.nameInternal,!1),this.reachableFromWindow=!0):t.canBeQueried&&(this.reachableFromWindow=!0),t.detachedDOMTreeNode&&(this.detachedDOMTreeNode=!0);const i=e.snapshot,s=this.shallowSize/i.totalSize*100,r=this.retainedSize/i.totalSize*100;this.data={distance:this.toUIDistance(this.distance),shallowSize:x(this.shallowSize),retainedSize:x(this.retainedSize),"shallowSize-percent":this.toPercentString(s),"retainedSize-percent":this.toPercentString(r)}}get name(){return this.nameInternal}retainersDataSource(){return this.snapshotNodeIndex===void 0?null:{snapshot:this.dataGridInternal.snapshot,snapshotNodeIndex:this.snapshotNodeIndex,snapshotNodeId:this.snapshotNodeId}}createCell(e){return e!=="object"?this.createValueCell(e):this.createObjectCell()}createObjectCell(){let e=this.nameInternal,t="object";switch(this.type){case"concatenated string":case"string":e=`"${e}"`,t="string";break;case"regexp":e=`/${e}/`,t="string";break;case"closure":e=`${e}()`,t="function";break;case"bigint":t="bigint";break;case"number":t="number";break;case"hidden":case"object shape":t="null";break;case"array":e=e?`${e}[]`:C(b.internalArray);break}return this.createObjectCellWithValue(t,e||"")}createObjectCellWithValue(e,t){const i=ti("object-column").track({click:!0}),s=xs.build`
  <td class="object-column disclosure" jslog=${i}>
  <div class="source-code event-properties" style="overflow: visible;" $="container">
  <span class="value object-value-${e}">${t}</span>
  <span class="object-value-id">@${this.snapshotNodeId}</span>
  </div>
  </td>`,r=s.$("container");if(this.prefixObjectCell(r),this.reachableFromWindow){const o=tt("frame","heap-object-tag");$.install(o,C(b.userObjectReachableFromWindow)),r.appendChild(o)}if(this.detachedDOMTreeNode){const o=tt("scissors","heap-object-tag");$.install(o,C(b.detachedFromDomTree)),r.appendChild(o)}this.appendSourceLocation(r);const n=s.element();return this.depth&&n.style.setProperty("padding-left",this.depth*this.dataGrid.indentWidth+"px"),n}prefixObjectCell(e){}async appendSourceLocation(e){const t=Se`<span class="heap-object-source-link" />`;e.appendChild(t);const i=await this.dataGridInternal.dataDisplayDelegate().linkifyObject(this.snapshotNodeIndex);i?(i.setAttribute("tabindex","0"),t.appendChild(i),this.linkElement=i):t.remove()}async queryObjectContent(e,t){return await this.tryQueryObjectContent(e,t)||this.tryGetTooltipDescription()||e.runtimeModel().createRemoteObjectFromPrimitiveValue(C(b.previewIsNotAvailable))}async tryQueryObjectContent(e,t){return this.type==="string"?e.runtimeModel().createRemoteObjectFromPrimitiveValue(this.nameInternal):await e.objectForSnapshotObjectId(String(this.snapshotNodeId),t)}tryGetTooltipDescription(){const e="https://developer.chrome.com/docs/devtools/memory-problems/heap-snapshots#";switch(this.type){case"code":return{description:C(b.compiledCodeSummary),link:e+"compiled-code"};case"concatenated string":return{description:C(b.concatenatedStringSummary),link:e+"concatenated-string"};case"sliced string":return{description:C(b.slicedStringSummary),link:e+"sliced-string"}}switch(this.type+":"+this.nameInternal){case"array:":return{description:C(b.internalArraySummary),link:e+"array"};case"array:(object elements)":return{description:C(b.objectElementsSummary),link:e+"array"};case"array:(object properties)":case"hidden:system / PropertyArray":return{description:C(b.objectPropertiesSummary),link:e+"array"};case"object:system / Context":return{description:C(b.contextSummary),link:e+"system-context"};case"object shape:system / DescriptorArray":return{description:C(b.descriptorArraySummary),link:e+"object-shape"};case"object shape:system / Map":return{description:C(b.mapSummary),link:e+"object-shape"};case"native:InternalNode":return{description:C(b.internalNodeSummary),link:e+"internal-node"}}}async updateHasChildren(){const e=await this.provider().isEmpty();this.setHasChildren(!e)}shortenWindowURL(e,t){const i=e.indexOf("/"),s=t?e.indexOf("@"):e.length;if(i===-1||s===-1)return e;const r=e.substring(i+1,s).trimLeft();let n=Es(r);return n.length>40&&(n=Ns(n,40)),e.substr(0,i+2)+n+e.substr(s)}populateContextMenu(e,t,i){if(this.shallowSize!==0&&e.revealSection().appendItem(C(b.revealInSummaryView),()=>{t.showObject(String(this.snapshotNodeId),C(b.summary))},{jslogContext:"reveal-in-summary"}),this.referenceName)for(const s of this.referenceName.matchAll(/\((?<objectName>[^@)]*) @(?<snapshotNodeId>\d+)\)/g)){const{objectName:r,snapshotNodeId:n}=s.groups;e.revealSection().appendItem(C(b.revealObjectSWithIdSInSummary,{PH1:r,PH2:n}),()=>{t.showObject(n,C(b.summary))},{jslogContext:"reveal-in-summary"})}i&&e.revealSection().appendItem(C(b.storeAsGlobalVariable),async()=>{const s=await this.tryQueryObjectContent(i,"");s?await i.target().model(Rs)?.saveToTempVariable(F.instance().flavor(Ds),s):G.instance().error(C(b.previewIsNotAvailable))},{jslogContext:"store-as-global-variable"})}}class Ce extends Ee{referenceName;referenceType;edgeIndex;snapshot;parentObjectNode;cycledWithAncestorGridNode;constructor(e,t,i,s){super(e,i.node),this.referenceName=i.name,this.referenceType=i.type,this.edgeIndex=i.edgeIndex,this.snapshot=t,this.parentObjectNode=s,this.cycledWithAncestorGridNode=this.findAncestorWithSameSnapshotNodeId(),this.cycledWithAncestorGridNode||this.updateHasChildren();const r=this.data;r.count="",r.addedCount="",r.removedCount="",r.countDelta="",r.addedSize="",r.removedSize="",r.sizeDelta=""}retainersDataSource(){return this.snapshotNodeIndex===void 0?null:{snapshot:this.snapshot,snapshotNodeIndex:this.snapshotNodeIndex,snapshotNodeId:this.snapshotNodeId}}createProvider(){if(this.snapshotNodeIndex===void 0)throw new Error("Cannot create a provider on a root node");return this.snapshot.createEdgesProvider(this.snapshotNodeIndex)}findAncestorWithSameSnapshotNodeId(){let e=this.parentObjectNode;for(;e;){if(e.snapshotNodeId===this.snapshotNodeId)return e;e=e.parentObjectNode}return null}createChildNode(e){return new Ce(this.dataGridInternal,this.snapshot,e,this)}getHash(){return this.edgeIndex}comparator(){const e=this.dataGridInternal.isSortOrderAscending();switch(this.dataGridInternal.sortColumnId()){case"object":return new v("!edgeName",e,"retainedSize",!1);case"count":return new v("!edgeName",!0,"retainedSize",!1);case"shallowSize":return new v("selfSize",e,"!edgeName",!0);case"retainedSize":return new v("retainedSize",e,"!edgeName",!0);case"distance":return new v("distance",e,"name",!0);default:return new v("!edgeName",!0,"retainedSize",!1)}}prefixObjectCell(e){let t=this.referenceName||"(empty)",i="name";switch(this.referenceType){case"context":i="object-value-number";break;case"internal":case"hidden":case"weak":i="object-value-null";break;case"element":t=`[${t}]`;break}this.cycledWithAncestorGridNode&&e.classList.add("cycled-ancestor-node"),e.prepend(Se`<span class="property-name ${i}">${t}</span>
  <span class="grayed">${this.edgeNodeSeparator()}</span>`)}edgeNodeSeparator(){return"::"}}class Je extends Ce{#e;constructor(e,t,i,s){super(e,t,i,s),this.#e=i.node.ignored,this.#e&&(this.data.distance=C(b.ignored))}createProvider(){if(this.snapshotNodeIndex===void 0)throw new Error("Cannot create providers on root nodes");return this.snapshot.createRetainingEdgesProvider(this.snapshotNodeIndex)}createChildNode(e){return new Je(this.dataGridInternal,this.snapshot,e,this)}edgeNodeSeparator(){return C(b.inElement)}expand(){this.expandRetainersChain(20)}populateContextMenu(e,t,i){super.populateContextMenu(e,t,i);const s=this.snapshotNodeIndex;s!==void 0&&(this.#e?e.revealSection().appendItem(C(b.stopIgnoringThisRetainer),async()=>{await this.snapshot.unignoreNodeInRetainersView(s),await this.dataGridInternal.dataSourceChanged()},{jslogContext:"stop-ignoring-this-retainer"}):e.revealSection().appendItem(C(b.ignoreThisRetainer),async()=>{await this.snapshot.ignoreNodeInRetainersView(s),await this.dataGridInternal.dataSourceChanged()},{jslogContext:"ignore-this-retainer"}))}isReachable(){return(this.distance??0)<cr}prefixObjectCell(e){super.prefixObjectCell(e),this.isReachable()||e.classList.add("unreachable-ancestor-node")}expandRetainersChain(e){if(!this.populated){this.once(Y.Events.PopulateComplete).then(()=>this.expandRetainersChain(e)),this.populate();return}if(super.expand(),--e>0&&this.children.length>0){const t=this.children[0];if((t.distance||0)>1&&t.isReachable()){t.expandRetainersChain(e);return}}this.dataGridInternal.dispatchEventToListeners(M.ExpandRetainersComplete)}comparator(){const e=super.comparator();return e.fieldName1==="distance"&&(e.fieldName1="!edgeDistance"),e.fieldName2==="distance"&&(e.fieldName2="!edgeDistance"),e}}class Ae extends Ee{baseSnapshotOrSnapshot;isDeletedNode;constructor(e,t,i,s){super(e,i),this.baseSnapshotOrSnapshot=t,this.isDeletedNode=s,this.updateHasChildren();const r=this.data;r.count="",r.countDelta="",r.sizeDelta="",this.isDeletedNode?(r.addedCount="",r.addedSize="",r.removedCount="•",r.removedSize=x(this.shallowSize||0)):(r.addedCount="•",r.addedSize=x(this.shallowSize||0),r.removedCount="",r.removedSize="")}retainersDataSource(){return this.snapshotNodeIndex===void 0?null:{snapshot:this.baseSnapshotOrSnapshot,snapshotNodeIndex:this.snapshotNodeIndex,snapshotNodeId:this.snapshotNodeId}}createProvider(){if(this.snapshotNodeIndex===void 0)throw new Error("Cannot create providers on root nodes");return this.baseSnapshotOrSnapshot.createEdgesProvider(this.snapshotNodeIndex)}createChildNode(e){return new Ce(this.dataGridInternal,this.baseSnapshotOrSnapshot,e,null)}getHash(){if(this.snapshotNodeId===void 0)throw new Error("Cannot hash root nodes");return this.snapshotNodeId}comparator(){const e=this.dataGridInternal.isSortOrderAscending();switch(this.dataGridInternal.sortColumnId()){case"object":return new v("!edgeName",e,"retainedSize",!1);case"distance":return new v("distance",e,"retainedSize",!1);case"count":return new v("!edgeName",!0,"retainedSize",!1);case"addedSize":return new v("selfSize",e,"!edgeName",!0);case"removedSize":return new v("selfSize",e,"!edgeName",!0);case"shallowSize":return new v("selfSize",e,"!edgeName",!0);case"retainedSize":return new v("retainedSize",e,"!edgeName",!0);default:return new v("!edgeName",!0,"retainedSize",!1)}}}class It extends Y{nameInternal;nodeFilter;distance;count;shallowSize;retainedSize;constructor(e,t,i,s){super(e,i.count>0),this.nameInternal=t,this.nodeFilter=s,this.distance=i.distance,this.count=i.count,this.shallowSize=i.self,this.retainedSize=i.maxRet;const r=e.snapshot,n=this.retainedSize/r.totalSize*100,o=this.shallowSize/r.totalSize*100;this.data={object:t,count:x(this.count),distance:this.toUIDistance(this.distance),shallowSize:x(this.shallowSize),retainedSize:x(this.retainedSize),"shallowSize-percent":this.toPercentString(o),"retainedSize-percent":this.toPercentString(n)}}get name(){return this.nameInternal}createProvider(){return this.dataGridInternal.snapshot.createNodesProviderForClass(this.nameInternal,this.nodeFilter)}async populateNodeBySnapshotObjectId(e){this.dataGridInternal.resetNameFilter(),await this.expandWithoutPopulate();const t=await this.provider().nodePosition(e);if(t===-1)return this.collapse(),[];await this.populateChildren(t,null);const i=this.childForPosition(t);return i?[this,i]:[]}filteredOut(e){return this.nameInternal.toLowerCase().indexOf(e)===-1}createCell(e){const t=e==="object"?super.createCell(e):this.createValueCell(e);return e==="object"&&this.count>1&&t.appendChild(Se`<span class="objects-count">×${this.count}</span>`),t}createChildNode(e){return new Ae(this.dataGridInternal,this.dataGridInternal.snapshot,e,!1)}comparator(){const e=this.dataGridInternal.isSortOrderAscending(),t=this.dataGridInternal.sortColumnId();switch(t){case"object":return new v("name",e,"id",!0);case"distance":return new v("distance",e,"retainedSize",!1);case"shallowSize":return new v("selfSize",e,"id",!0);case"retainedSize":return new v("retainedSize",e,"id",!0);default:throw new Error(`Invalid sort column id ${t}`)}}}class ki{addedNodesProvider;deletedNodesProvider;addedCount;removedCount;constructor(e,t,i,s){this.addedNodesProvider=e,this.deletedNodesProvider=t,this.addedCount=i,this.removedCount=s}dispose(){this.addedNodesProvider.dispose(),this.deletedNodesProvider.dispose()}nodePosition(e){throw new Error("Unreachable")}isEmpty(){return Promise.resolve(!1)}async serializeItemsRange(e,t){let i,s;if(e<this.addedCount){i=await this.addedNodesProvider.serializeItemsRange(e,t);for(const r of i.items)r.isAddedNotRemoved=!0;if(i.endPosition>=t)return i.totalLength=this.addedCount+this.removedCount,i;s=i,i=await this.deletedNodesProvider.serializeItemsRange(0,t-i.endPosition)}else s=new ur(0,0,0,[]),i=await this.deletedNodesProvider.serializeItemsRange(e-this.addedCount,t-this.addedCount);s.items.length||(s.startPosition=this.addedCount+i.startPosition);for(const r of i.items)r.isAddedNotRemoved=!1;return s.items.push(...i.items),s.endPosition=this.addedCount+i.endPosition,s.totalLength=this.addedCount+this.removedCount,s}async sortAndRewind(e){await this.addedNodesProvider.sortAndRewind(e),await this.deletedNodesProvider.sortAndRewind(e)}}class yt extends Y{nameInternal;addedCount;removedCount;countDelta;addedSize;removedSize;sizeDelta;deletedIndexes;constructor(e,t,i){super(e,!0),this.nameInternal=t,this.addedCount=i.addedCount,this.removedCount=i.removedCount,this.countDelta=i.countDelta,this.addedSize=i.addedSize,this.removedSize=i.removedSize,this.sizeDelta=i.sizeDelta,this.deletedIndexes=i.deletedIndexes,this.data={object:t,addedCount:x(this.addedCount),removedCount:x(this.removedCount),countDelta:this.signForDelta(this.countDelta)+x(Math.abs(this.countDelta)),addedSize:x(this.addedSize),removedSize:x(this.removedSize),sizeDelta:this.signForDelta(this.sizeDelta)+x(Math.abs(this.sizeDelta))}}get name(){return this.nameInternal}createProvider(){const e=this.dataGridInternal;if(e.snapshot===null||e.baseSnapshot===void 0||e.baseSnapshot.uid===void 0)throw new Error("Data sources have not been set correctly");const t=e.snapshot.createAddedNodesProvider(e.baseSnapshot.uid,this.nameInternal),i=e.baseSnapshot.createDeletedNodesProvider(this.deletedIndexes);if(!t||!i)throw new Error("Failed to create node providers");return new ki(t,i,this.addedCount,this.removedCount)}createCell(e){const t=super.createCell(e);return e!=="object"&&t.classList.add("numeric-column"),t}createChildNode(e){const t=this.dataGridInternal;if(e.isAddedNotRemoved){if(t.snapshot===null)throw new Error("Data sources have not been set correctly");return new Ae(this.dataGridInternal,t.snapshot,e,!1)}if(t.baseSnapshot===void 0)throw new Error("Data sources have not been set correctly");return new Ae(this.dataGridInternal,t.baseSnapshot,e,!0)}comparator(){const e=this.dataGridInternal.isSortOrderAscending(),t=this.dataGridInternal.sortColumnId();switch(t){case"object":return new v("name",e,"id",!0);case"addedCount":return new v("name",!0,"id",!0);case"removedCount":return new v("name",!0,"id",!0);case"countDelta":return new v("name",!0,"id",!0);case"addedSize":return new v("selfSize",e,"id",!0);case"removedSize":return new v("selfSize",e,"id",!0);case"sizeDelta":return new v("selfSize",e,"id",!0);default:throw new Error(`Invalid sort column ${t}`)}}filteredOut(e){return this.nameInternal.toLowerCase().indexOf(e)===-1}signForDelta(e){return e===0?"":e>0?"+":"−"}}class Pe extends Y{populated;allocationNode;constructor(e,t){super(e,t.hasChildren),this.populated=!1,this.allocationNode=t,this.data={liveCount:x(t.liveCount),count:x(t.count),liveSize:x(t.liveSize),size:x(t.size),name:t.name}}populate(){this.populated||this.doPopulate()}async doPopulate(){this.populated=!0;const e=await this.dataGridInternal.snapshot.allocationNodeCallers(this.allocationNode.id),t=e.nodesWithSingleCaller;let i=this;const s=this.dataGridInternal;for(const n of t){const o=new Pe(s,n);s.appendNode(i,o),i=o,i.populated=!0,this.expanded&&i.expand()}const r=e.branchingCallers;r.sort(this.dataGridInternal.createComparator());for(const n of r)s.appendNode(i,new Pe(s,n));s.updateVisibleNodes(!0)}expand(){super.expand(),this.children.length===1&&this.children[0].expand()}createCell(e){if(e!=="name")return this.createValueCell(e);const t=super.createCell(e),i=this.allocationNode,s=this.dataGridInternal.heapProfilerModel();if(i.scriptId){const n=this.dataGridInternal.linkifier.linkifyScriptLocation(s?s.target():null,String(i.scriptId),i.scriptName,i.line-1,{columnNumber:i.column-1,inlineFrameIndex:0,className:"profile-node-file"});n.style.maxWidth="75%",t.insertBefore(n,t.firstChild)}return t}allocationNodeId(){return this.allocationNode.id}}const wn=Object.freeze(Object.defineProperty({__proto__:null,AllocationGridNode:Pe,HeapSnapshotConstructorNode:It,HeapSnapshotDiffNode:yt,HeapSnapshotDiffNodesProvider:ki,HeapSnapshotGenericObjectNode:Ee,get HeapSnapshotGridNode(){return Y},HeapSnapshotInstanceNode:Ae,HeapSnapshotObjectNode:Ce,HeapSnapshotRetainingObjectNode:Je},Symbol.toStringTag,{value:"Module"})),S={distanceFromWindowObject:"Distance from window object",sizeOfTheObjectItselfInBytes:"Size of the object itself in bytes",sizeOfTheObjectPlusTheGraphIt:"Size of the object plus the graph it retains in bytes",object:"Object",distance:"Distance",shallowSize:"Shallow Size",retainedSize:"Retained Size",heapSnapshotRetainment:"Heap Snapshot Retainment",constructorString:"Constructor",heapSnapshotConstructors:"Heap Snapshot Constructors",New:"# New",Deleted:"# Deleted",Delta:"# Delta",allocSize:"Alloc. Size",freedSize:"Freed Size",sizeDelta:"Size Delta",heapSnapshotDiff:"Heap Snapshot Diff",liveCount:"Live Count",count:"Count",liveSize:"Live Size",size:"Size",function:"Function",allocation:"Allocation"},vr=O("panels/profiler/HeapSnapshotDataGrids.ts",S),w=L.bind(void 0,vr),Re=new WeakMap;class Sr extends gt{}class Pt extends X(Sr){snapshot;selectedNode;heapProfilerModelInternal;dataDisplayDelegateInternal;recursiveSortingDepth;populatedAndSorted;nameFilter;nodeFilterInternal;lastSortColumnId;lastSortAscending;constructor(e,t,i){super(i),this.snapshot=null,this.selectedNode=null,this.heapProfilerModelInternal=e,this.dataDisplayDelegateInternal=t;const s=[["distance",w(S.distanceFromWindowObject)],["shallowSize",w(S.sizeOfTheObjectItselfInBytes)],["retainedSize",w(S.sizeOfTheObjectPlusTheGraphIt)]];for(const r of s){const n=this.headerTableHeader(r[0]);n&&n.setAttribute("title",r[1])}this.recursiveSortingDepth=0,this.populatedAndSorted=!1,this.nameFilter=null,this.nodeFilterInternal=new ve,this.addEventListener(M.SortingComplete,this.sortingComplete,this),this.addEventListener("SortingChanged",this.sortingChanged,this),this.setRowContextMenuCallback(this.populateContextMenu.bind(this))}async setDataSource(e,t){}isFilteredOut(e){const t=this.nameFilter?this.nameFilter.value().toLowerCase():"";return!!(t&&(e instanceof yt||e instanceof It)&&e.filteredOut(t))}heapProfilerModel(){return this.heapProfilerModelInternal}dataDisplayDelegate(){return this.dataDisplayDelegateInternal}nodeFilter(){return this.nodeFilterInternal}setNameFilter(e){this.nameFilter=e}defaultPopulateCount(){return 100}disposeAllNodes(){const e=this.topLevelNodes();for(let t=0,i=e.length;t<i;++t)e[t].dispose()}wasShown(){this.nameFilter&&(this.nameFilter.addEventListener("TextChanged",this.onNameFilterChanged,this),this.updateVisibleNodes(!0)),this.populatedAndSorted&&this.dispatchEventToListeners(M.ContentShown,this)}sortingComplete(){this.removeEventListener(M.SortingComplete,this.sortingComplete,this),this.populatedAndSorted=!0,this.dispatchEventToListeners(M.ContentShown,this)}willHide(){this.nameFilter&&this.nameFilter.removeEventListener("TextChanged",this.onNameFilterChanged,this)}populateContextMenu(e,t){const i=t;i.populateContextMenu(e,this.dataDisplayDelegateInternal,this.heapProfilerModel()),i instanceof Ee&&i.linkElement&&e.appendApplicableItems(i.linkElement)}resetSortingCache(){delete this.lastSortColumnId,delete this.lastSortAscending}topLevelNodes(){return this.rootNode().children}revealObjectByHeapSnapshotId(e){return Promise.resolve(null)}resetNameFilter(){this.nameFilter&&this.nameFilter.setValue("")}onNameFilterChanged(){this.updateVisibleNodes(!0),this.deselectFilteredNodes()}deselectFilteredNodes(){let e=this.selectedNode;for(;e;){if(this.selectedNode&&this.isFilteredOut(e)){this.selectedNode.deselect(),this.selectedNode=null;return}e=e.parent}}sortFields(e,t){throw new Error("Not implemented")}sortingChanged(){const e=this.isSortOrderAscending(),t=this.sortColumnId();if(this.lastSortColumnId===t&&this.lastSortAscending===e)return;this.lastSortColumnId=t,this.lastSortAscending=e;const i=this.sortFields(t||"",e);function s(r,n){let o=r[i.fieldName1],l=n[i.fieldName1],a=o<l?-1:o>l?1:0;return i.ascending1||(a=-a),a!==0||(o=r[i.fieldName2],l=n[i.fieldName2],a=o<l?-1:o>l?1:0,i.ascending2||(a=-a)),a}this.performSorting(s)}performSorting(e){this.recursiveSortingEnter();const t=this.allChildren(this.rootNode());this.rootNode().removeChildren(),t.sort(e);for(let i=0,s=t.length;i<s;++i){const r=t[i];this.appendChildAfterSorting(r),r.populated&&r.sort()}this.recursiveSortingLeave()}appendChildAfterSorting(e){const t=e.revealed;this.rootNode().appendChild(e),e.revealed=t}recursiveSortingEnter(){++this.recursiveSortingDepth}recursiveSortingLeave(){this.recursiveSortingDepth&&(--this.recursiveSortingDepth||(this.updateVisibleNodes(!0),this.dispatchEventToListeners(M.SortingComplete)))}updateVisibleNodes(e){}allChildren(e){return e.children}insertChild(e,t,i){e.insertChild(t,i)}removeChildByIndex(e,t){e.removeChild(e.children[t])}removeAllChildren(e){e.removeChildren()}async dataSourceChanged(){throw new Error("Not implemented")}}var M;(function(d){d.ContentShown="ContentShown",d.SortingComplete="SortingComplete",d.ExpandRetainersComplete="ExpandRetainersComplete"})(M||(M={}));class Ye extends Pt{topPaddingHeight;bottomPaddingHeight;selectedNode;scrollToResolveCallback;constructor(e,t,i){super(e,t,i),this.scrollContainer.addEventListener("scroll",this.onScroll.bind(this),!0),this.topPaddingHeight=0,this.bottomPaddingHeight=0,this.selectedNode=null}topLevelNodes(){return this.allChildren(this.rootNode())}appendChildAfterSorting(e){}updateVisibleNodes(e){const i=this.scrollContainer.scrollHeight;let s=this.scrollContainer.scrollTop,r=i-s-this.scrollContainer.offsetHeight;s=Math.max(0,s-40),r=Math.max(0,r-40);let n=i-s-r;if(!e&&s>=this.topPaddingHeight&&r>=this.bottomPaddingHeight)return;const o=500;s-=o,n+=2*o;const l=this.selectedNode;this.rootNode().removeChildren(),this.topPaddingHeight=0,this.bottomPaddingHeight=0,this.addVisibleNodes(this.rootNode(),s,s+n),this.setVerticalPadding(this.topPaddingHeight,this.bottomPaddingHeight),l&&(l.parent?l.select(!0):this.selectedNode=l)}addVisibleNodes(e,t,i){if(!e.expanded)return 0;const s=this.allChildren(e);let r=0,n=0;for(;n<s.length;++n){const a=s[n];if(this.isFilteredOut(a))continue;const h=r+this.nodeHeight(a);if(h>t)break;r=h}let o=r;for(;n<s.length&&o<i;++n){const a=s[n];if(this.isFilteredOut(a))continue;const h=a.hasChildren();a.removeChildren(),a.setHasChildren(h),e.appendChild(a),o+=a.nodeSelfHeight(),o+=this.addVisibleNodes(a,t-o,i-o)}let l=0;for(;n<s.length;++n){const a=s[n];this.isFilteredOut(a)||(l+=this.nodeHeight(a))}return this.topPaddingHeight+=r,this.bottomPaddingHeight+=l,o+l}nodeHeight(e){let t=e.nodeSelfHeight();if(!e.expanded)return t;const i=this.allChildren(e);for(let s=0;s<i.length;s++)t+=this.nodeHeight(i[s]);return t}revealTreeNode(e){const t=this.calculateOffset(e),i=e[e.length-1],s=this.scrollContainer.scrollTop,r=s+this.scrollContainer.offsetHeight;if(t>=s&&t<r)return Promise.resolve(i);const n=40;return this.scrollContainer.scrollTop=Math.max(0,t-n),new Promise(o=>{console.assert(!this.scrollToResolveCallback),this.scrollToResolveCallback=o.bind(null,i),this.scrollContainer.window().requestAnimationFrame(()=>{this.scrollToResolveCallback&&(this.scrollToResolveCallback(),this.scrollToResolveCallback=null)})})}calculateOffset(e){let t=this.rootNode(),i=0;if(e.length===0)return 0;for(let s=0;s<e.length;++s){const r=e[s],n=this.allChildren(t);for(let o=0;o<n.length;++o){const l=n[o];if(r===l){i+=r.nodeSelfHeight();break}i+=this.nodeHeight(l)}t=r}return i-e[e.length-1].nodeSelfHeight()}allChildren(e){const t=Re.get(e)||[];return Re.has(e)||Re.set(e,t),t}appendNode(e,t){this.allChildren(e).push(t)}insertChild(e,t,i){this.allChildren(e).splice(i,0,t)}removeChildByIndex(e,t){this.allChildren(e).splice(t,1)}removeAllChildren(e){Re.delete(e)}removeTopLevelNodes(){this.disposeAllNodes(),this.rootNode().removeChildren(),this.removeAllChildren(this.rootNode())}isScrolledIntoView(e){const t=this.scrollContainer.scrollTop,i=t+this.scrollContainer.clientHeight,s=e.offsetTop;return s+e.offsetHeight<=i&&s>=t}onResize(){super.onResize(),this.updateVisibleNodes(!1)}onScroll(e){this.updateVisibleNodes(!1),this.scrollToResolveCallback&&(this.scrollToResolveCallback(),this.scrollToResolveCallback=null)}}class Tt extends Pt{constructor(e,t,i,s){s=s||[{id:"object",title:w(S.object),disclosure:!0,sortable:!0},{id:"distance",title:w(S.distance),width:"70px",sortable:!0,fixedWidth:!0},{id:"shallowSize",title:w(S.shallowSize),width:"110px",sortable:!0,fixedWidth:!0},{id:"retainedSize",title:w(S.retainedSize),width:"110px",sortable:!0,fixedWidth:!0,sort:Q.Descending}];const r={displayName:i,columns:s};super(e,t,r)}async setDataSource(e,t,i){this.snapshot=e;const s=new pr(i??-1,"root",0,t||e.rootNodeIndex,0,0,"");this.setRootNode(this.createRootNode(e,s)),this.rootNode().sort()}createRootNode(e,t){const i=new Di("",t,"",-1);return new Ce(this,e,i,null)}sortingChanged(){const e=this.rootNode();e.hasChildren()&&e.sort()}}class Fi extends Tt{resetRetainersButton;constructor(e,t){const i=[{id:"object",title:w(S.object),disclosure:!0,sortable:!0},{id:"distance",title:w(S.distance),width:"70px",sortable:!0,fixedWidth:!0,sort:Q.Ascending},{id:"shallowSize",title:w(S.shallowSize),width:"110px",sortable:!0,fixedWidth:!0},{id:"retainedSize",title:w(S.retainedSize),width:"110px",sortable:!0,fixedWidth:!0}];super(e,t,w(S.heapSnapshotRetainment),i)}createRootNode(e,t){const i=new Di("",t,"",-1);return new Je(this,e,i,null)}sortFields(e,t){switch(e){case"object":return new v("name",t,"count",!1);case"count":return new v("count",t,"name",!0);case"shallowSize":return new v("shallowSize",t,"name",!0);case"retainedSize":return new v("retainedSize",t,"name",!0);case"distance":return new v("distance",t,"name",!0);default:throw new Error(`Unknown column ${e}`)}}reset(){this.rootNode().removeChildren(),this.resetSortingCache()}updateResetButtonVisibility(){this.snapshot?.areNodesIgnoredInRetainersView().then(e=>{this.resetRetainersButton?.setVisible(e)})}async setDataSource(e,t,i){await super.setDataSource(e,t,i),this.rootNode().expand(),this.updateResetButtonVisibility()}async dataSourceChanged(){this.reset(),await this.rootNode().sort(),this.rootNode().expand(),this.updateResetButtonVisibility()}}var ct;(function(d){d.ExpandRetainersComplete="ExpandRetainersComplete"})(ct||(ct={}));class Oi extends Ye{profileIndex;objectIdToSelect;nextRequestedFilter;lastFilter;filterInProgress;constructor(e,t){const i=[{id:"object",title:w(S.constructorString),disclosure:!0,sortable:!0},{id:"distance",title:w(S.distance),width:"70px",sortable:!0,fixedWidth:!0},{id:"shallowSize",title:w(S.shallowSize),width:"110px",sortable:!0,fixedWidth:!0},{id:"retainedSize",title:w(S.retainedSize),width:"110px",sort:Q.Descending,sortable:!0,fixedWidth:!0}];super(e,t,{displayName:w(S.heapSnapshotConstructors).toString(),columns:i}),this.profileIndex=-1,this.objectIdToSelect=null,this.nextRequestedFilter=null}sortFields(e,t){switch(e){case"object":return new v("name",t,"retainedSize",!1);case"distance":return new v("distance",t,"retainedSize",!1);case"shallowSize":return new v("shallowSize",t,"name",!0);case"retainedSize":return new v("retainedSize",t,"name",!0);default:throw new Error(`Unknown column ${e}`)}}async revealObjectByHeapSnapshotId(e){if(!this.snapshot)return this.objectIdToSelect=e,null;const t=await this.snapshot.nodeClassName(parseInt(e,10));if(!t)return null;const i=this.topLevelNodes().find(r=>r.name===t);if(!i)return null;const s=await i.populateNodeBySnapshotObjectId(parseInt(e,10));return s.length?this.revealTreeNode(s):null}clear(){this.nextRequestedFilter=null,this.lastFilter=null,this.removeTopLevelNodes()}async setDataSource(e,t){this.snapshot=e,this.profileIndex===-1&&this.populateChildren(),this.objectIdToSelect&&(this.revealObjectByHeapSnapshotId(this.objectIdToSelect),this.objectIdToSelect=null)}setSelectionRange(e,t){this.nodeFilterInternal=new ve(e,t),this.populateChildren(this.nodeFilterInternal)}setAllocationNodeId(e){this.nodeFilterInternal=new ve,this.nodeFilterInternal.allocationNodeId=e,this.populateChildren(this.nodeFilterInternal)}aggregatesReceived(e,t){this.filterInProgress=null,this.nextRequestedFilter&&this.snapshot&&(this.snapshot.aggregatesWithFilter(this.nextRequestedFilter).then(this.aggregatesReceived.bind(this,this.nextRequestedFilter)),this.filterInProgress=this.nextRequestedFilter,this.nextRequestedFilter=null),this.removeTopLevelNodes(),this.resetSortingCache();for(const i in t)this.appendNode(this.rootNode(),new It(this,i,t[i],e));this.sortingChanged(),this.lastFilter=e}async populateChildren(e){const t=e||new ve;if(this.filterInProgress){this.nextRequestedFilter=this.filterInProgress.equals(t)?null:t;return}if(!(this.lastFilter&&this.lastFilter.equals(t))&&(this.filterInProgress=t,this.snapshot)){const i=await this.snapshot.aggregatesWithFilter(t);this.aggregatesReceived(t,i)}}filterSelectIndexChanged(e,t,i){if(this.profileIndex=t,this.nodeFilterInternal=void 0,t!==-1){const s=t>0?e[t-1].maxJSObjectId:0,r=e[t].maxJSObjectId;this.nodeFilterInternal=new ve(s,r)}else i!==void 0&&(this.nodeFilterInternal=new ve,this.nodeFilterInternal.filterName=i);this.populateChildren(this.nodeFilterInternal)}}class Li extends Ye{baseSnapshot;constructor(e,t){const i=[{id:"object",title:w(S.constructorString),disclosure:!0,sortable:!0},{id:"addedCount",title:w(S.New),width:"75px",sortable:!0,fixedWidth:!0},{id:"removedCount",title:w(S.Deleted),width:"75px",sortable:!0,fixedWidth:!0},{id:"countDelta",title:w(S.Delta),width:"65px",sortable:!0,fixedWidth:!0},{id:"addedSize",title:w(S.allocSize),width:"75px",sortable:!0,fixedWidth:!0,sort:Q.Descending},{id:"removedSize",title:w(S.freedSize),width:"75px",sortable:!0,fixedWidth:!0},{id:"sizeDelta",title:w(S.sizeDelta),width:"75px",sortable:!0,fixedWidth:!0}];super(e,t,{displayName:w(S.heapSnapshotDiff).toString(),columns:i})}defaultPopulateCount(){return 50}sortFields(e,t){switch(e){case"object":return new v("name",t,"count",!1);case"addedCount":return new v("addedCount",t,"name",!0);case"removedCount":return new v("removedCount",t,"name",!0);case"countDelta":return new v("countDelta",t,"name",!0);case"addedSize":return new v("addedSize",t,"name",!0);case"removedSize":return new v("removedSize",t,"name",!0);case"sizeDelta":return new v("sizeDelta",t,"name",!0);default:throw new Error(`Unknown column ${e}`)}}async setDataSource(e,t){this.snapshot=e}setBaseDataSource(e){if(this.baseSnapshot=e,this.removeTopLevelNodes(),this.resetSortingCache(),this.baseSnapshot===this.snapshot){this.dispatchEventToListeners(M.SortingComplete);return}this.populateChildren()}async populateChildren(){if(this.snapshot===null||this.baseSnapshot===void 0||this.baseSnapshot.uid===void 0)throw new Error("Data sources have not been set correctly");const e=await this.snapshot.interfaceDefinitions(),t=await this.baseSnapshot.aggregatesForDiff(e),i=await this.snapshot.calculateSnapshotDiff(this.baseSnapshot.uid,t);for(const s in i){const r=i[s];this.appendNode(this.rootNode(),new yt(this,s,r))}this.sortingChanged()}}class zi extends Ye{linkifierInternal;topNodes;constructor(e,t){const i=[{id:"liveCount",title:w(S.liveCount),width:"75px",sortable:!0,fixedWidth:!0},{id:"count",title:w(S.count),width:"65px",sortable:!0,fixedWidth:!0},{id:"liveSize",title:w(S.liveSize),width:"75px",sortable:!0,fixedWidth:!0},{id:"size",title:w(S.size),width:"75px",sortable:!0,fixedWidth:!0,sort:Q.Descending},{id:"name",title:w(S.function),disclosure:!0,sortable:!0}];super(e,t,{displayName:w(S.allocation).toString(),columns:i}),this.linkifierInternal=new oe}get linkifier(){return this.linkifierInternal}dispose(){this.linkifierInternal.reset()}async setDataSource(e,t){this.snapshot=e,this.topNodes=await this.snapshot.allocationTracesTops(),this.populateChildren()}populateChildren(){this.removeTopLevelNodes();const e=this.rootNode(),t=this.topNodes||[];for(const i of t)this.appendNode(e,new Pe(this,i));this.updateVisibleNodes(!0)}sortingChanged(){this.topNodes!==void 0&&(this.topNodes.sort(this.createComparator()),this.rootNode().removeChildren(),this.populateChildren())}createComparator(){const e=this.sortColumnId(),t=this.sortOrder()===Q.Ascending?1:-1;function i(s,r){return s[e]>r[e]?t:s[e]<r[e]?-t:0}return i}}const bn=Object.freeze(Object.defineProperty({__proto__:null,AllocationDataGrid:zi,HeapSnapshotConstructorsDataGrid:Oi,HeapSnapshotContainmentDataGrid:Tt,HeapSnapshotDiffDataGrid:Li,HeapSnapshotRetainmentDataGrid:Fi,get HeapSnapshotRetainmentDataGridEvents(){return ct},HeapSnapshotSortableDataGrid:Pt,get HeapSnapshotSortableDataGridEvents(){return M},HeapSnapshotViewportDataGrid:Ye},Symbol.toStringTag,{value:"Module"})),Bi={anErrorOccurredWhenACallToMethod:"An error occurred when a call to method ''{PH1}'' was requested"},wr=O("panels/profiler/HeapSnapshotProxy.ts",Bi),br=L.bind(void 0,wr);class Ai extends mt{eventHandler;nextObjectId;nextCallId;callbacks;previousCallbacks;worker;interval;constructor(e){super(),this.eventHandler=e,this.nextObjectId=1,this.nextCallId=1,this.callbacks=new Map,this.previousCallbacks=new Set,this.worker=Fs.fromURL(new URL("data:text/javascript;base64,Ly8gQ29weXJpZ2h0IDIwMjAgVGhlIENocm9taXVtIEF1dGhvcnMuIEFsbCByaWdodHMgcmVzZXJ2ZWQuCi8vIFVzZSBvZiB0aGlzIHNvdXJjZSBjb2RlIGlzIGdvdmVybmVkIGJ5IGEgQlNELXN0eWxlIGxpY2Vuc2UgdGhhdCBjYW4gYmUKLy8gZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZS4KaW1wb3J0ICogYXMgSGVhcFNuYXBzaG90V29ya2VyIGZyb20gJy4vaGVhcF9zbmFwc2hvdF93b3JrZXIuanMnOwpjb25zdCBkaXNwYXRjaGVyID0gbmV3IEhlYXBTbmFwc2hvdFdvcmtlci5IZWFwU25hcHNob3RXb3JrZXJEaXNwYXRjaGVyLkhlYXBTbmFwc2hvdFdvcmtlckRpc3BhdGNoZXIoc2VsZi5wb3N0TWVzc2FnZS5iaW5kKHNlbGYpKTsKc2VsZi5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgZGlzcGF0Y2hlci5kaXNwYXRjaE1lc3NhZ2UuYmluZChkaXNwYXRjaGVyKSwgZmFsc2UpOwpzZWxmLnBvc3RNZXNzYWdlKCd3b3JrZXJSZWFkeScpOwovLyMgc291cmNlTWFwcGluZ1VSTD1oZWFwX3NuYXBzaG90X3dvcmtlci1lbnRyeXBvaW50LmpzLm1hcA==",import.meta.url)),this.worker.onmessage=this.messageReceived.bind(this)}createLoader(e,t){const i=this.nextObjectId++,s=new Hi(this,i,e,t);return this.postMessage({callId:this.nextCallId++,disposition:"createLoader",objectId:i}),s}dispose(){this.worker.terminate(),this.interval&&clearInterval(this.interval)}disposeObject(e){this.postMessage({callId:this.nextCallId++,disposition:"dispose",objectId:e})}evaluateForTest(e,t){const i=this.nextCallId++;this.callbacks.set(i,t),this.postMessage({callId:i,disposition:"evaluateForTest",source:e})}callFactoryMethod(e,t,i,s,...r){const n=this.nextCallId++,o=this.nextObjectId++;return e?(this.callbacks.set(n,l=>{e(l?new s(this,o):null)}),this.postMessage({callId:n,disposition:"factory",objectId:t,methodName:i,methodArguments:r,newObjectId:o}),null):(this.postMessage({callId:n,disposition:"factory",objectId:t,methodName:i,methodArguments:r,newObjectId:o}),new s(this,o))}callMethod(e,t,i,...s){const r=this.nextCallId++;e&&this.callbacks.set(r,e),this.postMessage({callId:r,disposition:"method",objectId:t,methodName:i,methodArguments:s})}startCheckingForLongRunningCalls(){this.interval||(this.checkLongRunningCalls(),this.interval=window.setInterval(this.checkLongRunningCalls.bind(this),300))}checkLongRunningCalls(){for(const t of this.previousCallbacks)this.callbacks.has(t)||this.previousCallbacks.delete(t);const e=!!this.previousCallbacks.size;this.dispatchEventToListeners("Wait",e);for(const t of this.callbacks.keys())this.previousCallbacks.add(t)}messageReceived(e){const t=e.data;if(t.eventName){this.eventHandler&&this.eventHandler(t.eventName,t.data);return}if(t.error){t.errorMethodName&&G.instance().error(br(Bi.anErrorOccurredWhenACallToMethod,{PH1:t.errorMethodName})),G.instance().error(t.errorCallStack),this.callbacks.delete(t.callId);return}const i=this.callbacks.get(t.callId);i&&(this.callbacks.delete(t.callId),i(t.result))}postMessage(e){this.worker.postMessage(e)}}class Xe{worker;objectId;constructor(e,t){this.worker=e,this.objectId=t}dispose(){this.worker.disposeObject(this.objectId)}disposeWorker(){this.worker.dispose()}callFactoryMethod(e,t,...i){return this.worker.callFactoryMethod(null,String(this.objectId),e,t,...i)}callFactoryMethodPromise(e,t,...i){return new Promise(s=>this.worker.callFactoryMethod(s,String(this.objectId),e,t,...i))}callMethodPromise(e,...t){return new Promise(i=>this.worker.callMethod(i,String(this.objectId),e,...t))}}class Hi extends Xe{profileUid;snapshotReceivedCallback;constructor(e,t,i,s){super(e,t),this.profileUid=i,this.snapshotReceivedCallback=s}async write(e){await this.callMethodPromise("write",e)}async close(){await this.callMethodPromise("close");const e=await this.callFactoryMethodPromise("buildSnapshot",ji);this.dispose(),e.setProfileUid(this.profileUid),await e.updateStaticData(),this.snapshotReceivedCallback(e)}}class ji extends Xe{staticData;profileUid;constructor(e,t){super(e,t),this.staticData=null}search(e,t){return this.callMethodPromise("search",e,t)}interfaceDefinitions(){return this.callMethodPromise("interfaceDefinitions")}aggregatesWithFilter(e){return this.callMethodPromise("aggregatesWithFilter",e)}aggregatesForDiff(e){return this.callMethodPromise("aggregatesForDiff",e)}calculateSnapshotDiff(e,t){return this.callMethodPromise("calculateSnapshotDiff",e,t)}nodeClassName(e){return this.callMethodPromise("nodeClassName",e)}createEdgesProvider(e){return this.callFactoryMethod("createEdgesProvider",ie,e)}createRetainingEdgesProvider(e){return this.callFactoryMethod("createRetainingEdgesProvider",ie,e)}createAddedNodesProvider(e,t){return this.callFactoryMethod("createAddedNodesProvider",ie,e,t)}createDeletedNodesProvider(e){return this.callFactoryMethod("createDeletedNodesProvider",ie,e)}createNodesProvider(e){return this.callFactoryMethod("createNodesProvider",ie,e)}createNodesProviderForClass(e,t){return this.callFactoryMethod("createNodesProviderForClass",ie,e,t)}allocationTracesTops(){return this.callMethodPromise("allocationTracesTops")}allocationNodeCallers(e){return this.callMethodPromise("allocationNodeCallers",e)}allocationStack(e){return this.callMethodPromise("allocationStack",e)}dispose(){throw new Error("Should never be called")}get nodeCount(){return this.staticData?this.staticData.nodeCount:0}get rootNodeIndex(){return this.staticData?this.staticData.rootNodeIndex:0}async updateStaticData(){this.staticData=await this.callMethodPromise("updateStaticData")}getStatistics(){return this.callMethodPromise("getStatistics")}getLocation(e){return this.callMethodPromise("getLocation",e)}getSamples(){return this.callMethodPromise("getSamples")}ignoreNodeInRetainersView(e){return this.callMethodPromise("ignoreNodeInRetainersView",e)}unignoreNodeInRetainersView(e){return this.callMethodPromise("unignoreNodeInRetainersView",e)}unignoreAllNodesInRetainersView(){return this.callMethodPromise("unignoreAllNodesInRetainersView")}areNodesIgnoredInRetainersView(){return this.callMethodPromise("areNodesIgnoredInRetainersView")}get totalSize(){return this.staticData?this.staticData.totalSize:0}get uid(){return this.profileUid}setProfileUid(e){this.profileUid=e}maxJSObjectId(){return this.staticData?this.staticData.maxJSObjectId:0}}class ie extends Xe{constructor(e,t){super(e,t)}nodePosition(e){return this.callMethodPromise("nodePosition",e)}isEmpty(){return this.callMethodPromise("isEmpty")}serializeItemsRange(e,t){return this.callMethodPromise("serializeItemsRange",e,t)}async sortAndRewind(e){await this.callMethodPromise("sortAndRewind",e)}}const Cn=Object.freeze(Object.defineProperty({__proto__:null,HeapSnapshotLoaderProxy:Hi,HeapSnapshotProviderProxy:ie,HeapSnapshotProxy:ji,HeapSnapshotProxyObject:Xe,HeapSnapshotWorkerProxy:Ai},Symbol.toStringTag,{value:"Module"})),Cr={buildingEdgeIndexes:"Building edge indexes…",buildingRetainers:"Building retainers…",propagatingDomState:"Propagating DOM state…",calculatingNodeFlags:"Calculating node flags…",calculatingDistances:"Calculating distances…",calculatingShallowSizes:"Calculating shallow sizes…",calculatingRetainedSizes:"Calculating retained sizes…",buildingDominatedNodes:"Building dominated nodes…",calculatingObjectNames:"Calculating object names…",calculatingStatistics:"Calculating statistics…",calculatingSamples:"Calculating samples…",buildingLocations:"Building locations…",finishedProcessing:"Finished processing.",buildingAllocationStatistics:"Building allocation statistics…",done:"Done",processingSnapshot:"Processing snapshot…",parsingStrings:"Parsing strings…",loadingSnapshotInfo:"Loading snapshot info…",loadingNodesD:"Loading nodes… {PH1}%",loadingEdgesD:"Loading edges… {PH1}%",loadingAllocationTracesD:"Loading allocation traces… {PH1}%",loadingSamples:"Loading samples…",loadingLocations:"Loading locations…",loadingStrings:"Loading strings…"},u={find:"Find",containment:"Containment",retainers:"Retainers",allocationStack:"Allocation stack",perspective:"Perspective",baseSnapshot:"Base snapshot",filter:"Filter",filterByClass:"Filter by class",code:"Code",strings:"Strings",jsArrays:"JS arrays",typedArrays:"Typed arrays",systemObjects:"System objects",selectedSizeS:"Selected size: {PH1}",allObjects:"All objects",objectsAllocatedBeforeS:"Objects allocated before {PH1}",objectsAllocatedBetweenSAndS:"Objects allocated between {PH1} and {PH2}",duplicatedStrings:"Duplicated strings",objectsRetainedByDetachedDomNodes:"Objects retained by detached DOM nodes",objectsRetainedByConsole:"Objects retained by DevTools Console",summary:"Summary",comparison:"Comparison",allocation:"Allocation",liveObjects:"Live objects",statistics:"Statistics",heapSnapshot:"Heap snapshot",takeHeapSnapshot:"Take heap snapshot",heapSnapshots:"Heap snapshots",heapSnapshotProfilesShowMemory:"See the memory distribution of JavaScript objects and related DOM nodes",exposeInternals:"Internals with implementation details",snapshotting:"Snapshotting…",snapshotD:"Snapshot {PH1}",percentagePlaceholder:"{PH1}%",allocationInstrumentationOn:"Allocations on timeline",stopRecordingHeapProfile:"Stop recording heap profile",startRecordingHeapProfile:"Start recording heap profile",recordAllocationStacksExtra:"Allocation stack traces (more overhead)",recording:"Recording…",allocationTimelines:"Allocation timelines",AllocationTimelinesShowInstrumented:"Record memory allocations over time and isolate memory leaks by selecting intervals with allocations that are still alive",loading:"Loading…",savingD:"Saving… {PH1}%",heapMemoryUsage:"Heap memory usage",stackWasNotRecordedForThisObject:"Stack wasn't recorded for this object because it had been allocated before this profile recording started.",restoreIgnoredRetainers:"Restore ignored retainers"},Ir=O("panels/profiler/HeapSnapshotView.ts",u),f=L.bind(void 0,Ir),yr=O("panels/profiler/ModuleUIStrings.ts",Cr),Pr=L.bind(void 0,yr);class ne extends vt{searchResults;profile;linkifier;parentDataDisplayDelegate;searchableViewInternal;splitWidget;containmentDataGrid;containmentWidget;statisticsView;constructorsDataGrid;constructorsWidget;diffDataGrid;diffWidget;allocationDataGrid;allocationWidget;allocationStackView;tabbedPane;retainmentDataGrid;retainmentWidget;objectDetailsView;perspectives;comparisonPerspective;perspectiveSelect;baseSelect;filterSelect;classNameFilter;selectedSizeText;resetRetainersButton;popoverHelper;currentPerspectiveIndex;currentPerspective;dataGrid;searchThrottler;baseProfile;trackingOverviewGrid;currentSearchResultIndex=-1;currentQuery;constructor(e,t){super(f(u.heapSnapshot)),this.searchResults=[],this.element.classList.add("heap-snapshot-view"),this.profile=t,this.linkifier=new oe;const i=t.profileType();i.addEventListener("SnapshotReceived",this.onReceiveSnapshot,this),i.addEventListener("remove-profile-header",this.onProfileHeaderRemoved,this);const s=i.id===be.TypeId;s&&this.createOverview();const r=he.trackingHeapSnapshotProfileType.recordAllocationStacksSetting().get();this.parentDataDisplayDelegate=e,this.searchableViewInternal=new Yt(this,null),this.searchableViewInternal.setPlaceholder(f(u.find),f(u.find)),this.searchableViewInternal.show(this.element),this.splitWidget=new ii(!1,!0,"heap-snapshot-split-view-state",200,200),this.splitWidget.show(this.searchableViewInternal.element);const n=t.heapProfilerModel();this.containmentDataGrid=new Tt(n,this,f(u.containment)),this.containmentDataGrid.addEventListener("SelectedNode",this.selectionChanged,this),this.containmentWidget=this.containmentDataGrid.asWidget(),this.containmentWidget.setMinimumSize(50,25),this.statisticsView=new qe,this.constructorsDataGrid=new Oi(n,this),this.constructorsDataGrid.addEventListener("SelectedNode",this.selectionChanged,this),this.constructorsWidget=this.constructorsDataGrid.asWidget(),this.constructorsWidget.setMinimumSize(50,25),this.constructorsWidget.element.setAttribute("jslog",`${rt("heap-snapshot.constructors-view").track({resize:!0})}`),this.diffDataGrid=new Li(n,this),this.diffDataGrid.addEventListener("SelectedNode",this.selectionChanged,this),this.diffWidget=this.diffDataGrid.asWidget(),this.diffWidget.setMinimumSize(50,25),this.allocationDataGrid=null,s&&r&&(this.allocationDataGrid=new zi(n,this),this.allocationDataGrid.addEventListener("SelectedNode",this.onSelectAllocationNode,this),this.allocationWidget=this.allocationDataGrid.asWidget(),this.allocationWidget.setMinimumSize(50,25),this.allocationStackView=new _i(n),this.allocationStackView.setMinimumSize(50,25),this.tabbedPane=new kt),this.retainmentDataGrid=new Fi(n,this),this.retainmentWidget=this.retainmentDataGrid.asWidget(),this.retainmentWidget.setMinimumSize(50,21),this.retainmentWidget.element.classList.add("retaining-paths-view"),this.retainmentWidget.element.setAttribute("jslog",`${rt("heap-snapshot.retaining-paths-view").track({resize:!0})}`);let o;if(this.allocationStackView)this.tabbedPane=new kt,this.tabbedPane.appendTab("retainers",f(u.retainers),this.retainmentWidget),this.tabbedPane.appendTab("allocation-stack",f(u.allocationStack),this.allocationStackView),o=this.tabbedPane.headerElement(),this.objectDetailsView=this.tabbedPane;else{const a=document.createElement("div");a.classList.add("heap-snapshot-view-resizer");const h=a.createChild("div","title");a.createChild("div","verticalResizerIcon");const m=h.createChild("span");m.textContent=f(u.retainers),o=a,this.objectDetailsView=new W,this.objectDetailsView.element.appendChild(a),this.retainmentWidget.show(this.objectDetailsView.element)}this.splitWidget.hideDefaultResizer(),this.splitWidget.installResizer(o),this.retainmentDataGrid.addEventListener("SelectedNode",this.inspectedObjectChanged,this),this.retainmentDataGrid.reset(),this.perspectives=[],this.comparisonPerspective=new Gi,this.perspectives.push(new Mi),t.profileType()!==he.trackingHeapSnapshotProfileType&&this.perspectives.push(this.comparisonPerspective),this.perspectives.push(new Vi),this.allocationWidget&&this.perspectives.push(new Wi),this.perspectives.push(new Ui),this.perspectiveSelect=new De(this.onSelectedPerspectiveChanged.bind(this),f(u.perspective),void 0,"profiler.heap-snapshot-perspective"),this.updatePerspectiveOptions(),this.baseSelect=new De(this.changeBase.bind(this),f(u.baseSnapshot),void 0,"profiler.heap-snapshot-base"),this.baseSelect.setVisible(!1),this.updateBaseOptions(),this.filterSelect=new De(this.changeFilter.bind(this),f(u.filter),void 0,"profiler.heap-snapshot-filter"),this.filterSelect.setVisible(!1),this.updateFilterOptions(),this.classNameFilter=new Os(f(u.filterByClass)),this.classNameFilter.setVisible(!1),this.constructorsDataGrid.setNameFilter(this.classNameFilter),this.diffDataGrid.setNameFilter(this.classNameFilter),this.selectedSizeText=new St;const l=f(u.restoreIgnoredRetainers);this.resetRetainersButton=new ke(l,"clear-list",l),this.resetRetainersButton.setVisible(!1),this.resetRetainersButton.addEventListener("Click",async()=>{await this.retainmentDataGrid.snapshot?.unignoreAllNodesInRetainersView(),await this.retainmentDataGrid.dataSourceChanged()}),this.retainmentDataGrid.resetRetainersButton=this.resetRetainersButton,this.popoverHelper=new Xs(this.element,this.getPopoverRequest.bind(this),"profiler.heap-snapshot-object"),this.popoverHelper.setDisableOnClick(!0),this.popoverHelper.setHasPadding(!0),this.element.addEventListener("scroll",this.popoverHelper.hidePopover.bind(this.popoverHelper),!0),this.currentPerspectiveIndex=0,this.currentPerspective=this.perspectives[0],this.currentPerspective.activate(this),this.dataGrid=this.currentPerspective.masterGrid(this),this.populate(),this.searchThrottler=new Ls(0);for(const a of this.profiles())a.addEventListener("ProfileTitleChanged",this.updateControls,this)}createOverview(){const e=this.profile.profileType();this.trackingOverviewGrid=new Ct,this.trackingOverviewGrid.addEventListener("IdsRangeChanged",this.onIdsRangeChanged.bind(this)),!this.profile.fromFile()&&e.profileBeingRecorded()===this.profile&&(e.addEventListener("HeapStatsUpdate",this.onHeapStatsUpdate,this),e.addEventListener("TrackingStopped",this.onStopTracking,this),this.trackingOverviewGrid.start())}onStopTracking(){const e=this.profile.profileType();e.removeEventListener("HeapStatsUpdate",this.onHeapStatsUpdate,this),e.removeEventListener("TrackingStopped",this.onStopTracking,this),this.trackingOverviewGrid&&this.trackingOverviewGrid.stop()}onHeapStatsUpdate({data:e}){this.trackingOverviewGrid&&this.trackingOverviewGrid.setSamples(e)}searchableView(){return this.searchableViewInternal}showProfile(e){return this.parentDataDisplayDelegate.showProfile(e)}showObject(e,t){Number(e)<=this.profile.maxJSObjectId?this.selectLiveObject(t,e):this.parentDataDisplayDelegate.showObject(e,t)}async linkifyObject(e){const t=this.profile.heapProfilerModel();if(!t)return null;const i=await this.profile.getLocation(e);if(!i)return null;const r=t.runtimeModel().debuggerModel().createRawLocationByScriptId(String(i.scriptId),i.lineNumber,i.columnNumber);if(!r)return null;const n=r.script(),o=n&&n.sourceURL;return o&&this.linkifier?this.linkifier.linkifyRawLocation(r,o):null}async populate(){const e=await this.profile.loadPromise;if(this.retrieveStatistics(e),this.dataGrid&&this.dataGrid.setDataSource(e,0),this.profile.profileType().id===be.TypeId&&this.profile.fromFile()){const s=await e.getSamples();if(s){console.assert(!!s.timestamps.length);const r=new _e;r.sizes=s.sizes,r.ids=s.lastAssignedIds,r.timestamps=s.timestamps,r.max=s.sizes,r.totalTime=Math.max(s.timestamps[s.timestamps.length-1]||0,1e4),this.trackingOverviewGrid&&this.trackingOverviewGrid.setSamples(r)}}const i=this.profiles().indexOf(this.profile);this.baseSelect.setSelectedIndex(Math.max(0,i-1)),this.trackingOverviewGrid&&this.trackingOverviewGrid.updateGrid()}async retrieveStatistics(e){const t=await e.getStatistics(),i=[{value:t.code,color:"#f77",title:f(u.code)},{value:t.strings,color:"#5e5",title:f(u.strings)},{value:t.jsArrays,color:"#7af",title:f(u.jsArrays)},{value:t.native,color:"#fc5",title:f(u.typedArrays)},{value:t.system,color:"#98f",title:f(u.systemObjects)}];return this.statisticsView.setTotalAndRecords(t.total,i),t}onIdsRangeChanged(e){const{minId:t,maxId:i}=e.data;this.selectedSizeText.setText(f(u.selectedSizeS,{PH1:J(e.data.size)})),this.constructorsDataGrid.snapshot&&this.constructorsDataGrid.setSelectionRange(t,i)}async toolbarItems(){const e=[this.perspectiveSelect,this.classNameFilter];return this.profile.profileType()!==he.trackingHeapSnapshotProfileType&&e.push(this.baseSelect,this.filterSelect),e.push(this.selectedSizeText),e.push(this.resetRetainersButton),e}willHide(){this.currentSearchResultIndex=-1,this.popoverHelper.hidePopover()}supportsCaseSensitiveSearch(){return!0}supportsRegexSearch(){return!1}onSearchCanceled(){this.currentSearchResultIndex=-1,this.searchResults=[]}selectRevealedNode(e){e&&e.select()}performSearch(e,t,i){const s=new fr(e.query.trim(),e.caseSensitive,e.isRegex,t,i||!1);this.searchThrottler.schedule(this.performSearchInternal.bind(this,s))}async performSearchInternal(e){if(this.onSearchCanceled(),!this.currentPerspective.supportsSearch())return;this.currentQuery=e;const t=e.query.trim();if(!t)return;if(t.charAt(0)==="@"){const s=parseInt(t.substring(1),10);if(isNaN(s)||!this.dataGrid)return;const r=await this.dataGrid.revealObjectByHeapSnapshotId(String(s));this.selectRevealedNode(r);return}if(!this.profile.snapshotProxy||!this.dataGrid)return;const i=this.dataGrid.nodeFilter();this.searchResults=i?await this.profile.snapshotProxy.search(this.currentQuery,i):[],this.searchableViewInternal.updateSearchMatchesCount(this.searchResults.length),this.searchResults.length&&(this.currentSearchResultIndex=e.jumpBackward?this.searchResults.length-1:0),await this.jumpToSearchResult(this.currentSearchResultIndex)}jumpToNextSearchResult(){this.searchResults.length&&(this.currentSearchResultIndex=(this.currentSearchResultIndex+1)%this.searchResults.length,this.searchThrottler.schedule(this.jumpToSearchResult.bind(this,this.currentSearchResultIndex)))}jumpToPreviousSearchResult(){this.searchResults.length&&(this.currentSearchResultIndex=(this.currentSearchResultIndex+this.searchResults.length-1)%this.searchResults.length,this.searchThrottler.schedule(this.jumpToSearchResult.bind(this,this.currentSearchResultIndex)))}async jumpToSearchResult(e){if(this.searchableViewInternal.updateCurrentMatchIndex(e),e===-1||!this.dataGrid)return;const t=await this.dataGrid.revealObjectByHeapSnapshotId(String(this.searchResults[e]));this.selectRevealedNode(t)}refreshVisibleData(){if(!this.dataGrid)return;let e=this.dataGrid.rootNode().children[0];for(;e;)e.refresh(),e=e.traverseNextNode(!1,null,!0)}changeBase(){if(this.baseProfile===this.profiles()[this.baseSelect.selectedIndex()])return;this.baseProfile=this.profiles()[this.baseSelect.selectedIndex()];const e=this.dataGrid;e.snapshot&&this.baseProfile.loadPromise.then(e.setBaseDataSource.bind(e)),!(!this.currentQuery||!this.searchResults)&&this.performSearch(this.currentQuery,!1)}static ALWAYS_AVAILABLE_FILTERS=[{uiName:f(u.duplicatedStrings),filterName:"duplicatedStrings"},{uiName:f(u.objectsRetainedByDetachedDomNodes),filterName:"objectsRetainedByDetachedDomNodes"},{uiName:f(u.objectsRetainedByConsole),filterName:"objectsRetainedByConsole"}];changeFilter(){let e=this.filterSelect.selectedIndex(),t;const i=this.filterSelect.size()-ne.ALWAYS_AVAILABLE_FILTERS.length;e>=i&&(t=ne.ALWAYS_AVAILABLE_FILTERS[e-i].filterName,e=0);const s=e-1;this.dataGrid&&(this.dataGrid.filterSelectIndexChanged(this.profiles(),s,t),!(!this.currentQuery||!this.searchResults)&&this.performSearch(this.currentQuery,!1))}profiles(){return this.profile.profileType().getProfiles()}selectionChanged(e){const t=e.data;this.setSelectedNodeForDetailsView(t),this.inspectedObjectChanged(e)}onSelectAllocationNode(e){const t=e.data;this.constructorsDataGrid.setAllocationNodeId(t.allocationNodeId()),this.setSelectedNodeForDetailsView(null)}inspectedObjectChanged(e){const t=e.data,i=this.profile.heapProfilerModel();i&&t instanceof Ee&&i.addInspectedHeapObject(String(t.snapshotNodeId))}setSelectedNodeForDetailsView(e){const t=e&&e.retainersDataSource();t?(this.retainmentDataGrid.setDataSource(t.snapshot,t.snapshotNodeIndex,t.snapshotNodeId),this.allocationStackView&&this.allocationStackView.setAllocatedObject(t.snapshot,t.snapshotNodeIndex)):(this.allocationStackView&&this.allocationStackView.clear(),this.retainmentDataGrid.reset())}async changePerspectiveAndWait(e){const t=this.perspectives.findIndex(n=>n.title()===e);if(t===-1||this.currentPerspectiveIndex===t)return;const i=this.perspectives[t].masterGrid(this);if(!i)return;const s=i.once(M.ContentShown),r=this.perspectiveSelect.options().find(n=>n.value===String(t));this.perspectiveSelect.select(r),this.changePerspective(t),await s}async updateDataSourceAndView(){const e=this.dataGrid;if(!e||e.snapshot)return;const t=await this.profile.loadPromise;if(this.dataGrid!==e||(e.snapshot!==t&&e.setDataSource(t,0),e!==this.diffDataGrid))return;this.baseProfile||(this.baseProfile=this.profiles()[this.baseSelect.selectedIndex()]);const i=await this.baseProfile.loadPromise;this.diffDataGrid.baseSnapshot!==i&&this.diffDataGrid.setBaseDataSource(i)}onSelectedPerspectiveChanged(e){this.changePerspective(Number(e.target.selectedOptions[0].value))}changePerspective(e){if(e===this.currentPerspectiveIndex)return;this.currentPerspectiveIndex=e,this.currentPerspective.deactivate(this);const t=this.perspectives[e];this.currentPerspective=t,this.dataGrid=t.masterGrid(this),t.activate(this),this.refreshVisibleData(),this.dataGrid&&this.dataGrid.updateWidths(),this.updateDataSourceAndView(),!(!this.currentQuery||!this.searchResults)&&this.performSearch(this.currentQuery,!1)}async selectLiveObject(e,t){if(await this.changePerspectiveAndWait(e),!this.dataGrid)return;const i=await this.dataGrid.revealObjectByHeapSnapshotId(t);i?i.select():G.instance().error("Cannot find corresponding heap snapshot node")}getPopoverRequest(e){const t=Ft(e.target,"span"),i=Ft(e.target,"tr");if(!i||!this.dataGrid)return null;const s=this.dataGrid.dataGridNodeFromNode(i)||this.containmentDataGrid.dataGridNodeFromNode(i)||this.constructorsDataGrid.dataGridNodeFromNode(i)||this.diffDataGrid.dataGridNodeFromNode(i)||this.allocationDataGrid&&this.allocationDataGrid.dataGridNodeFromNode(i)||this.retainmentDataGrid.dataGridNodeFromNode(i),r=this.profile.heapProfilerModel();if(!s||!t||!r)return null;let n;return{box:t.boxInWindow(),show:async o=>{if(!r)return!1;const l=await s.queryObjectContent(r,"popover");return l instanceof zs?n=await Ot.buildObjectPopover(l,o):n=Ot.buildDescriptionPopover(l.description,l.link,o),n?!0:(r.runtimeModel().releaseObjectGroup("popover"),!1)},hide:()=>{r.runtimeModel().releaseObjectGroup("popover"),n&&n.dispose()}}}updatePerspectiveOptions(){const e=this.profiles().length>1;this.perspectiveSelect.removeOptions(),this.perspectives.forEach((t,i)=>{if(e||t!==this.comparisonPerspective){const s=this.perspectiveSelect.createOption(t.title(),String(i));t===this.currentPerspective&&this.perspectiveSelect.select(s)}})}updateBaseOptions(){const e=this.profiles(),t=this.baseSelect.selectedIndex();this.baseSelect.removeOptions();for(const i of e)this.baseSelect.createOption(i.title);t>-1&&this.baseSelect.setSelectedIndex(t)}updateFilterOptions(){const e=this.profiles(),t=this.filterSelect.selectedIndex(),i=this.filterSelect.size();this.filterSelect.removeOptions(),this.filterSelect.createOption(f(u.allObjects));for(let o=0;o<e.length;++o){let l;o?l=f(u.objectsAllocatedBetweenSAndS,{PH1:e[o-1].title,PH2:e[o].title}):l=f(u.objectsAllocatedBeforeS,{PH1:e[o].title}),this.filterSelect.createOption(l)}const s=this.filterSelect.size(),r=this.filterSelect.createOption("—".repeat(18));r.disabled=!0;for(const o of ne.ALWAYS_AVAILABLE_FILTERS)this.filterSelect.createOption(o.uiName);const n=this.filterSelect.size();if(t>-1){const o=i-t;o<=ne.ALWAYS_AVAILABLE_FILTERS.length?this.filterSelect.setSelectedIndex(n-o):t>=s?this.filterSelect.setSelectedIndex(-1):this.filterSelect.setSelectedIndex(t)}}updateControls(){this.updatePerspectiveOptions(),this.updateBaseOptions(),this.updateFilterOptions()}onReceiveSnapshot(e){this.updateControls(),e.data.addEventListener("ProfileTitleChanged",this.updateControls,this)}onProfileHeaderRemoved(e){const t=e.data;t.removeEventListener("ProfileTitleChanged",this.updateControls,this),this.profile===t?(this.detach(),this.profile.profileType().removeEventListener("SnapshotReceived",this.onReceiveSnapshot,this),this.profile.profileType().removeEventListener("remove-profile-header",this.onProfileHeaderRemoved,this),this.dispose()):this.updateControls()}dispose(){this.linkifier.dispose(),this.popoverHelper.dispose(),this.allocationStackView&&(this.allocationStackView.clear(),this.allocationDataGrid&&this.allocationDataGrid.dispose()),this.onStopTracking(),this.trackingOverviewGrid&&this.trackingOverviewGrid.removeEventListener("IdsRangeChanged",this.onIdsRangeChanged.bind(this))}}class Ie{titleInternal;constructor(e){this.titleInternal=e}activate(e){}deactivate(e){e.baseSelect.setVisible(!1),e.filterSelect.setVisible(!1),e.classNameFilter.setVisible(!1),e.trackingOverviewGrid&&e.trackingOverviewGrid.detach(),e.allocationWidget&&e.allocationWidget.detach(),e.statisticsView&&e.statisticsView.detach(),e.splitWidget.detach(),e.splitWidget.detachChildWidgets()}masterGrid(e){return null}title(){return this.titleInternal}supportsSearch(){return!1}}class Mi extends Ie{constructor(){super(f(u.summary))}activate(e){e.splitWidget.setMainWidget(e.constructorsWidget),e.splitWidget.setSidebarWidget(e.objectDetailsView),e.splitWidget.show(e.searchableViewInternal.element),e.filterSelect.setVisible(!0),e.classNameFilter.setVisible(!0),e.trackingOverviewGrid&&(e.trackingOverviewGrid.show(e.searchableViewInternal.element,e.splitWidget.element),e.trackingOverviewGrid.update(),e.trackingOverviewGrid.updateGrid())}masterGrid(e){return e.constructorsDataGrid}supportsSearch(){return!0}}class Gi extends Ie{constructor(){super(f(u.comparison))}activate(e){e.splitWidget.setMainWidget(e.diffWidget),e.splitWidget.setSidebarWidget(e.objectDetailsView),e.splitWidget.show(e.searchableViewInternal.element),e.baseSelect.setVisible(!0),e.classNameFilter.setVisible(!0)}masterGrid(e){return e.diffDataGrid}supportsSearch(){return!0}}class Vi extends Ie{constructor(){super(f(u.containment))}activate(e){e.splitWidget.setMainWidget(e.containmentWidget),e.splitWidget.setSidebarWidget(e.objectDetailsView),e.splitWidget.show(e.searchableViewInternal.element)}masterGrid(e){return e.containmentDataGrid}}class Wi extends Ie{allocationSplitWidget;constructor(){super(f(u.allocation)),this.allocationSplitWidget=new ii(!1,!0,"heap-snapshot-allocation-split-view-state",200,200),this.allocationSplitWidget.setSidebarWidget(new W)}activate(e){e.allocationWidget&&this.allocationSplitWidget.setMainWidget(e.allocationWidget),e.splitWidget.setMainWidget(e.constructorsWidget),e.splitWidget.setSidebarWidget(e.objectDetailsView);const t=new W,i=document.createElement("div");i.classList.add("heap-snapshot-view-resizer");const s=i.createChild("div","title").createChild("span");if(i.createChild("div","verticalResizerIcon"),s.textContent=f(u.liveObjects),this.allocationSplitWidget.hideDefaultResizer(),this.allocationSplitWidget.installResizer(i),t.element.appendChild(i),e.splitWidget.show(t.element),this.allocationSplitWidget.setSidebarWidget(t),this.allocationSplitWidget.show(e.searchableViewInternal.element),e.constructorsDataGrid.clear(),e.allocationDataGrid){const r=e.allocationDataGrid.selectedNode;r&&e.constructorsDataGrid.setAllocationNodeId(r.allocationNodeId())}}deactivate(e){this.allocationSplitWidget.detach(),super.deactivate(e)}masterGrid(e){return e.allocationDataGrid}}class Ui extends Ie{constructor(){super(f(u.statistics))}activate(e){e.statisticsView.show(e.searchableViewInternal.element)}masterGrid(e){return null}}class Ne extends X(Ve){exposeInternals;customContentInternal;constructor(e,t){super(e||Ne.TypeId,t||f(u.heapSnapshot)),B.instance().observeModels(j,this),B.instance().addModelListener(j,"ResetProfiles",this.resetProfiles,this),B.instance().addModelListener(j,"AddHeapSnapshotChunk",this.addHeapSnapshotChunk,this),B.instance().addModelListener(j,"ReportHeapSnapshotProgress",this.reportHeapSnapshotProgress,this),this.exposeInternals=Te.instance().createSetting("expose-internals",!1),this.customContentInternal=null}modelAdded(e){e.enable()}modelRemoved(e){}getProfiles(){return super.getProfiles()}fileExtension(){return".heapsnapshot"}get buttonTooltip(){return f(u.takeHeapSnapshot)}isInstantProfile(){return!0}buttonClicked(){return this.takeHeapSnapshot(),ze.actionTaken(it.ProfilesHeapProfileTaken),!1}get treeItemTitle(){return f(u.heapSnapshots)}get description(){return f(u.heapSnapshotProfilesShowMemory)}customContent(){const e=Be.isEnabled("show-option-tp-expose-internals-in-heap-snapshot"),t=si(f(u.exposeInternals),this.exposeInternals);return this.customContentInternal=t,e?t:null}setCustomContentEnabled(e){this.customContentInternal&&(this.customContentInternal.checkboxElement.disabled=!e)}createProfileLoadedFromFile(e){return new He(null,this,e)}async takeHeapSnapshot(){if(this.profileBeingRecorded())return;const e=F.instance().flavor(j);if(!e)return;let t=new He(e,this);this.setProfileBeingRecorded(t),this.addProfile(t),t.updateStatus(f(u.snapshotting)),await e.takeHeapSnapshot({reportProgress:!0,captureNumericValue:!0,exposeInternals:this.exposeInternals.get()}),t=this.profileBeingRecorded(),t&&(t.title=f(u.snapshotD,{PH1:t.uid}),t.finishLoad(),this.setProfileBeingRecorded(null),this.dispatchEventToListeners("profile-complete",t))}addHeapSnapshotChunk(e){const t=this.profileBeingRecorded();t&&t.transferChunk(e.data)}reportHeapSnapshotProgress(e){const t=this.profileBeingRecorded();if(!t)return;const{done:i,total:s,finished:r}=e.data;t.updateStatus(f(u.percentagePlaceholder,{PH1:(i/s*100).toFixed(0)}),!0),r&&t.prepareToLoad()}resetProfiles(e){const t=e.data;for(const i of this.getProfiles())i.heapProfilerModel()===t&&this.removeProfile(i)}snapshotReceived(e){this.profileBeingRecorded()===e&&this.setProfileBeingRecorded(null),this.dispatchEventToListeners("SnapshotReceived",e)}static TypeId="HEAP";static SnapshotReceived="SnapshotReceived"}class be extends X(Ne){recordAllocationStacksSettingInternal;customContentInternal;recording;profileSamples;constructor(){super(be.TypeId,f(u.allocationInstrumentationOn)),this.recordAllocationStacksSettingInternal=Te.instance().createSetting("record-allocation-stacks",!1),this.customContentInternal=null,this.recording=!1}modelAdded(e){super.modelAdded(e),e.addEventListener("HeapStatsUpdate",this.heapStatsUpdate,this),e.addEventListener("LastSeenObjectId",this.lastSeenObjectId,this)}modelRemoved(e){super.modelRemoved(e),e.removeEventListener("HeapStatsUpdate",this.heapStatsUpdate,this),e.removeEventListener("LastSeenObjectId",this.lastSeenObjectId,this)}heapStatsUpdate(e){if(!this.profileSamples)return;const t=e.data;let i;for(let s=0;s<t.length;s+=3){i=t[s];const r=t[s+2];this.profileSamples.sizes[i]=r,this.profileSamples.max[i]||(this.profileSamples.max[i]=r)}}lastSeenObjectId(e){const t=this.profileSamples;if(!t)return;const{lastSeenObjectId:i,timestamp:s}=e.data,r=Math.max(t.ids.length,t.max.length-1);t.ids[r]=i,t.max[r]||(t.max[r]=0,t.sizes[r]=0),t.timestamps[r]=s,t.totalTime<s-t.timestamps[0]&&(t.totalTime*=2),this.profileSamples&&this.dispatchEventToListeners("HeapStatsUpdate",this.profileSamples);const n=this.profileBeingRecorded();n&&n.updateStatus(null,!0)}hasTemporaryView(){return!0}get buttonTooltip(){return this.recording?f(u.stopRecordingHeapProfile):f(u.startRecordingHeapProfile)}isInstantProfile(){return!1}buttonClicked(){return this.toggleRecording()}startRecordingProfile(){if(this.profileBeingRecorded())return;const e=this.addNewProfile();e&&e.startTrackingHeapObjects(this.recordAllocationStacksSettingInternal.get())}customContent(){const e=si(f(u.recordAllocationStacksExtra),this.recordAllocationStacksSettingInternal);return this.customContentInternal=e,e}setCustomContentEnabled(e){this.customContentInternal&&(this.customContentInternal.checkboxElement.disabled=!e)}recordAllocationStacksSetting(){return this.recordAllocationStacksSettingInternal}addNewProfile(){const e=F.instance().flavor(j);return e?(this.setProfileBeingRecorded(new He(e,this,void 0)),this.profileSamples=new _e,this.profileBeingRecorded()._profileSamples=this.profileSamples,this.recording=!0,this.addProfile(this.profileBeingRecorded()),this.profileBeingRecorded().updateStatus(f(u.recording)),this.dispatchEventToListeners("TrackingStarted"),e):null}async stopRecordingProfile(){let e=this.profileBeingRecorded();e.updateStatus(f(u.snapshotting));const t=e.heapProfilerModel().stopTrackingHeapObjects(!0);this.recording=!1,this.dispatchEventToListeners("TrackingStopped"),await t,e=this.profileBeingRecorded(),e&&(e.finishLoad(),this.profileSamples=null,this.setProfileBeingRecorded(null),this.dispatchEventToListeners("profile-complete",e))}toggleRecording(){return this.recording?this.stopRecordingProfile():this.startRecordingProfile(),this.recording}fileExtension(){return".heaptimeline"}get treeItemTitle(){return f(u.allocationTimelines)}get description(){return f(u.AllocationTimelinesShowInstrumented)}resetProfiles(e){const t=this.recording;this.setProfileBeingRecorded(null),super.resetProfiles(e),this.profileSamples=null,t&&this.addNewProfile()}profileBeingRecordedRemoved(){this.stopRecordingProfile(),this.profileSamples=null}static TypeId="HEAP-RECORD";static HeapStatsUpdate="HeapStatsUpdate";static TrackingStarted="TrackingStarted";static TrackingStopped="TrackingStopped"}class He extends ce{heapProfilerModelInternal;maxJSObjectId;workerProxy;receiver;snapshotProxy;loadPromise;fulfillLoad;totalNumberOfChunks;bufferedWriter;onTempFileReady;failedToCreateTempFile;wasDisposed;fileName;constructor(e,t,i){super(t,i||f(u.snapshotD,{PH1:t.nextProfileUid()})),this.heapProfilerModelInternal=e,this.maxJSObjectId=-1,this.workerProxy=null,this.receiver=null,this.snapshotProxy=null,this.loadPromise=new Promise(s=>{this.fulfillLoad=s}),this.totalNumberOfChunks=0,this.bufferedWriter=null,this.onTempFileReady=null}heapProfilerModel(){return this.heapProfilerModelInternal}async getLocation(e){return this.snapshotProxy?this.snapshotProxy.getLocation(e):null}createSidebarTreeElement(e){return new We(e,this,"heap-snapshot-sidebar-tree-item")}createView(e){return new ne(e,this)}prepareToLoad(){console.assert(!this.receiver,"Already loading"),this.setupWorker(),this.updateStatus(f(u.loading),!0)}finishLoad(){!this.wasDisposed&&this.receiver&&this.receiver.close(),this.bufferedWriter&&this.didWriteToTempFile(this.bufferedWriter)}didWriteToTempFile(e){if(this.wasDisposed){e&&e.remove();return}this.tempFile=e,e||(this.failedToCreateTempFile=!0),this.onTempFileReady&&(this.onTempFileReady(),this.onTempFileReady=null)}setupWorker(){console.assert(!this.workerProxy,"HeapSnapshotWorkerProxy already exists"),this.workerProxy=new Ai(this.handleWorkerEvent.bind(this)),this.workerProxy.addEventListener("Wait",e=>{this.updateStatus(null,e.data)},this),this.receiver=this.workerProxy.createLoader(this.uid,this.snapshotReceived.bind(this))}handleWorkerEvent(e,t){if(Mt.BrokenSnapshot===e){const r=t;G.instance().error(r);return}if(Mt.Update!==e)return;const s=Bs(t);this.updateStatus(Pr(s.string,s.values))}dispose(){this.workerProxy&&this.workerProxy.dispose(),this.removeTempFile(),this.wasDisposed=!0}didCompleteSnapshotTransfer(){this.snapshotProxy&&this.updateStatus(J(this.snapshotProxy.totalSize),!1)}transferChunk(e){this.bufferedWriter||(this.bufferedWriter=new oi),this.bufferedWriter.write([e]),++this.totalNumberOfChunks,this.receiver&&this.receiver.write(e)}snapshotReceived(e){this.wasDisposed||(this.receiver=null,this.snapshotProxy=e,this.maxJSObjectId=e.maxJSObjectId(),this.didCompleteSnapshotTransfer(),this.workerProxy&&this.workerProxy.startCheckingForLongRunningCalls(),this.notifySnapshotReceived())}notifySnapshotReceived(){this.snapshotProxy&&this.fulfillLoad&&this.fulfillLoad(this.snapshotProxy),this.profileType().snapshotReceived(this)}canSaveToFile(){return!this.fromFile()}async saveToFile(){await this.loadPromise;const e=new Zt;this.fileName=this.fileName||"Heap-"+qt(new Date)+this.profileType().fileExtension();const t=async i=>{if(i){if(this.failedToCreateTempFile){G.instance().error("Failed to open temp file with heap snapshot"),e.close();return}if(this.tempFile){const s=await this.tempFile.copyToOutputStream(e,this.onChunkTransferred.bind(this));s&&G.instance().error("Failed to read heap snapshot from temp file: "+s.message),this.didCompleteSnapshotTransfer();return}this.onTempFileReady=()=>{t(i)},this.updateSaveProgress(0,1)}};await e.open(this.fileName).then(t.bind(this))}onChunkTransferred(e){this.updateSaveProgress(e.loadedSize(),e.fileSize())}updateSaveProgress(e,t){const i=((t&&e/t)*100).toFixed(0);this.updateStatus(f(u.savingD,{PH1:i}))}async loadFromFile(e){this.updateStatus(f(u.loading),!0),this.setupWorker();const t=new pt(e,1e7),i=await t.read(this.receiver);if(!i){const s=t.error();s&&this.updateStatus(s.message)}return i?null:t.error()}profileType(){return super.profileType()}}class qe extends W{pieChart;constructor(){super(),this.element.classList.add("heap-snapshot-statistics-view"),this.element.setAttribute("jslog",`${rt("profiler.heap-snapshot-statistics-view").track({resize:!0})}`),this.pieChart=new Ys,this.setTotalAndRecords(0,[]),this.pieChart.classList.add("heap-snapshot-stats-pie-chart"),this.element.appendChild(this.pieChart)}static valueFormatter(e){return new Intl.NumberFormat(As.instance().locale,{style:"unit",unit:"kilobyte"}).format(Math.round(e/1e3))}setTotalAndRecords(e,t){this.pieChart.data={chartName:f(u.heapMemoryUsage),size:150,formatter:qe.valueFormatter,showLegend:!0,total:e,slices:t}}}class _i extends Hs{heapProfilerModel;linkifier;frameElements;constructor(e){super(),this.heapProfilerModel=e,this.linkifier=new oe,this.frameElements=[]}onContextMenu(e,t){const i=new Jt(t);i.appendApplicableItems(e),i.show(),t.consume(!0)}onStackViewKeydown(e){const t=e.target;if(!t)return;if(e.key==="Enter"){const l=Gt.get(t);if(!l)return;const a=oe.linkInfo(l);if(!a)return;oe.invokeFirstAction(a)&&e.consume(!0);return}let i;const s=e;if(s.key==="ArrowUp")i=!1;else if(s.key==="ArrowDown")i=!0;else return;const r=this.frameElements.indexOf(t);if(r===-1)return;const n=i?r+1:r-1;if(n<0||n>=this.frameElements.length)return;const o=this.frameElements[n];o.tabIndex=0,t.tabIndex=-1,o.focus(),e.consume(!0)}async setAllocatedObject(e,t){this.clear();const i=await e.allocationStack(t);if(!i){const r=this.element.createChild("div","no-heap-allocation-stack");ft(r,f(u.stackWasNotRecordedForThisObject));return}const s=this.element.createChild("div","heap-allocation-stack");s.addEventListener("keydown",this.onStackViewKeydown.bind(this),!1);for(const r of i){const n=s.createChild("div","stack-frame");this.frameElements.push(n),n.tabIndex=-1;const o=n.createChild("div");if(o.textContent=je(r.functionName),!r.scriptId)continue;const l=this.heapProfilerModel?this.heapProfilerModel.target():null,a={columnNumber:r.column-1,inlineFrameIndex:0},h=this.linkifier.linkifyScriptLocation(l,String(r.scriptId),r.scriptName,r.line-1,a);n.appendChild(h),Gt.set(n,h),n.addEventListener("contextmenu",this.onContextMenu.bind(this,h))}this.frameElements[0].tabIndex=0}clear(){this.element.removeChildren(),this.frameElements=[],this.linkifier.reset()}}const Gt=new WeakMap,In=Object.freeze(Object.defineProperty({__proto__:null,AllocationPerspective:Wi,ComparisonPerspective:Gi,ContainmentPerspective:Vi,HeapAllocationStackView:_i,HeapProfileHeader:He,HeapSnapshotProfileType:Ne,HeapSnapshotStatisticsView:qe,HeapSnapshotView:ne,Perspective:Ie,StatisticsPerspective:Ui,SummaryPerspective:Mi,TrackingHeapSnapshotProfileType:be},Symbol.toStringTag,{value:"Module"}));class $i{heapSnapshotProfileType;samplingHeapProfileType;trackingHeapSnapshotProfileType;detachedElementProfileType;constructor(){this.heapSnapshotProfileType=new Ne,this.samplingHeapProfileType=new $e,this.trackingHeapSnapshotProfileType=new be,this.detachedElementProfileType=new lr}}const he=new $i,yn=Object.freeze(Object.defineProperty({__proto__:null,ProfileTypeRegistry:$i,instance:he},Symbol.toStringTag,{value:"Module"})),Ji={revealInSummaryView:"Reveal in Summary view"},Tr=O("panels/profiler/HeapProfilerPanel.ts",Ji),xr=L.bind(void 0,Tr);let Ke;class re extends pe{constructor(){const e=he,t=[e.heapSnapshotProfileType,e.trackingHeapSnapshotProfileType,e.samplingHeapProfileType,e.detachedElementProfileType];super("heap-profiler",t,"profiler.heap-toggle-recording")}static instance(){return Ke||(Ke=new re),Ke}appendApplicableItems(e,t,i){if(!this.isShowing()||!i.objectId)return;const s=i.objectId;if(!he.heapSnapshotProfileType.getProfiles().length)return;const n=i.runtimeModel().heapProfilerModel();if(!n)return;function o(l){n.snapshotObjectIdForObjectId(s).then(a=>{this.isShowing()&&a&&this.showObject(a,l)})}t.revealSection().appendItem(xr(Ji.revealInSummaryView),o.bind(this,"Summary"),{jslogContext:"reveal-in-summary"})}handleAction(e,t){const i=F.instance().flavor(re);return console.assert(!!i&&i instanceof re),i&&i.toggleRecord(),!0}wasShown(){super.wasShown(),F.instance().setFlavor(re,this),ze.panelLoaded("heap-profiler","DevTools.Launch.HeapProfiler")}willHide(){F.instance().setFlavor(re,null),super.willHide()}showObject(e,t){const s=he.heapSnapshotProfileType.getProfiles();for(let r=0;r<s.length;r++){const n=s[r];if(n.maxJSObjectId>=parseInt(e,10)){this.showProfile(n),this.viewForProfile(n).selectLiveObject(t,e);break}}}}const Pn=Object.freeze(Object.defineProperty({__proto__:null,HeapProfilerPanel:re},Symbol.toStringTag,{value:"Module"})),Yi=new CSSStyleSheet;Yi.replaceSync(`/*
 * Copyright 2019 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

.data-grid {
  border: none;
}

.data-grid td .size-units {
  margin-left: 4px;
  font-size: 75%;
}

.data-grid tr:not(.selected) td .size-units {
  color: var(--sys-color-token-subtle);
}

.toolbar {
  border-bottom: 1px solid var(--sys-color-divider);
}

/*# sourceURL=liveHeapProfile.css */
`);const U={jsHeap:"JS Heap",allocatedJsHeapSizeCurrentlyIn:"Allocated JS heap size currently in use",vms:"VMs",numberOfVmsSharingTheSameScript:"Number of VMs sharing the same script source",scriptUrl:"Script URL",urlOfTheScriptSource:"URL of the script source",heapProfile:"Heap Profile",anonymousScriptS:"(Anonymous Script {PH1})",kb:"kB"},Er=O("panels/profiler/LiveHeapProfileView.ts",U),Z=L.bind(void 0,Er);let et;class xt extends W{gridNodeByUrl;setting;toggleRecordAction;toggleRecordButton;startWithReloadButton;dataGrid;currentPollId;constructor(){super(!0),this.gridNodeByUrl=new Map,this.setting=Te.instance().moduleSetting("memory-live-heap-profile");const e=new _("live-heap-profile-toolbar",this.contentElement);this.toggleRecordAction=ye.instance().getAction("live-heap-profile.toggle-recording"),this.toggleRecordButton=_.createActionButton(this.toggleRecordAction),this.toggleRecordButton.setToggled(this.setting.get()),e.appendToolbarItem(this.toggleRecordButton);const t=B.instance().primaryPageTarget();if(t&&t.model(Lt)){const i=ye.instance().getAction("live-heap-profile.start-with-reload");this.startWithReloadButton=_.createActionButton(i),e.appendToolbarItem(this.startWithReloadButton)}this.dataGrid=this.createDataGrid(),this.dataGrid.asWidget().show(this.contentElement),this.currentPollId=0}static instance(){return et||(et=new xt),et}createDataGrid(){const e={id:"",title:ei,width:void 0,fixedWidth:!0,sortable:!0,align:"right",sort:Q.Descending,titleDOMFragment:void 0,editable:void 0,nonSelectable:void 0,longText:void 0,disclosure:void 0,weight:void 0,allowInSortByEvenWhenHidden:void 0,dataType:void 0,defaultWeight:void 0},t=[{...e,id:"size",title:Z(U.jsHeap),width:"72px",fixedWidth:!0,sortable:!0,align:"right",sort:Q.Descending,tooltip:Z(U.allocatedJsHeapSizeCurrentlyIn)},{...e,id:"isolates",title:Z(U.vms),width:"40px",fixedWidth:!0,align:"right",tooltip:Z(U.numberOfVmsSharingTheSameScript)},{...e,id:"url",title:Z(U.scriptUrl),fixedWidth:!1,sortable:!0,tooltip:Z(U.urlOfTheScriptSource)}],i=new js({displayName:Z(U.heapProfile),columns:t,editCallback:void 0,deleteCallback:void 0,refreshCallback:void 0});i.setResizeMethod("last"),i.element.classList.add("flex-auto"),i.element.addEventListener("keydown",this.onKeyDown.bind(this),!1),i.addEventListener("OpenedNode",this.revealSourceForSelectedNode,this),i.addEventListener("SortingChanged",this.sortingChanged,this);for(const s of t){const r=i.headerTableHeader(s.id);r&&r.setAttribute("title",s.tooltip)}return i}wasShown(){super.wasShown(),this.poll(),this.registerCSSFiles([Yi]),this.setting.addChangeListener(this.settingChanged,this)}willHide(){++this.currentPollId,this.setting.removeChangeListener(this.settingChanged,this)}settingChanged(e){this.toggleRecordButton.setToggled(e.data)}async poll(){const e=this.currentPollId;do{const t=Array.from(ge.instance().isolates()),i=await Promise.all(t.map(s=>{const r=s.heapProfilerModel();return r?r.getSamplingProfile():null}));if(this.currentPollId!==e)return;this.update(t,i),await new Promise(s=>window.setTimeout(s,3e3))}while(this.currentPollId===e)}update(e,t){const i=new Map;t.forEach((a,h)=>{a&&n(e[h],"",a.head)});const s=this.dataGrid.rootNode(),r=new Set;for(const a of i){const h=a[0],m=a[1].size,g=a[1].isolates.size;if(!h){console.info(`Node with empty URL: ${m} bytes`);continue}let c=this.gridNodeByUrl.get(h);c?c.updateNode(m,g):(c=new Xi(h,m,g),this.gridNodeByUrl.set(h,c),s.appendChild(c)),r.add(c)}for(const a of s.children.slice()){const h=a;r.has(h)||h.remove(),this.gridNodeByUrl.delete(h.url)}this.sortingChanged();function n(a,h,m){const g=m.callFrame.url||h||o(m)||l(m);if(m.children.forEach(n.bind(null,a,g)),!m.selfSize)return;let c=i.get(g);c||(c={size:0,isolates:new Set},i.set(g,c)),c.size+=m.selfSize,c.isolates.add(a)}function o(a){const h=a.callFrame.functionName;return h.startsWith("(")&&h!=="(root)"?h:""}function l(a){return Number(a.callFrame.scriptId)?Z(U.anonymousScriptS,{PH1:a.callFrame.scriptId}):""}}onKeyDown(e){e.key==="Enter"&&(e.consume(!0),this.revealSourceForSelectedNode())}revealSourceForSelectedNode(){const e=this.dataGrid.selectedNode;if(!e||!e.url)return;const t=Ms.instance().uiSourceCodeForURL(e.url);t&&Xt(t)}sortingChanged(){const e=this.dataGrid.sortColumnId();if(!e)return;function t(r,n){return n.url.localeCompare(r.url)}function i(r,n){return n.size-r.size}const s=e==="url"?t:i;this.dataGrid.sortNodes(s,this.dataGrid.isSortOrderAscending())}toggleRecording(){!this.setting.get()?this.startRecording(!1):this.stopRecording()}startRecording(e){if(this.setting.set(!0),!e)return;const t=B.instance().primaryPageTarget();if(!t)return;const i=t.model(Lt);i&&i.reloadPage()}async stopRecording(){this.setting.set(!1)}}class Xi extends Gs{url;size;isolateCount;constructor(e,t,i){super(),this.url=e,this.size=t,this.isolateCount=i}updateNode(e,t){this.size===e&&this.isolateCount===t||(this.size=e,this.isolateCount=t,this.refresh())}createCell(e){const t=this.createTD(e);switch(e){case"url":t.textContent=this.url;break;case"size":t.textContent=x(Math.round(this.size/1e3)),t.createChild("span","size-units").textContent=Z(U.kb);break;case"isolates":t.textContent=`${this.isolateCount}`;break}return t}}class Nr{handleAction(e,t){return(async()=>{const i="live-heap-profile";await zt.instance().showView(i);const s=zt.instance().view(i);if(s){const r=await s.widget();this.innerHandleAction(r,t)}})(),!0}innerHandleAction(e,t){switch(t){case"live-heap-profile.toggle-recording":e.toggleRecording();break;case"live-heap-profile.start-with-reload":e.startRecording(!0);break;default:console.assert(!1,`Unknown action: ${t}`)}}}const Tn=Object.freeze(Object.defineProperty({__proto__:null,ActionDelegate:Nr,GridNode:Xi,LiveHeapProfileView:xt},Symbol.toStringTag,{value:"Module"}));export{nn as BottomUpProfileDataGrid,on as ChildrenProvider,Sn as HeapProfileView,Pn as HeapProfilerPanel,bn as HeapSnapshotDataGrids,wn as HeapSnapshotGridNodes,Cn as HeapSnapshotProxy,In as HeapSnapshotView,vn as HeapTimelineOverview,ln as IsolateSelector,Tn as LiveHeapProfileView,rn as ProfileDataGrid,fn as ProfileFlameChart,an as ProfileHeader,dn as ProfileLauncherView,hn as ProfileSidebarTreeElement,yn as ProfileTypeRegistry,gn as ProfileView,pn as ProfilesPanel,mn as TopDownProfileDataGrid};
//# sourceMappingURL=profiler-DsaRy7yO.js.map
