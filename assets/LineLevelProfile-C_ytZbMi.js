import{aD as L,aE as P,at as y,aF as S}from"./inspector-CyOA7R9n.js";import"./PreviewFactory-7rWtg079.js";let h;class m{helper;constructor(){this.helper=new w("performance")}static instance(e={forceNew:null}){const{forceNew:o}=e;return(!h||o)&&(h=new m),h}reset(){this.helper.reset()}appendLegacyCPUProfile(e,o){const n=[e.profileHead],a=(e.profileEndTime-e.profileStartTime)/e.totalHitCount;for(;n.length;){const t=n.pop().children;for(let i=0;i<t.length;++i){const s=t[i];if(n.push(s),!(!s.url||!s.positionTicks))for(let c=0;c<s.positionTicks.length;++c){const r=s.positionTicks[c],l=r.line,p=r.ticks*a;this.helper.addLineData(o,s.url,l,p)}}}}appendCPUProfile(e,o){if(!e.lines){this.appendLegacyCPUProfile(e,o),this.helper.scheduleUpdate();return}if(e.samples){for(let n=1;n<e.samples.length;++n){const a=e.lines[n];if(!a)continue;const t=e.nodeByIndex(n);if(!t)continue;const i=Number(t.scriptId)||t.url;if(!i)continue;const s=e.timestamps[n]-e.timestamps[n-1];this.helper.addLineData(o,i,a,s)}this.helper.scheduleUpdate()}}}let f;class g{helper;constructor(){this.helper=new w("memory")}static instance(e={forceNew:null}){const{forceNew:o}=e;return(!f||o)&&(f=new g),f}reset(){this.helper.reset()}appendHeapProfile(e,o){const n=this.helper;a(e.head),n.scheduleUpdate();function a(t){if(t.children.forEach(a),!t.selfSize)return;const i=Number(t.callFrame.scriptId)||t.callFrame.url;if(!i)return;const s=t.callFrame.lineNumber+1;n.addLineData(o,i,s,t.selfSize)}}}class w{type;locationPool;updateTimer;lineData;constructor(e){this.type=e,this.locationPool=new L,this.updateTimer=null,this.reset()}reset(){this.lineData=new Map,this.scheduleUpdate()}addLineData(e,o,n,a){let t=this.lineData.get(e);t||(t=new Map,this.lineData.set(e,t));let i=t.get(o);i||(i=new Map,t.set(o,i)),i.set(n,(i.get(n)||0)+a)}scheduleUpdate(){this.updateTimer||(this.updateTimer=window.setTimeout(()=>{this.updateTimer=null,this.doUpdate()},0))}async doUpdate(){this.locationPool.disposeAll();const e=new Map,o=[];for(const[n,a]of this.lineData){const t=n?n.model(P):null;for(const[i,s]of a){const c=y.instance();if(t){const r=S.instance();for(const l of s){const p=l[0]-1,T=l[1],D=typeof i=="string"?t.createRawLocationByURL(i,p,0):t.createRawLocationByScriptId(String(i),p,0);D&&o.push(r.rawLocationToUILocation(D).then(d=>{if(d){let u=e.get(d.uiSourceCode);u||(u=new Map,e.set(d.uiSourceCode,u)),u.set(d.lineNumber+1,T)}}))}}else if(typeof i=="string"){const r=c.uiSourceCodeForURL(i);r&&e.set(r,s)}}await Promise.all(o);for(const[i,s]of e)i.setDecorationData(this.type,s)}for(const n of y.instance().uiSourceCodes())e.has(n)||n.setDecorationData(this.type,void 0)}}const b=Object.freeze(Object.defineProperty({__proto__:null,Helper:w,Memory:g,Performance:m},Symbol.toStringTag,{value:"Module"}));export{b as L,g as M,m as P};
//# sourceMappingURL=LineLevelProfile-C_ytZbMi.js.map
