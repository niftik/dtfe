import{gf as na,dx as Po,la as Cd,mH as Ai,lT as sa,kM as Rn,l4 as kd,mI as xd,mJ as ra,kv as Id,kw as Pd,m3 as Ld,i as Y,bm as aa,kt as We,l9 as Gi,kR as _,mK as Jt,ev as oi,lM as si,at as Rd,aE as Ma,i3 as Da,mL as Ad,d5 as Nd,aF as Fd,ik as An,b as A,g as N,bc as ie,b7 as se,dV as ve,b8 as $,mM as wt,aN as D,cc as Ji,b6 as Gn,b9 as Ye,bj as V,bG as Zi,aP as K,aO as q,dA as ke,bD as tt,bQ as z,lg as Md,lh as Dr,eA as Nt,lj as Dd,lo as $d,lp as $a,mN as Lo,mO as jn,mP as Ro,ku as Dt,ex as qn,lN as Bd,mQ as Ni,mR as ze,fh as Od,bf as Hd,bM as bt,bh as _d,mS as Bt,bx as Ke,bn as Nn,mT as Tt,ir as Wd,d9 as Vd,mU as Ft,ge as ee,mj as Pe,mV as Qi,dX as ci,dy as ri,bW as Ao,di as No,mW as Ud,fk as $r,bY as Ba,mX as zd,bk as Gd,c4 as Mt,lA as Oa,aj as Te,mY as jd,r as qd,b1 as Fo,mZ as Mo,m_ as Kd,eR as Yd,m$ as Xd,be as Jd,aJ as Fi,n0 as Fn,en as Br,k9 as Ha,n1 as Zd,cC as xn,cj as oa,bN as mn,hE as Pi,n2 as Qd,n3 as eh,n4 as th,jw as In,n5 as _a,bu as Cs,gy as ih,dj as ne,b0 as nh,fi as sh,aU as xe,hb as Do,as as Or,ds as $o,cH as Li,hL as xi,ar as la,fj as Hr,n6 as rh,n7 as ah,kK as ms,n8 as oh,bO as Bo,n9 as ca,na as Qn,nb as lh,nc as ch,nd as dt,iX as Wa,bo as Oo,bA as et,ne as dh,lD as Ho,m7 as fe,nf as hh,bv as Mn,ak as js,fR as uh,cX as Va,d2 as _o,al as ks,kG as ph,ng as pt,nh as zt,ni as qs,kD as xs,cf as da,C as Is,hK as mh,ky as gh,nj as mi,nk as fh,bS as qt,nl as vh,nm as yh,bE as Wo,kB as Ps,kI as bh,nn as wh,no as Vo,lY as Uo,np as zo,aZ as Dn,b3 as Th,b5 as Sh,da as Ua,nq as Eh,nr as Go,ns as Ch,l as kh,ep as ha,hP as ua,a$ as xh,f_ as Ih,kl as Ph,nt as jo,lR as qo,lV as Ko,lW as Yo,lX as Xo,cd as Zt,bz as pa,cV as Lh,ct as gr,d0 as Rh,iv as Ah,g2 as Ls,cW as Nh,bq as Pn,g9 as Fh,nu as Mh,mh as Dh,bi as rn,fr as ma,ba as Jo,nv as $h,aq as Zo,dG as Qo,bB as Bh,nw as _r,eq as Oh,cR as Vi,mg as Hh,ck as _h,nx as gn,l7 as Wh,ny as Vh,dZ as Uh,kx as zh,bs as Rs,nz as Gh,lt as jh,me as el,aM as ga,nA as Wr,f4 as qh,nB as Kh,nC as tl,nD as Yh,nE as Xh,nF as za,gg as $n,cB as Jh,f2 as Zh,bl as Qh,f0 as eu,nG as tu,nH as iu,bH as il,aW as nu,du as su,e4 as ru,e5 as au,nI as ou,nJ as lu,nK as Ga,cA as cu,i0 as du,mr as ja,hJ as hu,kH as qa,nL as uu,nM as pu,I as mu,nN as Ka,bd as gu,aR as es,aS as fr,fX as fu,u as Wt,A as gi,i$ as vu,gd as yu,hN as bu,dH as nl,g7 as As,dn as wu,a as Tu,nO as Su,df as Eu,gb as Cu,ga as ku,bJ as Ya,gP as xu,V as sl,mi as Iu,l2 as Pu,lv as on,nP as Lu,fS as Ru,lU as Au,lQ as Xa,ll as Nu,lk as Fu,kC as Mu,kA as Du,kr as $u}from"./inspector-CyOA7R9n.js";import{g as Kt,C as rl,c as Bu,a as oe,i as fa,s as Ou,b as Hu,d as _u,f as Ks,e as Vr,L as Wu,T as Bn,t as al,M as Vu,h as Uu,j as zu,k as Gu,l as Ja}from"./ModelImpl-DjdwMiMr.js";import{u as vr,h as ju,d as qu,i as Ku,D as ol,g as ll,f as Ns,e as Za,R as Yu}from"./timelineOverviewInfo.css-BT4HnMd6.js";import"./PreviewFactory-7rWtg079.js";import{S as Xu,M as Ju}from"./SelectMenu-BqCYT45A.js";import{t as Ur,T as va}from"./mobile_throttling-CIMam4T2.js";import{D as Zu}from"./DataGridController-DdQqp2ti.js";import"./ShortcutDialog-D3xyB3nU.js";import{n as ji}from"./directives-BpSiwtWR.js";import"./MarkdownView-IOiMoU4I.js";import{D as Qu}from"./DeviceModeModel-fDJ3OPwb.js";import{d as cl}from"./Debouncer-BW_30p93.js";import{U as ep}from"./UserVisibleError-YMOzvDSx.js";import{P as yr}from"./LineLevelProfile-C_ytZbMi.js";import{D as tp,T as Qa}from"./DropTarget-DDkHhLsd.js";import{I as eo}from"./IsolateManager-NiMHBY0n.js";import{L as ip,b as np,c as sp,d as rp,e as ap,a as op,P as lp,T as cp}from"./PaintProfilerView-caNlpRTi.js";import{b as dp,c as hp}from"./TimelineOverviewPane-DjPkTYph.js";class up{#e=[];#t=new Map;#i=new Map;#n=new Map;#s=new Map;#r=[];#a=[];#o=[];static enhancedTraceVersion=1;constructor(e){try{this.parseEnhancedTrace(e)}catch(t){throw new ep(t)}}parseEnhancedTrace(e){for(const t of e)if(this.isTargetRundownEvent(t)){const i=t.args?.data;this.#t.set(this.getScriptIsolateId(i.isolate,i.scriptId),i.v8context),this.#r.find(n=>n.targetId===i.frame)||this.#r.push({targetId:i.frame,type:i.frameType,isolate:i.isolate,pid:t.pid,url:i.url}),this.#a.find(n=>n.v8Context===i.v8context)||this.#a.push({id:-1,origin:i.origin,v8Context:i.v8context,auxData:{frameId:i.frame,isDefault:i.isDefault,type:i.contextType},isolate:i.isolate})}else if(this.isScriptRundownEvent(t)){this.#e.push(t);const i=t.args.data;this.#o.find(n=>n.scriptId===i.scriptId&&n.isolate===i.isolate)||this.#o.push({scriptId:i.scriptId,isolate:i.isolate,executionContextId:i.executionContextId,startLine:i.startLine,startColumn:i.startColumn,endLine:i.endLine,endColumn:i.endColumn,hash:i.hash,isModule:i.isModule,url:i.url,hasSourceUrl:i.hasSourceUrl,sourceMapUrl:i.sourceMapUrl})}else if(this.isScriptRundownSourceEvent(t)){const i=t.args.data,n=this.getScriptIsolateId(i.isolate,i.scriptId);if("splitIndex"in i&&"splitCount"in i){this.#n.has(n)||this.#n.set(n,new Array(i.splitCount).fill(""));const s=this.#n.get(n);s&&i.sourceText&&(s[i.splitIndex]=i.sourceText)}else i.sourceText&&this.#i.set(n,i.sourceText),i.length&&this.#s.set(n,i.length)}}data(){const e=new Map;this.#e.forEach(i=>{const n=i.args.data,s=this.#t.get(this.getScriptIsolateId(n.isolate,n.scriptId));s&&e.set(s,n.executionContextId)}),this.#a.forEach(i=>{if(i.v8Context){const n=e.get(i.v8Context);n&&(i.id=n)}}),this.#o.forEach(i=>{const n=this.getScriptIsolateId(i.isolate,i.scriptId);if(this.#i.has(n))i.sourceText=this.#i.get(n),i.length=this.#s.get(n);else if(this.#n.has(n)){const s=this.#n.get(n);s&&(i.sourceText=s.join(""),i.length=i.sourceText.length)}i.auxData=this.#a.find(s=>s.id===i.executionContextId&&s.isolate===i.isolate)?.auxData});const t=new Map;for(const i of this.#r)t.set(i,this.groupContextsAndScriptsUnderTarget(i,this.#a,this.#o));return{data:t}}getScriptIsolateId(e,t){return t+"@"+e}isTraceEvent(e){return"cat"in e&&"pid"in e}isTargetRundownEvent(e){return this.isTraceEvent(e)&&e.cat==="disabled-by-default-devtools.target-rundown"}isScriptRundownEvent(e){return this.isTraceEvent(e)&&e.cat==="disabled-by-default-devtools.v8-source-rundown"}isScriptRundownSourceEvent(e){return this.isTraceEvent(e)&&e.cat==="disabled-by-default-devtools.v8-source-rundown-sources"}groupContextsAndScriptsUnderTarget(e,t,i){const n=[],s=[];for(const r of t)r.auxData?.frameId===e.targetId&&n.push(r);for(const r of i)r.auxData===null&&console.error(r+" missing aux data"),r.auxData?.frameId===e.targetId&&s.push(r);return[n,s]}}function pp(a){let t="";for(const[i,n]of a.searchParams)t&&(t+="&"),n?t+=`${i}=${Po(n,8)}`:t+=i;return t&&(t="?"+t),t}function dl(a){const e=[],t=a.every(i=>i.protocol==="https:");for(const[i,n]of a.entries()){const s=a[i-1];let o=s&&n.host===s.host&&n.protocol===s.protocol,l=t;i===0&&t&&(o=!0,l=!0);const d=pp(n);l?o?e.push(`${n.pathname}${d}`):e.push(`${n.host}${n.pathname}${d}`):e.push(`${n.protocol}//${n.host}${n.pathname}${d}`)}return e.map(i=>i.length>1&&i.endsWith("/")?i.substring(0,i.length-1):i)}function hl(a,e=20){const t=a.pathname.split("/");let i=t.at(-1)??"";if(i.length>e)return na(i,e);let n=t.length-1;for(;--n>=0;)i.length+t[n].length<=e&&(i=`${t[n]}/${i}`);return i}const Pf=Object.freeze(Object.defineProperty({__proto__:null,createUrlLabels:dl,shortenUrl:hl},Symbol.toStringTag,{value:"Module"}));function to(a){return a.type==="TIME_RANGE"}function ul(a){return a.type==="ENTRY_LABEL"}function zr(a){return a.type==="ENTRIES_LINK"}function mp(a){const e=a.split("-"),t=e[0];switch(t){case"p":if(e.length!==5||!e.every((i,n)=>n===0||typeof i=="number"||!isNaN(parseInt(i,10))))throw new Error(`Invalid ProfileCallKey: ${a}`);return{type:e[0],processID:parseInt(e[1],10),threadID:parseInt(e[2],10),sampleIndex:parseInt(e[3],10),protocol:parseInt(e[4],10)};case"r":if(e.length!==2||!(typeof e[1]=="number"||!isNaN(parseInt(e[1],10))))throw new Error(`Invalid RawEvent Key: ${a}`);return{type:e[0],rawIndex:parseInt(e[1],10)};case"s":if(e.length!==2||!(typeof e[1]=="number"||!isNaN(parseInt(e[1],10))))throw new Error(`Invalid SyntheticEvent Key: ${a}`);return{type:e[0],rawIndex:parseInt(e[1],10)};case"l":{if(e.length!==2||Number.isNaN(parseInt(e[1],10)))throw new Error(`Invalid LegacyTimelineFrame Key: ${a}`);return{type:t,rawIndex:parseInt(e[1],10)}}default:throw new Error(`Unknown trace event key: ${a}`)}}const br=new Map,io=new WeakMap;function pl(a,e){const t=io.get(e);if(t)return t;const i=new Set;if(Cd(e))e.args.endData?.layoutRoots.forEach(n=>i.add(n.nodeId));else if(Ai(e)&&e.args.data?.impacted_nodes)e.args.data.impacted_nodes.forEach(n=>i.add(n.node_id));else if(sa(e)&&typeof e.args.data?.nodeId<"u")i.add(e.args.data.nodeId);else if(Rn(e)&&typeof e.args.data.nodeId<"u")i.add(e.args.data.nodeId);else if(kd(e)&&typeof e.args.data.nodeId<"u")i.add(e.args.data.nodeId);else if(xd(e)&&typeof e.args.data.nodeId<"u")i.add(e.args.data.nodeId);else if(ra(e)&&typeof e.args.data.beginEvent.args.data.nodeId<"u")i.add(e.args.data.beginEvent.args.data.nodeId);else if(Id(e)){const n=a.ImagePainting.paintImageForEvent.get(e);n&&typeof n.args.data.nodeId<"u"&&i.add(n.args.data.nodeId)}else if(Pd(e)&&e.args?.LazyPixelRef){const n=a.ImagePainting.paintImageByDrawLazyPixelRef.get(e.args.LazyPixelRef);n&&typeof n.args.data.nodeId<"u"&&i.add(n.args.data.nodeId)}else Ld(e)&&typeof e.args?.data.node_id<"u"&&i.add(e.args.data.node_id);return io.set(e,i),i}async function gp(a,e){const t=pl(a,e);return t.size?fp(a,Array.from(t)):null}async function fp(a,e){const t=br.get(a)?.get(e);if(t)return t;const n=Y.instance().primaryPageTarget()?.model(aa);if(!n)return new Map;const s=await n.pushNodesByBackendIdsToFrontend(new Set(e))||new Map,r=br.get(a)||new Map;return r.set(e,s),br.set(a,r),s}const vp=new Set(["(program)","(idle)","(root)"]);function yp(a,e){if(!e.length)return a;const t=e.filter(h=>!(We(h)&&(vp.has(h.callFrame.functionName)||!h.callFrame.functionName)));if(t.length===0)return a;function i(h,u){let v=h;const T=t[v],E=Gi(T);let U=(E.startTime+E.endTime)/2,w=0;const x=Math.sign(u-h);for(let C=h;C!==u;C+=x){const W=t[C],O=Gi(W),j=(O.startTime+O.endTime)/2,S=Math.abs(U-j);w<.1*S&&(v=C,U=j,w=0),w+=O.duration}return v}const n=i(t.length-1,0),s=i(0,n),r=Gi(t[s]),o=Gi(t[n]);let l=r.startTime,d=o.endTime;const c=d-l;return c<a.range*.1?a:(l=_(Math.max(l-.05*c,a.min)),d=_(Math.min(d+.05*c,a.max)),{min:l,max:d,range:_(d-l)})}async function bp(a,e){try{let i=function(){return Promise.race([Jt.instance().getHardwareConcurrency(),new Promise(l=>{setTimeout(()=>l(void 0),1e3)})])};if(a)return{dataOrigin:"CPUProfile"};const n=Jt.instance().hasPrimaryPageTargetSet()?await i():void 0,s=Jt.instance().cpuThrottlingRate(),r=oi.instance().networkConditions(),o=typeof r.title=="function"?r.title():r.title;return{source:"DevTools",startTime:e?new Date(e).toJSON():void 0,cpuThrottling:s,networkThrottling:o,hardwareConcurrency:n,dataOrigin:"TraceEvents"}}catch{return{}}}class en extends Event{static eventName="sourcemappingsupdated";constructor(){super(en.eventName,{composed:!0,bubbles:!0})}}const fn=new Map;class Ot extends EventTarget{#e;#t=!1;#i=new Set;constructor(e){super(),this.#e=e}static clearResolvedNodeNames(){fn.clear()}static keyForCodeLocation(e){return`${e.url}$$$${e.scriptId}$$$${e.functionName}$$$${e.lineNumber}$$$${e.columnNumber}`}static resolvedCodeLocationForEntry(e){let t=null;if(We(e))t=e.callFrame;else{const n=si(e);if(n===null||n.length<1)return null;t=n[0]}const i=this.keyForCodeLocation(t);return fn.get(e.pid)?.get(e.tid)?.get(i)??null}static resolvedURLForEntry(e,t){const i=Ot.resolvedCodeLocationForEntry(t)?.devtoolsLocation?.uiSourceCode.url();if(i)return i;const n=Kt(e,t);return n?Rd.instance().uiSourceCodeForURL(n)?.url()??n:null}static storeResolvedNodeDataForEntry(e,t,i,n){const s=fn.get(e)||new Map,r=s.get(t)||new Map,o=this.keyForCodeLocation(i);r.set(o,n),s.set(t,r),fn.set(e,s)}async install(){for(const e of this.#e.Samples.profilesInProcess.values())for(const[t,i]of e){const n=i.parsedProfile.nodes();if(!n||n.length===0)continue;const r=this.#r(t)?.model(Ma);if(r)for(const o of n){const l=r.scriptForId(String(o.callFrame.scriptId));(!l||l.sourceMapURL)&&this.#i.add(r)}}for(const e of this.#i)e.sourceMapManager().addEventListener(Da.SourceMapAttached,this.#s,this);await this.#n()}uninstall(){for(const e of this.#i)e.sourceMapManager().removeEventListener(Da.SourceMapAttached,this.#s,this);this.#i.clear()}async#n(){let e=!1;for(const[t,i]of this.#e.Samples.profilesInProcess)for(const[n,s]of i){const r=s.parsedProfile.nodes()??[],o=this.#r(n);if(o)for(const l of r){const d=await Ad(l.callFrame,o);e||=!!d,l.setFunctionName(d);const c=o.model(Ma),h=c?.scriptForId(l.scriptId)||null,u=c&&new Nd(c,l.callFrame.scriptId,l.callFrame.lineNumber,l.callFrame.columnNumber),m=u&&await Fd.instance().rawLocationToUILocation(u);e||=!!m,Ot.storeResolvedNodeDataForEntry(t,n,l.callFrame,{name:d,devtoolsLocation:m,script:h})}}e&&this.dispatchEvent(new en)}#s(){this.#t||(this.#t=!0,setTimeout(async()=>{this.#t=!1,await this.#n()},500))}#r(e){const t=this.#e.Workers.workerIdByThread.get(e);return t?Y.instance().targetById(t):Y.instance().primaryPageTarget()}}const Lf=Object.freeze(Object.defineProperty({__proto__:null,SourceMappingsUpdated:en,SourceMapsResolver:Ot,resolvedCodeLocationDataNames:fn},Symbol.toStringTag,{value:"Module"}));function On(a){if(!We(a))return!1;const e=a.callFrame.url,t=Ot.resolvedCodeLocationForEntry(a),i=t?.script,n=t?.devtoolsLocation?.uiSourceCode,s=n?.url(),r=n?.isKnownThirdParty(),l={isContentScript:i?.isContentScript(),isKnownThirdParty:r};return ml(s||e,l)}function ml(a,e){return An.instance().isUserIgnoreListedURL(a,e)}const Rf=Object.freeze(Object.defineProperty({__proto__:null,isIgnoreListedEntry:On,isIgnoreListedURL:ml},Symbol.toStringTag,{value:"Module"})),gl={sSelfS:"{PH1} (self {PH2})"},wp=A("panels/timeline/AppenderUtils.ts",gl),Tp=N.bind(void 0,wp);function it(a){const e={padding:4,height:17,collapsible:!0,color:ie.instance().getComputedValue("--sys-color-on-surface"),backgroundColor:ie.instance().getComputedValue("--sys-color-cdt-base-container"),nestingLevel:0,shareHeaderLine:!0};return Object.assign(e,a)}function nt(a,e,t,i,n,s,r){const o={startLevel:e,name:t,style:i,selectable:n,expanded:s,showStackContextMenu:r};return a!==null&&(o.jslogContext=a),o}function hi(a,e){const t=$(a||0);if(t===se(0))return"";const i=$(e||0),n=1e-6;return Math.abs(t-i)>n&&i>n?Tp(gl.sSelfS,{PH1:ve(t,!0),PH2:ve(i,!0)}):ve(t,!0)}function Fs(a,e){let t=0;const i=a.ts,n=a.ts+(a.dur||0);for(;t<e.length&&i<e[t];)++t;return e[t]=n,t}function qi(a,e,t){const i=a.entryDecorations[e]||[];i.push(t),a.entryDecorations[e]=i}const Af=Object.freeze(Object.defineProperty({__proto__:null,addDecorationToEvent:qi,buildGroupStyle:it,buildTrackHeader:nt,getEventLevel:Fs,getFormattedTime:hi},Symbol.toStringTag,{value:"Module"})),fl={animations:"Animations"},Sp=A("panels/timeline/AnimationsTrackAppender.ts",fl),Ep=N.bind(void 0,Sp);class vl{appenderName="Animations";#e;#t;#i=this.#s.bind(this);constructor(e,t){this.#e=e,this.#t=t}appendTrackAtLevel(e,t){const i=this.#t.Animations.animations;return i.length===0?e:(this.#n(e,t),this.#e.appendEventsAtLevel(i,e,this,this.#i))}#n(e,t){const i=it({useFirstLineForOverview:!1}),n=nt("animations",e,Ep(fl.animations),i,!0,t);this.#e.registerTrackForGroup(n,this)}#s(e,t){e&&ra(e)&&rl.getNonCompositedFailure(e).length&&qi(this.#e.getFlameChartTimelineData(),t,{type:"WARNING_TRIANGLE"})}colorForEvent(){return ie.instance().getComputedValue("--app-color-rendering")}titleForEvent(e){const{displayName:t}=e.args.data.beginEvent.args.data;return t||e.name}highlightedEntryInfo(e){return{title:this.titleForEvent(e),formattedTime:hi(e.dur)}}}const Nf=Object.freeze(Object.defineProperty({__proto__:null,AnimationsTrackAppender:vl},Symbol.toStringTag,{value:"Module"}));let ts=null;class Ki extends Event{state;updateType;options;static eventName="traceboundsstatechanged";constructor(e,t,i={shouldAnimate:!1}){super(Ki.eventName,{composed:!0,bubbles:!0}),this.state=e,this.updateType=t,this.options=i}}function Ys(a){ae.instance().addEventListener(Ki.eventName,a)}class ae extends EventTarget{static instance(e={forceNew:null}){const t=!!e.forceNew;return(!ts||t)&&(ts=new ae),ts}static removeInstance(){ts=null}#e=null;constructor(){super()}resetWithNewBounds(e){return this.#e={entireTraceBounds:e,minimapTraceBounds:e,timelineTraceWindow:e},this.dispatchEvent(new Ki(this.state(),"RESET")),this}state(){if(this.#e===null)return null;const e=wt(this.#e.entireTraceBounds),t=wt(this.#e.minimapTraceBounds),i=wt(this.#e.timelineTraceWindow);return{micro:this.#e,milli:{entireTraceBounds:e,minimapTraceBounds:t,timelineTraceWindow:i}}}setMiniMapBounds(e){if(!this.#e){console.error("TraceBounds.setMiniMapBounds could not set bounds because there is no existing trace window set.");return}const t=this.#e.minimapTraceBounds;e.min===t.min&&e.max===t.max||e.range<1e3||(this.#e.minimapTraceBounds=e,this.dispatchEvent(new Ki(this.state(),"MINIMAP_BOUNDS")))}setTimelineVisibleWindow(e,t={shouldAnimate:!1,ignoreMiniMapBounds:!1}){if(!this.#e){console.error("TraceBounds.setTimelineVisibleWindow could not set bounds because there is no existing trace window set.");return}const i=this.#e.timelineTraceWindow;e.range<1e3||e.min===i.min&&e.max===i.max||(t.ignoreMiniMapBounds||(e.min=_(Math.max(this.#e.minimapTraceBounds.min,e.min)),e.max=_(Math.min(this.#e.minimapTraceBounds.max,e.max))),!(e.min===i.min&&e.max===i.max)&&(this.#e.timelineTraceWindow=e,this.dispatchEvent(new Ki(this.state(),"VISIBLE_WINDOW",{shouldAnimate:t.shouldAnimate}))))}}function Cp(a){const e=[a];let t=a;for(;t.child!==null;){const i=t.child;i!==null&&(e.push(i),t=i)}return e}class kp{initialBreadcrumb;activeBreadcrumb;constructor(e){this.initialBreadcrumb={window:e,child:null};let t=this.initialBreadcrumb;for(;t.child!==null;)t=t.child;this.activeBreadcrumb=t}add(e){if(!this.isTraceWindowWithinTraceWindow(e,this.activeBreadcrumb.window))throw new Error("Can not add a breadcrumb that is equal to or is outside of the parent breadcrumb TimeWindow");const t={window:e,child:null};return this.activeBreadcrumb.child=t,this.setActiveBreadcrumb(t,{removeChildBreadcrumbs:!1,updateVisibleWindow:!0}),t}isTraceWindowWithinTraceWindow(e,t){return e.min>=t.min&&e.max<=t.max&&!(e.min===t.min&&e.max===t.max)}setInitialBreadcrumbFromLoadedModifications(e){this.initialBreadcrumb=e;let t=e;for(;t.child!==null;)t=t.child;this.setActiveBreadcrumb(t,{removeChildBreadcrumbs:!1,updateVisibleWindow:!0})}setActiveBreadcrumb(e,t){t.removeChildBreadcrumbs&&(e.child=null),this.activeBreadcrumb=e,ae.instance().setMiniMapBounds(e.window),t.updateVisibleWindow&&ae.instance().setTimelineVisibleWindow(e.window)}}const yl=new CSSStyleSheet;yl.replaceSync(`/*
 * Copyright 2023 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

.breadcrumbs {
  display: none;
  align-items: center;
  height: 29px;
  padding: 3px;
  overflow-y: hidden;
  overflow-x: scroll;
}

.breadcrumbs::-webkit-scrollbar {
  display: none;
}

.breadcrumb {
  padding: 2px 6px;
  border-radius: 4px;
}

.breadcrumb:hover {
  background-color: var(--sys-color-state-hover-on-subtle);
}

.range {
  font-size: 12px;
  white-space: nowrap;
}

.active-breadcrumb {
  font-weight: bold;
  color: var(--app-color-active-breadcrumb);
}

/*# sourceURL=breadcrumbsUI.css */
`);const{render:xp,html:is}=K,Gr={activateBreadcrumb:"Activate breadcrumb",removeChildBreadcrumbs:"Remove child breadcrumbs"},Ip=A("panels/timeline/components/BreadcrumbsUI.ts",Gr),no=N.bind(void 0,Ip);class Yi extends Event{breadcrumb;childBreadcrumbsRemoved;static eventName="breadcrumbactivated";constructor(e,t){super(Yi.eventName),this.breadcrumb=e,this.childBreadcrumbsRemoved=t}}class bl extends HTMLElement{#e=this.attachShadow({mode:"open"});#t=this.#l.bind(this);#i=null;#n=null;connectedCallback(){this.#e.adoptedStyleSheets=[yl]}set data(e){this.#i=e.initialBreadcrumb,this.#n=e.activeBreadcrumb,D(this,this.#t)}#s(e){this.#n=e,this.dispatchEvent(new Yi(e))}#r(){const e=this.#e.querySelector(".breadcrumbs");e&&(e.style.display="flex",requestAnimationFrame(()=>{e.scrollWidth-e.clientWidth>0&&requestAnimationFrame(()=>{e.scrollLeft=e.scrollWidth-e.clientWidth})}))}#a(e,t){const i=new Ji(e);i.defaultSection().appendItem(no(Gr.activateBreadcrumb),()=>{this.dispatchEvent(new Yi(t))}),i.defaultSection().appendItem(no(Gr.removeChildBreadcrumbs),()=>{this.dispatchEvent(new Yi(t,!0))}),i.show()}#o(e,t){const i=$(e.window.range);return is`
          <div class="breadcrumb" @contextmenu=${n=>this.#a(n,e)} @click=${()=>this.#s(e)}
          jslog=${Gn("timeline.breadcrumb-select").track({click:!0})}>
           <span class="${e===this.#n?"active-breadcrumb":""} range">
            ${t===0?`Full range (${Ye(i,2)})`:`${Ye(i,2)}`}
            </span>
          </div>
          ${e.child!==null?is`
            <devtools-icon .data=${{iconName:"chevron-right",color:"var(--icon-default)",width:"16px",height:"16px"}}>`:""}
      `}#l(){const e=is`
      ${this.#i===null?V:is`<div class="breadcrumbs" jslog=${Zi("breadcrumbs")}>
        ${Cp(this.#i).map((t,i)=>this.#o(t,i))}
      </div>`}
    `;xp(e,this.#e,{host:this}),this.#i?.child&&this.#r()}}customElements.define("devtools-breadcrumbs-ui",bl);const wl=new CSSStyleSheet;wl.replaceSync(`/*
 * Copyright 2024 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

:host {
  display: inline-block;
  max-width: 100%;
  min-width: 50px;
}

devtools-select-menu {
  max-width: 100%;
}

/*# sourceURL=cpuThrottlingSelector.css */
`);const{html:so}=K,wi={cpu:"CPU: {PH1}",cpuThrottling:"CPU throttling: {PH1}",noThrottling:"No throttling",dSlowdown:"{PH1}Ã— slowdown"},Pp=A("panels/timeline/components/CPUThrottlingSelector.ts",wi),$i=N.bind(void 0,Pp);class Lp extends HTMLElement{#e=this.attachShadow({mode:"open"});#t;constructor(){super(),this.#t=Jt.instance().cpuThrottlingRate(),this.#s()}connectedCallback(){this.#e.adoptedStyleSheets=[wl],Jt.instance().addEventListener("RateChanged",this.#i,this),this.#i()}disconnectedCallback(){Jt.instance().removeEventListener("RateChanged",this.#i,this)}#i(){this.#t=Jt.instance().cpuThrottlingRate(),D(this,this.#s)}#n(e){Ur().setCPUThrottlingRate(Number(e.itemValue))}#s=()=>{const e=this.#t===1?$i(wi.noThrottling):$i(wi.dSlowdown,{PH1:this.#t}),t=so`
      <devtools-select-menu
            @selectmenuselected=${this.#n}
            .showDivider=${!0}
            .showArrow=${!0}
            .sideButton=${!1}
            .showSelectedItem=${!0}
            .showConnector=${!1}
            .jslogContext=${"cpu-throttling"}
            .buttonTitle=${$i(wi.cpu,{PH1:e})}
            title=${$i(wi.cpuThrottling,{PH1:e})}
          >
          ${va.cpuThrottlingPresets.map(i=>{const n=i===1?$i(wi.noThrottling):$i(wi.dSlowdown,{PH1:i}),s=i===1?"cpu-no-throttling":`cpu-throttled-${i}`;return so`
              <devtools-menu-item
                .value=${i}
                .selected=${this.#t===i}
                jslog=${Gn(s).track({click:!0})}
              >
                ${n}
              </devtools-menu-item>
            `})}
      </devtools-select-menu>
    `;q(t,this.#e,{host:this})}}customElements.define("devtools-cpu-throttling-selector",Lp);const ut={forcedReflow:"Forced reflow",sIsALikelyPerformanceBottleneck:"{PH1} is a likely performance bottleneck.",idleCallbackExecutionExtended:"Idle callback execution extended beyond deadline by {PH1}",sTookS:"{PH1} took {PH2}.",longTask:"Long task",longInteractionINP:"Long interaction",sIsLikelyPoorPageResponsiveness:"{PH1} is indicating poor page responsiveness.",websocketProtocol:"WebSocket protocol",webSocketBytes:"{PH1} byte(s)",webSocketDataLength:"Data length"},gs=A("panels/timeline/components/DetailsView.ts",ut),di=N.bind(void 0,gs);function Tl(a,e){const t=e.Warnings.perEvent.get(a),i=[];if(!t)return i;for(const n of t){const s=$(_(a.dur||0)),r=document.createElement("span");switch(n){case"FORCED_REFLOW":{const o=tt.create("https://developers.google.com/web/fundamentals/performance/rendering/avoid-large-complex-layouts-and-layout-thrashing#avoid-forced-synchronous-layouts",di(ut.forcedReflow),void 0,void 0,"forced-reflow");r.appendChild(z(gs,ut.sIsALikelyPerformanceBottleneck,{PH1:o}));break}case"IDLE_CALLBACK_OVER_TIME":{if(!Md(a))break;const o=ve((s||0)-a.args.data.allottedMilliseconds,!0);r.textContent=di(ut.idleCallbackExecutionExtended,{PH1:o});break}case"LONG_TASK":{const o=tt.create("https://web.dev/optimize-long-tasks/",di(ut.longTask),void 0,void 0,"long-tasks");r.appendChild(z(gs,ut.sTookS,{PH1:o,PH2:ve(s||0,!0)}));break}case"LONG_INTERACTION":{const o=tt.create("https://web.dev/inp",di(ut.longInteractionINP),void 0,void 0,"long-interaction");r.appendChild(z(gs,ut.sIsLikelyPoorPageResponsiveness,{PH1:o}));break}default:ke(n,`Unhandled warning type ${n}`)}i.push(r)}return i}function Rp(a,e){const t=[],i=e.Initiators.eventToInitiator.get(a);return i&&Dr(i)?(t.push({key:Nt("URL"),value:i.args.data.url}),i.args.data.websocketProtocol&&t.push({key:di(ut.websocketProtocol),value:i.args.data.websocketProtocol})):Dr(a)&&(t.push({key:Nt("URL"),value:a.args.data.url}),a.args.data.websocketProtocol&&t.push({key:di(ut.websocketProtocol),value:a.args.data.websocketProtocol})),Dd(a)&&a.args.data.dataLength&&t.push({key:di(ut.webSocketDataLength),value:`${di(ut.webSocketBytes,{PH1:a.args.data.dataLength})}`}),t}function Ap(a){const e={},t=new Set;for(const i of a){t.add(i.args.data.nodeId);let n=i.args.data.reason||"unknown";if(n==="unknown"&&$d(i)&&i.args.data.invalidatedSelectorId)switch(i.args.data.invalidatedSelectorId){case"attribute":n="Attribute",i.args.data.changedAttribute&&(n+=` (${i.args.data.changedAttribute})`);break;case"class":n="Class",i.args.data.changedClass&&(n+=` (${i.args.data.changedClass})`);break;case"id":n="Id",i.args.data.changedId&&(n+=` (${i.args.data.changedId})`);break}if(n==="PseudoClass"&&$a(i)&&i.args.data.extraData&&(n+=i.args.data.extraData),n==="Attribute"&&$a(i)&&i.args.data.extraData&&(n+=` (${i.args.data.extraData})`),n==="StyleInvalidator")continue;const s=e[n]||[];s.push(i),e[n]=s}return{groupedByReason:e,backendNodeIds:t}}const y={loading:"Loading",experience:"Experience",scripting:"Scripting",rendering:"Rendering",painting:"Painting",gpu:"GPU",async:"Async",system:"System",idle:"Idle",task:"Task",other:"Other",animation:"Animation",event:"Event",requestMainThreadFrame:"Request main thread frame",frameStart:"Frame start",onMessage:"On message",schedulePostMessage:"Schedule postMessage",messaging:"Messaging",frameStartMainThread:"Frame start (main thread)",drawFrame:"Draw frame",profilingOverhead:"Profiling overhead",hitTest:"Hit test",scheduleStyleRecalculation:"Schedule style recalculation",recalculateStyle:"Recalculate style",invalidateLayout:"Invalidate Layout",layerize:"Layerize",layout:"Layout",paintSetup:"Paint setup",paintImage:"Paint image",prePaint:"Pre-paint",updateLayer:"Update layer",updateLayerTree:"Update layer tree",paint:"Paint",rasterizePaint:"Rasterize paint",scroll:"Scroll",commit:"Commit",compositeLayers:"Composite layers",computeIntersections:"Compute intersections",parseHtml:"Parse HTML",parseStylesheet:"Parse stylesheet",installTimer:"Install timer",removeTimer:"Remove timer",timerFired:"Timer fired",xhrReadyStateChange:"`XHR` `readyState` change",xhrLoad:"`XHR` load",compileScript:"Compile script",cacheScript:"Cache script code",compileCode:"Compile code",optimizeCode:"Optimize code",evaluateScript:"Evaluate script",compileModule:"Compile module",cacheModule:"Cache module code",evaluateModule:"Evaluate module",streamingCompileTask:"Streaming compile task",waitingForNetwork:"Waiting for network",parseAndCompile:"Parse and compile",deserializeCodeCache:"Deserialize code cache",streamingWasmResponse:"Streaming Wasm response",compiledWasmModule:"Compiled Wasm module",cachedWasmModule:"Cached Wasm module",wasmModuleCacheHit:"Wasm module cache hit",wasmModuleCacheInvalid:"Wasm module cache invalid",frameStartedLoading:"Frame started loading",onloadEvent:"Onload event",domcontentloadedEvent:"DOMContentLoaded event",firstPaint:"First Paint",firstContentfulPaint:"First Contentful Paint",largestContentfulPaint:"Largest Contentful Paint",timestamp:"Timestamp",consoleTime:"Console time",userTiming:"User timing",willSendRequest:"Will send request",sendRequest:"Send request",receiveResponse:"Receive response",finishLoading:"Finish loading",receiveData:"Receive data",runMicrotasks:"Run microtasks",functionCall:"Function call",gcEvent:"GC event",majorGc:"Major GC",minorGc:"Minor GC",requestAnimationFrame:"Request animation frame",cancelAnimationFrame:"Cancel animation frame",animationFrameFired:"Animation frame fired",requestIdleCallback:"Request idle callback",cancelIdleCallback:"Cancel idle callback",fireIdleCallback:"Fire idle callback",createWebsocket:"Create WebSocket",sendWebsocketHandshake:"Send WebSocket handshake",receiveWebsocketHandshake:"Receive WebSocket handshake",wsMessageReceived:"Receive WebSocket message",wsMessageSent:"Send WebSocket message",destroyWebsocket:"Destroy WebSocket",embedderCallback:"Embedder callback",imageDecode:"Image decode",domGc:"DOM GC",cppGc:"CPP GC",encrypt:"Encrypt",encryptReply:"Encrypt reply",decrypt:"Decrypt",decryptReply:"Decrypt reply",digest:"Digest",digestReply:"Digest reply",sign:"Sign",signReply:"Sign reply",verify:"Verify",verifyReply:"Verify reply",asyncTask:"Async task",layoutShift:"Layout shift",layoutShiftCluster:"Layout shift cluster",eventTiming:"Event timing",jsFrame:"JS frame",rasterizing:"Rasterizing",drawing:"Drawing"};var G;(function(a){a.DRAWING="drawing",a.RASTERIZING="rasterizing",a.LAYOUT="layout",a.LOADING="loading",a.EXPERIENCE="experience",a.SCRIPTING="scripting",a.MESSAGING="messaging",a.RENDERING="rendering",a.PAINTING="painting",a.GPU="gpu",a.ASYNC="async",a.OTHER="other",a.IDLE="idle"})(G||(G={}));let vn;const Np=A("panels/timeline/components/EntryStyles.ts",y),b=N.bind(void 0,Np);class f{title;category;hidden;constructor(e,t,i=!1){this.title=e,this.category=t,this.hidden=i}}class le{name;title;visible;childColor;colorInternal;#e;constructor(e,t,i,n,s){this.name=e,this.title=t,this.visible=i,this.childColor=n,this.colorInternal=s,this.hidden=!1}get hidden(){return!!this.#e}get color(){return this.getComputedColorValue()}getCSSValue(){return`var(${this.colorInternal})`}getComputedColorValue(){return ie.instance().getComputedValue(this.colorInternal)}set hidden(e){this.#e=e}}let yn,bn;function tn(a){return El()[a]}function Sl(a){return Object.values(G).includes(a)}function $e(){return yn||(yn={loading:new le(G.LOADING,b(y.loading),!0,"--app-color-loading-children","--app-color-loading"),experience:new le(G.EXPERIENCE,b(y.experience),!1,"--app-color-rendering-children","--app-color-rendering"),messaging:new le(G.MESSAGING,b(y.messaging),!0,"--app-color-messaging-children","--app-color-messaging"),scripting:new le(G.SCRIPTING,b(y.scripting),!0,"--app-color-scripting-children","--app-color-scripting"),rendering:new le(G.RENDERING,b(y.rendering),!0,"--app-color-rendering-children","--app-color-rendering"),painting:new le(G.PAINTING,b(y.painting),!0,"--app-color-painting-children","--app-color-painting"),gpu:new le(G.GPU,b(y.gpu),!1,"--app-color-painting-children","--app-color-painting"),async:new le(G.ASYNC,b(y.async),!1,"--app-color-async-children","--app-color-async"),other:new le(G.OTHER,b(y.system),!1,"--app-color-system-children","--app-color-system"),idle:new le(G.IDLE,b(y.idle),!1,"--app-color-idle-children","--app-color-idle"),layout:new le(G.LAYOUT,b(y.layout),!1,"--app-color-loading-children","--app-color-loading"),rasterizing:new le(G.RASTERIZING,b(y.rasterizing),!1,"--app-color-children","--app-color-scripting"),drawing:new le(G.DRAWING,b(y.drawing),!1,"--app-color-rendering-children","--app-color-rendering")},yn)}function El(){if(bn)return bn;const a=$e();return bn={RunTask:new f(b(y.task),a.other),ProfileCall:new f(b(y.jsFrame),a.scripting),JSSample:new f("JSSample",a.scripting),Program:new f(b(y.other),a.other),"CpuProfiler::StartProfiling":new f(b(y.profilingOverhead),a.other),Animation:new f(b(y.animation),a.rendering),EventDispatch:new f(b(y.event),a.scripting),RequestMainThreadFrame:new f(b(y.requestMainThreadFrame),a.rendering,!0),BeginFrame:new f(b(y.frameStart),a.rendering,!0),BeginMainThreadFrame:new f(b(y.frameStartMainThread),a.rendering,!0),DrawFrame:new f(b(y.drawFrame),a.rendering,!0),HitTest:new f(b(y.hitTest),a.rendering),ScheduleStyleRecalculation:new f(b(y.scheduleStyleRecalculation),a.rendering),UpdateLayoutTree:new f(b(y.recalculateStyle),a.rendering),InvalidateLayout:new f(b(y.invalidateLayout),a.rendering,!0),Layerize:new f(b(y.layerize),a.rendering),Layout:new f(b(y.layout),a.rendering),PaintSetup:new f(b(y.paintSetup),a.painting),PaintImage:new f(b(y.paintImage),a.painting,!0),UpdateLayer:new f(b(y.updateLayer),a.painting,!0),UpdateLayerTree:new f(b(y.updateLayerTree),a.rendering),Paint:new f(b(y.paint),a.painting),PrePaint:new f(b(y.prePaint),a.rendering),RasterTask:new f(b(y.rasterizePaint),a.painting),ScrollLayer:new f(b(y.scroll),a.rendering),Commit:new f(b(y.commit),a.painting),CompositeLayers:new f(b(y.compositeLayers),a.painting),ComputeIntersections:new f(b(y.computeIntersections),a.rendering),ParseHTML:new f(b(y.parseHtml),a.loading),ParseAuthorStyleSheet:new f(b(y.parseStylesheet),a.loading),TimerInstall:new f(b(y.installTimer),a.scripting),TimerRemove:new f(b(y.removeTimer),a.scripting),TimerFire:new f(b(y.timerFired),a.scripting),XHRReadyStateChange:new f(b(y.xhrReadyStateChange),a.scripting),XHRLoad:new f(b(y.xhrLoad),a.scripting),"v8.compile":new f(b(y.compileScript),a.scripting),"v8.produceCache":new f(b(y.cacheScript),a.scripting),"V8.CompileCode":new f(b(y.compileCode),a.scripting),"V8.OptimizeCode":new f(b(y.optimizeCode),a.scripting),EvaluateScript:new f(b(y.evaluateScript),a.scripting),"V8.CompileModule":new f(b(y.compileModule),a.scripting),"v8.produceModuleCache":new f(b(y.cacheModule),a.scripting),"v8.evaluateModule":new f(b(y.evaluateModule),a.scripting),"v8.parseOnBackground":new f(b(y.streamingCompileTask),a.other),"v8.parseOnBackgroundWaiting":new f(b(y.waitingForNetwork),a.idle),"v8.parseOnBackgroundParsing":new f(b(y.parseAndCompile),a.scripting),"v8.deserializeOnBackground":new f(b(y.deserializeCodeCache),a.scripting),"V8.FinalizeDeserialization":new f(b(y.profilingOverhead),a.other),"v8.wasm.streamFromResponseCallback":new f(b(y.streamingWasmResponse),a.scripting),"v8.wasm.compiledModule":new f(b(y.compiledWasmModule),a.scripting),"v8.wasm.cachedModule":new f(b(y.cachedWasmModule),a.scripting),"v8.wasm.moduleCacheHit":new f(b(y.wasmModuleCacheHit),a.scripting),"v8.wasm.moduleCacheInvalid":new f(b(y.wasmModuleCacheInvalid),a.scripting),FrameStartedLoading:new f(b(y.frameStartedLoading),a.loading,!0),MarkLoad:new f(b(y.onloadEvent),a.scripting,!0),MarkDOMContent:new f(b(y.domcontentloadedEvent),a.scripting,!0),firstPaint:new f(b(y.firstPaint),a.painting,!0),firstContentfulPaint:new f(b(y.firstContentfulPaint),a.rendering,!0),"largestContentfulPaint::Candidate":new f(b(y.largestContentfulPaint),a.rendering,!0),TimeStamp:new f(b(y.timestamp),a.scripting),ConsoleTime:new f(b(y.consoleTime),a.scripting),UserTiming:new f(b(y.userTiming),a.scripting),ResourceWillSendRequest:new f(b(y.willSendRequest),a.loading),ResourceSendRequest:new f(b(y.sendRequest),a.loading),ResourceReceiveResponse:new f(b(y.receiveResponse),a.loading),ResourceFinish:new f(b(y.finishLoading),a.loading),ResourceReceivedData:new f(b(y.receiveData),a.loading),RunMicrotasks:new f(b(y.runMicrotasks),a.scripting),FunctionCall:new f(b(y.functionCall),a.scripting),GCEvent:new f(b(y.gcEvent),a.scripting),MajorGC:new f(b(y.majorGc),a.scripting),MinorGC:new f(b(y.minorGc),a.scripting),"CppGC.IncrementalSweep":new f(b(y.cppGc),a.scripting),RequestAnimationFrame:new f(b(y.requestAnimationFrame),a.scripting),CancelAnimationFrame:new f(b(y.cancelAnimationFrame),a.scripting),FireAnimationFrame:new f(b(y.animationFrameFired),a.scripting),RequestIdleCallback:new f(b(y.requestIdleCallback),a.scripting),CancelIdleCallback:new f(b(y.cancelIdleCallback),a.scripting),FireIdleCallback:new f(b(y.fireIdleCallback),a.scripting),WebSocketCreate:new f(b(y.createWebsocket),a.scripting),WebSocketSendHandshakeRequest:new f(b(y.sendWebsocketHandshake),a.scripting),WebSocketReceiveHandshakeResponse:new f(b(y.receiveWebsocketHandshake),a.scripting),WebSocketDestroy:new f(b(y.destroyWebsocket),a.scripting),WebSocketSend:new f(b(y.wsMessageSent),a.scripting),WebSocketReceive:new f(b(y.wsMessageReceived),a.scripting),EmbedderCallback:new f(b(y.embedderCallback),a.scripting),"Decode Image":new f(b(y.imageDecode),a.painting),GPUTask:new f(b(y.gpu),a.gpu),"BlinkGC.AtomicPhase":new f(b(y.domGc),a.scripting),DoEncrypt:new f(b(y.encrypt),a.scripting),DoEncryptReply:new f(b(y.encryptReply),a.scripting),DoDecrypt:new f(b(y.decrypt),a.scripting),DoDecryptReply:new f(b(y.decryptReply),a.scripting),DoDigest:new f(b(y.digest),a.scripting),DoDigestReply:new f(b(y.digestReply),a.scripting),DoSign:new f(b(y.sign),a.scripting),DoSignReply:new f(b(y.signReply),a.scripting),DoVerify:new f(b(y.verify),a.scripting),DoVerifyReply:new f(b(y.verifyReply),a.scripting),AsyncTask:new f(b(y.asyncTask),a.async),LayoutShift:new f(b(y.layoutShift),a.experience),SyntheticLayoutShiftCluster:new f(b(y.layoutShiftCluster),a.experience),EventTiming:new f(b(y.eventTiming),a.experience),HandlePostMessage:new f(b(y.onMessage),a.messaging),SchedulePostMessage:new f(b(y.schedulePostMessage),a.messaging)},bn}function Fp(a){bn=a}function Mp(a){yn=a}function Dp(){const a=El(),e=[];for(const t in a)a[t]?.hidden||e.push(t);return e}function $p(){return vn||(vn=[G.IDLE,G.LOADING,G.PAINTING,G.RENDERING,G.SCRIPTING,G.OTHER],vn)}function Bp(a){vn=a}const Ti={anonymous:"(anonymous)",eventDispatchS:"Event: {PH1}",frame:"Frame",wsConnectionOpened:"WebSocket opened",wsConnectionOpenedWithUrl:"WebSocket opened: {PH1}",wsConnectionClosed:"WebSocket closed"},Op=A("panels/timeline/components/EntryName.ts",Ti),ln=N.bind(void 0,Op);function Ge(a,e){if(We(a)){if(e){const i=Lo(e.Samples,a);if(i)return i}return a.callFrame.functionName||ln(Ti.anonymous)}if(jn(a))return Nt(Ti.frame);if(Ro(a))return ln(Ti.eventDispatchS,{PH1:a.args.data.type});if(Dt(a)){const i=new qn(a.args.data.url),n=i.isValid?`${i.displayName} (${i.host})`:a.args.data.url||"Network request";return Po(n,40)}return Dr(a)?a.args.data.url?ln(Ti.wsConnectionOpenedWithUrl,{PH1:a.args.data.url}):ln(Ti.wsConnectionOpened):Bd(a)?ln(Ti.wsConnectionClosed):Ni(a)?Hp(a):tn(a.name)?.title||a.name}function Hp(a){const e=Bu(a);return e==="OTHER"?"Other":e==="KEYBOARD"?"Keyboard":e==="POINTER"?"Pointer":a.type}const Cl=new CSSStyleSheet;Cl.replaceSync(`/*
 * Copyright 2024 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

:host {
  display: block;
}

:host * {
  box-sizing: border-box;
}

devtools-dialog {
  --override-transparent: color-mix(in sRGB, var(--color-background) 80%, transparent);
}

.title {
  font-size: var(--sys-typescale-headline4-size);
  line-height: var(--sys-typescale-headline4-line-height);
  font-weight: var(--ref-typeface-weight-medium);
  margin: 0;
}

.section-title {
  font-size: var(--sys-typescale-headline5-size);
  line-height: var(--sys-typescale-headline5-line-height);
  font-weight: var(--ref-typeface-weight-medium);
  margin: 0;
}

.privacy-disclosure {
  margin: 8px 0;
}

.url-override {
  margin: 8px 0;
  display: flex;
  align-items: center;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: max-content;
}

details > summary {
  font-size: var(--sys-typescale-body4-size);
  line-height: var(--sys-typescale-body4-line-height);
  font-weight: var(--ref-typeface-weight-medium);
}

.content {
  max-width: 360px;
  padding: 16px 20px 18px;
  box-sizing: border-box;
}

.open-button-section {
  display: flex;
  flex-direction: row;
}

.origin-mapping-grid {
  border: 1px solid var(--sys-color-divider);
  margin-top: 8px;
}

.origin-mapping-button-section {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-top: 6px;
}

.config-button {
  margin-left: auto;
}

.advanced-section-contents {
  margin: 4px 0 14px;
}

.buttons-section {
  display: flex;
  justify-content: flex-end;
  margin-top: 6px;
  gap: 8px;
}

input[type="checkbox"] {
  height: 12px;
  width: 12px;
  min-height: 12px;
  min-width: 12px;
  margin: 6px;
}

input[type="text"][disabled] {
  color: var(--sys-color-state-disabled);
}

.warning {
  margin: 2px 8px;
  color: var(--color-error-text);
}

x-link { /* stylelint-disable-line selector-type-no-unknown */
  color: var(--sys-color-primary);
  text-decoration-line: underline;
}

.divider {
  margin: 10px 0;
  border: none;
  border-top: 1px solid var(--sys-color-divider);
}

/*# sourceURL=fieldSettingsDialog.css */
`);const X={setUp:"Set up",configure:"Configure",ok:"Ok",optOut:"Opt out",cancel:"Cancel",onlyFetchFieldData:"Always show field data for the below URL",url:"URL",doesNotHaveSufficientData:"The Chrome UX Report does not have sufficient real-world speed data for this page.",configureFieldData:"Configure field data fetching",fetchAggregated:"Fetch aggregated field data from the {PH1} to help you contextualize local measurements with what real users experience on the site.",privacyDisclosure:"Privacy disclosure",whenPerformanceIsShown:"When DevTools is open, the URLs you visit will be sent to Google to query field data. These requests are not tied to your Google account.",advanced:"Advanced",mapDevelopmentOrigins:"Set a development origin to automatically get relevant field data for its production origin.",developmentOrigin:"Development origin",productionOrigin:"Production origin",developmentOriginValue:"Development origin: {PH1}",productionOriginValue:"Production origin: {PH1}",new:"New",add:"Add",delete:"Delete",invalidOrigin:'"{PH1}" is not a valid origin or URL.',alreadyMapped:'"{PH1}" is already mapped to a production origin.'},kl=A("panels/timeline/components/FieldSettingsDialog.ts",X),te=N.bind(void 0,kl),{html:ot,nothing:ro,Directives:{ifDefined:wr}}=K;class ya extends Event{static eventName="showdialog";constructor(){super(ya.eventName)}}class _p extends HTMLElement{#e=this.attachShadow({mode:"open"});#t;#i=ze.instance().getConfigSetting();#n="";#s=!1;#r="";#a="";#o=[];#l=!1;#p="";#h="";constructor(){super();const e=ze.instance();this.#i=e.getConfigSetting(),this.#d(),this.#S()}#d(){const e=this.#i.get();this.#n=e.override||"",this.#s=e.overrideEnabled||!1,this.#o=e.originMappings||[],this.#r="",this.#a="",this.#l=!1,this.#p="",this.#h=""}#u(e){this.#i.set({enabled:e,override:this.#n,originMappings:this.#o,overrideEnabled:this.#s})}#c(){D(this,this.#S)}async#m(e){const i=await ze.instance().getFieldDataForPage(e);return Object.values(i).some(n=>n)}async#g(e){if(e&&this.#s){if(!this.#I(this.#n)){this.#r=te(X.invalidOrigin,{PH1:this.#n}),D(this,this.#S);return}if(!await this.#m(this.#n)){this.#r=te(X.doesNotHaveSufficientData),D(this,this.#S);return}}this.#u(e),this.#f()}#v(){if(!this.#t)throw new Error("Dialog not found");this.#d(),this.#t.setDialogVisible(!0),D(this,this.#S),this.dispatchEvent(new ya)}#f(e){if(!this.#t)throw new Error("Dialog not found");this.#t.setDialogVisible(!1),e&&e.stopImmediatePropagation(),D(this,this.#S)}connectedCallback(){this.#e.adoptedStyleSheets=[Cl,Od,Hd],this.#i.addChangeListener(this.#c,this),D(this,this.#S)}disconnectedCallback(){this.#i.removeChangeListener(this.#c,this)}#w(){return this.#i.get().enabled?ot`
        <devtools-button
          class="config-button"
          @click=${this.#v}
          .data=${{variant:"outlined",title:te(X.configure)}}
        jslog=${bt("timeline.field-data.configure").track({click:!0})}
        >${te(X.configure)}</devtools-button>
      `:ot`
      <devtools-button
        class="setup-button"
        @click=${this.#v}
        .data=${{variant:"primary",title:te(X.setUp)}}
        jslog=${bt("timeline.field-data.setup").track({click:!0})}
        data-field-data-setup
      >${te(X.setUp)}</devtools-button>
    `}#b(){return ot`
      <devtools-button
        @click=${()=>{this.#g(!0)}}
        .data=${{variant:"primary",title:te(X.ok)}}
        jslog=${bt("timeline.field-data.enable").track({click:!0})}
        data-field-data-enable
      >${te(X.ok)}</devtools-button>
    `}#y(){const e=this.#i.get().enabled?te(X.optOut):te(X.cancel);return ot`
      <devtools-button
        @click=${()=>{this.#g(!1)}}
        .data=${{variant:"outlined",title:e}}
        jslog=${bt("timeline.field-data.disable").track({click:!0})}
        data-field-data-disable
      >${e}</devtools-button>
    `}#E(e){e.stopPropagation();const t=e.target;this.#n=t.value,this.#r="",D(this,this.#S)}#T(e){e.stopPropagation();const t=e.target;this.#s=t.checked,this.#r="",D(this,this.#S)}#x=e=>{e.stopPropagation();const t=e.target;this.#p=t.value,D(this,this.#S)};#P=e=>{e.stopPropagation();const t=e.target;this.#h=t.value,D(this,this.#S)};#I(e){try{return new URL(e).origin}catch{return null}}#L(){this.#p="",this.#h="",this.#l=!0,this.#a="",D(this,this.#S)}async#C(){const e=this.#I(this.#p),t=this.#I(this.#h);if(!e){this.#a=te(X.invalidOrigin,{PH1:this.#p}),D(this,this.#S);return}if(this.#o.find(n=>n.developmentOrigin===e)){this.#a=te(X.alreadyMapped,{PH1:e}),D(this,this.#S);return}if(!t){this.#a=te(X.invalidOrigin,{PH1:this.#h}),D(this,this.#S);return}if(!await this.#m(t)){this.#a=te(X.doesNotHaveSufficientData,{PH1:this.#h}),D(this,this.#S);return}this.#o.push({developmentOrigin:e,productionOrigin:t}),this.#p="",this.#h="",this.#l=!1,this.#a="",D(this,this.#S)}#k(e){this.#o.splice(e,1),D(this,this.#S)}#N(){const e=this.#o.map((i,n)=>({cells:[{columnId:"development-origin",value:i.developmentOrigin,title:i.developmentOrigin},{columnId:"production-origin",value:i.productionOrigin,title:i.productionOrigin},{columnId:"action-button",value:te(X.delete),renderer:s=>ot`
              <div style="display: flex; align-items: center; justify-content: center;">
                <devtools-button
                  class="delete-mapping"
                  .data=${{variant:"icon",size:"SMALL",title:s,iconName:"bin",jslogContext:"delete-origin-mapping"}}
                  @click=${()=>this.#k(n)}
                ></devtools-button>
              </div>
            `}]}));if(this.#l){const i="width: 100%; box-sizing: border-box; border: none; background: none;";e.push({cells:[{columnId:"development-origin",value:this.#p,renderer:n=>ot`
              <input
                type="text"
                placeholder="http://localhost:8080"
                aria-label=${te(X.developmentOriginValue,{PH1:n})}
                style=${i}
                title=${wr(n)}
                @keyup=${this.#x}
                @change=${this.#x} />
            `},{columnId:"production-origin",value:this.#h,renderer:n=>ot`
              <input
                type="text"
                placeholder="https://example.com"
                aria-label=${te(X.productionOriginValue,{PH1:n})}
                style=${i}
                title=${wr(n)}
                @keyup=${this.#P}
                @change=${this.#P} />
            `},{columnId:"action-button",value:te(X.add),renderer:n=>ot`
              <div style="display: flex; align-items: center; justify-content: center;">
                <devtools-button
                  id="add-mapping-button"
                  .data=${{variant:"icon",size:"SMALL",title:n,iconName:"plus",disabled:!this.#p||!this.#h,jslogContext:"add-origin-mapping"}}
                  @click=${()=>this.#C()}
                ></devtools-button>
              </div>
            `}]})}const t={columns:[{id:"development-origin",title:te(X.developmentOrigin),widthWeighting:13,hideable:!1,visible:!0,sortable:!1},{id:"production-origin",title:te(X.productionOrigin),widthWeighting:13,hideable:!1,visible:!0,sortable:!1},{id:"action-button",title:"",widthWeighting:3,hideable:!1,visible:!0,sortable:!1}],rows:e};return ot`
      <div>${te(X.mapDevelopmentOrigins)}</div>
      <devtools-data-grid-controller
        class="origin-mapping-grid"
        .data=${t}
      ></devtools-data-grid-controller>
      ${this.#a?ot`
        <div class="warning" role="alert" aria-label=${this.#a}>${this.#a}</div>
      `:ro}
      <div class="origin-mapping-button-section">
        <devtools-button
          @click=${this.#L}
          .data=${{variant:"text",title:te(X.new),iconName:"plus",disabled:this.#l}}
          jslogContext=${"new-origin-mapping"}
        >${te(X.new)}</devtools-button>
      </div>
    `}#S=()=>{const e=tt.create("https://developer.chrome.com/docs/crux",Nt("Chrome UX Report")),t=z(kl,X.fetchAggregated,{PH1:e}),i=ot`
      <div class="open-button-section">${this.#w()}</div>
      <devtools-dialog
        @clickoutsidedialog=${this.#f}
        .showConnector=${!0}
        .position=${"auto"}
        .horizontalAlignment=${"center"}
        .jslogContext=${"timeline.field-data.settings"}
        on-render=${ji(n=>{this.#t=n})}
      >
        <div class="content">
          <h2 class="title">${te(X.configureFieldData)}</h2>
          <div>${t}</div>
          <div class="privacy-disclosure">
            <h3 class="section-title">${te(X.privacyDisclosure)}</h3>
            <div>${te(X.whenPerformanceIsShown)}</div>
          </div>
          <details aria-label=${te(X.advanced)}>
            <summary>${te(X.advanced)}</summary>
            <div class="advanced-section-contents">
              ${this.#N()}
              <hr class="divider">
              <label class="url-override">
                <input
                  type="checkbox"
                  .checked=${this.#s}
                  @change=${this.#T}
                  aria-label=${te(X.onlyFetchFieldData)}
                  jslog=${_d().track({click:!0}).context("field-url-override-enabled")}
                />
                ${te(X.onlyFetchFieldData)}
              </label>
              <input
                type="text"
                @keyup=${this.#E}
                @change=${this.#E}
                class="devtools-text-input"
                .disabled=${!this.#s}
                .value=${this.#n}
                placeholder=${wr(this.#s?te(X.url):void 0)}
              />
              ${this.#r?ot`<div class="warning" role="alert" aria-label=${this.#r}>${this.#r}</div>`:ro}
            </div>
          </details>
          <div class="buttons-section">
            ${this.#y()}
            ${this.#b()}
          </div>
        </div>
      </devtools-dialog>
    `;q(i,this.#e,{host:this})}}customElements.define("devtools-field-settings-dialog",_p);const xl=new CSSStyleSheet;xl.replaceSync(`/*
 * Copyright 2023 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

:host {
  display: block;
}

.breakdown {
  margin: 0;
  padding: 0;
  list-style: none;
  color: var(--sys-color-token-subtle);
}

.value {
  display: inline-block;
  padding: 0 5px;
  color: var(--sys-color-on-surface);
}

/*# sourceURL=interactionBreakdown.css */
`);const{html:Wp}=K,fs={inputDelay:"Input delay",processingDuration:"Processing duration",presentationDelay:"Presentation delay"},Vp=A("panels/timeline/components/InteractionBreakdown.ts",fs),Tr=N.bind(void 0,Vp);class Il extends HTMLElement{#e=this.attachShadow({mode:"open"});#t=this.#n.bind(this);#i=null;connectedCallback(){this.#e.adoptedStyleSheets=[xl]}set entry(e){e!==this.#i&&(this.#i=e,D(this,this.#t))}#n(){if(!this.#i)return;const e=Bt(this.#i.inputDelay),t=Bt(this.#i.mainThreadHandling),i=Bt(this.#i.presentationDelay);q(Wp`<ul class="breakdown">
                     <li data-entry="input-delay">${Tr(fs.inputDelay)}<span class="value">${e}</span></li>
                     <li data-entry="processing-duration">${Tr(fs.processingDuration)}<span class="value">${t}</span></li>
                     <li data-entry="presentation-delay">${Tr(fs.presentationDelay)}<span class="value">${i}</span></li>
                   </ul>
                   `,this.#e,{host:this})}}customElements.define("devtools-interaction-breakdown",Il);const Xs=new CSSStyleSheet;Xs.replaceSync(`/*
 * Copyright 2024 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

:host {
  --markdown-link-text-decoration-style: underline;
}

.insight {
  display: block;
  position: relative;
  width: auto;
  height: auto;
  margin: var(--sys-size-6) 0;
  border-radius: var(--sys-shape-corner-extra-small);
  overflow: hidden;
  border: var(--sys-size-1) solid var(--sys-color-divider);
  background-color: var(--sys-color-base);

  &.closed {
    background-color: var(--sys-color-surface3);
    border: none;

    &:focus-within {
      /* Ensure that if the user tabs to a closed insight, we outline it so they know it's focused. */
      outline: var(--sys-size-1) solid var(--sys-color-primary);
    }
  }

  header {
    padding: var(--sys-size-5) var(--sys-size-6);

    h3 {
      font: var(--sys-typescale-body4-medium);
    }
  }

  &:not(.closed) {
    header {
      padding-bottom: var(--sys-size-2);
    }
  }
}

.insight-hover-icon {
  position: absolute;
  top: var(--sys-size-5);
  right: var(--sys-size-5);
  border: none;
  width: var(--sys-size-9);
  user-select: none;
  height: var(--sys-size-9);
  box-shadow: var(--sys-elevation-level1);
  border-radius: var(--sys-shape-corner-full);
  background: var(--sys-color-cdt-base-container);
  opacity: 0%;
  transition: opacity 0.2s ease;

  /* Ensure that the icon appears when the user hovers, or focuses the header */
  .insight:hover &,
  header:focus-within & {
    opacity: 100%;
  }

  devtools-button {
    transition: transform 0.2s ease;
  }

  &.active devtools-button {
    transform: rotate(180deg);
  }
}

.insight-description,
.insight-body,
.insight-title {
  user-select: text;
}

.insight-body {
  padding: 0 var(--sys-size-6) var(--sys-size-5) var(--sys-size-6);
}

.insight-section {
  padding-top: var(--sys-size-5);
}

.insight-description:not(:empty) {
  padding-bottom: var(--sys-size-5);
}

.insight-section:not(:empty) {
  border-top: var(--sys-size-1) solid var(--sys-color-divider);
}

.insight-title {
  color: var(--sys-color-on-base);
  margin-block: 3px;
}

.link {
  color: var(--sys-color-primary);
}

.dl-title {
  font-weight: bold;
}

dd.dl-title {
  text-align: right;
}

.dl-value {
  font-weight: bold;
}

.metric-value-bad {
  color: var(--app-color-performance-bad);
}

.metric-value-good {
  color: var(--app-color-performance-good);
}

.insight-entry {
  font: var(--sys-typescale-body4-medium);
  padding-block: var(--sys-size-3);
  display: flex;
  align-items: center;
}

.element-img {
  width: var(--sys-size-13);
  height: var(--sys-size-13);
  object-fit: cover;
  border: var(--sys-size-1) solid var(--sys-color-divider);
  background: var(--sys-color-divider) -0.054px -12px / 100.239% 148.936% no-repeat;
  margin-right: var(--sys-size-5);
}

.element-img-details {
  font: var(--sys-typescale-body4-regular);
  display: flex;
  flex-direction: column;
  word-break: break-all;

  .element-img-details-size {
    color: var(--color-text-secondary);
  }
}

::slotted(*) {
  font: var(--sys-typescale-body4-regular);
}

.insight-savings {
  font: var(--sys-typescale-body4-medium);
  color: var(--sys-color-green);
}

ul.insight-icon-results {
  list-style: none;
  margin: 0;
  padding: 0;

  li {
    display: flex;
    align-items: flex-start;
    justify-content: flex-start;
    gap: var(--sys-size-3);

    span {
      /* push the text down to align slightly better with the icons */
      padding-top: 2px;
    }
  }
}

.timeline-link {
  cursor: pointer;
  text-decoration: underline;
  color: var(--sys-color-primary);
  /* for a11y reasons this is a button, so we have to remove some default
   * styling */
  background: none;
  border: none;
  padding: 0;
  font: inherit;
}

.timeline-link.invalid-link {
  color: var(--sys-color-state-disabled);
}

.lcp-element {
  display: inline-flex;
  align-items: center;
}

.insight-results:not(:last-child) {
  border-bottom: var(--sys-size-1) solid var(--sys-color-divider);
  padding-bottom: var(--sys-size-5);
}

.lcp-element:not(:empty) {
  padding: inherit;
}

/*# sourceURL=sidebarInsight.css */
`);const{html:Pl}=K;class ui extends Event{event;static eventName="eventreferenceclick";constructor(e){super(ui.eventName,{bubbles:!0,composed:!0}),this.event=e}}class Up extends HTMLElement{#e=this.attachShadow({mode:"open"});#t=this.#s.bind(this);#i=null;#n=null;connectedCallback(){this.#e.adoptedStyleSheets=[Xs]}set text(e){this.#i=e,D(this,this.#t)}set event(e){this.#n=e,D(this,this.#t)}#s(){!this.#i||!this.#n||q(Pl`
      <button type="button" class="timeline-link" @click=${e=>{e.stopPropagation(),this.#n&&this.dispatchEvent(new ui(this.#n))}}>${this.#i}</button>
    `,this.#e,{host:this})}}function ba(a){let e,t;return Dt(a)?(t=hl(new URL(a.args.data.url)),e=a.args.data.url):ke(a,`unsupported event in eventRef: ${a.name}`),Pl`<devtools-performance-event-ref
    .event=${a}
    .text=${t}
    title=${e}
  ></devtools-performance-event-ref>`}customElements.define("devtools-performance-event-ref",Up);const{html:ns}=K,wn={estimatedSavings:"Est savings: {PH1}",estimatedSavingsTimingAndBytes:"Est savings: {PH1} & {PH2}",viewDetails:"View details for {PH1}"},zp=A("panels/timeline/components/insights/SidebarInsight.ts",wn),ss=N.bind(void 0,zp);class Js extends Event{name;insightSetKey;overlays;static eventName="insightactivated";constructor(e,t,i){super(Js.eventName,{bubbles:!0,composed:!0}),this.name=e,this.insightSetKey=t,this.overlays=i}}class Kn extends Event{static eventName="insightdeactivated";constructor(){super(Kn.eventName,{bubbles:!0,composed:!0})}}class Hn extends Event{bounds;static eventName="insightsethovered";constructor(e){super(Hn.eventName,{bubbles:!0,composed:!0}),this.bounds=e}}class Zs extends Event{bounds;static eventName="insightsetzoom";constructor(e){super(Zs.eventName,{bubbles:!0,composed:!0}),this.bounds=e}}class Qs extends Event{overlays;options;static eventName="insightprovideoverlays";constructor(e,t){super(Qs.eventName,{bubbles:!0,composed:!0}),this.overlays=e,this.options=t}}class er extends Event{label;events;activateInsight;static eventName="insightproviderelatedevents";constructor(e,t,i){super(er.eventName,{bubbles:!0,composed:!0}),this.label=e,this.events=t,this.activateInsight=i}}class Gp extends HTMLElement{#e=this.attachShadow({mode:"open"});#t=this.#u.bind(this);#i="";#n="";#s="";#r=!1;#a=void 0;#o=void 0;set data(e){this.#i=e.title,this.#n=e.description,this.#s=e.internalName,this.#r=e.expanded,this.#a=e.estimatedSavingsTime,this.#o=e.estimatedSavingsBytes,this.dataset.insightTitle=e.title,e.expanded?this.dataset.insightExpanded="":delete this.dataset.insightExpanded,D(this,this.#t)}connectedCallback(){this.#e.adoptedStyleSheets=[Xs],D(this,this.#t)}#l(){this.dispatchEvent(new CustomEvent("insighttoggleclick"))}#p(e){const t=Nn({"insight-hover-icon":!0,active:e});return ns`
      <div class=${t} inert>
        <devtools-button .data=${{variant:"icon",iconName:"chevron-down",size:"SMALL"}}
      ></devtools-button>
      </div>

    `}#h(e){(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),e.stopPropagation(),this.#l())}#d(){let e,t;return this.#a!==void 0&&this.#a>0&&(e=ve(this.#a)),this.#o!==void 0&&this.#o>0&&(t=Ke(this.#o)),e&&t?ss(wn.estimatedSavingsTimingAndBytes,{PH1:e,PH2:t}):e?ss(wn.estimatedSavings,{PH1:e}):t?ss(wn.estimatedSavings,{PH1:t}):null}#u(){const e=Nn({insight:!0,closed:!this.#r}),t=this.#d(),i=ns`
      <div class=${e}>
        <header @click=${this.#l}
          @keydown=${this.#h}
          jslog=${bt(`timeline.toggle-insight.${this.#s}`).track({click:!0})}
          tabIndex="0"
          role="button"
          aria-expanded=${this.#r}
          aria-label=${ss(wn.viewDetails,{PH1:this.#i})}
        >
          ${this.#p(this.#r)}
          <h3 class="insight-title">${this.#i}</h3>
          ${t?ns`
            <slot name="insight-savings" class="insight-savings">
              ${t}
            </slot>
          </div>`:V}
        </header>
        ${this.#r?ns`
          <div class="insight-body">
            <div class="insight-description">${this.#n?Kp(this.#n):V}</div>
            <div class="insight-content">
              <slot name="insight-content"></slot>
            </div>
          </div>`:V}
      </div>
    `;q(i,this.#e,{host:this})}}customElements.define("devtools-performance-sidebar-insight",Gp);var Be;(function(a){a.ALL="All",a.INP="INP",a.LCP="LCP",a.CLS="CLS"})(Be||(Be={}));const{html:jp}=K;function Ht(a){return a.activeCategory===Be.ALL||a.activeCategory===a.insightCategory}function qp(a){return!!(a.activeInsight&&a.activeInsight.name===a.insightName&&a.activeInsight.insightSetKey===a.insightSetKey)}class _t extends HTMLElement{static litTagName=Tt``;shadow=this.attachShadow({mode:"open"});data={insights:null,parsedTrace:null,insightSetKey:null,activeInsight:null,activeCategory:Be.ALL};#e=this.#s.bind(this);sharedTableState={selectedRowEl:null,selectionIsSticky:!1};#t=null;#i=!1;scheduleRender(){D(this,this.#e)}connectedCallback(){if(this.shadow.adoptedStyleSheets.push(Xs),this.setAttribute("jslog",`${Zi(`timeline.insights.${this.internalName}`)}`),this.dataset.insightName=this.internalName,!this.#i){this.#i=!0;const e=this.getRelatedEvents();e.length&&this.dispatchEvent(new er(this.userVisibleTitle,e,this.#n.bind(this)))}}set insights(e){this.data.insights=e,D(this,this.#e)}set parsedTrace(e){this.data.parsedTrace=e,D(this,this.#e)}set insightSetKey(e){this.data.insightSetKey=e,D(this,this.#e)}set activeInsight(e){this.data.activeInsight=e,D(this,this.#e)}set activeCategory(e){this.data.activeCategory=e,D(this,this.#e)}onSidebarClick(){if(this.isActive()){this.dispatchEvent(new Kn);return}this.#n()}#n(){this.data.insightSetKey&&(this.sharedTableState.selectedRowEl?.classList.remove("selected"),this.sharedTableState.selectedRowEl=null,this.sharedTableState.selectionIsSticky=!1,this.dispatchEvent(new Js(this.internalName,this.data.insightSetKey,this.getInitialOverlays())))}toggleTemporaryOverlays(e,t){this.isActive()&&this.dispatchEvent(new Qs(e??this.getInitialOverlays(),t))}getInitialOverlays(){return this.#t?this.#t:(this.#t=this.createOverlays(),this.#t)}getRelatedEvents(){return[]}#s(){this.render(),this.isActive()&&requestAnimationFrame(()=>requestAnimationFrame(()=>this.scrollIntoViewIfNeeded()))}isActive(){return qp({activeInsight:this.data.activeInsight,insightName:this.internalName,insightSetKey:this.data.insightSetKey})}getInsightSetUrl(){const e=this.data.insights?.get(this.data.insightSetKey??"")?.url;return Wd(e,"Expected url for insight set"),new URL(e)}}function Kp(a){const e=Vd(a);return jp`<devtools-markdown-view
    .data=${{tokens:e}}>
  </devtools-markdown-view>`}const{html:Sr}=K,xt={title:"Layout shift culprits",description:"Layout shifts occur when elements move absent any user interaction. [Investigate the causes of layout shifts](https://web.dev/articles/optimize-cls), such as elements being added, removed, or their fonts changing as the page loads.",worstLayoutShiftCluster:"Worst layout shift cluster",worstCluster:"Worst cluster",layoutShiftCluster:"Layout shift cluster @ {PH1}",topCulprits:"Top layout shift culprits",injectedIframe:"Injected iframe",fontRequest:"Font request",animation:"Animation"},Yp=A("panels/timeline/components/insights/CLSCulprits.ts",xt),Vt=N.bind(void 0,Yp);class Ll extends _t{static litTagName=Tt`devtools-performance-cls-culprits`;insightCategory=Be.CLS;internalName="cls-culprits";userVisibleTitle=Vt(xt.title);description=Vt(xt.description);createOverlays(){const i=(oe("CumulativeLayoutShift",this.data.insights,this.data.insightSetKey)?.clusters.toSorted((o,l)=>l.clusterCumulativeScore-o.clusterCumulativeScore)??[])[0];if(!i)return[];const n=_(i.dur??0),s=_(i.ts+n),r=Sr`<div>${Vt(xt.worstLayoutShiftCluster)}</div>`;return[{type:"TIMESPAN_BREAKDOWN",sections:[{bounds:{min:i.ts,range:n,max:s},label:r,showDuration:!1}],entry:i.events[0],renderLocation:"ABOVE_EVENT"}]}getTopCulprits(e,t){const n=[];if(n.length===3)return n;const s=e.events;for(const r of s){if(n.length===3)break;const o=t.get(r);if(!o)continue;const l=o.fontRequests,d=o.iframeIds,c=o.nonCompositedAnimations;for(let h=0;h<l.length&&n.length<3;h++)n.push(Vt(xt.fontRequest));for(let h=0;h<d.length&&n.length<3;h++)n.push(Vt(xt.injectedIframe));for(let h=0;h<c.length&&n.length<3;h++)n.push(Vt(xt.animation))}return n.slice(0,3)}#e(e){this.dispatchEvent(new ui(e))}#t(e,t){const i=_(t.ts-(this.data.parsedTrace?.Meta.traceBounds.min??0)),n=Ft(i);return Sr`
        <div class="insights">
            <devtools-performance-sidebar-insight .data=${{title:this.userVisibleTitle,description:this.description,internalName:this.internalName,expanded:this.isActive()}}
            @insighttoggleclick=${this.onSidebarClick}>
                <div slot="insight-content" class="insight-section">
                  <span class="worst-cluster">${Vt(xt.worstCluster)}: <button type="button" class="timeline-link" @click=${()=>this.#e(t)}>${Vt(xt.layoutShiftCluster,{PH1:n})}</button></span>
                    <p>${Vt(xt.topCulprits)}:</p>
                        ${e.map(s=>Sr`
                            <li>${s}</li>
                          `)}
                </div>
            </devtools-performance-sidebar-insight>
        </div>`}getRelatedEvents(){return oe("CumulativeLayoutShift",this.data.insights,this.data.insightSetKey)?.relatedEvents??[]}render(){const e=oe("CumulativeLayoutShift",this.data.insights,this.data.insightSetKey);if(!e)return;const t=e.shifts;if(!(e.clusters??[]).length||!e.worstCluster)return;const n=this.getTopCulprits(e.worstCluster,t),s=n.length>0,r=Ht({activeCategory:this.data.activeCategory,insightCategory:this.insightCategory}),o=s&&r?this.#t(n,e.worstCluster):V;q(o,this.shadow,{host:this})}}customElements.define("devtools-performance-cls-culprits",Ll);const{html:ao}=K,je={title:"Document request latency",description:"Your first network request is the most important.  Reduce its latency by avoiding redirects, ensuring a fast server response, and enabling text compression.",passingRedirects:"Avoids redirects",failedRedirects:"Had redirects",passingServerResponseTime:"Server responds quickly",failedServerResponseTime:"Server responded slowly",passingTextCompression:"Applies text compression",failedTextCompression:"No compression applied",redirectsLabel:"Redirects",serverResponseTimeLabel:"Server response time",uncompressedDownload:"Uncompressed download",successAriaLabel:"Insight check passed: {PH1}",failedAriaLabel:"Insight check failed: {PH1}"},Xp=A("panels/timeline/components/insights/DocumentLatency.ts",je),Je=N.bind(void 0,Xp);class Rl extends _t{static litTagName=Tt`devtools-performance-document-latency`;insightCategory=Be.ALL;internalName="document-latency";userVisibleTitle=Je(je.title);description=Je(je.description);#e(e,t,i){const n=e?"check-circle":"clear",s=e?Je(je.successAriaLabel,{PH1:t}):Je(je.failedAriaLabel,{PH1:i});return ao`
      <devtools-icon
        aria-label=${s}
        name=${n}
        class=${e?"metric-value-good":"metric-value-bad"}
      ></devtools-icon>
      <span>${e?t:i}</span>
    `}createOverlays(){const e=oe("DocumentLatency",this.data.insights,this.data.insightSetKey);if(!e?.data?.documentRequest)return[];const t=[],i=e.data.documentRequest,n=ee(e.data.redirectDuration),s=[];if(e.data.redirectDuration){const r=Pe(i.ts,i.ts+n);s.push({bounds:r,label:Je(je.redirectsLabel),showDuration:!0}),t.push({type:"CANDY_STRIPED_TIME_RANGE",bounds:r,entry:i})}if(e.data.serverResponseTooSlow){const r=ee(e.data.serverResponseTime),o=i.args.data.timing?.sendEnd??se(0),l=ee(o),d=Pe(l,l+r);s.push({bounds:d,label:Je(je.serverResponseTimeLabel),showDuration:!0})}if(e.data.uncompressedResponseBytes){const r=Pe(i.args.data.syntheticData.downloadStart,i.args.data.syntheticData.downloadStart+i.args.data.syntheticData.download);s.push({bounds:r,label:Je(je.uncompressedDownload),showDuration:!0}),t.push({type:"CANDY_STRIPED_TIME_RANGE",bounds:r,entry:i})}return s.length&&t.push({type:"TIMESPAN_BREAKDOWN",sections:s,entry:e.data.documentRequest,renderLocation:"BELOW_EVENT"}),t.push({type:"ENTRY_SELECTED",entry:e.data.documentRequest}),t}#t(e){return e.data?ao`
    <div class="insights">
      <devtools-performance-sidebar-insight .data=${{title:this.userVisibleTitle,description:this.description,expanded:this.isActive(),internalName:this.internalName,estimatedSavingsTime:e.metricSavings?.FCP,estimatedSavingsBytes:e.data.uncompressedResponseBytes}}
        @insighttoggleclick=${this.onSidebarClick}
      >
        <div slot="insight-content" class="insight-section">
          <ul class="insight-results insight-icon-results">
            <li class="insight-entry">
              ${this.#e(e.data.redirectDuration===0,Je(je.passingRedirects),Je(je.failedRedirects))}
            </li>
            <li class="insight-entry">
              ${this.#e(!e.data.serverResponseTooSlow,Je(je.passingServerResponseTime),Je(je.failedServerResponseTime))}
            </li>
            <li class="insight-entry">
              ${this.#e(e.data.uncompressedResponseBytes===0,Je(je.passingTextCompression),Je(je.failedTextCompression))}
            </li>
          </ul>
        </div>
      </devtools-performance-sidebar-insight>
    </div>`:V}getRelatedEvents(){return oe("DocumentLatency",this.data.insights,this.data.insightSetKey)?.relatedEvents??[]}render(){const e=oe("DocumentLatency",this.data.insights,this.data.insightSetKey);if(e?.data===void 0)return;const t=Ht({activeCategory:this.data.activeCategory,insightCategory:this.insightCategory}),i=e?.data?.redirectDuration>0||e?.data?.serverResponseTooSlow||e.data.uncompressedResponseBytes>0,n=t&&i?this.#t(e):V;q(n,this.shadow,{host:this})}}customElements.define("devtools-performance-document-latency",Rl);const Al=new CSSStyleSheet;Al.replaceSync(`/*
 * Copyright 2024 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

table {
  width: 100%;
  padding: 5px 0;
  border-collapse: collapse;
}

thead {
  white-space: nowrap;
}

table tr > * {
  text-align: right;
}

table tr > *:first-child {
  text-align: left;
}

table.interactive tbody tr {
  cursor: pointer;
}

table.interactive tbody tr:hover,
table.interactive tbody tr.selected {
  background-color: var(--app-color-performance-sidebar-table-row-hover);
}

table thead th {
  font: var(--sys-typescale-body4-medium);
}

table tbody th {
  font-weight: normal;
}

table th[scope="row"] {
  padding: 3px 0;
  word-break: break-word;
}

/*# sourceURL=table.css */
`);const{html:cn}=K;class Jp extends HTMLElement{#e=this.attachShadow({mode:"open"});#t=this.#u.bind(this);#i;#n;#s;#r;#a=!1;#o=null;set data(e){this.#i=e.insight,this.#n=e.insight.sharedTableState,this.#s=e.headers,this.#r=e.rows,this.#a=this.#r.some(t=>t.overlays),D(this,this.#t)}connectedCallback(){this.#e.adoptedStyleSheets.push(Al),D(this,this.#t)}#l(e){if(!(e.target instanceof HTMLElement))return;const t=e.target.closest("tr");if(!t||!t.parentElement)return;const i=[...t.parentElement.children].indexOf(t);i===-1||i===this.#o||(this.#o=i,this.#d(t,i,{isHover:!0}))}#p(e){if(!(e.target instanceof HTMLElement))return;const t=e.target.closest("tr");if(!t||!t.parentElement)return;const i=[...t.parentElement.children].indexOf(t);i!==-1&&this.#d(t,i,{sticky:!0})}#h(){this.#o=null,this.#d(null,null)}#d(e,t,i={}){if(!(!this.#r||!this.#n||!this.#i)&&!(this.#n.selectionIsSticky&&!i.sticky)){if(this.#n.selectionIsSticky&&e===this.#n.selectedRowEl&&(e=null,i.sticky=!1),e&&t!==null){const n=this.#r[t].overlays;n&&this.#i.toggleTemporaryOverlays(n,{updateTraceWindow:!i.isHover})}else this.#i.toggleTemporaryOverlays(null,{updateTraceWindow:!1});this.#n.selectedRowEl?.classList.remove("selected"),e?.classList.add("selected"),this.#n.selectedRowEl=e,this.#n.selectionIsSticky=i.sticky??!1}}async#u(){!this.#s||!this.#r||q(cn`<table
          class=${Nn({interactive:this.#a})}
          @mouseleave=${this.#a?this.#h:null}>
        <thead>
          <tr>
          ${this.#s.map(e=>cn`<th scope="col">${e}</th>`)}
          </tr>
        </thead>
        <tbody
          @mouseover=${this.#a?this.#l:null}
          @click=${this.#a?this.#p:null}
        >
          ${this.#r.map(e=>{const t=e.values.map((i,n)=>n===0?cn`<th scope="row">${i}</th>`:cn`<td>${i}</td>`);return cn`<tr>${t}</tr>`})}
        </tbody>
      </table>`,this.#e,{host:this})}}customElements.define("devtools-performance-table",Jp);const{html:oo}=K,Tn={title:"Font display",description:"Consider setting [`font-display`](https://developer.chrome.com/blog/font-display) to `swap` or `optional` to ensure text is consistently visible. `swap` can be further optimized to mitigate layout shifts with [font metric overrides](https://developer.chrome.com/blog/font-fallbacks).",fontColumn:"Font",wastedTimeColumn:"Wasted time"},Zp=A("panels/timeline/components/insights/FontDisplay.ts",Tn),rs=N.bind(void 0,Zp);class wa extends _t{static litTagName=Tt`devtools-performance-font-display`;insightCategory=Be.INP;internalName="font-display";userVisibleTitle=rs(Tn.title);description=rs(Tn.description);#e=new Map;createOverlays(){this.#e.clear();const e=oe("FontDisplay",this.data.insights,this.data.insightSetKey);if(!e)return[];for(const t of e.fonts)this.#e.set(t.request,{type:"ENTRY_OUTLINE",entry:t.request,outlineReason:t.wastedTime?"ERROR":"INFO"});return[...this.#e.values()]}#t(e){return oo`
        <div class="insights">
            <devtools-performance-sidebar-insight .data=${{title:this.userVisibleTitle,description:this.description,expanded:this.isActive(),internalName:this.internalName,estimatedSavingsTime:e.metricSavings?.FCP}}
            @insighttoggleclick=${this.onSidebarClick}>
                <div slot="insight-content" class="insight-section">
                  ${oo`<devtools-performance-table
                    .data=${{insight:this,headers:[rs(Tn.fontColumn),"font-display",rs(Tn.wastedTimeColumn)],rows:e.fonts.map(t=>({values:[ba(t.request),t.display,ve(t.wastedTime)],overlays:[this.#e.get(t.request)]}))}}>
                  </devtools-performance-table>`}
                </div>
            </devtools-performance-sidebar-insight>
        </div>`}getRelatedEvents(){return oe("FontDisplay",this.data.insights,this.data.insightSetKey)?.relatedEvents??[]}render(){const e=oe("FontDisplay",this.data.insights,this.data.insightSetKey),t=e&&e.fonts.find(s=>s.wastedTime),i=Ht({activeCategory:this.data.activeCategory,insightCategory:this.insightCategory}),n=t&&i?this.#t(e):V;q(n,this.shadow,{host:this})}}customElements.define("devtools-performance-font-display",wa);const{html:lo}=K,gt={description:"Start investigating with the longest phase. [Delays can be minimized](https://web.dev/articles/optimize-inp#optimize_interactions). To reduce processing duration, [optimize the main-thread costs](https://web.dev/articles/optimize-long-tasks), often JS.",title:"INP by phase",phase:"Phase",duration:"Duration",inputDelay:"Input delay",processingDuration:"Processing duration",presentationDelay:"Presentation delay"},Qp=A("panels/timeline/components/insights/InteractionToNextPaint.ts",gt),St=N.bind(void 0,Qp);class Nl extends _t{static litTagName=Tt`devtools-performance-inp`;insightCategory=Be.INP;internalName="inp";userVisibleTitle=St(gt.title);description=St(gt.description);createOverlays(){const e=oe("InteractionToNextPaint",this.data.insights,this.data.insightSetKey);if(!e)return[];const t=e.longestInteractionEvent;return t?this.#e(t):[]}#e(e,t=-1){const i=Pe(e.ts,e.ts+e.inputDelay),n=Pe(i.max,i.max+e.mainThreadHandling),s=Pe(n.max,n.max+e.presentationDelay);let r=[{bounds:i,label:St(gt.inputDelay),showDuration:!0},{bounds:n,label:St(gt.processingDuration),showDuration:!0},{bounds:s,label:St(gt.presentationDelay),showDuration:!0}];return t!==-1&&(r=[r[t]]),[{type:"TIMESPAN_BREAKDOWN",sections:r,renderLocation:"BELOW_EVENT",entry:e}]}#t(e){const t=i=>ve(Qi(i));return lo`
        <div class="insights">
            <devtools-performance-sidebar-insight .data=${{title:this.userVisibleTitle,description:this.description,internalName:this.internalName,expanded:this.isActive()}}
            @insighttoggleclick=${this.onSidebarClick}>
                <div slot="insight-content" class="insight-section">
                  ${lo`<devtools-performance-table
                    .data=${{insight:this,headers:[St(gt.phase),St(gt.duration)],rows:[{values:[St(gt.inputDelay),t(e.inputDelay)],overlays:this.#e(e,0)},{values:[St(gt.processingDuration),t(e.mainThreadHandling)],overlays:this.#e(e,1)},{values:[St(gt.presentationDelay),t(e.presentationDelay)],overlays:this.#e(e,2)}]}}>
                  </devtools-performance-table>`}
                </div>
            </devtools-performance-sidebar-insight>
        </div>`}getRelatedEvents(){return oe("InteractionToNextPaint",this.data.insights,this.data.insightSetKey)?.relatedEvents??[]}render(){const t=oe("InteractionToNextPaint",this.data.insights,this.data.insightSetKey)?.longestInteractionEvent,i=Ht({activeCategory:this.data.activeCategory,insightCategory:this.insightCategory}),n=t&&i?this.#t(t):V;q(n,this.shadow,{host:this})}}customElements.define("devtools-performance-inp",Nl);const{html:dn}=K,ct={title:"LCP request discovery",description:"Optimize LCP by making the LCP image [discoverable](https://web.dev/articles/optimize-lcp#1_eliminate_resource_load_delay) from the HTML immediately, and [avoiding lazy-loading](https://web.dev/articles/lcp-lazy-loading)",lcpLoadDelay:"LCP image loaded {PH1} after earliest start point.",fetchPriorityApplied:"fetchpriority=high applied",requestDiscoverable:"Request is discoverable in initial document",lazyLoadNotApplied:"lazy load not applied",successAriaLabel:"Insight check passed: {PH1}",failedAriaLabel:"Insight check failed: {PH1}"},Fl=A("panels/timeline/components/insights/LCPDiscovery.ts",ct),Et=N.bind(void 0,Fl);function co(a,e){const t=oe("LargestContentfulPaint",a,e);if(!t||t.lcpRequest===void 0)return null;const i=t.shouldIncreasePriorityHint,n=t.shouldPreloadImage,s=t.shouldRemoveLazyLoading;if(!(i!==void 0&&n!==void 0&&s!==void 0))return null;const o={shouldIncreasePriorityHint:i,shouldPreloadImage:n,shouldRemoveLazyLoading:s,request:t.lcpRequest,discoveryDelay:null,estimatedSavings:t.metricSavings?.LCP??null};if(t.earliestDiscoveryTimeTs&&t.lcpRequest){const l=t.lcpRequest.ts-t.earliestDiscoveryTimeTs;o.discoveryDelay=_(l)}return o}class Ml extends _t{static litTagName=Tt`devtools-performance-lcp-discovery`;insightCategory=Be.LCP;internalName="lcp-discovery";userVisibleTitle=Et(ct.title);description=Et(ct.description);#e(e,t){const i=e?"clear":"check-circle",n=e?Et(ct.failedAriaLabel,{PH1:t}):Et(ct.successAriaLabel,{PH1:t});return dn`
      <devtools-icon
        aria-label=${n}
        name=${i}
        class=${e?"metric-value-bad":"metric-value-good"}
      ></devtools-icon>
    `}#t(e){const t=document.createElement("span");return t.classList.add("discovery-time-ms"),t.innerText=Ft(e),z(Fl,ct.lcpLoadDelay,{PH1:t})}createOverlays(){const e=co(this.data.insights,this.data.insightSetKey);if(!e||!e.discoveryDelay)return[];const t=Pe(_(e.request.ts-e.discoveryDelay),e.request.ts),i=dn`<div class="discovery-delay"> ${this.#t(t.range)}</div>`;return[{type:"ENTRY_OUTLINE",entry:e.request,outlineReason:"ERROR"},{type:"CANDY_STRIPED_TIME_RANGE",bounds:t,entry:e.request},{type:"TIMESPAN_BREAKDOWN",sections:[{bounds:t,label:i,showDuration:!1}],entry:e.request,renderLocation:"ABOVE_EVENT"}]}#i(e){const t=e.target;t.style.display="none"}#n(e){return dn`
      <div class="lcp-element">
        ${e.request.args.data.mimeType.includes("image")?dn`
        <img
          class="element-img"
          src=${e.request.args.data.url}
          @error=${this.#i}
           />`:V}
        <span class="element-img-details">
          ${ba(e.request)}
          <span class="element-img-details-size">${Ke(e.request.args.data.decodedBodyLength??0)}</span>
        </span>
      </div>`}#s(e){return dn`
        <div class="insights">
          <devtools-performance-sidebar-insight .data=${{title:this.userVisibleTitle,description:this.description,internalName:this.internalName,expanded:this.isActive(),estimatedSavingsTime:e.estimatedSavings}}
          @insighttoggleclick=${this.onSidebarClick}>
            <div slot="insight-content" class="insight-section">
              <div class="insight-results">
                <ul class="insight-icon-results">
                  <li class="insight-entry">
                    ${this.#e(e.shouldIncreasePriorityHint,Et(ct.fetchPriorityApplied))}
                    <span>${Et(ct.fetchPriorityApplied)}</span>
                  </li>
                  <li class="insight-entry">
                    ${this.#e(e.shouldPreloadImage,Et(ct.requestDiscoverable))}
                    <span>${Et(ct.requestDiscoverable)}</span>
                  </li>
                  <li class="insight-entry">
                    ${this.#e(e.shouldRemoveLazyLoading,Et(ct.lazyLoadNotApplied))}
                    <span>${Et(ct.lazyLoadNotApplied)}</span>
                  </li>
                </ul>
              </div>
              ${this.#n(e)}
            </div>
          </devtools-performance-sidebar-insight>
      </div>`}getRelatedEvents(){const e=oe("LargestContentfulPaint",this.data.insights,this.data.insightSetKey);return!e?.lcpEvent||!e?.lcpRequest?[]:[e.lcpEvent,e.lcpRequest]}render(){const e=co(this.data.insights,this.data.insightSetKey),t=Ht({activeCategory:this.data.activeCategory,insightCategory:this.insightCategory}),i=e&&t?this.#s(e):V;q(i,this.shadow,{host:this})}}customElements.define("devtools-performance-lcp-discovery",Ml);const{html:ho}=K,Me={title:"LCP by phase",description:"Each [phase has specific improvement strategies](https://web.dev/articles/optimize-lcp#lcp-breakdown). Ideally, most of the LCP time should be spent on loading the resources, not within delays.",timeToFirstByte:"Time to first byte",resourceLoadDelay:"Resource load delay",resourceLoadDuration:"Resource load duration",elementRenderDelay:"Element render delay",phase:"Phase",percentLCP:"% of LCP"},em=A("panels/timeline/components/insights/LCPPhases.ts",Me),Oe=N.bind(void 0,em);class Dl extends _t{static litTagName=Tt`devtools-performance-lcp-by-phases`;insightCategory=Be.LCP;internalName="lcp-by-phase";userVisibleTitle=Oe(Me.title);description=Oe(Me.description);#e=null;#t(e,t){if(!e||!t)return[];const i=e.get(t);if(!i)return[];const n=i.data.LargestContentfulPaint;if(n instanceof Error)return[];const s=n.lcpMs,r=n.phases;if(!s||!r)return[];const{ttfb:o,loadDelay:l,loadTime:d,renderDelay:c}=r;return l&&d?[{phase:Oe(Me.timeToFirstByte),timing:o,percent:`${(100*o/s).toFixed(0)}%`},{phase:Oe(Me.resourceLoadDelay),timing:l,percent:`${(100*l/s).toFixed(0)}%`},{phase:Oe(Me.resourceLoadDuration),timing:d,percent:`${(100*d/s).toFixed(0)}%`},{phase:Oe(Me.elementRenderDelay),timing:c,percent:`${(100*c/s).toFixed(0)}%`}]:[{phase:Oe(Me.timeToFirstByte),timing:o,percent:`${(100*o/s).toFixed(0)}%`},{phase:Oe(Me.elementRenderDelay),timing:c,percent:`${(100*c/s).toFixed(0)}%`}]}createOverlays(){if(this.#e=null,!this.data.insights||!this.data.insightSetKey)return[];const{insightSetKey:e,insights:t}=this.data,i=t.get(e);if(!i)return[];const n=i.data.LargestContentfulPaint;if(n instanceof Error)return[];const s=n.phases,r=n.lcpTs;if(!s||!r)return[];const o=_(ee(r)),l=[];if(!s?.loadDelay&&!s?.loadTime){const d=_(o-ee(s.renderDelay)),c=Pe(d,o),h=_(d-ee(s.ttfb)),u=Pe(h,d);l.push({bounds:u,label:Oe(Me.timeToFirstByte),showDuration:!0},{bounds:c,label:Oe(Me.elementRenderDelay),showDuration:!0})}else if(s?.loadDelay&&s?.loadTime){const d=_(o-ee(s.renderDelay)),c=Pe(d,o),h=_(d-ee(s.loadTime)),u=Pe(h,d),m=_(h-ee(s.loadDelay)),v=Pe(m,h),T=_(m-ee(s.ttfb)),E=Pe(T,m);l.push({bounds:E,label:Oe(Me.timeToFirstByte),showDuration:!0},{bounds:v,label:Oe(Me.resourceLoadDelay),showDuration:!0},{bounds:u,label:Oe(Me.resourceLoadDuration),showDuration:!0},{bounds:c,label:Oe(Me.elementRenderDelay),showDuration:!0})}return this.#e={type:"TIMESPAN_BREAKDOWN",sections:l},[this.#e]}#i(e){const t=e.map(({phase:i,percent:n})=>{const s=this.#e?.sections.find(r=>i===r.label);return{values:[i,n],overlays:s&&[{type:"TIMESPAN_BREAKDOWN",sections:[s]}]}});return ho`
    <div class="insights">
      <devtools-performance-sidebar-insight .data=${{title:this.userVisibleTitle,description:this.description,internalName:this.internalName,expanded:this.isActive()}}
        @insighttoggleclick=${this.onSidebarClick}
      >
        <div slot="insight-content" class="insight-section">
          ${ho`<devtools-performance-table
            .data=${{insight:this,headers:[Oe(Me.phase),Oe(Me.percentLCP)],rows:t}}>
          </devtools-performance-table>`}
        </div>
      </devtools-performance-sidebar-insight>
    </div>`}#n(e){return e?e.length>0:!1}getRelatedEvents(){const e=oe("LargestContentfulPaint",this.data.insights,this.data.insightSetKey);if(!e?.lcpEvent)return[];const t=[e.lcpEvent];return e.lcpRequest&&t.push(e.lcpRequest),t}render(){const e=this.#t(this.data.insights,this.data.insightSetKey),n=Ht({activeCategory:this.data.activeCategory,insightCategory:this.insightCategory})&&this.#n(e)?this.#i(e):V;q(n,this.shadow,{host:this})}}customElements.define("devtools-performance-lcp-by-phases",Dl);const{html:tm}=K;class im extends HTMLElement{#e=this.attachShadow({mode:"open"});#t=this.#r.bind(this);#i;#n;set data(e){this.#i=e.backendNodeId,this.#n=e.options,D(this,this.#t)}async#s(){if(this.#i===void 0)return;const e=Y.instance().primaryPageTarget();if(!e)return;const t=e.model(aa);if(!t)return;const i=new Set([this.#i]),n=await t.pushNodesByBackendIdsToFrontend(i);if(!n)return;const s=n.get(this.#i);if(s)return ci.linkify(s,this.#n)}async#r(){const e=await this.#s();q(tm`<div class='node-link'>
        ${e}
      </div>`,this.#e,{host:this})}}customElements.define("devtools-performance-node-link",im);const{html:uo}=K,Sn={title:"Render blocking requests",description:"Requests are blocking the page's initial render, which may delay LCP. [Deferring or inlining](https://web.dev/learn/performance/understanding-the-critical-path#render-blocking_resources/) can move these network requests out of the critical path.",renderBlockingRequest:"Request",duration:"Duration"},nm=A("panels/timeline/components/insights/RenderBlocking.ts",Sn),as=N.bind(void 0,nm);class $l extends _t{static litTagName=Tt`devtools-performance-render-blocking-requests`;insightCategory=Be.LCP;internalName="render-blocking-requests";userVisibleTitle=as(Sn.title);description=as(Sn.description);createOverlays(){const e=oe("RenderBlocking",this.data.insights,this.data.insightSetKey);return e?e.renderBlockingRequests.map(t=>this.#e(t)):[]}#e(e){return{type:"ENTRY_OUTLINE",entry:e,outlineReason:"ERROR"}}#t(e){const t=e.metricSavings?.FCP,n=e.renderBlockingRequests.slice(0,3);return uo`
        <div class="insights">
          <devtools-performance-sidebar-insight .data=${{title:this.userVisibleTitle,description:this.description,internalName:this.internalName,expanded:this.isActive(),estimatedSavingsTime:t}}
          @insighttoggleclick=${this.onSidebarClick} >
            <div slot="insight-content" class="insight-section">
              ${uo`<devtools-performance-table
                .data=${{insight:this,headers:[as(Sn.renderBlockingRequest),as(Sn.duration)],rows:n.map(s=>({values:[ba(s),ve(Qi(s.dur))],overlays:[this.#e(s)]}))}}>
              </devtools-performance-table>`}
            </div>
          </devtools-performance-sidebar-insight>
      </div>`}getRelatedEvents(){return oe("RenderBlocking",this.data.insights,this.data.insightSetKey)?.relatedEvents??[]}render(){const e=oe("RenderBlocking",this.data.insights,this.data.insightSetKey),t=e?.renderBlockingRequests&&e.renderBlockingRequests.length>0,i=Ht({activeCategory:this.data.activeCategory,insightCategory:this.insightCategory}),n=t&&i?this.#t(e):V;q(n,this.shadow,{host:this})}}customElements.define("devtools-performance-render-blocking-requests",$l);const Bl=new CSSStyleSheet;Bl.replaceSync(`/*
 * Copyright 2021 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

.link:link,
.link:visited {
  color: var(--sys-color-primary);
  text-decoration: underline;
  cursor: pointer;
  outline-offset: 2px;
}

/*# sourceURL=linkifierImpl.css */
`);function sm(a,e){if(a){let i=`${ri(a)}`;return typeof e<"u"&&(i+=`:${e+1}`),i}throw new Error("New linkifier component error: don't know how to generate link text for given arguments")}const{html:rm}=K,am=Ao.instance();class Ta extends Event{data;static eventName="linkifieractivated";constructor(e){super(Ta.eventName,{bubbles:!0,composed:!0}),this.data=e,this.data=e}}let om=class extends HTMLElement{#e=this.attachShadow({mode:"open"});#t=No;#i;#n;#s;#r;set data(e){if(this.#t=e.url,this.#i=e.lineNumber,this.#n=e.columnNumber,this.#s=e.linkText,this.#r=e.title,!this.#t)throw new Error("Cannot construct a Linkifier without providing a valid string URL.");this.#o()}connectedCallback(){this.#e.adoptedStyleSheets=[Bl]}#a(e){e.preventDefault();const t=new Ta({url:this.#t,lineNumber:this.#i,columnNumber:this.#n});this.dispatchEvent(t)}async#o(){const e=this.#s??sm(this.#t,this.#i);await am.write(()=>{q(rm`<a class="link" href=${this.#t} @click=${this.#a} title=${Ud(this.#r)}><slot>${e}</slot></a>`,this.#e,{host:this})})}};customElements.define("devtools-linkifier",om);const{html:Qt}=K,ft={title:"CSS Selector costs",description:"If Recalculate Style costs remain high, selector optimization can reduce them. [Optimize the selectors](https://developer.chrome.com/docs/devtools/performance/selector-stats) with both high elapsed time and high slow-path %. Simpler selectors, fewer selectors, a smaller DOM, and a shallower DOM will all reduce matching costs.",matchAttempts:"Match attempts",matchCount:"Match count",elapsed:"Elapsed time",topSelectors:"Top selectors",total:"Total"},lm=A("panels/timeline/components/insights/SlowCSSSelector.ts",ft),Ct=N.bind(void 0,lm);class Ol extends _t{static litTagName=Tt`devtools-performance-slow-css-selector`;insightCategory=Be.ALL;internalName="slow-css-selector";userVisibleTitle=Ct(ft.title);description=Ct(ft.description);#e=null;#t=new Map;createOverlays(){return[]}async toSourceFileLocation(e,t){if(!e)return;const i=e.styleSheetHeaderForId(t.style_sheet_id);if(!i||!i.resourceURL())return;const n=JSON.stringify({selectorText:t.selector,styleSheetId:t.style_sheet_id});let s=this.#t.get(n);if(!s){const o=await e.agent.invoke_getLocationForSelector({selectorText:t.selector,styleSheetId:t.style_sheet_id});if(o.getError()||!o.ranges)return;s=o.ranges,this.#t.set(n,s)}return s.map((o,l)=>({url:i.resourceURL(),lineNumber:o.startLine,columnNumber:o.startColumn,linkText:`[${l+1}]`,title:`${i.id} line ${o.startLine+1}:${o.startColumn+1}`}))}async getSelectorLinks(e,t){if(!e)return V;if(!t.style_sheet_id)return V;const i=await this.toSourceFileLocation(e,t);return i?Qt`
    ${i.map((s,r)=>{const o=r!==i.length-1?", ":"";return Qt`<devtools-linkifier .data=${s}></devtools-linkifier>${o}`})}`:V}renderSlowCSSSelector(){const t=Y.instance().primaryPageTarget()?.model($r),i=n=>ve(Qi(n));return this.#e?Qt`
      <div class="insights">
        <devtools-performance-sidebar-insight .data=${{title:this.userVisibleTitle,description:this.description,internalName:this.internalName,expanded:this.isActive()}}
          @insighttoggleclick=${this.onSidebarClick} >
          <div slot="insight-content">
            <div class="insight-section">
              ${Qt`<devtools-performance-table
                .data=${{insight:this,headers:[Ct(ft.total),""],rows:[{values:[Ct(ft.elapsed),ve(this.#e.totalElapsedMs)]},{values:[Ct(ft.matchAttempts),this.#e.totalMatchAttempts]},{values:[Ct(ft.matchCount),this.#e.totalMatchCount]}]}}>
              </devtools-performance-table>`}
            </div>
            <div class="insight-section">
              ${Qt`<devtools-performance-table
                .data=${{insight:this,headers:[Ct(ft.topSelectors),Ct(ft.elapsed)],rows:this.#e.topElapsedMs.map(n=>({values:[Qt`${n.selector} ${Ba(this.getSelectorLinks(t,n))}`,i(_(n["elapsed (us)"]))]}))}}>
              </devtools-performance-table>`}
            </div>
            <div class="insight-section">
              ${Qt`<devtools-performance-table
                .data=${{insight:this,headers:[Ct(ft.topSelectors),Ct(ft.matchAttempts)],rows:this.#e.topMatchAttempts.map(n=>({values:[Qt`${n.selector} ${Ba(this.getSelectorLinks(t,n))}`,n.match_attempts]}))}}>
              </devtools-performance-table>`}
            </div>
          </div>
        </devtools-performance-sidebar-insight>
      </div>`:V}#i(){return this.#e=oe("SlowCSSSelector",this.data.insights,this.data.insightSetKey),this.#e!==null&&this.#e.topElapsedMs.length!==0&&this.#e.topMatchAttempts.length!==0}getRelatedEvents(){return oe("SlowCSSSelector",this.data.insights,this.data.insightSetKey)?.relatedEvents??[]}render(){const i=Ht({activeCategory:this.data.activeCategory,insightCategory:this.insightCategory})&&this.#i()?this.renderSlowCSSSelector():V;q(i,this.shadow,{host:this})}}customElements.define("devtools-performance-slow-css-selector",Ol);const{html:Er}=K,Si={title:"Third parties",description:"Third party code can significantly impact load performance. [Reduce and defer loading of third party code](https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/loading-third-party-javascript/) to prioritize your page's content.",columnThirdParty:"Third party",columnTransferSize:"Transfer size",columnBlockingTime:"Blocking time"},cm=A("panels/timeline/components/insights/ThirdParties.ts",Si),Bi=N.bind(void 0,cm);class Hl extends _t{static litTagName=Tt`devtools-performance-third-parties`;insightCategory=Be.ALL;internalName="third-parties";userVisibleTitle=Bi(Si.title);description=Bi(Si.description);#e=new Map;createOverlays(){this.#e.clear();const e=oe("ThirdPartyWeb",this.data.insights,this.data.insightSetKey);if(!e)return[];const t=[];for(const[i,n]of e.requestsByEntity){if(i===e.firstPartyEntity)continue;const s=[];for(const r of n){const o={type:"ENTRY_OUTLINE",entry:r,outlineReason:"INFO"};s.push(o),t.push(o)}this.#e.set(i,s)}return t}#t(e){const t=e.sort((n,s)=>s[1].transferSize-n[1].transferSize).slice(0,6),i=e.sort((n,s)=>s[1].mainThreadTime-n[1].mainThreadTime).slice(0,6);return Er`
        <div class="insights">
            <devtools-performance-sidebar-insight .data=${{title:this.userVisibleTitle,description:this.description,internalName:this.internalName,expanded:this.isActive()}}
            @insighttoggleclick=${this.onSidebarClick}>
                <div slot="insight-content">
                  <div class="insight-section">
                    ${Er`<devtools-performance-table
                      .data=${{insight:this,headers:[Bi(Si.columnThirdParty),Bi(Si.columnTransferSize)],rows:t.map(([n,s])=>({values:[n.name,Ke(s.transferSize)],overlays:this.#e.get(n)}))}}>
                    </devtools-performance-table>`}
                  </div>

                  <div class="insight-section">
                    ${Er`<devtools-performance-table
                      .data=${{insight:this,headers:[Bi(Si.columnThirdParty),Bi(Si.columnBlockingTime)],rows:i.map(([n,s])=>({values:[n.name,ve(Qi(s.mainThreadTime))],overlays:this.#e.get(n)}))}}>
                    </devtools-performance-table>`}
                  </div>
                </div>
            </devtools-performance-sidebar-insight>
        </div>`}getRelatedEvents(){return oe("ThirdPartyWeb",this.data.insights,this.data.insightSetKey)?.relatedEvents??[]}render(){const e=oe("ThirdPartyWeb",this.data.insights,this.data.insightSetKey),t=e&&[...e.summaryByEntity.entries()].filter(r=>r[0]!==e.firstPartyEntity),i=t?.length,n=Ht({activeCategory:this.data.activeCategory,insightCategory:this.insightCategory}),s=i&&n?this.#t(t):V;q(s,this.shadow,{host:this})}}customElements.define("devtools-performance-third-parties",Hl);const{html:po}=K,jr={title:"Viewport not optimized for mobile",description:"The page's viewport is not mobile-optimized, so tap interactions may be [delayed by up to 300Â ms](https://developer.chrome.com/blog/300ms-tap-delay-gone-away/)."},dm=A("panels/timeline/components/insights/Viewport.ts",jr),mo=N.bind(void 0,dm);class _l extends _t{static litTagName=Tt`devtools-performance-viewport`;insightCategory=Be.INP;internalName="viewport";userVisibleTitle=mo(jr.title);description=mo(jr.description);createOverlays(){return[]}#e(e){const t=e.viewportEvent?.args.data.node_id;return po`
        <div class="insights">
            <devtools-performance-sidebar-insight .data=${{title:this.userVisibleTitle,description:this.description,expanded:this.isActive(),internalName:this.internalName,estimatedSavingsTime:e.metricSavings?.INP}}
            @insighttoggleclick=${this.onSidebarClick}>
              ${t!==void 0?po`<devtools-performance-node-link
                .data=${{backendNodeId:t,options:{tooltip:e.viewportEvent?.args.data.content}}}>
              </devtools-performance-node-link>`:V}
            </devtools-performance-sidebar-insight>
        </div>`}render(){const e=oe("Viewport",this.data.insights,this.data.insightSetKey),t=e&&e.mobileOptimized===!1,i=Ht({activeCategory:this.data.activeCategory,insightCategory:this.insightCategory}),n=t&&i?this.#e(e):V;q(n,this.shadow,{host:this})}}customElements.define("devtools-performance-viewport",_l);const Wl=new CSSStyleSheet;Wl.replaceSync(`/*
 * Copyright 2024 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

.layout-shift-details-title,
.cluster-details-title {
  padding-bottom: var(--sys-size-5);
  display: flex;
  align-items: center;

  .layout-shift-event-title,
  .cluster-event-title {
    background-color: var(--app-color-rendering);
    width: var(--sys-size-6);
    height: var(--sys-size-6);
    border: var(--sys-size-1) solid var(--sys-color-divider);
    display: inline-block;
    margin-right: var(--sys-size-3);
  }
}

.layout-shift-details-table {
  font: var(--sys-typescale-body4-regular);
  margin-bottom: var(--sys-size-4);
  text-align: left;
  border-block: var(--sys-size-1) solid var(--sys-color-divider);
  border-collapse: collapse;
  font-variant-numeric: tabular-nums;

  th,
  td {
    padding-right: var(--sys-size-4);
    min-width: var(--sys-size-20);
    max-width: var(--sys-size-24);
  }
}

.table-title {
  th {
    font: var(--sys-typescale-body4-medium);
  }

  tr {
    border-bottom: var(--sys-size-1) solid var(--sys-color-divider);
  }
}

/** TODO: This is duplicated in sidebarInsights.css. Should make a component. */
.timeline-link {
  cursor: pointer;
  text-decoration: underline;
  color: var(--sys-color-primary);
  /* for a11y reasons this is a button, so we have to remove some default
   * styling */
  background: none;
  border: none;
  padding: 0;
  font: inherit;
}

.timeline-link.invalid-link {
  color: var(--sys-color-state-disabled);
}

.details-row {
  display: flex;
  min-height: var(--sys-size-9);
}

.title {
  color: var(--sys-color-token-subtle);
  overflow: hidden;
  padding-right: var(--sys-size-5);
  display: inline-block;
  vertical-align: top;
}

.value {
  display: inline-block;
  user-select: text;
  text-overflow: ellipsis;
  overflow: hidden;
  padding: 0 var(--sys-size-3);
}

.layout-shift-summary-details,
.layout-shift-cluster-summary-details {
  font: var(--sys-typescale-body4-regular);
  display: flex;
  flex-direction: column;
  column-gap: var(--sys-size-4);
  padding: var(--sys-size-6) var(--sys-size-6) 0 var(--sys-size-6);
}

.culprits {
  display: flex;
  flex-direction: column;
}

.shift-row:not(:last-child) {
  border-bottom: var(--sys-size-1) solid var(--sys-color-divider);
}

.total-row {
  font: var(--sys-typescale-body4-medium);
}

/*# sourceURL=layoutShiftDetails.css */
`);const{html:Ee}=K,hm=20,De={startTime:"Start time",shiftScore:"Shift score",elementsShifted:"Elements shifted",culprit:"Culprit",injectedIframe:"Injected iframe",fontRequest:"Font request",nonCompositedAnimation:"Non-composited animation",animation:"Animation",parentCluster:"Parent cluster",cluster:"Layout shift cluster @ {PH1}",layoutShift:"Layout shift @ {PH1}",total:"Total"},um=A("panels/timeline/components/LayoutShiftDetails.ts",De),He=N.bind(void 0,um);class Vl extends HTMLElement{#e=this.attachShadow({mode:"open"});#t=null;#i=null;#n=null;#s=!1;connectedCallback(){this.#e.adoptedStyleSheets=[Wl],zd(this.#e),this.#w()}setData(e,t,i,n){this.#t!==e&&(this.#t=e,this.#i=t,this.#n=i,this.#s=n,this.#w())}#r(e){const t=Ge(e);return Ee`
      <div class="layout-shift-details-title">
        <div class="layout-shift-event-title"></div>
        ${t}
      </div>
    `}#a(e){return Ee`
      ${e?.map(t=>t.node_id!==void 0?Ee`
            <devtools-performance-node-link
              .data=${{backendNodeId:t.node_id}}>
            </devtools-performance-node-link>`:V)}`}#o(e){const t=e;if(!t)return null;const i=Gd.instance().getFrame(t);if(!i)return null;const n=Mt.linkifyRevealable(i,i.displayName());return Ee`
    <span class="culprit"><span class="culprit-type">${He(De.injectedIframe)}: </span><span class="culprit-value">${n}</span></span>`}#l(e){const t={tabStop:!0,showColumnNumber:!1,inlineFrameIndex:0,maxLength:hm},i=Mt.linkifyURL(e.args.data.url,t);return Ee`
    <span class="culprit"><span class="culprit-type">${He(De.fontRequest)}: </span><span class="culprit-value">${i}</span></span>`}#p(e){this.dispatchEvent(new ui(e))}#h(e){const t=e.animation;return t?Ee`
        <span class="culprit">
        <span class="culprit-type">${He(De.nonCompositedAnimation)}: </span>
        <button type="button" class="culprit-value timeline-link" @click=${()=>this.#p(t)}>${He(De.animation)}</button>
      </span>`:null}#d(e){return Ee`
      ${e?.fontRequests.map(t=>this.#l(t))}
      ${e?.iframeIds.map(t=>this.#o(t))}
      ${e?.nonCompositedAnimations.map(t=>this.#h(t))}
    `}#u(e,t){const i=_(e.ts-t.Meta.traceBounds.min);if(e===this.#t)return Ee`${Ye($(i))}`;const n=Ft(i);return Ee`
         <button type="button" class="timeline-link" @click=${()=>this.#p(e)}>${He(De.layoutShift,{PH1:n})}</button>`}#c(e,t,i,n){const s=e.args.data?.weighted_score_delta;if(!s)return null;const r=!!(n&&(n.fontRequests.length||n.iframeIds.length||n.nonCompositedAnimations.length));return Ee`
      <tr class="shift-row" data-ts=${e.ts}>
        <td>${this.#u(e,t)}</td>
        <td>${s.toFixed(4)}</td>
        ${this.#s?Ee`
          <td>
            <div class="elements-shifted">
              ${this.#a(i)}
            </div>
          </td>`:V}
        ${r&&this.#s?Ee`
          <td class="culprits">
            ${this.#d(n)}
          </td>`:V}
      </tr>`}#m(e,t){if(!e)return null;const i=_(e.ts-(t?.Meta.traceBounds.min??0)),n=Ft(i);return Ee`
      <span class="parent-cluster">${He(De.parentCluster)}:
         <button type="button" class="timeline-link" @click=${()=>this.#p(e)}>${He(De.cluster,{PH1:n})}</button>
      </span>`}#g(e){return Ee`
      <td class="total-row">${He(De.total)}</td>
      <td class="total-row">${e.clusterCumulativeScore.toFixed(4)}</td>`}#v(e,t,i){if(!t)return null;const n=e.args.data?.navigationId??Oa,s=t.get(n)?.data.CumulativeLayoutShift;if(!s||s instanceof Error)return null;const r=s.shifts.get(e),o=e.args.data?.impacted_nodes??[],l=r&&(r.fontRequests.length||r.iframeIds.length||r.nonCompositedAnimations.length),d=o?.length,c=s.clusters.find(h=>h.events.find(u=>u===e));return Ee`
      <table class="layout-shift-details-table">
        <thead class="table-title">
          <tr>
            <th>${He(De.startTime)}</th>
            <th>${He(De.shiftScore)}</th>
            ${d&&this.#s?Ee`
              <th>${He(De.elementsShifted)}</th>`:V}
            ${l&&this.#s?Ee`
              <th>${He(De.culprit)}</th> `:V}
          </tr>
        </thead>
        <tbody>
          ${this.#c(e,i,o,r)}
        </tbody>
      </table>
      ${this.#m(c,i)}
    `}#f(e,t,i){if(!t)return null;const n=e.navigationId??Oa,s=t.get(n)?.data.CumulativeLayoutShift;if(!s||s instanceof Error)return null;const o=!!Array.from(s.shifts.entries()).filter(([l])=>e.events.includes(l)).map(([,l])=>l).flatMap(l=>Object.values(l)).flat().length;return Ee`
          <table class="layout-shift-details-table">
            <thead class="table-title">
              <tr>
                <th>${He(De.startTime)}</th>
                <th>${He(De.shiftScore)}</th>
                ${this.#s?Ee`
                  <th>${He(De.elementsShifted)}</th>`:V}
                ${o&&this.#s?Ee`
                  <th>${He(De.culprit)}</th> `:V}
              </tr>
            </thead>
            <tbody>
              ${e.events.map(l=>{const d=s.shifts.get(l),c=l.args.data?.impacted_nodes??[];return this.#c(l,i,c,d)})}
              ${this.#g(e)}
            </tbody>
          </table>
        `}#w(){if(!this.#t||!this.#n)return;const e=Ee`
      <div class="layout-shift-summary-details">
        <div
          class="event-details"
          @mouseover=${this.#b}
          @mouseleave=${this.#b}
        >
          ${this.#r(this.#t)}
          ${Ai(this.#t)?this.#v(this.#t,this.#i,this.#n):this.#f(this.#t,this.#i,this.#n)}
        </div>
      </div>
    `;q(e,this.#e,{host:this})}#b(e){const t=e.type==="mouseover";if(e.type==="mouseleave"&&this.dispatchEvent(new CustomEvent("toggle-popover",{detail:{show:t},bubbles:!0,composed:!0})),!(e.target instanceof HTMLElement)||!this.#t)return;const i=e.target.closest("tbody tr");if(!i||!i.parentElement)return;const n=Ai(this.#t)?this.#t:this.#t.events.find(s=>s.ts===parseInt(i.getAttribute("data-ts")??"",10));this.dispatchEvent(new CustomEvent("toggle-popover",{detail:{event:n,show:t},bubbles:!0,composed:!0}))}}customElements.define("devtools-performance-layout-shift-details",Vl);const Ul=new CSSStyleSheet;Ul.replaceSync(`/*
 * Copyright 2024 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

:host {
  display: inline-block;
  max-width: 100%;
  min-width: 50px;
}

devtools-select-menu {
  max-width: 100%;
}

/*# sourceURL=networkThrottlingSelector.css */
`);const{html:os,nothing:pm}=K,Ei={network:"Network: {PH1}",networkThrottling:"Network throttling: {PH1}",disabled:"Disabled",presets:"Presets",custom:"Custom",add:"Addâ€¦"},mm=A("panels/timeline/components/NetworkThrottlingSelector.ts",Ei),Oi=N.bind(void 0,mm);class gm extends HTMLElement{#e=this.attachShadow({mode:"open"});#t;#i=[];#n;constructor(){super(),this.#t=Te.instance().moduleSetting("custom-network-conditions"),this.#s(),this.#n=oi.instance().networkConditions(),this.#d()}connectedCallback(){this.#e.adoptedStyleSheets=[Ul],oi.instance().addEventListener("ConditionsChanged",this.#r,this),this.#r(),this.#t.addChangeListener(this.#o,this)}disconnectedCallback(){oi.instance().removeEventListener("ConditionsChanged",this.#r,this),this.#t.removeChangeListener(this.#o,this)}#s(){this.#i=[{name:Oi(Ei.disabled),items:[jd]},{name:Oi(Ei.presets),items:va.networkPresets},{name:Oi(Ei.custom),items:this.#t.get(),showCustomAddOption:!0,jslogContext:"custom-network-throttling-item"}]}#r(){this.#n=oi.instance().networkConditions(),D(this,this.#d)}#a(e){const t=this.#i.flatMap(i=>i.items).find(i=>this.#h(i)===e.itemValue);t&&oi.instance().setNetworkConditions(t)}#o(){this.#s(),D(this,this.#d)}#l(e){return e.title instanceof Function?e.title():e.title}#p(){qd(this.#t)}#h(e){return e.i18nTitleKey||this.#l(e)}#d=()=>{const e=this.#l(this.#n),t=this.#h(this.#n),i=os`
      <devtools-select-menu
        @selectmenuselected=${this.#a}
        .showDivider=${!0}
        .showArrow=${!0}
        .sideButton=${!1}
        .showSelectedItem=${!0}
        .showConnector=${!1}
        .jslogContext=${"network-conditions"}
        .buttonTitle=${Oi(Ei.network,{PH1:e})}
        title=${Oi(Ei.networkThrottling,{PH1:e})}
      >
        ${this.#i.map(n=>os`
            <devtools-menu-group .name=${n.name}>
              ${n.items.map(s=>{const r=this.#h(s),o=this.#l(s),l=n.jslogContext||Fo(s.i18nTitleKey||o);return os`
                  <devtools-menu-item
                    title=${o}
                    .value=${r}
                    .selected=${t===r}
                    jslog=${Gn(l).track({click:!0})}
                  >
                    ${o}
                  </devtools-menu-item>
                `})}
              ${n.showCustomAddOption?os`
                <devtools-menu-item
                  .value=${1}
                  jslog=${bt("add").track({click:!0})}
                  @click=${this.#p}
                >
                  ${Oi(Ei.add)}
                </devtools-menu-item>
              `:pm}
            </devtools-menu-group>
          `)}
      </devtools-select-menu>
    `;q(i,this.#e,{host:this})}}customElements.define("devtools-network-throttling-selector",gm);const zl=new CSSStyleSheet;zl.replaceSync(`/*
 * Copyright 2024 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

.metric-card {
  border-radius: var(--sys-shape-corner-small);
  padding: 14px 16px;
  background-color: var(--sys-color-surface3);
  height: 100%;
  box-sizing: border-box;
}

.title {
  font-size: var(--sys-typescale-headline5-size);
  line-height: var(--sys-typescale-headline5-line-height);
  font-weight: var(--ref-typeface-weight-medium);
  margin: 0;
  margin-bottom: 6px;
}

.metric-values-section {
  position: relative;
  display: flex;
  column-gap: 8px;
  margin-bottom: 8px;
}

.metric-values-section:focus-visible {
  outline: 2px solid -webkit-focus-ring-color;
}

.metric-source-block {
  flex: 1;
}

.metric-source-value {
  font-size: 32px;
  line-height: 36px;
  font-weight: var(--ref-typeface-weight-regular);
}

.metric-source-label {
  font-weight: var(--ref-typeface-weight-medium);
}

.good-bg {
  background-color: var(--app-color-performance-good);
}

.needs-improvement-bg {
  background-color: var(--app-color-performance-ok);
}

.poor-bg {
  background-color: var(--app-color-performance-bad);
}

.divider {
  width: 100%;
  border: 0;
  border-bottom: 1px solid var(--sys-color-divider);
  margin: 8px 0;
  box-sizing: border-box;
}

.compare-text {
  margin-top: 8px;
}

.environment-recs-intro {
  margin-top: 8px;
}

.environment-recs {
  margin: 12px 0;
}

.environment-recs > summary {
  font-weight: var(--ref-typeface-weight-medium);
  margin-bottom: 4px;
}

.environment-recs-list {
  margin: 0;
  padding-left: 20px;
}

.detailed-compare-text {
  margin-bottom: 8px;
}

.bucket-summaries {
  margin-top: 8px;
  overflow-x: auto;
}

.bucket-summaries.histogram {
  display: grid;
  grid-template-columns: minmax(min-content, auto) minmax(20px, 50px) max-content;
  grid-auto-rows: 1fr;
  column-gap: 8px;
  justify-items: flex-end;
  align-items: center;
}

.bucket-label {
  justify-self: start;
  font-weight: var(--ref-typeface-weight-medium);
}

.bucket-range {
  color: var(--sys-color-token-subtle);
}

.histogram-bar {
  height: 6px;
}

.histogram-percent {
  color: var(--sys-color-token-subtle);
  font-weight: var(--ref-typeface-weight-medium);
}

.tooltip {
  display: none;
  visibility: hidden;
  transition-property: visibility;
  width: min(var(--tooltip-container-width, 350px), 350px);
  max-width: max-content;
  position: absolute;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
  z-index: 1;
  box-sizing: border-box;
  padding: var(--sys-size-5) var(--sys-size-6);
  border-radius: var(--sys-shape-corner-small);
  background-color: var(--sys-color-cdt-base-container);
  box-shadow: var(--drop-shadow-depth-3);
}

.phase-table-row {
  display: flex;
  justify-content: space-between;
}

.phase-table-header-row {
  font-weight: var(--ref-typeface-weight-medium);
}

/*# sourceURL=metricCard.css */
`);const ue={goodBetterCompare:"Your local {PH1} value of {PH2} is good, but is significantly better than your usersâ€™ experience.",goodWorseCompare:"Your local {PH1} value of {PH2} is good, but is significantly worse than your usersâ€™ experience.",goodSimilarCompare:"Your local {PH1} value of {PH2} is good, and is similar to your usersâ€™ experience.",goodSummarized:"Your local {PH1} value of {PH2} is good.",needsImprovementBetterCompare:"Your local {PH1} value of {PH2} needs improvement, but is significantly better than your usersâ€™ experience.",needsImprovementWorseCompare:"Your local {PH1} value of {PH2} needs improvement, but is significantly worse than your usersâ€™ experience.",needsImprovementSimilarCompare:"Your local {PH1} value of {PH2} needs improvement, and is similar to your usersâ€™ experience.",needsImprovementSummarized:"Your local {PH1} value of {PH2} needs improvement.",poorBetterCompare:"Your local {PH1} value of {PH2} is poor, but is significantly better than your usersâ€™ experience.",poorWorseCompare:"Your local {PH1} value of {PH2} is poor, but is significantly worse than your usersâ€™ experience.",poorSimilarCompare:"Your local {PH1} value of {PH2} is poor, and is similar to your usersâ€™ experience.",poorSummarized:"Your local {PH1} value of {PH2} is poor.",goodGoodDetailedCompare:"Your local {PH1} value of {PH2} is good and is rated the same as {PH4} of real-user {PH1} experiences. Additionally, the field data 75th percentile {PH1} value of {PH3} is good.",goodNeedsImprovementDetailedCompare:"Your local {PH1} value of {PH2} is good and is rated the same as {PH4} of real-user {PH1} experiences. However, the field data 75th percentile {PH1} value of {PH3} needs improvement.",goodPoorDetailedCompare:"Your local {PH1} value of {PH2} is good and is rated the same as {PH4} of real-user {PH1} experiences. However, the field data 75th percentile {PH1} value of {PH3} is poor.",needsImprovementGoodDetailedCompare:"Your local {PH1} value of {PH2} needs improvement and is rated the same as {PH4} of real-user {PH1} experiences. However, the field data 75th percentile {PH1} value of {PH3} is good.",needsImprovementNeedsImprovementDetailedCompare:"Your local {PH1} value of {PH2} needs improvement and is rated the same as {PH4} of real-user {PH1} experiences. Additionally, the field data 75th percentile {PH1} value of {PH3} needs improvement.",needsImprovementPoorDetailedCompare:"Your local {PH1} value of {PH2} needs improvement and is rated the same as {PH4} of real-user {PH1} experiences. However, the field data 75th percentile {PH1} value of {PH3} is poor.",poorGoodDetailedCompare:"Your local {PH1} value of {PH2} is poor and is rated the same as {PH4} of real-user {PH1} experiences. However, the field data 75th percentile {PH1} value of {PH3} is good.",poorNeedsImprovementDetailedCompare:"Your local {PH1} value of {PH2} is poor and is rated the same as {PH4} of real-user {PH1} experiences. However, the field data 75th percentile {PH1} value of {PH3} needs improvement.",poorPoorDetailedCompare:"Your local {PH1} value of {PH2} is poor and is rated the same as {PH4} of real-user {PH1} experiences. Additionally, the field data 75th percentile {PH1} value of {PH3} is poor."},ge=A("panels/timeline/components/MetricCompareStrings.ts",ue);function fm(a){const{rating:e,compare:t}=a,i={PH1:a.metric,PH2:a.localValue};if(e==="good"&&t==="better")return z(ge,ue.goodBetterCompare,i);if(e==="good"&&t==="worse")return z(ge,ue.goodWorseCompare,i);if(e==="good"&&t==="similar")return z(ge,ue.goodSimilarCompare,i);if(e==="good"&&!t)return z(ge,ue.goodSummarized,i);if(e==="needs-improvement"&&t==="better")return z(ge,ue.needsImprovementBetterCompare,i);if(e==="needs-improvement"&&t==="worse")return z(ge,ue.needsImprovementWorseCompare,i);if(e==="needs-improvement"&&t==="similar")return z(ge,ue.needsImprovementSimilarCompare,i);if(e==="needs-improvement"&&!t)return z(ge,ue.needsImprovementSummarized,i);if(e==="poor"&&t==="better")return z(ge,ue.poorBetterCompare,i);if(e==="poor"&&t==="worse")return z(ge,ue.poorWorseCompare,i);if(e==="poor"&&t==="similar")return z(ge,ue.poorSimilarCompare,i);if(e==="poor"&&!t)return z(ge,ue.poorSummarized,i);throw new Error("Compare string not found")}function vm(a){const{localRating:e,fieldRating:t}=a,i={PH1:a.metric,PH2:a.localValue,PH3:a.fieldValue,PH4:a.percent};if(e==="good"&&t==="good")return z(ge,ue.goodGoodDetailedCompare,i);if(e==="good"&&t==="needs-improvement")return z(ge,ue.goodNeedsImprovementDetailedCompare,i);if(e==="good"&&t==="poor")return z(ge,ue.goodPoorDetailedCompare,i);if(e==="good"&&!t)return z(ge,ue.goodSummarized,i);if(e==="needs-improvement"&&t==="good")return z(ge,ue.needsImprovementGoodDetailedCompare,i);if(e==="needs-improvement"&&t==="needs-improvement")return z(ge,ue.needsImprovementNeedsImprovementDetailedCompare,i);if(e==="needs-improvement"&&t==="poor")return z(ge,ue.needsImprovementPoorDetailedCompare,i);if(e==="needs-improvement"&&!t)return z(ge,ue.needsImprovementSummarized,i);if(e==="poor"&&t==="good")return z(ge,ue.poorGoodDetailedCompare,i);if(e==="poor"&&t==="needs-improvement")return z(ge,ue.poorNeedsImprovementDetailedCompare,i);if(e==="poor"&&t==="poor")return z(ge,ue.poorPoorDetailedCompare,i);if(e==="poor"&&!t)return z(ge,ue.poorSummarized,i);throw new Error("Detailed compare string not found")}const Sa=new CSSStyleSheet;Sa.replaceSync(`/*
 * Copyright 2024 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

.metric-value {
  text-wrap: nowrap;
}

.metric-value.dim {
  font-weight: var(--ref-typeface-weight-medium);
}

.metric-value.waiting {
  color: var(--sys-color-token-subtle);
}

.metric-value.good {
  color: var(--app-color-performance-good);
}

.metric-value.needs-improvement {
  color: var(--app-color-performance-ok);
}

.metric-value.poor {
  color: var(--app-color-performance-bad);
}

.metric-value.good.dim {
  color: var(--app-color-performance-good-dim);
}

.metric-value.needs-improvement.dim {
  color: var(--app-color-performance-ok-dim);
}

.metric-value.poor.dim {
  color: var(--app-color-performance-bad-dim);
}

/*# sourceURL=metricValueStyles.css */
`);const qr={fms:"{PH1}[ms]()",fs:"{PH1}[s]()"},ym=A("panels/timeline/components/Utils.ts",qr),go=N.bind(void 0,ym);var he;(function(a){a.DOC="Doc",a.CSS="CSS",a.JS="JS",a.FONT="Font",a.IMG="Img",a.MEDIA="Media",a.WASM="Wasm",a.OTHER="Other"})(he||(he={}));function Gl(a){const{mimeType:e}=a.args.data;switch(a.args.data.resourceType){case"Document":return he.DOC;case"Stylesheet":return he.CSS;case"Image":return he.IMG;case"Media":return he.MEDIA;case"Font":return he.FONT;case"Script":case"WebSocket":return he.JS;default:return e.startsWith("text/")?he.DOC:e.endsWith("/css")?he.CSS:e.endsWith("javascript")?he.JS:e.startsWith("image/")?he.IMG:e.startsWith("audio/")||e.startsWith("video/")?he.MEDIA:e.startsWith("font/")||e.includes("font-")?he.FONT:e==="application/wasm"?he.WASM:he.OTHER}}function jl(a){let e="--app-color-system";switch(a){case he.DOC:e="--app-color-doc";break;case he.JS:e="--app-color-scripting";break;case he.CSS:e="--app-color-css";break;case he.IMG:e="--app-color-image";break;case he.MEDIA:e="--app-color-media";break;case he.FONT:e="--app-color-font";break;case he.WASM:e="--app-color-wasm";break;case he.OTHER:default:e="--app-color-system";break}return ie.instance().getComputedValue(e)}function Ms(a){const e=Gl(a);return jl(e)}const bm=[2500,4e3],ql=[.1,.25],Kl=[200,500];function Ui(a,e){return a<=e[0]?"good":a<=e[1]?"needs-improvement":"poor"}function ki(a,e,t,i,n){const s=document.createElement("span");if(s.classList.add("metric-value"),e===void 0)return s.classList.add("waiting"),s.textContent="-",s;s.textContent=i(e);const r=Ui(e,t);return s.classList.add(r),s.setAttribute("jslog",`${Zi(a)}`),n?.dim&&s.classList.add("dim"),s}var Ds;(function(a){function e(n){const s=n.indexOf("["),r=s!==-1&&n.indexOf("]",s),o=r&&n.indexOf("(",r),l=o&&n.indexOf(")",o);if(!l||l===-1)return null;const d=n.substring(0,s),c=n.substring(s+1,r),h=n.substring(l+1);return{firstPart:d,unitPart:c,lastPart:h}}a.parse=e;function t(n){const s=document.createElement("span");s.classList.add("number-with-unit");const r=Qi(n),o=Kd(r),l=go(qr.fs,{PH1:o.toFixed(2)}),d=e(l);if(!d)return s.textContent=Mo(n),{text:l,element:s};const{firstPart:c,unitPart:h,lastPart:u}=d;return c&&s.append(c),s.createChild("span","unit").textContent=h,u&&s.append(u),{text:s.textContent??"",element:s}}a.formatMicroSecondsAsSeconds=t;function i(n,s=0){const r=document.createElement("span");r.classList.add("number-with-unit");const o=Qi(n),l=go(qr.fms,{PH1:o.toFixed(s)}),d=e(l);if(!d)return r.textContent=Bt(n),{text:l,element:r};const{firstPart:c,unitPart:h,lastPart:u}=d;return c&&r.append(c),r.createChild("span","unit").textContent=h,u&&r.append(u),{text:r.textContent??"",element:r}}a.formatMicroSecondsAsMillisFixed=i})(Ds||(Ds={}));const{html:Ae,nothing:Cr}=K,pe={localValue:"Local",field75thPercentile:"Field 75th percentile",good:"Good",needsImprovement:"Needs improvement",poor:"Poor",leqRange:"(â‰¤{PH1})",betweenRange:"({PH1}-{PH2})",gtRange:"(>{PH1})",percentage:"{PH1}%",interactToMeasure:"Interact with the page to measure INP.",viewCardDetails:"View card details",considerTesting:"Consider your local test conditions",recThrottlingLCP:"Real users may experience longer page loads due to slower network conditions. Increasing network throttling will simulate slower network conditions.",recThrottlingINP:"Real users may experience longer interactions due to slower CPU speeds. Increasing CPU throttling will simulate a slower device.",recViewportLCP:"Screen size can influence what the LCP element is. Ensure you are testing common viewport sizes.",recViewportCLS:"Screen size can influence what layout shifts happen. Ensure you are testing common viewport sizes.",recJourneyCLS:"How a user interacts with the page can influence layout shifts. Ensure you are testing common interactions like scrolling the page.",recJourneyINP:"How a user interacts with the page influences interaction delays. Ensure you are testing common interactions.",recDynamicContentLCP:"The LCP element can vary between page loads if content is dynamic.",recDynamicContentCLS:"Dynamic content can influence what layout shifts happen.",phase:"Phase",duration:"Local duration (ms)"},wm=A("panels/timeline/components/MetricCard.ts",pe),ye=N.bind(void 0,wm);class Tm extends HTMLElement{#e=this.attachShadow({mode:"open"});constructor(){super(),this.#P()}#t;#i={metric:"LCP"};set data(e){this.#i=e,D(this,this.#P)}connectedCallback(){this.#e.adoptedStyleSheets=[zl,Sa],D(this,this.#P)}#n=e=>{Yd(e)&&(e.stopPropagation(),this.#a())};#s(e){e.target?.hasFocus()||this.#a()}#r(e){const t=e.target;if(t?.hasFocus())return;const i=e.relatedTarget;i instanceof Node&&t.contains(i)||this.#a()}#a(){const e=this.#t;e&&(document.body.removeEventListener("keydown",this.#n),e.style.removeProperty("left"),e.style.removeProperty("visibility"),e.style.removeProperty("display"),e.style.removeProperty("transition-delay"))}#o(e=0){const t=this.#t;if(!t||t.style.visibility||t.style.display)return;document.body.addEventListener("keydown",this.#n),t.style.display="block",t.style.transitionDelay=`${Math.round(e)}ms`;const i=this.#i.tooltipContainer;if(!i)return;const n=i.getBoundingClientRect();t.style.setProperty("--tooltip-container-width",`${Math.round(n.width)}px`),requestAnimationFrame(()=>{let s=0;const r=t.getBoundingClientRect(),o=r.right-n.right,l=r.left-n.left;l<0?s=Math.round(l):o>0&&(s=Math.round(o)),t.style.left=`calc(50% - ${s}px)`,t.style.visibility="visible"})}#l(){switch(this.#i.metric){case"LCP":return 1e3;case"CLS":return .1;case"INP":return 200}}#p(){switch(this.#i.metric){case"LCP":return Nt("Largest Contentful Paint (LCP)");case"CLS":return Nt("Cumulative Layout Shift (CLS)");case"INP":return Nt("Interaction to Next Paint (INP)")}}#h(){switch(this.#i.metric){case"LCP":return bm;case"CLS":return ql;case"INP":return Kl}}#d(){switch(this.#i.metric){case"LCP":return e=>{const t=e*1e3;return Mo(t)};case"CLS":return e=>e===0?"0":e.toFixed(2);case"INP":return e=>Ye(e)}}#u(){const{localValue:e}=this.#i;if(e!==void 0)return e}#c(){let{fieldValue:e}=this.#i;if(e!==void 0&&(typeof e=="string"&&(e=Number(e)),!!Number.isFinite(e)))return e}#m(){const e=this.#u(),t=this.#c();if(e===void 0||t===void 0)return;const i=this.#h(),n=Ui(e,i),s=Ui(t,i);if(n==="good"&&s==="good")return"similar";const r=this.#l();return e-t>r?"worse":t-e>r?"better":"similar"}#g(){const e=this.#u();if(e===void 0)return this.#i.metric==="INP"?Ae`
          <div class="compare-text">${ye(pe.interactToMeasure)}</div>
        `:V;const t=this.#m(),i=Ui(e,this.#h()),n=ki(this.#f(!0),e,this.#h(),this.#d(),{dim:!0});return Ae`
      <div class="compare-text">
        ${fm({metric:Nt(this.#i.metric),rating:i,compare:t,localValue:n})}
      </div>
    `}#v(){const e=this.#m();if(!e||e==="similar")return V;const t=[],i=this.#i.metric;return i==="LCP"&&e==="better"?t.push(ye(pe.recThrottlingLCP)):i==="INP"&&e==="better"&&t.push(ye(pe.recThrottlingINP)),i==="LCP"?t.push(ye(pe.recViewportLCP)):i==="CLS"&&t.push(ye(pe.recViewportCLS)),i==="CLS"?t.push(ye(pe.recJourneyCLS)):i==="INP"&&t.push(ye(pe.recJourneyINP)),i==="LCP"?t.push(ye(pe.recDynamicContentLCP)):i==="CLS"&&t.push(ye(pe.recDynamicContentCLS)),t.length?Ae`
      <details class="environment-recs">
        <summary>${ye(pe.considerTesting)}</summary>
        <ul class="environment-recs-list">${t.map(n=>Ae`<li>${n}</li>`)}</ul>
      </details>
    `:V}#f(e){return`timeline.landing.${e?"local":"field"}-${this.#i.metric.toLowerCase()}`}#w(){const e=this.#u();if(e===void 0)return this.#i.metric==="INP"?Ae`
          <div class="detailed-compare-text">${ye(pe.interactToMeasure)}</div>
        `:V;const t=Ui(e,this.#h()),i=this.#c(),n=i!==void 0?Ui(i,this.#h()):void 0,s=ki(this.#f(!0),e,this.#h(),this.#d(),{dim:!0}),r=ki(this.#f(!1),i,this.#h(),this.#d(),{dim:!0});return Ae`
      <div class="detailed-compare-text">${vm({metric:Nt(this.#i.metric),localRating:t,fieldRating:n,localValue:s,fieldValue:r,percent:this.#E(t)})}</div>
    `}#b(e){switch(e){case"good":return 0;case"needs-improvement":return 1;case"poor":return 2}}#y(e){const i=this.#i.histogram?.[this.#b(e)].density||0;return`${Math.round(i*100)}%`}#E(e){const t=this.#i.histogram;if(t===void 0)return"-";const i=t[this.#b(e)].density||0,n=Math.round(i*100);return ye(pe.percentage,{PH1:n})}#T(){const e=ze.instance().getConfigSetting().get().enabled,t=this.#d(),i=this.#h(),n=Ae`
      <div class="bucket-label">
        <span>${ye(pe.good)}</span>
        <span class="bucket-range">${ye(pe.leqRange,{PH1:t(i[0])})}</span>
      </div>
    `,s=Ae`
      <div class="bucket-label">
        <span>${ye(pe.needsImprovement)}</span>
        <span class="bucket-range">${ye(pe.betweenRange,{PH1:t(i[0]),PH2:t(i[1])})}</span>
      </div>
    `,r=Ae`
      <div class="bucket-label">
        <span>${ye(pe.poor)}</span>
        <span class="bucket-range">${ye(pe.gtRange,{PH1:t(i[1])})}</span>
      </div>
    `;return e?Ae`
      <div class="bucket-summaries histogram">
        ${n}
        <div class="histogram-bar good-bg" style="width: ${this.#y("good")}"></div>
        <div class="histogram-percent">${this.#E("good")}</div>
        ${s}
        <div class="histogram-bar needs-improvement-bg" style="width: ${this.#y("needs-improvement")}"></div>
        <div class="histogram-percent">${this.#E("needs-improvement")}</div>
        ${r}
        <div class="histogram-bar poor-bg" style="width: ${this.#y("poor")}"></div>
        <div class="histogram-percent">${this.#E("poor")}</div>
      </div>
    `:Ae`
        <div class="bucket-summaries">
          ${n}
          ${s}
          ${r}
        </div>
      `}#x(){const e=this.#u(),t=this.#i.phases;return!t||!e?V:Ae`
      <hr class="divider">
      <div class="phase-table" role="table">
        <div class="phase-table-row phase-table-header-row" role="row">
          <div role="columnheader">${ye(pe.phase)}</div>
          <div role="columnheader">${ye(pe.duration)}</div>
        </div>
        ${t.map(i=>Ae`
          <div class="phase-table-row" role="row">
            <div role="cell">${i[0]}</div>
            <div role="cell">${Math.round(i[1])}</div>
          </div>
        `)}
      </div>
    `}#P=()=>{const e=ze.instance().getConfigSetting().get().enabled,t=Ae`
      <div class="metric-card">
        <h3 class="title">
          ${this.#p()}
        </h3>
        <div tabindex="0" class="metric-values-section"
          @mouseenter=${()=>this.#o(500)}
          @mouseleave=${this.#s}
          @focusin=${this.#o}
          @focusout=${this.#r}
          aria-describedby="tooltip"
        >
          <div class="metric-source-block">
            <div class="metric-source-value" id="local-value">${ki(this.#f(!0),this.#u(),this.#h(),this.#d())}</div>
            ${e?Ae`<div class="metric-source-label">${ye(pe.localValue)}</div>`:Cr}
          </div>
          ${e?Ae`
            <div class="metric-source-block">
              <div class="metric-source-value" id="field-value">${ki(this.#f(!1),this.#c(),this.#h(),this.#d())}</div>
              <div class="metric-source-label">${ye(pe.field75thPercentile)}</div>
            </div>
          `:Cr}
          <div
            id="tooltip"
            class="tooltip"
            role="tooltip"
            aria-label=${ye(pe.viewCardDetails)}
            on-render=${ji(i=>{this.#t=i})}
          >
            ${this.#w()}
            <hr class="divider">
            ${this.#T()}
            ${this.#x()}
          </div>
        </div>
        ${e?Ae`<hr class="divider">`:Cr}
        ${this.#g()}
        ${this.#v()}
        <slot name="extra-info"></slot>
      </div>
    `;q(t,this.#e,{host:this})}}customElements.define("devtools-metric-card",Tm);const Yl=new CSSStyleSheet;Yl.replaceSync(`/*
 * Copyright 2024 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

.container {
  /* stylelint-disable-next-line property-no-unknown */
  container-type: inline-size;
  height: 100%;
  font-size: var(--sys-typescale-body4-size);
  line-height: var(--sys-typescale-body4-line-height);
  font-weight: var(--ref-typeface-weight-regular);
  user-select: text;
}

.live-metrics-view {
  --min-main-area-size: 60%;

  background-color: var(--sys-color-cdt-base-container);
  display: flex;
  flex-direction: row;
  width: 100%;
  height: 100%;
}

.live-metrics,
.next-steps {
  padding: 16px;
  height: 100%;
  overflow-y: auto;
  box-sizing: border-box;
}

.live-metrics {
  flex: 1;
  display: flex;
  flex-direction: column;
}

.next-steps {
  flex: 0 0 336px;
  box-sizing: border-box;
  border: none;
  border-left: 1px solid var(--sys-color-divider);
}

/* stylelint-disable-next-line at-rule-no-unknown */
@container (max-width: 650px) {
  .live-metrics-view {
    flex-direction: column;
  }

  .next-steps {
    flex-basis: 40%;
    border: none;
    border-top: 1px solid var(--sys-color-divider);
  }
}

.metric-cards {
  display: grid;
  gap: 16px;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  width: 100%;
}

.section-title {
  font-size: var(--sys-typescale-headline4-size);
  line-height: var(--sys-typescale-headline4-line-height);
  font-weight: var(--ref-typeface-weight-medium);
  margin: 0;
  margin-bottom: 10px;
}

.settings-card {
  border-radius: var(--sys-shape-corner-small);
  padding: 14px 16px 16px;
  background-color: var(--sys-color-surface3);
  margin-bottom: 16px;
}

.record-action-card {
  border-radius: var(--sys-shape-corner-small);
  padding: 12px 16px 12px 12px;
  background-color: var(--sys-color-surface3);
  margin-bottom: 16px;
}

.card-title {
  font-size: var(--sys-typescale-headline5-size);
  line-height: var(--sys-typescale-headline5-line-height);
  font-weight: var(--ref-typeface-weight-medium);
  margin: 0;
}

.settings-card .card-title {
  margin-bottom: 4px;
}

.device-toolbar-description {
  margin-bottom: 12px;
  display: flex;
}

.network-cache-setting {
  display: inline-block;
  max-width: max-content;
}

.throttling-recommendation-value {
  font-weight: var(--ref-typeface-weight-medium);
}

.related-info {
  text-wrap: nowrap;
  margin-top: 8px;
  display: flex;
}

.related-info-label {
  font-weight: var(--ref-typeface-weight-medium);
  margin-right: 4px;
}

.related-info-link {
  background-color: var(--sys-color-cdt-base-container);
  border-radius: 2px;
  padding: 0 2px;
  min-width: 0;
}

.logs-section {
  margin-top: 24px;
  display: flex;
  flex-direction: column;
  flex: 1 0 300px;
  overflow: auto;
  max-height: max-content;

  --app-color-toolbar-background: transparent;
}

.logs-section-header {
  display: flex;
  align-items: center;
}

.interactions-clear {
  margin-left: 4px;
  vertical-align: sub;
}

.log {
  padding: 0;
  margin: 0;
  overflow: auto;
}

.log-item {
  border: none;
  border-bottom: 1px solid var(--sys-color-divider);

  &.highlight {
    animation: highlight-fadeout 2s;
  }
}

.interaction {
  --phase-table-margin: 120px;
  --details-indicator-width: 18px;

  summary {
    display: flex;
    align-items: center;
    padding: 7px 0;

    &::before {
      content: " ";
      height: 14px;
      width: var(--details-indicator-width);
      mask-image: var(--image-file-triangle-right);
      background-color: var(--icon-default);
      flex-shrink: 0;
    }
  }

  details[open] summary::before {
    mask-image: var(--image-file-triangle-down);
  }
}

.interaction-type {
  font-weight: var(--ref-typeface-weight-medium);
  width: calc(var(--phase-table-margin) - var(--details-indicator-width));
  flex-shrink: 0;
}

.interaction-inp-chip {
  background-color: var(--sys-color-yellow-bright);
  color: var(--sys-color-on-yellow);
  padding: 0 2px;
}

.interaction-node {
  flex-grow: 1;
  margin-right: 32px;
  min-width: 0;
}

.interaction-info {
  width: var(--sys-typescale-body4-line-height);
  height: var(--sys-typescale-body4-line-height);
  margin-right: 6px;
}

.interaction-duration {
  text-align: end;
  width: max-content;
  flex-shrink: 0;
  font-weight: var(--ref-typeface-weight-medium);
}

.layout-shift {
  display: flex;
  align-items: flex-start;
}

.layout-shift-score {
  margin-right: 16px;
  padding: 7px 0;
  width: 150px;
  box-sizing: border-box;
}

.layout-shift-nodes {
  flex: 1;
  min-width: 0;
}

.layout-shift-node {
  border-bottom: 1px solid var(--sys-color-divider);
  padding: 7px 0;

  &:last-child {
    border: none;
  }
}

.record-action {
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
}

.shortcut-label {
  width: max-content;
  flex-shrink: 0;
}

.field-data-option {
  margin: 8px 0;
  max-width: 100%;
}

.field-setup-buttons {
  margin-top: 14px;
}

.field-data-message {
  margin-bottom: 12px;
}

.collection-period-range {
  font-weight: var(--ref-typeface-weight-medium);
}

x-link { /* stylelint-disable-line selector-type-no-unknown */
  color: var(--sys-color-primary);
  text-decoration-line: underline;
}

.data-descriptions {
  margin-top: 10px;
  padding-left: 12px;
  border-left: 1px solid var(--sys-color-divider);
}

.environment-option {
  display: flex;
  align-items: center;
  margin-top: 8px;
}

.setting-hint {
  margin-left: 6px;
  vertical-align: bottom;
  height: 18px;
  width: 18px;
}

.environment-recs-title {
  margin-top: 12px;
  font-weight: var(--ref-typeface-weight-medium);
}

.environment-recs-list {
  margin: 0;
  padding-left: 20px;
}

.environment-rec {
  font-weight: var(--ref-typeface-weight-medium);
}

.link-to-log {
  padding: unset;
  background: unset;
  border: unset;
  font: inherit;
  color: var(--sys-color-primary);
  text-decoration: underline;
  cursor: pointer;
}

@keyframes highlight-fadeout {
  from {
    background-color: var(--sys-color-yellow-container);
  }

  to {
    background-color: transparent;
  }
}

.phase-table {
  border-top: 1px solid var(--sys-color-divider);
  padding: 7px 0;
  margin-left: var(--phase-table-margin);
}

.phase-table-row {
  display: flex;
  justify-content: space-between;
}

.phase-table-header-row {
  font-weight: var(--ref-typeface-weight-medium);
  margin-bottom: 4px;
}

/*# sourceURL=liveMetricsView.css */
`);const{html:de,nothing:fi,Directives:Sm}=K,{until:kr}=Sm,fo=Ao.instance(),Em=["AUTO",...Xd],Cm=200,km=60,P={localAndFieldMetrics:"Local and field metrics",localMetrics:"Local metrics",eventLogs:"Interaction and layout shift logs section",interactions:"Interactions",layoutShifts:"Layout shifts",nextSteps:"Next steps",fieldData:"Field data",environmentSettings:"Environment settings",showFieldDataForDevice:"Show field data for device type: {PH1}",notEnoughData:"Not enough data",network:"Network: {PH1}",device:"Device: {PH1}",allDevices:"All devices",desktop:"Desktop",mobile:"Mobile",tablet:"Tablet",auto:"Auto ({PH1})",loadingOption:"{PH1} - Loadingâ€¦",needsDataOption:"{PH1} - No data",urlOption:"URL",originOption:"Origin",urlOptionWithKey:"URL: {PH1}",originOptionWithKey:"Origin: {PH1}",showFieldDataForPage:"Show field data for {PH1}",tryDisablingThrottling:"75th percentile is too fast to simulate with throttling",tryUsingThrottling:"75th percentile is similar to {PH1} throttling",percentDevices:"{PH1}% mobile, {PH2}% desktop",useDeviceToolbar:"Use the device toolbar to {PH1}.",simulateDifferentDevices:"simulate different devices",networkCacheExplanation:"Disabling the network cache will simulate a network experience similar to a first time visitor.",disableNetworkCache:"Disable network cache",lcpElement:"LCP element",inpInteractionLink:"INP interaction",worstCluster:"Worst cluster",numShifts:`{shiftCount, plural,
    =1 {{shiftCount} shift}
    other {{shiftCount} shifts}
  }`,collectionPeriod:"Collection period: {PH1}",dateRange:"{PH1} - {PH2}",seeHowYourLocalMetricsCompare:"See how your local metrics compare to real user data in the {PH1}.",theLocalMetricsAre:"The {PH1} are captured from the current page using your network connection and device.",localMetricsLink:"local metrics",theFieldMetricsAre:"The {PH1} is measured by real users using many different network connections and devices.",fieldDataLink:"field data",interactionExcluded:"INP is calculated using the 98th percentile of interaction delays, so some interaction delays may be larger than the INP value.",clearCurrentLog:"Clear the current log",realUserEnvironments:"Real user environments",timeToFirstByte:"Time to first byte",resourceLoadDelay:"Resource load delay",resourceLoadDuration:"Resource load duration",elementRenderDelay:"Element render delay",inputDelay:"Input delay",processingDuration:"Processing duration",presentationDelay:"Presentation delay",inpInteraction:"The INP interaction is at the 98th percentile of interaction delays.",showInpInteraction:"Go to the INP interaction.",showClsCluster:"Go to worst layout shift cluster."},ti=A("panels/timeline/components/LiveMetricsView.ts",P),M=N.bind(void 0,ti);class Xl extends Jd{#e=this.attachShadow({mode:"open"});#t;#i;#n;#s=new Map;#r=[];#a;#o="AUTO";#l="url";#p;#h;#d;#u;#c;#m;#g=!1;constructor(){super(),this.#p=Fi.instance().getAction("timeline.toggle-recording"),this.#h=Fi.instance().getAction("timeline.record-reload")}#v(e){this.#t=e.data.lcp,this.#i=e.data.cls,this.#n=e.data.inp;const t=this.#r.length<e.data.layoutShifts.length;this.#r=[...e.data.layoutShifts];const i=this.#s.size<e.data.interactions.size;this.#s=new Map(e.data.interactions);const n=D(this,this.#D);i&&this.#c&&this.#f(n,this.#c),t&&this.#m&&this.#f(n,this.#m)}#f(e,t){!t.checkVisibility()||!(Math.abs(t.scrollHeight-t.clientHeight-t.scrollTop)<=1)&&!this.#g||e.then(()=>{requestAnimationFrame(()=>{this.#g=!0,t.addEventListener("scrollend",()=>{this.#g=!1},{once:!0}),t.scrollTo({top:t.scrollHeight,behavior:"smooth"})})})}#w(e){this.#a=e.data,D(this,this.#D)}#b(){D(this,this.#D)}async#y(){this.#a=await ze.instance().getFieldDataForCurrentPage(),D(this,this.#D)}#E(){const e=this.#o==="AUTO"?this.#R():this.#o;return this.#a?.[`${this.#l}-${e}`]}#T(e){return this.#E()?.record.metrics[e]}connectedCallback(){this.#e.adoptedStyleSheets=[Yl,Sa];const e=Fn.instance();e.addEventListener("status",this.#v,this);const t=ze.instance();t.addEventListener("field-data-changed",this.#w,this),this.#x()?.addEventListener("Updated",this.#b,this),t.getConfigSetting().get().enabled&&this.#y(),this.#t=e.lcpValue,this.#i=e.clsValue,this.#n=e.inpValue,this.#s=e.interactions,this.#r=e.layoutShifts,D(this,this.#D)}#x(){try{return Qu.instance()}catch{return null}}disconnectedCallback(){Fn.instance().removeEventListener("status",this.#v,this),ze.instance().removeEventListener("field-data-changed",this.#w,this),this.#x()?.removeEventListener("Updated",this.#b,this)}#P(){const e=this.#T("largest_contentful_paint"),t=this.#t?.node,i=this.#t?.phases;return de`
      <devtools-metric-card .data=${{metric:"LCP",localValue:this.#t?.value,fieldValue:e?.percentiles?.p75,histogram:e?.histogram,tooltipContainer:this.#u,phases:i&&[[M(P.timeToFirstByte),i.timeToFirstByte],[M(P.resourceLoadDelay),i.resourceLoadDelay],[M(P.resourceLoadDuration),i.resourceLoadTime],[M(P.elementRenderDelay),i.elementRenderDelay]]}}>
        ${t?de`
            <div class="related-info" slot="extra-info">
              <span class="related-info-label">${M(P.lcpElement)}</span>
              <span class="related-info-link">${kr(ci.linkify(t))}</span>
            </div>
          `:fi}
      </devtools-metric-card>
    `}#I(){const e=this.#T("cumulative_layout_shift"),t=new Set(this.#i?.clusterShiftIds||[]),i=t.size>0&&this.#r.some(n=>t.has(n.uniqueLayoutShiftId));return de`
      <devtools-metric-card .data=${{metric:"CLS",localValue:this.#i?.value,fieldValue:e?.percentiles?.p75,histogram:e?.histogram,tooltipContainer:this.#u}}>
        ${i?de`
          <div class="related-info" slot="extra-info">
            <span class="related-info-label">${M(P.worstCluster)}</span>
            <button
              class="link-to-log"
              title=${M(P.showClsCluster)}
              @click=${()=>this.#q(t)}
              jslog=${bt("timeline.landing.show-cls-cluster").track({click:!0})}
            >${M(P.numShifts,{shiftCount:t.size})}</button>
          </div>
        `:fi}
      </devtools-metric-card>
    `}#L(){const e=this.#T("interaction_to_next_paint"),t=this.#n?.phases,i=this.#n&&this.#s.get(this.#n.interactionId);return de`
      <devtools-metric-card .data=${{metric:"INP",localValue:this.#n?.value,fieldValue:e?.percentiles?.p75,histogram:e?.histogram,tooltipContainer:this.#u,phases:t&&[[M(P.inputDelay),t.inputDelay],[M(P.processingDuration),t.processingDuration],[M(P.presentationDelay),t.presentationDelay]]}}>
        ${i?de`
          <div class="related-info" slot="extra-info">
            <span class="related-info-label">${M(P.inpInteractionLink)}</span>
            <button
              class="link-to-log"
              title=${M(P.showInpInteraction)}
              @click=${()=>this.#G(i)}
              jslog=${bt("timeline.landing.show-inp-interaction").track({click:!0})}
            >${i.interactionType}</button>
          </div>
        `:fi}
      </devtools-metric-card>
    `}#C(e){function t(){e.execute()}return de`
      <div class="record-action">
        <devtools-button @click=${t} .data=${{variant:"text",size:"REGULAR",iconName:e.icon(),title:e.title(),jslogContext:e.id()}}>
          ${e.title()}
        </devtools-button>
        <span class="shortcut-label">${Br.instance().shortcutTitleForAction(e.id())}</span>
      </div>
    `}#k(){const e=this.#T("round_trip_time");if(!e?.percentiles)return null;const t=Number(e.percentiles.p75);if(!Number.isFinite(t))return null;if(t<km)return M(P.tryDisablingThrottling);let i=null,n=1/0;for(const r of va.networkPresets){const{targetLatency:o}=r;if(!o)continue;const l=Math.abs(o-t);l>Cm||n<l||(i=r,n=l)}if(!i)return null;const s=typeof i.title=="function"?i.title():i.title;return M(P.tryUsingThrottling,{PH1:s})}#N(){const e=this.#a?.[`${this.#l}-ALL`]?.record.metrics.form_factors?.fractions;return e?M(P.percentDevices,{PH1:Math.round(e.phone*100),PH2:Math.round(e.desktop*100)}):null}#S(){const e=ze.instance().getConfigSetting().get().enabled,t=tt.create("https://developer.chrome.com/docs/devtools/device-mode",M(P.simulateDifferentDevices)),i=z(ti,P.useDeviceToolbar,{PH1:t}),n=document.createElement("span");n.classList.add("environment-rec"),n.textContent=this.#N()||M(P.notEnoughData);const s=document.createElement("span");return s.classList.add("environment-rec"),s.textContent=this.#k()||M(P.notEnoughData),de`
      <h3 class="card-title">${M(P.environmentSettings)}</h3>
      <div class="device-toolbar-description">${i}</div>
      ${e?de`
        <div class="environment-recs-title">${M(P.realUserEnvironments)}</div>
        <ul class="environment-recs-list">
          <li>${z(ti,P.device,{PH1:n})}</li>
          <li>${z(ti,P.network,{PH1:s})}</li>
        </ul>
      `:fi}
      <div class="environment-option">
        <devtools-cpu-throttling-selector></devtools-cpu-throttling-selector>
      </div>
      <div class="environment-option">
        <devtools-network-throttling-selector></devtools-network-throttling-selector>
      </div>
      <div class="environment-option">
        <setting-checkbox
          class="network-cache-setting"
          .data=${{setting:Te.instance().moduleSetting("cache-disabled"),textOverride:M(P.disableNetworkCache)}}
        ></setting-checkbox>
        <devtools-icon
          class="setting-hint"
          name="help"
          title=${M(P.networkCacheExplanation)}
        ></devtools-icon>
        </div>
    `}#$(e){const t=this.#a?.[`${e}-ALL`]?.record.key[e];if(t)return e==="url"?M(P.urlOptionWithKey,{PH1:t}):M(P.originOptionWithKey,{PH1:t});const i=M(e==="url"?P.urlOption:P.originOption);return M(P.needsDataOption,{PH1:i})}#F(e){e.itemValue==="url"?this.#l="url":this.#l="origin",D(this,this.#D)}#B(){if(!ze.instance().getConfigSetting().get().enabled)return V;const e=this.#$("url"),t=this.#$("origin"),i=this.#l==="url"?e:t,n=M(P.showFieldDataForPage,{PH1:i}),s=!this.#a?.["url-ALL"]&&!this.#a?.["origin-ALL"];return de`
      <devtools-select-menu
        id="page-scope-select"
        class="field-data-option"
        @selectmenuselected=${this.#F}
        .showDivider=${!0}
        .showArrow=${!0}
        .sideButton=${!1}
        .showSelectedItem=${!0}
        .showConnector=${!1}
        .buttonTitle=${i}
        .disabled=${s}
        title=${n}
      >
        <devtools-menu-item
          .value=${"url"}
          .selected=${this.#l==="url"}
        >
          ${e}
        </devtools-menu-item>
        <devtools-menu-item
          .value=${"origin"}
          .selected=${this.#l==="origin"}
        >
          ${t}
        </devtools-menu-item>
      </devtools-select-menu>
    `}#_(e){switch(e){case"ALL":return M(P.allDevices);case"DESKTOP":return M(P.desktop);case"PHONE":return M(P.mobile);case"TABLET":return M(P.tablet)}}#R(){const e=this.#x();return e===null?"ALL":e.isMobile()?this.#a?.[`${this.#l}-PHONE`]?"PHONE":"ALL":this.#a?.[`${this.#l}-DESKTOP`]?"DESKTOP":"ALL"}#M(e){const t=e==="AUTO"?this.#R():e,i=this.#_(t),n=e==="AUTO"?M(P.auto,{PH1:i}):i;return this.#a?this.#a[`${this.#l}-${t}`]?n:M(P.needsDataOption,{PH1:n}):M(P.loadingOption,{PH1:n})}#O(e){this.#o=e.itemValue,D(this,this.#D)}#A(){if(!ze.instance().getConfigSetting().get().enabled)return V;const e=!this.#a?.[`${this.#l}-ALL`],t=this.#M(this.#o);return de`
      <devtools-select-menu
        id="device-scope-select"
        class="field-data-option"
        @selectmenuselected=${this.#O}
        .showDivider=${!0}
        .showArrow=${!0}
        .sideButton=${!1}
        .showSelectedItem=${!0}
        .showConnector=${!1}
        .buttonTitle=${M(P.device,{PH1:t})}
        .disabled=${e}
        title=${M(P.showFieldDataForDevice,{PH1:t})}
      >
        ${Em.map(i=>de`
            <devtools-menu-item
              .value=${i}
              .selected=${this.#o===i}
            >
              ${this.#M(i)}
            </devtools-menu-item>
          `)}
      </devtools-select-menu>
    `}#H(){const e=this.#E();if(!e)return null;const{firstDate:t,lastDate:i}=e.record.collectionPeriod,n=new Date(t.year,t.month-1,t.day),s=new Date(i.year,i.month-1,i.day),r={year:"numeric",month:"short",day:"numeric"};return M(P.dateRange,{PH1:n.toLocaleDateString(void 0,r),PH2:s.toLocaleDateString(void 0,r)})}#W(){const e=this.#H(),t=document.createElement("span");t.classList.add("collection-period-range"),t.textContent=e||M(P.notEnoughData);const i=z(ti,P.collectionPeriod,{PH1:t});return de`
      <div class="field-data-message">${i}</div>
    `}#V(){if(ze.instance().getConfigSetting().get().enabled)return this.#W();const e=tt.create("https://developer.chrome.com/docs/crux",Nt("Chrome UX Report")),t=z(ti,P.seeHowYourLocalMetricsCompare,{PH1:e});return de`
      <div class="field-data-message">${t}</div>
    `}#U(){const e=ze.instance().getConfigSetting().get().enabled,t=tt.create("https://goo.gle/perf-local-metrics",M(P.localMetricsLink)),i=z(ti,P.theLocalMetricsAre,{PH1:t}),n=tt.create("https://goo.gle/perf-field-data",M(P.fieldDataLink)),s=z(ti,P.theFieldMetricsAre,{PH1:n});return de`
      <div class="data-descriptions">
        <div>${i}</div>
        ${e?de`<div>${s}</div>`:fi}
      </div>
    `}#z(){return de`
      <section class="logs-section" aria-label=${M(P.eventLogs)}>
        <devtools-live-metrics-logs
          on-render=${ji(e=>{this.#d=e})}
        >
          ${this.#j()}
          ${this.#K()}
        </devtools-live-metrics-logs>
      </section>
    `}async#G(e){const t=this.#e.getElementById(e.interactionId);!t||!this.#d||!this.#d.selectTab("interactions")||await fo.write(()=>{t.scrollIntoView({block:"center"}),t.focus(),Ha(t,"highlight")})}#j(){return this.#s.size?de`
      <ol class="log"
        slot="interactions-log-content"
        on-render=${ji(e=>{this.#c=e})}
      >
        ${this.#s.values().map(e=>{const t=ki("timeline.landing.interaction-event-timing",e.duration,Kl,s=>Ye(s),{dim:!0}),i=this.#n&&this.#n.value<e.duration,n=this.#n?.interactionId===e.interactionId;return de`
            <li id=${e.interactionId} class="log-item interaction" tabindex="-1">
              <details>
                <summary>
                  <span class="interaction-type">
                    ${e.interactionType}
                    ${n?de`<span class="interaction-inp-chip" title=${M(P.inpInteraction)}>INP</span>`:fi}
                  </span>
                  <span class="interaction-node">${e.node&&kr(ci.linkify(e.node))}</span>
                  ${i?de`<devtools-icon
                    class="interaction-info"
                    name="info"
                    title=${M(P.interactionExcluded)}
                  ></devtools-icon>`:fi}
                  <span class="interaction-duration">${t}</span>
                </summary>
                <div class="phase-table" role="table">
                  <div class="phase-table-row phase-table-header-row" role="row">
                    <div role="columnheader">Phase</div>
                    <div role="columnheader">Local time (ms)</div>
                  </div>
                  <div class="phase-table-row" role="row">
                    <div role="cell">${M(P.inputDelay)}</div>
                    <div role="cell">${Math.round(e.phases.inputDelay)}</div>
                  </div>
                  <div class="phase-table-row" role="row">
                    <div role="cell">${M(P.processingDuration)}</div>
                    <div role="cell">${Math.round(e.phases.processingDuration)}</div>
                  </div>
                  <div class="phase-table-row" role="row">
                    <div role="cell">${M(P.presentationDelay)}</div>
                    <div role="cell">${Math.round(e.phases.presentationDelay)}</div>
                  </div>
                </div>
              </details>
            </li>
          `})}
      </ol>
    `:V}async#q(e){if(!this.#d)return;const t=[];for(const n of e){const s=this.#e.getElementById(n);s&&t.push(s)}!t.length||!this.#d.selectTab("layout-shifts")||await fo.write(()=>{t[0].scrollIntoView({block:"start"}),t[0].focus();for(const n of t)Ha(n,"highlight")})}#K(){return this.#r.length?de`
      <ol class="log"
        slot="layout-shifts-log-content"
        on-render=${ji(e=>{this.#m=e})}
      >
        ${this.#r.map(e=>{const t=ki("timeline.landing.layout-shift-event-score",e.score,ql,i=>i.toFixed(4),{dim:!0});return de`
            <li id=${e.uniqueLayoutShiftId} class="log-item layout-shift" tabindex="-1">
              <div class="layout-shift-score">Layout shift score: ${t}</div>
              <div class="layout-shift-nodes">
                ${e.affectedNodes.map(({node:i})=>de`
                  <div class="layout-shift-node">${kr(ci.linkify(i))}</div>
                `)}
              </div>
            </li>
          `})}
      </ol>
    `:V}#D=()=>{const e=ze.instance().getConfigSetting().get().enabled,t=M(e?P.localAndFieldMetrics:P.localMetrics),i=de`
      <div class="container">
        <div class="live-metrics-view">
          <main class="live-metrics"
          >
            <h2 class="section-title">${t}</h2>
            <div class="metric-cards"
              on-render=${ji(n=>{this.#u=n})}
            >
              <div id="lcp">
                ${this.#P()}
              </div>
              <div id="cls">
                ${this.#I()}
              </div>
              <div id="inp">
                ${this.#L()}
              </div>
            </div>
            ${this.#U()}
            ${this.#z()}
          </main>
          <aside class="next-steps" aria-labelledby="next-steps-section-title">
            <h2 id="next-steps-section-title" class="section-title">${M(P.nextSteps)}</h2>
            <div id="field-setup" class="settings-card">
              <h3 class="card-title">${M(P.fieldData)}</h3>
              ${this.#V()}
              ${this.#B()}
              ${this.#A()}
              <div class="field-setup-buttons">
                <devtools-field-settings-dialog></devtools-field-settings-dialog>
              </div>
            </div>
            <div id="recording-settings" class="settings-card">
              ${this.#S()}
            </div>
            <div id="record" class="record-action-card">
              ${this.#C(this.#p)}
            </div>
            <div id="record-page-load" class="record-action-card">
              ${this.#C(this.#h)}
            </div>
          </aside>
        </div>
      </div>
    `;q(i,this.#e,{host:this})}}class xm extends Zd{#e;constructor(){super(),this.style.display="contents"}selectTab(e){return this.#e?this.#e.selectTab(e):!1}#t(){const e=Fn.instance();switch(this.#e?.selectedTabId){case"interactions":e.clearInteractions();break;case"layout-shifts":e.clearLayoutShifts();break}}createWidget(){const e=new xn(!0,void 0,this);e.contentElement.style.display="contents",this.#e=new oa;const t=document.createElement("slot");t.name="interactions-log-content";const i=xn.getOrCreateWidget(t);this.#e.appendTab("interactions",M(P.interactions),i,void 0,void 0,void 0,void 0,void 0,"timeline.landing.interactions-log");const n=document.createElement("slot");n.name="layout-shifts-log-content";const s=xn.getOrCreateWidget(n);this.#e.appendTab("layout-shifts",M(P.layoutShifts),s,void 0,void 0,void 0,void 0,void 0,"timeline.landing.layout-shifts-log");const r=new mn(M(P.clearCurrentLog),"clear",void 0,"timeline.landing.clear-log");return r.addEventListener("Click",this.#t,this),this.#e.rightToolbar().appendToolbarItem(r),this.#e.show(e.contentElement),e}}customElements.define("devtools-live-metrics-view",Xl);customElements.define("devtools-live-metrics-logs",xm);const Jl=new CSSStyleSheet;Jl.replaceSync(`/*
 * Copyright (c) 2024 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

.network-request-details-title {
  font-size: 13px;
  padding: 8px;
  display: flex;
  align-items: center;
}

.network-request-details-title > div {
  box-sizing: border-box;
  width: 12px;
  height: 12px;
  border: 1px solid var(--sys-color-divider);
  display: inline-block;
  margin-right: 4px;
}

.network-request-details-cols {
  display: flex;
}

:host {
  border-bottom: 1px solid var(--sys-color-divider);
  display: block;
  padding-bottom: 5px;
}

.network-request-details-col {
  flex: 1;
}

.network-request-details-row {
  padding: 0 10px;
  min-height: 20px;
}

.title {
  color: var(--sys-color-token-subtle);
  overflow: hidden;
  padding-right: 10px;
  display: inline-block;
  vertical-align: top;
}

.value {
  display: inline-block;
  user-select: text;
  text-overflow: ellipsis;
  overflow: hidden;
  padding: 0 3px;
}

.devtools-link,
.timeline-link {
  color: var(--text-link);
  text-decoration: underline;
  outline-offset: 2px;
  padding: 0;
  text-align: left;

  .elements-disclosure & {
    color: var(--text-link);
  }

  devtools-icon {
    vertical-align: baseline;
    color: var(--sys-color-primary);
  }

  :focus .selected & devtools-icon {
    color: var(--sys-color-tonal-container);
  }

  &:focus-visible {
    outline-width: unset;
  }

  &.invalid-link {
    color: var(--text-disabled);
    text-decoration: none;
  }

  &:not(.devtools-link-prevent-click, .invalid-link) {
    cursor: pointer;
  }

  @media (forced-colors: active) {
    &:not(.devtools-link-prevent-click) {
      forced-color-adjust: none;
      color: linktext;
    }

    &:focus-visible {
      background: Highlight;
      color: HighlightText;
    }
  }
}

.text-button.link-style,
.text-button.link-style:hover,
.text-button.link-style:active {
  background: none;
  border: none;
  font: inherit;
}

.timing-rows {
  width: fit-content;
}

/*# sourceURL=networkRequestDetails.css */
`);const Ea=new CSSStyleSheet;Ea.replaceSync(`/*
 * Copyright (c) 2024 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

.bold {
  font-weight: bold;
}

.url {
  margin-left: 15px;
  margin-right: 5px;
}

.url--host {
  color: var(--sys-color-token-subtle);
}

.priority-row {
  margin-left: 15px;
}

.network-category-chip {
  box-sizing: border-box;
  width: 10px;
  height: 10px;
  border: 1px solid var(--sys-color-divider);
  display: inline-block;
  margin-right: 4px;
}

devtools-icon.priority {
  height: 13px;
  width: 13px;
  color: var(--sys-color-on-surface-subtle);
}

.render-blocking {
  margin-left: 15px;
  color: var(--sys-color-error);
}

.divider {
  border-top: 1px solid var(--sys-color-divider);
  margin: 5px 0;
}

.timings-row {
  align-self: start;
  display: flex;
  align-items: center;
  width: 100%;
}

.indicator {
  display: inline-block;
  width: 10px;
  height: 4px;
  margin-right: 5px;
  border: 1px solid var(--sys-color-on-surface-subtle);
}

.whisker-left {
  align-self: center;
  display: inline-flex;
  width: 10px;
  height: 6px;
  margin-right: 5px;
  border-left: 1px solid var(--sys-color-on-surface-subtle);
}

.whisker-right {
  align-self: center;
  display: inline-flex;
  width: 10px;
  height: 6px;
  margin-right: 5px;
  border-right: 1px solid var(--sys-color-on-surface-subtle);
}

.horizontal {
  background-color: var(--sys-color-on-surface-subtle);
  height: 1px;
  width: 10px;
  align-self: center;
}

.time {
  /* Push the time to right. */
  margin-left: auto;
  display: inline-block;
  padding-left: 10px;
}

.timings-row--duration {
  .indicator {
    border-color: transparent;
  }

  .time {
    font-weight: var(--ref-typeface-weight-medium);
  }
}

/*# sourceURL=networkRequestTooltip.css */
`);const{html:vi}=K,Im=60,ii={priority:"Priority",duration:"Duration",queuingAndConnecting:"Queuing and connecting",requestSentAndWaiting:"Request sent and waiting",contentDownloading:"Content downloading",waitingOnMainThread:"Waiting on main thread",renderBlocking:"Render blocking"},Pm=A("panels/timeline/components/NetworkRequestTooltip.ts",ii),yi=N.bind(void 0,Pm);class Mi extends HTMLElement{#e=this.attachShadow({mode:"open"});#t;connectedCallback(){this.#e.adoptedStyleSheets=[Ea],this.#i()}set networkRequest(e){this.#t!==e&&(this.#t=e,this.#i())}static renderPriorityValue(e){return e.args.data.priority===e.args.data.initialPriority?vi`${vr(e.args.data.priority)}`:vi`${vr(e.args.data.initialPriority)}
        <devtools-icon name=${"arrow-forward"} class="priority"></devtools-icon>
        ${vr(e.args.data.priority)}`}static renderTimings(e){const t=e.args.data.syntheticData,i=t.sendStartTime-e.ts,n=t.downloadStart-t.sendStartTime,s=t.finishTime-t.downloadStart,r=e.ts+e.dur-t.finishTime,o=Ms(e),l={backgroundColor:`color-mix(in srgb, ${o}, hsla(0, 100%, 100%, 0.8))`},d={backgroundColor:o},c=vi`<span class="whisker-left"> <span class="horizontal"></span> </span>`,h=vi`<span class="whisker-right"> <span class="horizontal"></span> </span>`;return vi`
      <div class="timings-row timings-row--duration">
        <span class="indicator"></span>
        ${yi(ii.duration)}
         <span class="time">${Ft(e.dur)}</span>
      </div>
      <div class="timings-row">
        ${c}
        ${yi(ii.queuingAndConnecting)}
        <span class="time">${Ft(i)}</span>
      </div>
      <div class="timings-row">
        <span class="indicator" style=${Pi(l)}></span>
        ${yi(ii.requestSentAndWaiting)}
        <span class="time">${Ft(n)}</span>
      </div>
      <div class="timings-row">
        <span class="indicator" style=${Pi(d)}></span>
        ${yi(ii.contentDownloading)}
        <span class="time">${Ft(s)}</span>
      </div>
      <div class="timings-row">
        ${h}
        ${yi(ii.waitingOnMainThread)}
        <span class="time">${Ft(r)}</span>
      </div>
    `}#i(){if(!this.#t)return;const e={backgroundColor:`${Ms(this.#t)}`},t=new URL(this.#t.args.data.url),i=vi`
      <div class="performance-card">
        <div class="url">${na(t.href.replace(t.origin,""),Im)}</div>
        <div class="url url--host">${t.origin.replace("https://","")}</div>

        <div class="divider"></div>
        <div class="network-category"><span class="network-category-chip" style=${Pi(e)}></span>${Gl(this.#t)}</div>
        <div class="priority-row">${yi(ii.priority)}: ${Mi.renderPriorityValue(this.#t)}</div>
        ${fa(this.#t)?vi`<div class="render-blocking"> ${yi(ii.renderBlocking)} </div>`:V}
        <div class="divider"></div>

        ${Mi.renderTimings(this.#t)}
      </div>
    `;q(i,this.#e,{host:this})}}customElements.define("devtools-performance-network-request-tooltip",Mi);const{html:Hi}=K,Lm=100,Ie={requestMethod:"Request method",priority:"Priority",encodedData:"Encoded data",decodedBody:"Decoded body",yes:"Yes",no:"No",preview:"Preview",networkRequest:"Network request",fromCache:"From cache",mimeType:"MIME type",FromMemoryCache:" (from memory cache)",FromCache:" (from cache)",FromPush:" (from push)",FromServiceWorker:" (from `service worker`)",initiatedBy:"Initiated by",blocking:"Blocking",inBodyParserBlocking:"In-body parser blocking",renderBlocking:"Render blocking"},Rm=A("panels/timeline/components/NetworkRequestDetails.ts",Ie),Ne=N.bind(void 0,Rm);class Zl extends HTMLElement{#e=this.attachShadow({mode:"open"});#t=null;#i=null;#n=new WeakMap;#s;#r=null;constructor(e){super(),this.#s=e}connectedCallback(){this.#e.adoptedStyleSheets=[Jl,Ea]}async setData(e,t,i){this.#t===t&&e===this.#r||(this.#r=e,this.#t=t,this.#i=i,await this.#m())}#a(){if(!this.#t)return null;const e={backgroundColor:`${Ms(this.#t)}`};return Hi`
      <div class="network-request-details-title">
        <div style=${Pi(e)}></div>
        ${Ne(Ie.networkRequest)}
      </div>
    `}#o(e,t){return t?Hi`
      <div class="network-request-details-row"><div class="title">${e}</div><div class="value">${t}</div></div>
    `:null}#l(){if(!this.#t)return null;const e={tabStop:!0,showColumnNumber:!1,inlineFrameIndex:0,maxLength:Lm},t=Mt.linkifyURL(this.#t.args.data.url,e),i=Qd(this.#t);if(i){t.addEventListener("contextmenu",s=>{if(!this.#t)return;const r=new Ji(s,{useSoftMenu:!0});r.appendApplicableItems(new eh(i)),r.show()});const n=Hi`
        ${t}
        <devtools-request-link-icon
          .data=${{request:i}} >
        </devtools-request-link-icon>
      `;return Hi`<div class="network-request-details-row">${n}</div>`}return Hi`<div class="network-request-details-row">${t}</div>`}#p(){if(!this.#t)return null;const e=this.#t.args.data.syntheticData.isMemoryCached||this.#t.args.data.syntheticData.isDiskCached;return this.#o(Ne(Ie.fromCache),Ne(e?Ie.yes:Ie.no))}#h(){if(!this.#t)return null;let e="";return this.#t.args.data.syntheticData.isMemoryCached?e+=Ne(Ie.FromMemoryCache):this.#t.args.data.syntheticData.isDiskCached?e+=Ne(Ie.FromCache):this.#t.args.data.timing?.pushStart&&(e+=Ne(Ie.FromPush)),this.#t.args.data.fromServiceWorker&&(e+=Ne(Ie.FromServiceWorker)),(this.#t.args.data.encodedDataLength||!e)&&(e=`${Ke(this.#t.args.data.encodedDataLength)}${e}`),this.#o(Ne(Ie.encodedData),e)}#d(){if(!this.#t)return null;if(th(this.#t)!==null){const i=si(this.#t)?.at(0)??null;if(i){const n=this.#s.maybeLinkifyConsoleCallFrame(this.#i,i,{tabStop:!0,inlineFrameIndex:0,showColumnNumber:!0});if(n)return this.#o(Ne(Ie.initiatedBy),n)}}const t=this.#r?.NetworkRequests.eventToInitiator.get(this.#t);if(t){const i=this.#s.maybeLinkifyScriptLocation(this.#i,null,t.args.data.url,void 0);if(i)return this.#o(Ne(Ie.initiatedBy),i)}return null}#u(){if(!this.#t||!fa(this.#t))return null;let e;switch(this.#t.args.data.renderBlocking){case"blocking":e=Ie.renderBlocking;break;case"in_body_parser_blocking":e=Ie.inBodyParserBlocking;break;default:return null}return this.#o(Ne(Ie.blocking),e)}async#c(){if(!this.#t)return null;if(!this.#n.get(this.#t)&&this.#t.args.data.url&&this.#i){const t=await In.build(this.#i,this.#t.args.data.url,!1,{imageAltText:In.defaultAltTextForImageURL(this.#t.args.data.url),precomputedFeatures:void 0,align:"start"});this.#n.set(this.#t,t)}const e=this.#n.get(this.#t);return e?this.#o(Ne(Ie.preview),e):null}async#m(){if(!this.#t)return;const e=this.#t.args.data,t=Hi`
      ${this.#a()}
      ${this.#l()}
      <div class="network-request-details-cols">
        <div class="network-request-details-col">
          ${this.#o(Ne(Ie.requestMethod),e.requestMethod)}
          ${this.#o(Ne(Ie.priority),Mi.renderPriorityValue(this.#t))}
          ${this.#o(Ne(Ie.mimeType),e.mimeType)}
          ${this.#h()}
          ${this.#o(Ne(Ie.decodedBody),Ke(this.#t.args.data.decodedBodyLength))}
          ${this.#u()}
          ${this.#p()}
        </div>
        <div class="network-request-details-col">
          <div class="timing-rows">
            ${Mi.renderTimings(this.#t)}
          </div>
        </div>
      </div>
      ${this.#d()}
      ${await this.#c()}
    `;q(t,this.#e,{host:this})}}customElements.define("devtools-performance-network-request-details",Zl);const Ql=new CSSStyleSheet;Ql.replaceSync(`/*
 * Copyright 2024 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

:host {
  display: block;
  padding: var(--sys-size-4);
}

ul {
  list-style: none;
  margin: 0;
  padding: 0;
  display: flex;
  flex-wrap: wrap;
  gap: var(--sys-size-5);
  justify-content: flex-start;
  align-items: center;
}

.insight-chip button {
  background: none;
  user-select: none;
  font: var(--sys-typescale-body4-regular);
  border: var(--sys-size-1) solid var(--sys-color-primary);
  border-radius: var(--sys-shape-corner-extra-small);
  display: flex;
  margin-top: var(--sys-size-4);
  padding: var(--sys-size-2) var(--sys-size-4) var(--sys-size-2) var(--sys-size-4);
  width: max-content;
  white-space: pre;

  .keyword {
    color: var(--sys-color-primary);
    padding-right: var(--sys-size-3);
  }
}

.insight-chip button:hover {
  background-color: var(--sys-color-state-hover-on-subtle);
  cursor: pointer;
  transition: opacity 0.2s ease;
}

/*# sourceURL=relatedInsightChips.css */
`);const{html:xr}=K,ec={insightKeyword:"Insight"},Am=A("panels/timeline/components/RelatedInsightChips.ts",ec),Nm=N.bind(void 0,Am);class tc extends HTMLElement{#e=this.attachShadow({mode:"open"});#t=this.#s.bind(this);#i={eventToRelatedInsightsMap:new Map,activeEvent:null};connectedCallback(){this.#e.adoptedStyleSheets=[Ql],this.#s()}set activeEvent(e){e!==this.#i.activeEvent&&(this.#i.activeEvent=e,D(this,this.#t))}set eventToRelatedInsightsMap(e){this.#i.eventToRelatedInsightsMap=e,D(this,this.#t)}#n(e){return t=>{t.preventDefault(),e.activateInsight()}}#s(){const{activeEvent:e,eventToRelatedInsightsMap:t}=this.#i,i=e?t.get(e)??[]:[];if(!e||t.size===0||i.length===0){q(xr``,this.#e,{host:this});return}const n=i.map(s=>xr`
      <li class="insight-chip">
        <button type="button" @click=${this.#n(s)}>
          <span class="keyword">${Nm(ec.insightKeyword)}</span>
          <span class="insight-label">${s.insightLabel}</span>
        </button>
      </li>
      `);q(xr`<ul>${n}</ul>`,this.#e,{host:this})}}customElements.define("devtools-related-insight-chips",tc);const ic=new CSSStyleSheet;ic.replaceSync(`/*
 * Copyright 2024 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

:host {
  display: block;
  height: 100%;
}

.annotations {
  display: flex;
  flex-direction: column;
  height: 100%;
  padding: 0;
}

.visibility-setting {
  margin-top: auto;
}

.annotation-container {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0 10px;

  .delete-button {
    visibility: hidden;
    border: none;
    background: none;
  }

  &:hover,
  &:focus-within {
    background-color: var(--sys-color-neutral-container);

    button.delete-button {
      visibility: visible;
    }
  }
}

.annotation {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  word-break: break-word;
  padding: var(--sys-size-8) 0;
  gap: 6px;
}

.annotation-identifier {
  padding: 4px 8px;
  border-radius: 10px;
  font-weight: bold;

  &.time-range {
    background-color: var(--app-color-performance-sidebar-time-range);
    color: var(--app-color-performance-sidebar-label-text-light);
  }
}

.entries-link {
  display: flex;
  flex-wrap: wrap;
  row-gap: 2px;
  align-items: center;
}

.label {
  font-size: larger;
}

.annotation-tutorial-container {
  padding: 10px;
}

.tutorial-card {
  display: block;
  position: relative;
  margin: 10px 0;
  padding: 10px;
  border-radius: var(--sys-shape-corner-extra-small);
  overflow: hidden;
  border: 1px solid var(--sys-color-divider);
  background-color: var(--sys-color-base);
}

.tutorial-image {
  display: flex;
  justify-content: center;

  & > img {
    max-width: 100%;
    height: auto;
  }
}

.tutorial-title,
.tutorial-description {
  margin: 5px 0;
}

/*# sourceURL=sidebarAnnotationsTab.css */
`);const{html:ei}=K,Fm=new URL("data:image/svg+xml,%3csvg%20width='186'%20height='50'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill='%23FACC15'%20d='M.5%200h81v16H.5zM82.5%200h42v16h-42z'/%3e%3cpath%20fill='%23D190FF'%20d='M42.5%2017h10v16h-10zM53.5%2017h84v16h-84zM138.5%2017h39v16h-39z'/%3e%3cpath%20fill='%2337BE5F'%20d='M56.5%2034h74v16h-74zM131.5%2034h54v16h-54z'/%3e%3cpath%20stroke='%231F1F1F'%20stroke-width='2'%20d='M1.5%201h79v14h-79zM132.5%2035h52v14h-52z'/%3e%3cg%20filter='url(%23a)'%3e%3cpath%20d='m78.726%206.956%2049.482%2032.134'%20stroke='%231F1F1F'%20stroke-width='2'%20stroke-linecap='round'/%3e%3ccircle%20cx='80.403'%20cy='8.045'%20r='2'%20transform='rotate(33%2080.403%208.045)'%20fill='%23fff'%20stroke='%231F1F1F'%20stroke-width='2'/%3e%3ccircle%20cx='132.401'%20cy='41.813'%20r='2'%20transform='rotate(33%20132.401%2041.813)'%20fill='%23fff'%20stroke='%231F1F1F'%20stroke-width='2'/%3e%3cpath%20d='M129.239%2040.749a1%201%200%200%200%20.904-1.391l-2.93-6.89a1%201%200%200%200-1.759-.154l-4.557%207.016a1%201%200%200%200%20.856%201.545l7.486-.126Z'%20fill='%231F1F1F'/%3e%3c/g%3e%3cdefs%3e%3cfilter%20id='a'%20x='70.075'%20y='-2.459'%20width='69.326'%20height='54.274'%20filterUnits='userSpaceOnUse'%20color-interpolation-filters='sRGB'%3e%3cfeFlood%20flood-opacity='0'%20result='BackgroundImageFix'/%3e%3cfeColorMatrix%20in='SourceAlpha'%20values='0%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%20127%200'%20result='hardAlpha'/%3e%3cfeMorphology%20radius='1'%20operator='dilate'%20in='SourceAlpha'%20result='effect1_dropShadow_4690_314721'/%3e%3cfeOffset%20dy='1'/%3e%3cfeGaussianBlur%20stdDeviation='1.5'/%3e%3cfeColorMatrix%20values='0%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200.15%200'/%3e%3cfeBlend%20in2='BackgroundImageFix'%20result='effect1_dropShadow_4690_314721'/%3e%3cfeColorMatrix%20in='SourceAlpha'%20values='0%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%20127%200'%20result='hardAlpha'/%3e%3cfeOffset%20dy='1'/%3e%3cfeGaussianBlur%20stdDeviation='1'/%3e%3cfeColorMatrix%20values='0%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200%200.3%200'/%3e%3cfeBlend%20in2='effect1_dropShadow_4690_314721'%20result='effect2_dropShadow_4690_314721'/%3e%3cfeBlend%20in='SourceGraphic'%20in2='effect2_dropShadow_4690_314721'%20result='shape'/%3e%3c/filter%3e%3c/defs%3e%3c/svg%3e",import.meta.url).toString(),Mm=new URL("/assets/performance-panel-entry-label-DkMZHOBe.svg",import.meta.url).toString(),Dm=new URL("data:image/svg+xml,%3csvg%20width='160'%20height='66'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cmask%20id='b'%20fill='%23fff'%3e%3cpath%20d='M0%200h160v66H0V0Z'/%3e%3c/mask%3e%3cpath%20d='M0%200h160v66H0V0Z'%20fill='url(%23a)'%20fill-opacity='.15'/%3e%3cpath%20d='M160%2066v4h1v-4h-1ZM0%2066h-1v4h1v-4ZM159%200v66h2V0h-2Zm1%2062H0v8h160v-8ZM1%2066V0h-2v66h2Z'%20fill='%23FF4896'%20mask='url(%23b)'/%3e%3cpath%20d='M69.042%2033.667V35H62.89v-9.864h1.53v8.531h4.622Zm3.828%201.456c-1.435%200-2.481-.861-2.481-2.215%200-1.333.998-2.105%202.768-2.215l2.017-.123v-.65c0-.813-.52-1.27-1.525-1.27-.82%200-1.387.307-1.551.847h-1.422c.15-1.25%201.353-2.064%203.042-2.064%201.866%200%202.919.93%202.919%202.488V35h-1.415v-1.053h-.116c-.445.752-1.258%201.176-2.236%201.176Zm.376-1.183c1.108%200%201.928-.724%201.928-1.681v-.643l-1.819.123c-1.025.069-1.49.43-1.49%201.108%200%20.69.581%201.093%201.381%201.093Zm9.427%201.183c-1.04%200-1.907-.478-2.352-1.299h-.11V35h-1.414V24.664h1.47v4.088h.116c.396-.807%201.271-1.306%202.29-1.306%201.887%200%203.076%201.484%203.076%203.842%200%202.338-1.196%203.835-3.076%203.835Zm-.424-6.419c-1.23%200-2.003.991-2.01%202.584.007%201.593.773%202.577%202.01%202.577%201.244%200%201.99-.97%201.99-2.577%200-1.606-.746-2.584-1.99-2.584ZM92.4%2033.011h1.415c-.32%201.312-1.524%202.133-3.226%202.133-2.133%200-3.439-1.47-3.439-3.842%200-2.359%201.333-3.87%203.432-3.87%202.071%200%203.322%201.416%203.322%203.74v.506h-5.257v.068c.048%201.347.807%202.194%201.983%202.194.889%200%201.497-.328%201.77-.93Zm-1.825-4.382c-1.087%200-1.846.793-1.928%201.99h3.76c-.034-1.204-.745-1.99-1.832-1.99ZM95.736%2035V24.664h1.47V35h-1.47ZM70.805%2054v-1.682H66.68v-1.113a115.448%20115.448%200%200%201%203.521-5.66h1.87v5.66h1.165v1.113H72.07V54h-1.265Zm-2.866-2.853v.081h2.883v-4.576h-.076a96.596%2096.596%200%200%200-2.806%204.495Zm7.536%202.94a.837.837%200%200%201-.862-.843c0-.474.37-.844.862-.844.498%200%20.86.37.86.844%200%20.475-.362.844-.86.844Zm2.537-6.093c0-1.553%201.2-2.654%202.906-2.654%201.588%200%202.73%201.013%202.73%202.402%200%20.979-.427%201.676-1.91%203.164l-1.863%201.875v.1h3.902V54h-5.695v-.89l2.895-3.012c1.072-1.12%201.353-1.541%201.353-2.227%200-.82-.557-1.447-1.494-1.447-.955%200-1.582.633-1.582%201.57h-1.242Zm10.441%206.211c-1.681%200-2.865-1.025-2.947-2.496h1.254c.093.844.78%201.4%201.699%201.4%201.025%200%201.717-.738%201.717-1.84%200-1.066-.686-1.78-1.682-1.78-.75%200-1.342.35-1.652.937H85.64l.474-4.881h4.904v1.113h-3.884l-.246%202.596h.1c.386-.522%201.013-.797%201.868-.797%201.43%200%202.602%201.102%202.602%202.79%200%201.757-1.213%202.958-3.006%202.958Zm7.799-4.787c0-1.108%201.037-1.904%202.479-1.904%201.435%200%202.373.668%202.496%201.77h-1.207c-.118-.475-.575-.786-1.29-.786-.703%200-1.236.346-1.236.861%200%20.393.322.639%201.014.803l1.06.246c1.213.282%201.782.803%201.782%201.729%200%201.183-1.12%201.986-2.643%201.986-1.517%200-2.508-.685-2.62-1.793h1.26c.159.498.628.809%201.39.809.785%200%201.341-.364%201.341-.885%200-.398-.299-.656-.937-.809l-1.114-.263c-1.213-.282-1.775-.82-1.775-1.764Z'%20fill='%23B90063'/%3e%3cdefs%3e%3clinearGradient%20id='a'%20x1='80'%20y1='0'%20x2='80'%20y2='66'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20stop-color='%23FF7DD2'%20stop-opacity='0'/%3e%3cstop%20offset='.85'%20stop-color='%23FF7DD2'/%3e%3c/linearGradient%3e%3c/defs%3e%3c/svg%3e",import.meta.url).toString(),$m=new URL("/assets/performance-panel-delete-annotation-ug2X6gH4.svg",import.meta.url).toString(),qe={annotationGetStarted:"Annotate a trace for yourself and others",entryLabelTutorialTitle:"Label an item",entryLabelTutorialDescription:"Double-click on an item and type to create an item label.",entryLinkTutorialTitle:"Connect two items",entryLinkTutorialDescription:"Double-click on an item, click on the adjacent rightward arrow, then select the destination item.",timeRangeTutorialTitle:"Define a time range",timeRangeTutorialDescription:"Shift-drag in the flamechart then type to create a time range annotation.",deleteAnnotationTutorialTitle:"Delete an annotation",deleteAnnotationTutorialDescription:"Hover over the list in the sidebar with Annotations tab selected to access the delete function.",deleteButton:"Delete annotation: {PH1}",entryLabelDescriptionLabel:'A "{PH1}" event annotated with the text "{PH2}"',timeRangeDescriptionLabel:"A time range starting at {PH1} and ending at {PH2}",entryLinkDescriptionLabel:'A link between a "{PH1}" event and a "{PH2}" event'},Bm=A("panels/timeline/components/SidebarAnnotationsTab.ts",qe),Qe=N.bind(void 0,Bm);class nc extends HTMLElement{#e=this.attachShadow({mode:"open"});#t=this.#c.bind(this);#i=[];#n=new Map;#s;constructor(){super(),this.#s=Te.instance().moduleSetting("annotations-hidden")}set annotations(e){this.#i=this.#r(e),D(this,this.#t)}set annotationEntryToColorMap(e){this.#n=e}#r(e){const t=new Set,i=e.filter(n=>{if(this.#o(n))return!0;if(n.type==="ENTRIES_LINK"||n.type==="ENTRY_LABEL"){const s=n.type==="ENTRIES_LINK"?n.entryFrom:n.entry;if(t.has(s))return!1;t.add(s)}return!0});return i.sort((n,s)=>this.#a(n)-this.#a(s)),i}#a(e){switch(e.type){case"ENTRY_LABEL":return e.entry.ts;case"ENTRIES_LINK":return e.entryFrom.ts;case"TIME_RANGE":return e.bounds.min;default:ke(e,`Invalid annotation type ${e}`)}}#o(e){switch(e.type){case"ENTRY_LABEL":return e.label.length>0;case"ENTRIES_LINK":return!!e.entryTo;case"TIME_RANGE":return e.bounds.range>0}}connectedCallback(){this.#e.adoptedStyleSheets=[ic],D(this,this.#t)}#l(e){if(e.entryTo){const t=Ge(e.entryTo),i=this.#n.get(e.entryTo)??"",n=Ir(i);return ei`
        <span class="annotation-identifier" style=${Pi({backgroundColor:i,color:n})}>
          ${t}
        </span>`}return V}#p(e){switch(e.type){case"ENTRY_LABEL":{const t=Ge(e.entry),i=this.#n.get(e.entry)??"",n=Ir(i);return ei`
              <span class="annotation-identifier" style=${Pi({backgroundColor:i,color:n})}>
                ${t}
              </span>
        `}case"TIME_RANGE":{const t=ae.instance().state()?.milli.entireTraceBounds.min??0,i=Math.round($(e.bounds.min)-t),n=Math.round($(e.bounds.max)-t);return ei`
              <span class="annotation-identifier time-range">
                ${i} - ${n} ms
              </span>
        `}case"ENTRIES_LINK":{const t=Ge(e.entryFrom),i=this.#n.get(e.entryFrom)??"",n=Ir(i);return ei`
          <div class="entries-link">
            <span class="annotation-identifier" style=${Pi({backgroundColor:i,color:n})}>
              ${t}
            </span>
            <devtools-icon class="inline-icon" .data=${{iconName:"arrow-forward",color:"var(--icon-default)",width:"18px",height:"18px"}}>
            </devtools-icon>
            ${this.#l(e)}
          </div>
      `}default:ke(e,"Unsupported annotation type")}}#h(e){this.dispatchEvent(new ir(e))}#d(){return ei`
      <div class="annotation-tutorial-container">
      ${Qe(qe.annotationGetStarted)}
        <div class="tutorial-card">
          <div class="tutorial-image"> <img src=${Mm}></img></div>
          <div class="tutorial-title">${Qe(qe.entryLabelTutorialTitle)}</div>
          <div class="tutorial-description">${Qe(qe.entryLabelTutorialDescription)}</div>
        </div>
        <div class="tutorial-card">
          <div class="tutorial-image"> <img src=${Fm}></img></div>
          <div class="tutorial-title">${Qe(qe.entryLinkTutorialTitle)}</div>
          <div class="tutorial-description">${Qe(qe.entryLinkTutorialDescription)}</div>
        </div>
        <div class="tutorial-card">
          <div class="tutorial-image"> <img src=${Dm}></img></div>
          <div class="tutorial-title">${Qe(qe.timeRangeTutorialTitle)}</div>
          <div class="tutorial-description">${Qe(qe.timeRangeTutorialDescription)}</div>
        </div>
        <div class="tutorial-card">
          <div class="tutorial-image"> <img src=${$m}></img></div>
          <div class="tutorial-title">${Qe(qe.deleteAnnotationTutorialTitle)}</div>
          <div class="tutorial-description">${Qe(qe.deleteAnnotationTutorialDescription)}</div>
        </div>
      </div>
    `}#u(e){switch(e.type){case"ENTRY_LABEL":return"entry-label";case"TIME_RANGE":return"time-range";case"ENTRIES_LINK":return"entries-link";default:ke(e,"unknown annotation type")}}#c(){q(ei`
        <span class="annotations">
          ${this.#i.length===0?this.#d():ei`
              ${this.#i.map(e=>{const t=Om(e);return ei`
                  <div class="annotation-container"
                    @click=${()=>this.#h(e)}
                    aria-label=${t}
                    tabindex="0"
                    jslog=${Gn(`timeline.annotation-sidebar.annotation-${this.#u(e)}`).track({click:!0})}
                  >
                    <div class="annotation">
                      ${this.#p(e)}
                      <span class="label">
                        ${e.type==="ENTRY_LABEL"||e.type==="TIME_RANGE"?e.label:""}
                      </span>
                    </div>
                    <button class="delete-button" aria-label=${Qe(qe.deleteButton,{PH1:t})} @click=${i=>{i.stopPropagation(),this.dispatchEvent(new tr(e))}} jslog=${bt("timeline.annotation-sidebar.delete").track({click:!0})}>
                      <devtools-icon
                        class="bin-icon"
                        .data=${{iconName:"bin",color:"var(--icon-default)",width:"20px",height:"20px"}}
                      ></devtools-icon>
                    </button>
                  </div>`})}
              <setting-checkbox class="visibility-setting" .data=${{setting:this.#s,textOverride:"Hide annotations"}}>
              </setting-checkbox>`}
      </span>`,this.#e,{host:this})}}customElements.define("devtools-performance-sidebar-annotations",nc);function Om(a){switch(a.type){case"ENTRY_LABEL":{const e=Ge(a.entry);return Qe(qe.entryLabelDescriptionLabel,{PH1:e,PH2:a.label})}case"TIME_RANGE":{const e=_a(a.bounds.min),t=_a(a.bounds.max);return Qe(qe.timeRangeDescriptionLabel,{PH1:e,PH2:t})}case"ENTRIES_LINK":{if(!a.entryTo)return"";const e=Ge(a.entryFrom),t=Ge(a.entryTo);return Qe(qe.entryLinkDescriptionLabel,{PH1:e,PH2:t})}default:ke(a,"Unsupported annotation")}}function Ir(a){const e=Cs(a)?.asLegacyColor(),t="--app-color-performance-sidebar-label-text-dark",i=Cs(ie.instance().getComputedValue(t))?.asLegacyColor();return!e||!i?`var(${t})`:ih(e.rgba(),i.rgba())>=4.5?`var(${t})`:"var(--app-color-performance-sidebar-label-text-light)"}const sc=new CSSStyleSheet;sc.replaceSync(`/*
 * Copyright 2024 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

:host {
  display: block;
  padding: 5px 10px;
}

.metrics-row {
  display: flex;
  flex-direction: row;
}

.metric {
  flex: 1;
  user-select: text;
  cursor: pointer;
  /* metric container is a button for a11y reasons, so remove default styles
   * */
  background: none;
  border: none;
  padding: 0;
  display: block;
  text-align: left;
}

.metric-value {
  font-size: var(--sys-size-11);
}

.metric-value-bad {
  color: var(--app-color-performance-bad);
}

.metric-value-ok {
  color: var(--app-color-performance-ok);
}

.metric-value-good {
  color: var(--app-color-performance-good);
}

.metric-score-unclassified {
  color: var(--sys-color-token-subtle);
}

.metric-label {
  font: var(--sys-typescale-body4-medium);
}

.number-with-unit {
  white-space: nowrap;

  .unit {
    font-size: 14px;
    padding: 0 1px;
  }
}

/*# sourceURL=sidebarSingleInsightSet.css */
`);const{html:_i}=K,rc={metricScore:"{PH1}: {PH2} {PH3} score"},Hm=A("panels/timeline/components/SidebarSingleInsightSet.ts",rc),_m=N.bind(void 0,Hm),Wm=new Set([wa]),vo=[Nl,Dl,Ml,Ll,$l,Rl,wa,_l,Hl,Ol];class Vm extends HTMLElement{#e=this.attachShadow({mode:"open"});#t=this.#u.bind(this);#i={parsedTrace:null,insights:null,insightSetKey:null,activeCategory:Be.ALL,activeInsight:null};set data(e){this.#i=e,D(this,this.#t)}connectedCallback(){this.#e.adoptedStyleSheets=[sc],this.#u()}#n(e){return this.#i.activeCategory===Be.ALL?!0:e===this.#i.activeCategory}#s(e){this.dispatchEvent(new ui(e))}#r(e,t,i,n){const s=typeof t=="string"?t:t.text,r=typeof t=="string"?t:t.element,o=_m(rc.metricScore,{PH1:e,PH2:s,PH3:i});return this.#n(e)?_i`
      <button class="metric"
        @click=${n?this.#s.bind(this,n):null}
        title=${o}
        aria-label=${o}
      >
        <div class="metric-value metric-value-${i}">${r}</div>
        <div class="metric-label">${e}</div>
      </button>
    `:V}#a(e){const t=oe("InteractionToNextPaint",this.#i.insights,e);return t?.longestInteractionEvent?.dur?{value:t.longestInteractionEvent.dur,event:t.longestInteractionEvent}:null}#o(e){const t=oe("LargestContentfulPaint",this.#i.insights,e);return!t||!t.lcpMs||!t.lcpEvent?null:{value:ee(t.lcpMs),event:t.lcpEvent}}#l(e){const t=oe("CumulativeLayoutShift",this.#i.insights,e);if(!t)return{value:0,worstShiftEvent:null};let i=0,n;for(const s of t.clusters)s.clusterCumulativeScore>i&&(i=s.clusterCumulativeScore,n=s);return{value:i,worstShiftEvent:n?.worstShiftEvent??null}}#p(e){const t=this.#o(e),i=this.#l(e),n=this.#a(e);return _i`
    <div class="metrics-row">
    ${t?this.#r("LCP",Ds.formatMicroSecondsAsSeconds(t.value),Ou(t.value),t.event??null):V}
    ${n?this.#r("INP",Ds.formatMicroSecondsAsMillisFixed(n.value),Hu(n.value),n.event):V}
    ${this.#r("CLS",i.value?i.value.toFixed(2):"0",_u(i.value),i.worstShiftEvent)}
    </div>
    `}#h(){return ne.isEnabled("timeline-experimental-insights")?vo:vo.filter(t=>!Wm.has(t))}#d(e,t,i){const n=this.#h();return _i`${n.map(s=>_i`<div data-single-insight-wrapper>
        <${s.litTagName}
          .insights=${e}
          .parsedTrace=${t}
          .insightSetKey=${i}
          .activeInsight=${this.#i.activeInsight}
          .activeCategory=${this.#i.activeCategory}>
        </${s.litTagName}>
      </div>`)}`}#u(){const{parsedTrace:e,insights:t,insightSetKey:i}=this.#i;if(!e||!t||!i){q(_i``,this.#e,{host:this});return}q(_i`
      <div class="navigation">
        ${this.#p(i)}
        ${this.#d(t,e,i)}
        </div>
      `,this.#e,{host:this})}}customElements.define("devtools-performance-sidebar-single-navigation",Vm);const ac=new CSSStyleSheet;ac.replaceSync(`/*
 * Copyright 2024 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

:host {
  display: flex;
  flex-flow: column nowrap;
  flex-grow: 1;
}

.insight-sets-wrapper {
  display: flex;
  flex-flow: column nowrap;
  flex-grow: 1; /* so it fills the available vertical height in the sidebar */

  details {
    flex-grow: 0;
  }

  details[open] {
    flex-grow: 1;
    border-bottom: 1px solid var(--sys-color-divider);
  }

  summary {
    background-color: var(--sys-color-surface2);
    border-bottom: 1px solid var(--sys-color-divider);
    overflow: hidden;
    padding: 2px 5px;
    text-overflow: ellipsis;
    white-space: nowrap;
    font: var(--sys-typescale-body4-medium);
    display: flex;
    align-items: center;

    &:focus {
      background-color: var(--sys-color-tonal-container);
    }

    &::marker {
      color: var(--sys-color-on-surface-subtle);
      font-size: 11px;
      line-height: 1;
    }

    /* make sure the first summary has a top border */
    details:first-child & {
      border-top: 1px solid var(--sys-color-divider);
    }
    }
  }

.zoom-button {
  margin-left: auto;
}

.zoom-icon {
  visibility: hidden;

  &.active devtools-button {
    visibility: visible;
  }
}

.dropdown-icon {
  &.active devtools-button {
    transform: rotate(90deg);
  }
}

.feedback-wrapper {
  position: relative;
  padding: var(--sys-size-6);

  .tooltip {
    visibility: hidden;
    transition-property: visibility;
    position: absolute;
    bottom: 35px; /* height of button + a little extra padding */
    width: 90%;
    max-width: 300px;
    left: var(--sys-size-6);
    z-index: 1;
    box-sizing: border-box;
    padding: var(--sys-size-5) var(--sys-size-6);
    border-radius: var(--sys-shape-corner-small);
    background-color: var(--sys-color-cdt-base-container);
    box-shadow: var(--drop-shadow-depth-3);
  }

  devtools-button:hover + .tooltip {
    visibility: visible;
  }
}

/*# sourceURL=sidebarInsightsTab.css */
`);const{html:hn}=K,Um="https://crbug.com/371170842",Kr={feedbackButton:"Feedback",feedbackTooltip:"Insights is an experimental feature. Your feedback will help us improve it."},zm=A("panels/timeline/components/SidebarInsightsTab.ts",Kr),yo=N.bind(void 0,zm);class oc extends HTMLElement{#e=this.#m.bind(this);#t=this.attachShadow({mode:"open"});#i=null;#n=null;#s=null;#r=Be.ALL;#a=null;connectedCallback(){this.#t.adoptedStyleSheets=[ac]}set parsedTrace(e){e!==this.#i&&(this.#i=e,this.#a=null,D(this,this.#e))}set insights(e){if(e===this.#n||(this.#n=e,this.#a=null,!this.#n||!this.#i))return;const t=ee(se(5e3)),i=[...this.#n.values()];this.#a=i.find(n=>n.navigation||n.bounds.range>t)?.id??i[0]?.id??null,D(this,this.#e)}set activeInsight(e){e!==this.#s&&(this.#s=e,this.#s&&(this.#a=this.#s.insightSetKey),D(this,this.#e))}#o(e){this.#a=this.#a===e?null:e,this.#a!==this.#s?.insightSetKey&&this.dispatchEvent(new Kn),D(this,this.#e)}#l(e){const t=this.#n?.get(e);t&&this.dispatchEvent(new Hn(t.bounds))}#p(){this.dispatchEvent(new Hn)}#h(){nh.openInNewTab(Um)}#d(e,t){e.stopPropagation();const i=this.#n?.get(t);i&&this.dispatchEvent(new Zs(i.bounds))}#u(e){const t=Nn({"zoom-icon":!0,active:e});return hn`
    <div class=${t}>
        <devtools-button .data=${{variant:"icon",iconName:"center-focus-weak",size:"SMALL"}}
      ></devtools-button></div>`}#c(e){const t=Nn({"dropdown-icon":!0,active:e});return hn`
      <div class=${t}>
        <devtools-button .data=${{variant:"icon",iconName:"chevron-right",size:"SMALL"}}
      ></devtools-button></div>
    `}#m(){if(!this.#i||!this.#n){q(V,this.#t,{host:this});return}const e=this.#n.size>1,t=dl([...this.#n.values()].map(({url:s})=>s)),i=hn`
      <div class="insight-sets-wrapper">
        ${[...this.#n.values()].map(({id:s,url:r},o)=>{const l={parsedTrace:this.#i,insights:this.#n,insightSetKey:s,activeCategory:this.#r,activeInsight:this.#s},d=hn`
            <devtools-performance-sidebar-single-navigation
              .data=${l}>
            </devtools-performance-sidebar-single-navigation>
          `;return e?hn`<details
              ?open=${s===this.#a}
            >
              <summary
                @click=${()=>this.#o(s)}
                @mouseenter=${()=>this.#l(s)}
                @mouseleave=${()=>this.#p()}
                title=${r.href}>
                ${this.#c(s===this.#a)}
                <span>${t[o]}</span>
                <span class='zoom-button' @click=${c=>this.#d(c,s)}>${this.#u(s===this.#a)}</span>
              </summary>
              ${d}
            </details>`:d})}
      </div>

      <div class="feedback-wrapper">
        <devtools-button .variant=${"outlined"} .iconName=${"experiment"} @click=${this.#h}>
          ${yo(Kr.feedbackButton)}
        </devtools-button>

        <p class="tooltip">${yo(Kr.feedbackTooltip)}</p>
      </div>
    `,n=sh([i],()=>this.#i,s=>s);q(n,this.#t,{host:this})}}customElements.define("devtools-performance-sidebar-insights",oc);class tr extends Event{removedAnnotation;static eventName="removeannotation";constructor(e){super(tr.eventName,{bubbles:!0,composed:!0}),this.removedAnnotation=e}}class ir extends Event{annotation;static eventName="revealannotation";constructor(e){super(ir.eventName,{bubbles:!0,composed:!0}),this.annotation=e}}const Gm=240,jm=170;class qm extends xe{#e=new oa;#t=new Km;#i=new Ym;#n=0;#s=Te.instance().createSetting("timeline-user-has-opened-sidebar-once",!1);userHasOpenedSidebarOnce(){return this.#s.get()}constructor(){super(),this.setMinimumSize(jm,0),ne.isEnabled("timeline-rpp-sidebar")&&this.#e.appendTab("insights","Insights",this.#t,void 0,void 0,!1,!1,0,"timeline.insights-tab"),ne.isEnabled("perf-panel-annotations")&&this.#e.appendTab("annotations","Annotations",this.#i,void 0,void 0,!1,!1,1,"timeline.annotations-tab"),this.#e.selectTab("insights")}wasShown(){this.#s.set(!0),this.#e.show(this.element),this.#r(),this.#e.selectedTabId==="insights"&&this.#e.tabIsDisabled("insights")&&this.#e.hasTab("annotations")&&this.#e.selectTab("annotations")}setAnnotations(e,t){this.#i.setAnnotations(e,t),this.#n=e.length,this.#r()}#r(){let e=null;if(this.#n>0){e=new Do;const t=document.createElement("span");t.textContent=this.#n.toString(),e.data={name:"countWrapper",content:t},e.classList.add("annotations-count")}this.#e.setSuffixElement("annotations",e)}setParsedTrace(e){this.#t.setParsedTrace(e)}setInsights(e){this.#t.setInsights(e),this.#e.setTabEnabled("insights",e!==null)}setActiveInsight(e){this.#t.setActiveInsight(e),e&&this.#e.selectTab("insights")}}class Km extends xe{#e=new oc;constructor(){super(),this.element.classList.add("sidebar-insights"),this.element.appendChild(this.#e)}setParsedTrace(e){this.#e.parsedTrace=e}setInsights(e){this.#e.insights=e}setActiveInsight(e){this.#e.activeInsight=e}}class Ym extends xe{#e=new nc;constructor(){super(),this.element.classList.add("sidebar-annotations"),this.element.appendChild(this.#e)}setAnnotations(e,t){this.#e.annotationEntryToColorMap=t,this.#e.annotations=e}}const Lt={srEnterLabelEditMode:"Editing the annotation label text",srLabelTextUpdated:"Label updated to {PH1}",srTimeRangeBoundsUpdated:"Time range updated, starting at {PH1} and ending at {PH2}",timeRange:"time range",entryLabel:"entry label",entriesLink:"connected entries",srAnnotationRemoved:"The {PH1} annotation has been removed",srAnnotationAdded:"The {PH1} annotation has been added",srEntriesLinked:"The connected entries annotation now links from {PH1} to {PH2}"},Xm=A("panels/timeline/AnnotationHelpers.ts",Lt),Gt=N.bind(void 0,Xm);function lc(a){const e=[];switch(a.type){case"ENTRY_LABEL":e.push(a.entry);break;case"TIME_RANGE":break;case"ENTRIES_LINK":e.push(a.entryFrom),a.entryTo&&e.push(a.entryTo);break;default:ke(a,"Unsupported annotation type")}return e}function cc(a){let e=null;const t=se(1);switch(a.type){case"ENTRY_LABEL":{const i=a.entry.dur??ee(t);e=Pe(a.entry.ts,_(a.entry.ts+i));break}case"TIME_RANGE":{e=a.bounds;break}case"ENTRIES_LINK":{if(!a.entryTo)break;const i=a.entryFrom.dur??t,n=a.entryTo.dur??t,s=a.entryFrom.ts+i,r=a.entryTo.ts+n,o=Math.max(s,r);e=Pe(a.entryFrom.ts,_(o));break}default:ke(a,"Unsupported annotation type")}return e}function Yn(a){return a.type==="TIME_RANGE"}function Xn(a){return a.type==="ENTRIES_LINK"}function nr(a){return a.type==="ENTRY_LABEL"}function Jm(a){return Yn(a)||nr(a)?a.label:null}function Yr(a){return Yn(a)?Gt(Lt.timeRange):Xn(a)?Gt(Lt.entriesLink):nr(a)?Gt(Lt.entryLabel):null}function dc(a){const{overlay:e,action:t}=a;switch(t){case"Remove":{const i=Yr(e);if(i)return Gt(Lt.srAnnotationRemoved,{PH1:i});break}case"Add":{const i=Yr(e);if(i)return Gt(Lt.srAnnotationAdded,{PH1:i});break}case"UpdateLabel":{const i=Jm(e);if(i)return Gt(Lt.srLabelTextUpdated,{PH1:i});break}case"UpdateTimeRange":{if(e.type!=="TIME_RANGE")return"";const i=ae.instance().state()?.micro.entireTraceBounds;if(!i)return"";const{min:n,max:s}=e.bounds,r=Bt(_(n-i.min)),o=Bt(_(s-i.min));return Gt(Lt.srTimeRangeBoundsUpdated,{PH1:r,PH2:o})}case"UpdateLinkToEntry":{if(Xn(e)&&e.entryFrom&&e.entryTo){const i=Ge(e.entryFrom),n=Ge(e.entryTo);return Gt(Lt.srEntriesLinked,{PH1:i,PH2:n})}break}case"EnterLabelEditState":return Gt(Lt.srEnterLabelEditMode);default:ke(t,"Unsupported action for AnnotationModifiedEvent")}return null}const Mf=Object.freeze(Object.defineProperty({__proto__:null,ariaAnnouncementForModifiedEvent:dc,ariaDescriptionForOverlay:Yr,getAnnotationEntries:lc,getAnnotationWindow:cc,isEntriesLink:Xn,isEntryLabel:nr,isTimeRangeLabel:Yn},Symbol.toStringTag,{value:"Module"}));class sr extends Event{duration;static eventName="traceload";constructor(e){super(sr.eventName,{bubbles:!0,composed:!0}),this.duration=e}}const Df=Object.freeze(Object.defineProperty({__proto__:null,TraceLoadEvent:sr},Symbol.toStringTag,{value:"Module"}));class Xr{x;y;width;height;color;outlineColor;constructor([e,t,i,n]){this.x=e,this.y=t,this.width=i,this.height=n,this.color={r:238,g:111,b:99,a:.4},this.outlineColor={r:238,g:111,b:99,a:.7}}}let Pr;class Ca{static instance(e={forceNew:null}){const{forceNew:t}=e;return(!Pr||t)&&(Pr=new Ca),Pr}linkify(e,t){const i=document.createElement("span"),n=e,{x:s,y:r,width:o,height:l}=n;return i.textContent=`Location: [${s},${r}], Size: [${o}x${l}]`,i.addEventListener("mouseover",()=>Or.highlightRect(n)),i.addEventListener("mouseleave",()=>Or.clearHighlight()),i}}const $f=Object.freeze(Object.defineProperty({__proto__:null,CLSRect:Xr,Linkifier:Ca},Symbol.toStringTag,{value:"Module"}));let ls=null;class nn{static instance(e={forceNew:null}){const t=!!e.forceNew;return(!ls||t)&&(ls=new nn),ls}static removeInstance(){ls=null}#e=[];activeFilters(){return this.#e}setFilters(e){this.#e=e}isVisible(e){return this.#e.every(t=>t.accept(e))}}const Zm=!1;let Lr=null;class Di{#e=new WeakSet;static instance(e={forceNew:!1}){return(!Lr||e.forceNew)&&(Lr=new Di),Lr}registerFreshRecording(e){this.#e.add(e)}recordingIsFresh(e){return this.#e.has(e)}}const Bf=Object.freeze(Object.defineProperty({__proto__:null,Tracker:Di},Symbol.toStringTag,{value:"Module"})),hc=new CSSStyleSheet;hc.replaceSync(`/*
 * Copyright 2017 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

.content {
  margin-left: 5px;
}

.history-dropdown-button {
  width: 160px;
  height: 26px;
  text-align: left;
  display: flex;
  border: 1px solid transparent;
}

.history-dropdown-button[disabled] {
  opacity: 50%;
  border: 1px solid transparent;
}

.history-dropdown-button > .content {
  padding-right: 5px;
  overflow: hidden;
  text-overflow: ellipsis;
  flex: 1 1;
  min-width: 35px;

  &::after {
    float: right;
    user-select: none;
    mask-image: var(--image-file-triangle-down);
    width: 14px;
    height: 14px;
    content: "";
    position: absolute;
    background-color: var(--icon-default);
    right: -3px;
  }
}

.history-dropdown-button:focus-visible::before {
  content: "";
  position: absolute;
  top: 2px;
  left: 0;
  right: 0;
  bottom: 2px;
  border-radius: 2px;
  background: var(--divider-line);
}

@media (forced-colors: active) {
  .history-dropdown-button[disabled] {
    opacity: 100%;
  }

  .history-dropdown-button > .content::after {
    background-color: ButtonText;
  }

  .history-dropdown-button[disabled] > .content::after {
    background-color: GrayText;
  }
}

/*# sourceURL=historyToolbarButton.css */
`);const En={empty:"(empty)",selectJavascriptVmInstance:"Select JavaScript VM instance"},Qm=A("panels/timeline/IsolateSelector.ts",En),cs=N.bind(void 0,Qm);class eg extends $o{menu;options;items;itemByIsolate=new Map;constructor(){const e=new Xu;super(e),this.menu=e,e.buttonTitle=cs(En.selectJavascriptVmInstance),e.showArrow=!0,e.style.whiteSpace="normal",e.addEventListener("selectmenuselected",this.#t.bind(this)),eo.instance().observeIsolates(this),Y.instance().addEventListener("NameChanged",this.targetChanged,this),Y.instance().addEventListener("InspectedURLChanged",this.targetChanged,this)}#e(e,t){const i=new Map;for(const n of e.models()){const s=n.target(),r=Y.instance().rootTarget()!==s?s.name():"",o=new qn(s.inspectedURL()),l=o.isValid?o.domain():"",d=s.decorateLabel(l&&r?`${l}: ${r}`:r||l||cs(En.empty));i.set(d,(i.get(d)||0)+1)}t.removeChildren();for(const[n,s]of i){const r=s>1?`${n} (${s})`:n,o=t.createChild("div");o.textContent=r}}#t(e){this.itemByIsolate.forEach((t,i)=>{if(t.selected=t.value===e.itemValue,t.selected){const n=t.textContent?.slice(0,29);this.menu.buttonTitle=n||cs(En.empty);const s=i.runtimeModel();Li.instance().setFlavor(xi,s&&s.target().model(xi))}})}isolateAdded(e){const t=new Ju;this.menu.appendChild(t),t.value=e.id(),this.itemByIsolate.set(e,t),this.#e(e,t)}isolateRemoved(e){const t=this.itemByIsolate.get(e);t&&(t.selected&&(this.menu.buttonTitle=cs(En.selectJavascriptVmInstance),Li.instance().setFlavor(xi,null)),this.menu.removeChild(t))}isolateChanged(e){const t=this.itemByIsolate.get(e);t&&this.#e(e,t)}targetChanged(e){const i=e.data.model(la);if(!i)return;const n=eo.instance().isolateByModel(i);n&&this.isolateChanged(n)}}class uc{#e;#t=[];#i=[];#n=new Map;constructor(e){this.#e=e}findPossibleActions(e){const t=this.#e.get(e);if(!t)return{MERGE_FUNCTION:!1,COLLAPSE_FUNCTION:!1,COLLAPSE_REPEATING_DESCENDANTS:!1,RESET_CHILDREN:!1,UNDO_ALL_ACTIONS:!1};const i=t.parent,n=this.#a(t).filter(l=>!this.#t.includes(l)),s=this.#o(t).filter(l=>!this.#t.includes(l)),r=this.#a(t).filter(l=>this.#t.includes(l));return{MERGE_FUNCTION:i!==null,COLLAPSE_FUNCTION:n.length>0,COLLAPSE_REPEATING_DESCENDANTS:s.length>0,RESET_CHILDREN:r.length>0,UNDO_ALL_ACTIONS:this.#t.length>0}}getTraceEntryTreeForAI(e){const t=this.#e.get(e);return t?Hr.fromSelectedEntryNode(t):null}findHiddenDescendantsAmount(e){const t=this.#e.get(e);return t?this.#a(t).filter(n=>this.invisibleEntries().includes(n)).length:0}invisibleEntries(){return this.#t}setHiddenAndExpandableEntries(e,t){this.#t.push(...e),this.#i.push(...t)}entryIsInvisible(e){return this.#t.includes(e)}expandableEntries(){return this.#i}applyFilterAction(e){const t=new Set;switch(e.type){case"MERGE_FUNCTION":{t.add(e.entry);const i=this.#e.get(e.entry)||null,n=i&&this.#r(i);n&&this.#s(n.entry);break}case"COLLAPSE_FUNCTION":{const i=this.#e.get(e.entry);if(!i)break;this.#a(i).forEach(s=>t.add(s)),this.#s(e.entry);break}case"COLLAPSE_REPEATING_DESCENDANTS":{const i=this.#e.get(e.entry);if(!i)break;this.#o(i).forEach(s=>t.add(s)),t.size>0&&this.#s(e.entry);break}case"UNDO_ALL_ACTIONS":{this.#t=[],this.#i=[];break}case"RESET_CHILDREN":{this.#l(e.entry);break}default:ke(e.type,`Unknown EntriesFilter action: ${e.type}`)}return this.#t.push(...t),this.#t}#s(e){this.#i.push(e);const t=this.#e.get(e);if(!t)return;const i=this.#a(t);i.length>0&&(this.#i=this.#i.filter(n=>!i.includes(n)))}firstVisibleParentEntryForEntry(e){const t=this.#e.get(e);if(!t)return null;const i=this.#r(t);return i?i.entry:null}#r(e){let t=e.parent;for(;t&&this.#t.includes(t.entry)||t&&!pr(t.entry);)t=t.parent;return t}#a(e){const t=this.#n.get(e);if(t)return t;const i=[],n=[...e.children];for(;n.length>0;){const s=n.shift();if(s){i.push(s.entry);const r=this.#n.get(s);r?i.push(...r):n.push(...s.children)}}return this.#n.set(e,i),i}#o(e){const t=[...e.children],i=[],n=We(e.entry);for(;t.length>0;){const s=t.shift();if(s){const r=We(s.entry);if(n&&r){const o=e.entry,l=s.entry;rh.framesAreEqual(o.callFrame,l.callFrame)&&i.push(s.entry)}else!n&&!r&&e.entry.name===s.entry.name&&i.push(s.entry);t.push(...s.children)}}return i}revealEntry(e){const t=this.#e.get(e);if(!t)return;let i=t;for(;i.parent&&!this.#i.includes(i.entry);)i=i.parent;this.#l(i.entry)}#l(e){const t=this.#e.get(e);if(!t)return;const i=this.#a(t);this.#t=this.#t.filter(n=>!i.includes(n)),this.#i=this.#i.filter(n=>!(i.includes(n)||n===e))}isEntryExpandable(e){return this.#i.includes(e)}}const Of=Object.freeze(Object.defineProperty({__proto__:null,EntriesFilter:uc},Symbol.toStringTag,{value:"Module"}));class Ii{#e=new Map;keyForEvent(e){if(We(e))return`p-${e.pid}-${e.tid}-${ah(e.sampleIndex)}-${e.nodeId}`;if(jn(e))return`l-${e.index}`;const t=ms.getActiveManager().getRawTraceEvents(),i=oh(e)?`s-${t.indexOf(e.rawSourceEvent)}`:`r-${t.indexOf(e)}`;return i.length<3?null:i}eventForKey(e,t){const i=mp(e);if(Ii.isProfileCallKey(i))return this.#t(i,t);if(Ii.isLegacyTimelineFrameKey(i)){const n=t.Frames.frames.at(i.rawIndex);if(!n)throw new Error(`Could not find frame with index ${i.rawIndex}`);return n}if(Ii.isSyntheticEventKey(i)){const s=ms.getActiveManager().getSyntheticTraces().at(i.rawIndex);if(!s)throw new Error(`Attempted to get a synthetic event from an unknown raw event index: ${i.rawIndex}`);return s}if(Ii.isRawEventKey(i))return ms.getActiveManager().getRawTraceEvents()[i.rawIndex];throw new Error(`Unknown trace event serializable key values: ${i.join("-")}`)}static isProfileCallKey(e){return e.type==="p"}static isLegacyTimelineFrameKey(e){return e.type==="l"}static isRawEventKey(e){return e.type==="r"}static isSyntheticEventKey(e){return e.type==="s"}#t(e,t){const i=this.#e.get(e);if(i)return i;const n=t.Renderer.processes.get(e.processID)?.threads.get(e.threadID)?.profileCalls;if(!n)throw new Error(`Unknown profile call serializable key: ${e}`);const s=n?.find(r=>r.sampleIndex===e.sampleIndex&&r.nodeId===e.protocol);if(!s)throw new Error(`Unknown profile call serializable key: ${JSON.stringify(e)}`);return this.#e.set(e,s),s}}const Hf=Object.freeze(Object.defineProperty({__proto__:null,EventsSerializer:Ii},Symbol.toStringTag,{value:"Module"})),un=[];let Wi;class Rt extends Event{overlay;action;static eventName="annotationmodifiedevent";constructor(e,t){super(Rt.eventName),this.overlay=e,this.action=t}}class H extends EventTarget{#e;#t;#i=null;#n;#s;#r;#a;static activeManager(){return Wi}static reset(){un.length=0,Wi=null}static initAndActivateModificationsManager(e,t){if(un[t]){if(Wi===un[t])return Wi;Wi=un[t],H.activeManager()?.applyModificationsIfPresent()}const i=e.parsedTrace(t);if(!i)throw new Error("ModificationsManager was initialized without a corresponding trace data");const n=i.Meta.traceBounds,s=e.rawTraceEvents(t);if(!s)throw new Error("ModificationsManager was initialized without a corresponding raw trace events array");const r=e.syntheticTraceEventsManager(t);if(!r)throw new Error("ModificationsManager was initialized without a corresponding SyntheticEventsManager");const o=e.metadata(t),l=new H({parsedTrace:i,traceBounds:n,rawTraceEvents:s,modifications:o?.modifications,syntheticEvents:r.getSyntheticTraces()});return un[t]=l,Wi=l,H.activeManager()?.applyModificationsIfPresent(),this.activeManager()}constructor({parsedTrace:e,traceBounds:t,modifications:i}){super();const n=new Map([...e.Samples.entryToNode,...e.Renderer.entryToNode]);this.#e=new uc(n),this.#t=new kp(t),this.#i=i||null,this.#n=e,this.#s=new Ii,this.#a=Te.instance().moduleSetting("annotations-hidden"),this.#r=new Map}getEntriesFilter(){return this.#e}getTimelineBreadcrumbs(){return this.#t}deleteEmptyRangeAnnotations(){for(const e of this.#r.keys())e.type==="TIME_RANGE"&&e.label.length===0&&this.removeAnnotation(e)}createAnnotation(e,t=!1){if(e.type==="ENTRY_LABEL"){const n=this.#o(e.entry);if(n){this.dispatchEvent(new Rt(n,"EnterLabelEditState"));return}}t||e.type!=="TIME_RANGE"&&this.#a.set(!1);const i=this.#l(e);this.#r.set(e,i),this.dispatchEvent(new Rt(i,"Add"))}annotationsForEntry(e){const t=[];for(const[i]of this.#r.entries())(i.type==="ENTRY_LABEL"&&i.entry===e||i.type==="ENTRIES_LINK"&&(i.entryFrom===e||i.entryTo===e))&&t.push(i);return t}deleteEntryAnnotations(e){this.annotationsForEntry(e).forEach(i=>{this.removeAnnotation(i)})}linkAnnotationBetweenEntriesExists(e,t){for(const i of this.#r.keys())if(i.type==="ENTRIES_LINK"&&(i.entryFrom===e&&i.entryTo===t||i.entryFrom===t&&i.entryTo===e))return!0;return!1}#o(e){for(const[t,i]of this.#r.entries())if(t.type==="ENTRY_LABEL"&&t.entry===e)return i;return null}#l(e){switch(e.type){case"ENTRY_LABEL":return{type:"ENTRY_LABEL",entry:e.entry,label:e.label};case"TIME_RANGE":return{type:"TIME_RANGE",label:e.label,showDuration:!0,bounds:e.bounds};case"ENTRIES_LINK":return{type:"ENTRIES_LINK",state:e.state,entryFrom:e.entryFrom,entryTo:e.entryTo};default:ke(e,"Overlay for provided annotation cannot be created")}}removeAnnotation(e){const t=this.#r.get(e);if(!t){console.warn("Overlay for deleted Annotation does not exist",e);return}this.#r.delete(e),this.dispatchEvent(new Rt(t,"Remove"))}removeAnnotationOverlay(e){const t=this.getAnnotationByOverlay(e);if(!t){console.warn("Annotation for deleted Overlay does not exist",e);return}this.removeAnnotation(t)}updateAnnotation(e){const t=this.#r.get(e);t&&Yn(t)&&to(e)?(t.label=e.label,t.bounds=e.bounds,this.dispatchEvent(new Rt(t,"UpdateTimeRange"))):t&&Xn(t)&&zr(e)?(t.state=e.state,t.entryFrom=e.entryFrom,t.entryTo=e.entryTo,this.dispatchEvent(new Rt(t,"UpdateLinkToEntry"))):console.error("Annotation could not be updated")}updateAnnotationOverlay(e){const t=this.getAnnotationByOverlay(e);if(!t){console.warn("Annotation for updated Overlay does not exist");return}(e.type==="ENTRY_LABEL"&&t.type==="ENTRY_LABEL"||e.type==="TIME_RANGE"&&t.type==="TIME_RANGE")&&(this.#a.set(!1),t.label=e.label,this.dispatchEvent(new Rt(e,"UpdateLabel"))),e.type==="ENTRIES_LINK"&&t.type==="ENTRIES_LINK"&&(this.#a.set(!1),t.state=e.state)}getAnnotationByOverlay(e){for(const[t,i]of this.#r.entries())if(i===e)return t;return null}getAnnotations(){return[...this.#r.keys()]}getOverlays(){return[...this.#r.values()]}toJSON(){const e=this.#e.invisibleEntries().map(i=>this.#s.keyForEvent(i)).filter(i=>i!==null),t=this.#e.expandableEntries().map(i=>this.#s.keyForEvent(i)).filter(i=>i!==null);return this.#i={entriesModifications:{hiddenEntries:e,expandableEntries:t},initialBreadcrumb:this.#t.initialBreadcrumb,annotations:this.#p()},this.#i}#p(){const e=this.getAnnotations(),t=[],i=[],n=[];for(let s=0;s<e.length;s++){const r=e[s];if(ul(r)){const o=this.#s.keyForEvent(r.entry);o&&t.push({entry:o,label:r.label})}else if(to(r))i.push({bounds:r.bounds,label:r.label});else if(zr(r)&&r.entryTo){const o=this.#s.keyForEvent(r.entryFrom),l=this.#s.keyForEvent(r.entryTo);o&&l&&n.push({entryFrom:o,entryTo:l})}}return{entryLabels:t,labelledTimeRanges:i,linksBetweenEntries:n}}applyModificationsIfPresent(){if(!this.#i||!this.#i.annotations)return;const e=this.#i.entriesModifications.hiddenEntries,t=this.#i.entriesModifications.expandableEntries;this.#t.setInitialBreadcrumbFromLoadedModifications(this.#i.initialBreadcrumb),this.#d(e,t),this.#h(this.#i.annotations)}#h(e){try{(e.entryLabels??[]).forEach(s=>{this.createAnnotation({type:"ENTRY_LABEL",entry:this.#s.eventForKey(s.entry,this.#n),label:s.label},!0)}),(e.labelledTimeRanges??[]).forEach(s=>{this.createAnnotation({type:"TIME_RANGE",bounds:s.bounds,label:s.label},!0)}),(e.linksBetweenEntries??[]).forEach(s=>{this.createAnnotation({type:"ENTRIES_LINK",state:"connected",entryFrom:this.#s.eventForKey(s.entryFrom,this.#n),entryTo:this.#s.eventForKey(s.entryTo,this.#n)},!0)})}catch(t){console.warn("Failed to apply stored annotations",t)}}#d(e,t){try{const i=e.map(s=>this.#s.eventForKey(s,this.#n)),n=t.map(s=>this.#s.eventForKey(s,this.#n));this.#e.setHiddenAndExpandableEntries(i,n)}catch(i){console.warn("Failed to apply entriesFilter modifications",i),this.#e.setHiddenAndExpandableEntries([],[])}}}const _f=Object.freeze(Object.defineProperty({__proto__:null,AnnotationModifiedEvent:Rt,ModificationsManager:H},Symbol.toStringTag,{value:"Module"})),pc=new CSSStyleSheet;pc.replaceSync(`/*
 * Copyright 2024 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

.connectorContainer {
  display: flex;
  width: 100%;
  height: 100%;
}

.entry-wrapper {
  pointer-events: none;
  position: absolute;
  display: block;
  border: 2px solid var(--color-text-primary);
  box-sizing: border-box;

  &.cut-off-top {
    border-top: none;
  }

  &.cut-off-bottom {
    border-bottom: none;
  }

  &.cut-off-right {
    border-right: none;
  }

  &.cut-off-left {
    border-left: none;
  }
}

.entry-is-not-source {
  border: 2px dashed var(--color-text-primary);
}

.create-link-icon {
  pointer-events: auto;
  cursor: pointer;
  color: var(--sys-color-on-surface);
  width: 16px;
  height: 16px;
  position: absolute;
}

/*# sourceURL=entriesLinkOverlay.css */
`);const mc={diagram:"Links bteween entries"},tg=A("panels/timeline/overlays/components/EntriesLinkOverlay.ts",mc),ig=N.bind(void 0,tg),{html:ng}=K;class Jn extends Event{static eventName="entrylinkstartcreating";constructor(){super(Jn.eventName,{bubbles:!0,composed:!0})}}class gc extends HTMLElement{#e=this.attachShadow({mode:"open"});#t;#i;#n;#s=null;#r=null;#a=null;#o=null;#l=null;#p=null;#h=null;#d=!0;#u=!0;#c=null;#m=!0;#g=!0;#v=!1;#f;constructor(e,t){super(),this.#T(),this.#t={x:e.x,y:e.y},this.#i={width:e.width,height:e.height},this.#n={x:e.x,y:e.y},this.#r=this.#e.querySelector(".connectorContainer")??null,this.#a=this.#r?.querySelector("line")??null,this.#o=this.#e.querySelector(".from-highlight-wrapper")??null,this.#l=this.#e.querySelector(".to-highlight-wrapper")??null,this.#p=this.#r?.querySelector(".entryFromConnector")??null,this.#h=this.#r?.querySelector(".entryToConnector")??null,this.#f=t,this.#T()}set canvasRect(e){e!==null&&(this.#c&&this.#c.width===e.width&&this.#c.height===e.height||(this.#c=e,this.#T()))}entryFromWrapper(){return this.#o}entryToWrapper(){return this.#l}connectedCallback(){this.#e.adoptedStyleSheets=[pc]}set hideArrow(e){this.#v=e,this.#a&&(this.#a.style.display=e?"none":"block")}set fromEntryCoordinateAndDimentions(e){this.#t={x:e.x,y:e.y},this.#i={width:e.length,height:e.height},this.#y(),this.#w()}set entriesVisibility(e){this.#d=e.fromEntryVisibility,this.#u=e.toEntryVisibility}set toEntryCoordinateAndDimentions(e){this.#n={x:e.x,y:e.y},e.length&&e.height?this.#s={width:e.length,height:e.height}:this.#s=null,this.#y(),this.#w()}set fromEntryIsSource(e){e!==this.#m&&(this.#m=e,this.#T())}set toEntryIsSource(e){e!==this.#g&&(this.#g=e,this.#T())}#w(){if(!this.#a||!this.#o||!this.#l||!this.#p||!this.#h){console.error("`connector` element is missing.");return}if(this.#f==="creation_not_started"){this.#p.setAttribute("visibility","hidden"),this.#h.setAttribute("visibility","hidden");return}const e=8,t=this.#d&&!this.#v&&this.#m&&this.#i.width>=e,i=this.#s?.width??0,n=!this.#v&&this.#u&&this.#g&&i>=e&&!this.#v;if(this.#p.setAttribute("visibility",t?"visible":"hidden"),this.#h.setAttribute("visibility",n?"visible":"hidden"),this.#d){const s=this.#i.height/2,r=String(this.#t.x+this.#i.width),o=String(this.#t.y+s);this.#a.setAttribute("x1",r),this.#a.setAttribute("y1",o),this.#p.setAttribute("cx",r),this.#p.setAttribute("cy",o),this.#o.style.visibility="visible"}else this.#a.setAttribute("x1",(this.#t.x+this.#i.width).toString()),this.#a.setAttribute("y1",this.#t.y.toString()),this.#o.style.visibility="hidden";if(this.#s&&this.#u){const s=String(this.#n.x),r=String(this.#n.y+this.#s.height/2);this.#a.setAttribute("x2",s),this.#a.setAttribute("y2",r),this.#h.setAttribute("cx",s),this.#h.setAttribute("cy",r),this.#l.style.visibility="visible"}else this.#l.style.visibility="hidden",this.#a.setAttribute("x2",this.#n.x.toString()),this.#a.setAttribute("y2",this.#n.y.toString());if(this.#a.setAttribute("stroke-width","2"),this.#s&&this.#d&&!this.#u)this.#a.setAttribute("stroke","url(#fromVisibleLineGradient)");else if(this.#s&&this.#u&&!this.#d)this.#a.setAttribute("stroke","url(#toVisibleLineGradient)");else{const s=ie.instance().getComputedValue("--color-text-primary");this.#a.setAttribute("stroke",s)}this.#T()}#b(){if(!this.#c)return 100;const e=this.#n.x-(this.#t.x+this.#i.width);let t=0;this.#d&&!this.#u?t=this.#c.width-(this.#t.x+this.#i.width):!this.#d&&this.#u&&(t=this.#n.x);const i=t*100/e;return i<100?i:100}#y(){const e=this.#e.querySelector(".create-link-box"),t=e?.querySelector(".create-link-icon")??null;if(!e||!t){console.error("creating element is missing.");return}if(this.#f!=="creation_not_started"){t.style.display="none";return}t.style.left=`${this.#t.x+this.#i.width}px`,t.style.top=`${this.#t.y}px`}#E(){this.#f="pending_to_event",this.dispatchEvent(new Jn)}#T(){const e=ie.instance().getComputedValue("--color-text-primary");q(ng`
          <svg class="connectorContainer" width="100%" height="100%" role="region" aria-label=${ig(mc.diagram)}>
            <defs>
              <linearGradient
                id="fromVisibleLineGradient"
                x1="0%" y1="0%" x2="100%" y2="0%">
                <stop
                  offset="0%"
                  stop-color=${e}
                  stop-opacity="1" />
                <stop
                  offset="${this.#b()}%"
                  stop-color=${e}
                  stop-opacity="0" />
              </linearGradient>

              <linearGradient
                id="toVisibleLineGradient"
                x1="0%" y1="0%" x2="100%" y2="0%">
                <stop
                  offset="${100-this.#b()}%"
                  stop-color=${e}
                  stop-opacity="0" />
                <stop
                  offset="100%"
                  stop-color=${e}
                  stop-opacity="1" />
              </linearGradient>
              <marker
                id="arrow"
                orient="auto"
                markerWidth="3"
                markerHeight="4"
                fill-opacity="1"
                refX="4"
                refY="2"
                visibility=${this.#u||!this.#s?"visible":"hidden"}>
                <path d="M0,0 V4 L4,2 Z" fill=${e} />
              </marker>
            </defs>
            <line
              marker-end="url(#arrow)"
              stroke-dasharray=${!this.#m||!this.#g?sg:"none"}
              visibility=${!this.#d&&!this.#u?"hidden":"visible"}
              />
            <circle class="entryFromConnector" fill="none" stroke=${e} stroke-width=${wo} r=${bo} />
            <circle class="entryToConnector" fill="none" stroke=${e} stroke-width=${wo} r=${bo} />
          </svg>
          <div class="entry-wrapper from-highlight-wrapper ${this.#m?"":"entry-is-not-source"}"></div>
          <div class="entry-wrapper to-highlight-wrapper ${this.#g?"":"entry-is-not-source"}"></div>
          <div class="create-link-box ${this.#f?"visible":"hidden"}">
            <devtools-icon
              class='create-link-icon'
              jslog=${bt("timeline.annotations.create-entry-link").track({click:!0})}
              @click=${this.#E}
              name='arrow-right-circle'>
            </devtools-icon>
          </div>
        `,this.#e,{host:this})}}const bo=2,wo=1,sg=4;customElements.define("devtools-entries-link-overlay",gc);const fc=new CSSStyleSheet;fc.replaceSync(`/*
 * Copyright 2024 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

.label-parts-wrapper {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.input-field {
  background-color: var(--color-background-inverted);
  color: var(--color-background);
  pointer-events: auto;
  border-radius: var(--sys-shape-corner-extra-small);
  white-space: nowrap;
  padding: var(--sys-size-3) var(--sys-size-4);
  font-family: var(--default-font-family);
  font-size: var(--sys-typescale-body2-size);
  font-weight: var(--ref-typeface-weight-medium);
}

.input-field:focus {
  background-color: var(--color-background);
  color: var(--color-background-inverted);
  outline: 2px solid var(--color-background-inverted);
}

.connectorContainer {
  overflow: visible;
}

.entry-highlight-wrapper {
  box-sizing: border-box;
  border: 2px solid var(--sys-color-on-surface);

  &.cut-off-top {
    border-top: none;
  }

  &.cut-off-bottom {
    border-bottom: none;
  }

  &.cut-off-right {
    border-right: none;
  }

  &.cut-off-left {
    border-left: none;
  }
}

/*# sourceURL=entryLabelOverlay.css */
`);const{html:rg}=K,Jr={entryLabel:"Entry label",inputTextPrompt:"Enter an annotation label"},ag=A("panels/timeline/overlays/components/EntryLabelOverlay.ts",Jr),To=N.bind(void 0,ag);class rr extends Event{static eventName="emptyentrylabelremoveevent";constructor(){super(rr.eventName)}}class ar extends Event{newLabel;static eventName="entrylabelchangeevent";constructor(e){super(ar.eventName),this.newLabel=e}}class Ce extends HTMLElement{static LABEL_AND_CONNECTOR_SHIFT_LENGTH=8;static LABEL_CONNECTOR_HEIGHT=7;static LABEL_HEIGHT=17;static LABEL_PADDING=4;static LABEL_AND_CONNECTOR_HEIGHT=Ce.LABEL_HEIGHT+Ce.LABEL_PADDING*2+Ce.LABEL_CONNECTOR_HEIGHT;static MAX_LABEL_LENGTH=100;#e=this.attachShadow({mode:"open"});#t=this.#f.bind(this);#i=!1;#n=!0;#s=null;#r=null;#a=null;#o=null;#l=null;#p;#h;constructor(e,t=!1){super(),this.#f(),this.#h=t,this.#r=this.#e.querySelector(".label-parts-wrapper"),this.#o=this.#r?.querySelector(".input-field")??null,this.#l=this.#r?.querySelector(".connectorContainer")??null,this.#a=this.#r?.querySelector(".entry-highlight-wrapper")??null,this.#p=e,this.#g(e),e!==""&&this.setLabelEditabilityAndRemoveEmptyLabel(!1);const i=e===""?To(Jr.inputTextPrompt):e;this.#o?.setAttribute("aria-label",i),this.#m()}connectedCallback(){this.#e.adoptedStyleSheets=[fc]}entryHighlightWrapper(){return this.#a}#d(){const e=this.#o?.textContent?.trim()??"";e!==this.#p&&(this.#p=e,this.dispatchEvent(new ar(this.#p))),this.#o?.setAttribute("aria-label",e)}#u(e){if(!this.#o)return!1;const t=["Backspace","Delete","ArrowLeft","ArrowRight"];return e.key==="Enter"||e.key==="Escape"?(this.#o.dispatchEvent(new FocusEvent("blur",{bubbles:!0})),!1):this.#o.textContent!==null&&this.#o.textContent.length<=Ce.MAX_LABEL_LENGTH||t.includes(e.key)||e.key.length===1&&e.ctrlKey?!0:(e.preventDefault(),!1)}#c(e){e.preventDefault();const t=e.clipboardData;if(!t||!this.#o)return;const i=t.getData("text"),s=(this.#o.textContent+i).slice(0,Ce.MAX_LABEL_LENGTH+1);this.#o.textContent=s;const r=window.getSelection(),o=document.createRange();o.selectNodeContents(this.#o),o.collapse(!1),r?.removeAllRanges(),r?.addRange(o)}set entryLabelVisibleHeight(e){if(e===this.#s){this.#m();return}this.#s=e,D(this,this.#t),this.#n&&this.#v(),this.#g(),this.#m()}#m(){if(!this.#l){console.error("`connectorLineContainer` element is missing.");return}if(this.#h&&this.#s){const n=this.#s+Ce.LABEL_CONNECTOR_HEIGHT;this.#l.style.transform=`translateY(${n}px) rotate(180deg)`}const e=this.#l.querySelector("line"),t=this.#l.querySelector("circle");if(!e||!t){console.error("Some entry label elements are missing.");return}this.#l.setAttribute("width",(Ce.LABEL_AND_CONNECTOR_SHIFT_LENGTH*2).toString()),this.#l.setAttribute("height",Ce.LABEL_CONNECTOR_HEIGHT.toString()),e.setAttribute("x1","0"),e.setAttribute("y1","0"),e.setAttribute("x2",Ce.LABEL_AND_CONNECTOR_SHIFT_LENGTH.toString()),e.setAttribute("y2",Ce.LABEL_CONNECTOR_HEIGHT.toString());const i=ie.instance().getComputedValue("--color-text-primary");e.setAttribute("stroke",i),e.setAttribute("stroke-width","2"),t.setAttribute("cx",Ce.LABEL_AND_CONNECTOR_SHIFT_LENGTH.toString()),t.setAttribute("cy",Ce.LABEL_CONNECTOR_HEIGHT.toString()),t.setAttribute("r","3"),t.setAttribute("fill",i)}#g(e){if(!this.#o){console.error("`labelBox`element is missing.");return}typeof e=="string"&&(this.#o.innerText=e);let t=null,i=null;this.#h?t=Ce.LABEL_AND_CONNECTOR_SHIFT_LENGTH:t=Ce.LABEL_AND_CONNECTOR_SHIFT_LENGTH*-1,this.#h&&this.#s&&(i=this.#s+Ce.LABEL_HEIGHT+Ce.LABEL_PADDING*2+Ce.LABEL_CONNECTOR_HEIGHT*2);let n="";t&&(n+=`translateX(${t}px) `),i&&(n+=`translateY(${i}px)`),n.length&&(this.#o.style.transform=n)}#v(){if(!this.#o){console.error("`labelBox` element is missing.");return}this.#o.focus()}setLabelEditabilityAndRemoveEmptyLabel(e){this.#n=e,this.#f(),e&&this.#v();const t=this.#o?.textContent?.trim()??"";!e&&t.length===0&&!this.#i&&(this.#i=!0,this.dispatchEvent(new rr))}#f(){q(rg`
        <span class="label-parts-wrapper" role="region" aria-label=${To(Jr.entryLabel)}>
          <span
            class="input-field"
            role="textbox"
            @dblclick=${()=>this.setLabelEditabilityAndRemoveEmptyLabel(!0)}
            @blur=${()=>this.setLabelEditabilityAndRemoveEmptyLabel(!1)}
            @keydown=${this.#u}
            @paste=${this.#c}
            @keyup=${this.#d}
            contenteditable=${this.#n?"plaintext-only":!1}
            jslog=${Bo("timeline.annotations.entry-label-input").track({keydown:!0,click:!0})}
          ></span>
          <svg class="connectorContainer">
            <line/>
            <circle/>
          </svg>
          <div class="entry-highlight-wrapper"></div>
        </span>`,this.#e,{host:this})}}customElements.define("devtools-entry-label-overlay",Ce);const vc=new CSSStyleSheet;vc.replaceSync(`/*
 * Copyright 2024 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

:host {
  display: flex;
  overflow: hidden;
  flex-direction: column;
  justify-content: flex-end;
  width: 100%;
  height: 100%;
  box-sizing: border-box;
  padding-bottom: 5px;
  background: linear-gradient(180deg, rgb(255 125 210 / 0%) 0%, rgb(255 125 210 / 15%) 85%); /* stylelint-disable-line plugin/use_theme_colors */
  border-color: var(--ref-palette-pink55);
  border-width: 0 1px 5px;
  border-style: solid;
  pointer-events: none;
}

.range-container {
  display: flex;
  align-items: center;
  flex-direction: column;
  text-align: center;
  box-sizing: border-box;
  pointer-events: all;
  user-select: none;
  color: var(--sys-color-pink);

  &.labelHidden {
    /* Have to use this not display: none so it maintains its width */
    user-select: none;
    pointer-events: none;
    visibility: hidden;
  }

  &.offScreenLeft {
    align-items: flex-start;
    text-align: left;
  }

  &.offScreenRight {
    align-items: flex-end;
    text-align: right;
  }
}

.label-text {
  /*
  * The width priority is min-width > max-width > width
  * When the range itself is smaller that 70px, expand 100% to fill the whole width.
  * When the range is wider, only expand the textfield to over 70px
  * if it's needed to fit the label text.
  */
  width: 100%;
  max-width: 70px;
  min-width: fit-content;
  text-overflow: ellipsis;
  overflow: hidden;
  overflow-wrap: break-word;
  word-break: break-word;
  margin-bottom: 3px;
  display: -webkit-box;
  white-space: break-spaces;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
}

.label-text[contenteditable="true"] {
  outline: none;
  box-shadow: 0 0 0 1px var(--ref-palette-pink55);
}

/*# sourceURL=timeRangeOverlay.css */
`);const{html:og}=K,yc={timeRange:"Time range"},lg=A("panels/timeline/overlays/components/TimeRangeOverlay.ts",yc),cg=N.bind(void 0,lg);class or extends Event{newLabel;static eventName="timerangelabelchange";constructor(e){super(or.eventName),this.newLabel=e}}class lr extends Event{static eventName="timerangeremoveevent";constructor(){super(lr.eventName)}}class bc extends HTMLElement{#e=this.attachShadow({mode:"open"});#t=null;#i=null;#n;#s=!0;#r=null;#a=null;connectedCallback(){this.#e.adoptedStyleSheets=[vc]}constructor(e){if(super(),this.#u(),this.#r=this.#e.querySelector(".range-container"),this.#a=this.#r?.querySelector(".label-text")??null,this.#n=e,!this.#a){console.error("`labelBox` element is missing.");return}this.#a.innerText=e,e&&(this.#a?.setAttribute("aria-label",e),this.#p(!1))}set canvasRect(e){e!==null&&(this.#i&&this.#i.width===e.width&&this.#i.height===e.height||(this.#i=e,this.#u()))}set duration(e){e!==this.#t&&(this.#t=e,this.#u())}#o(e){if(!this.#i)return 0;const{x:t,width:i}=e,n=t+i,s=this.#i.x,r=this.#i.x+this.#i.width,o=Math.max(s,t);return Math.min(r,n)-o}updateLabelPositioning(){if(!this.#r||!this.#i||!this.#a)return;const e=9,t=this.getBoundingClientRect(),i=this.#e.activeElement===this.#a,n=this.#r.getBoundingClientRect(),s=this.#o(t)-e,o=(this.#r.querySelector(".duration")??null)?.getBoundingClientRect().width;if(!o)return;const d=s<=o&&!i&&this.#n.length>0;if(this.#r.classList.toggle("labelHidden",d),d)return;const c=(t.width-n.width)/2,u=t.x+c<this.#i.x;this.#r.classList.toggle("offScreenLeft",u);const m=this.#i.x+this.#i.width,T=t.x+c+n.width>m;this.#r.classList.toggle("offScreenRight",T),u?this.#r.style.marginLeft=`${Math.abs(this.#i.x-t.x)+e}px`:T?this.#r.style.marginRight=`${t.right-this.#i.right+e}px`:this.#r.style.margin="0px",this.#a?.innerText===""&&this.#p(!0)}#l(){if(!this.#a){console.error("`labelBox` element is missing.");return}this.#a.focus()}#p(e){if(this.#a?.innerText===""){this.#l();return}this.#s=e,this.#u(),e&&this.#l()}#h(){const e=this.#a?.textContent??"";e!==this.#n&&(this.#n=e,this.dispatchEvent(new or(this.#n)),this.#a?.setAttribute("aria-label",e))}#d(e){return e.key==="Enter"||e.key==="Escape"?(e.stopPropagation(),this.#n===""&&this.dispatchEvent(new lr),this.#a?.blur(),!1):!0}#u(){const e=this.#t?Ft(this.#t):"";q(og`
          <span class="range-container" role="region" aria-label=${cg(yc.timeRange)}>
            <span
             class="label-text"
             role="textbox"
             @focusout=${()=>this.#p(!1)}
             @dblclick=${()=>this.#p(!0)}
             @keydown=${this.#d}
             @keyup=${this.#h}
             contenteditable=${this.#s?"plaintext-only":!1}
             jslog=${Bo("timeline.annotations.time-range-label-input").track({keydown:!0,click:!0})}
            ></span>
            <span class="duration">${e}</span>
          </span>
          `,this.#e,{host:this}),this.updateLabelPositioning()}}customElements.define("devtools-time-range-overlay",bc);const wc=new CSSStyleSheet;wc.replaceSync(`/*
 * Copyright 2024 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

.timespan-breakdown-overlay-section {
  border: solid;
  border-color: var(--sys-color-on-surface);
  border-width: 4px 1px 0;
  align-content: flex-start;
  text-align: center;
  overflow: hidden;
  text-overflow: ellipsis;
  background-image: linear-gradient(180deg, var(--sys-color-on-primary), transparent);
  height: 90%;
  box-sizing: border-box;
  padding-top: var(--sys-size-2);

  :host(.is-below) & {
    border-top-width: 0;
    border-bottom-width: 4px;
    align-content: flex-end; /* anchor the text at the bottom */
    padding-bottom: var(--sys-size-2);
    padding-top: 0;

    /* re-order so the timestamp is below label */
    .timespan-breakdown-overlay-label {
      display: flex;
      flex-direction: column-reverse;
    }
  }
}

:host {
  display: flex;
  overflow: hidden;
  flex-direction: row;
  justify-content: flex-end;
  align-items: flex-end;
  width: 100%;
  box-sizing: border-box;
  height: 100%;
  max-height: 100px;

  /* Ensure that the first & last sections always have the left/right border */
  /* (disable stylelint because we need the !important to override border
   * styles below + keeping them here is clearer to read) */
  .timespan-breakdown-overlay-section:first-child {
    border-left-width: 1px !important; /* stylelint-disable-line declaration-no-important */
  }

  .timespan-breakdown-overlay-section:last-child {
    border-right-width: 1px !important; /* stylelint-disable-line declaration-no-important */
  }
}

:host(.is-below) {
  align-items: flex-start;
}

/* Depending on if the number of sections is odd or even, we alternate the
 * heights of the even/odd sections. We do this to ensure that the first item
 * is never a "high" item, because that looks a bit clunky. */
:host(.odd-number-of-sections) {
  .timespan-breakdown-overlay-section:nth-child(even) {
    height: 100%;
  }

  .timespan-breakdown-overlay-section:nth-child(odd) {
    border-left-width: 0;
    border-right-width: 0;
  }
}

:host(.even-number-of-sections) {
  .timespan-breakdown-overlay-section:nth-child(odd) {
    height: 100%;
  }

  .timespan-breakdown-overlay-section:nth-child(even) {
    border-left-width: 0;
    border-right-width: 0;
  }
}

.timespan-breakdown-overlay-label {
  font-family: var(--default-font-family);
  font-size: var(--sys-typescale-body2-size);
  line-height: var(--sys-typescale-body4-line-height);
  font-weight: var(--ref-typeface-weight-medium);
  color: var(--sys-color-on-surface);
  text-align: center;
  box-sizing: border-box;
  width: max-content;
  padding: 0 3px;
  overflow: hidden;
  text-overflow: ellipsis;
  text-wrap: nowrap;

  .duration-text {
    font-size: var(--sys-typescale-body4-size);
    text-overflow: ellipsis;
    overflow: hidden;
    text-wrap: nowrap;
    display: block;
  }

  .discovery-time-ms {
    font-weight: var(--ref-typeface-weight-bold);
  }

  &.labelHidden {
    /* Have to use this not display: none so it maintains its width */
    user-select: none;
    pointer-events: none;
    visibility: hidden;
  }

  &.labelTruncated {
    /* This means the label will show the text that fits with an ellipsis for
     * the overflow */
    max-width: 100%;
  }

  &.offScreenLeft {
    text-align: left;
  }

  &.offScreenRight {
    text-align: right;
  }
}

/*# sourceURL=timespanBreakdownOverlay.css */
`);const{html:Rr}=K;class Tc extends HTMLElement{#e=this.attachShadow({mode:"open"});#t=null;#i=null;connectedCallback(){this.#e.adoptedStyleSheets=[wc]}set isBelowEntry(e){this.classList.toggle("is-below",e)}set canvasRect(e){this.#t&&e&&this.#t.width===e.width&&this.#t.height===e.height||(this.#t=e,this.#s())}set sections(e){e!==this.#i&&(this.#i=e,this.#s())}checkSectionLabelPositioning(){const e=this.#e.querySelectorAll(".timespan-breakdown-overlay-section");if(!e||!this.#t)return;const t=9,i=new Map;for(const s of e){const r=s.querySelector(".timespan-breakdown-overlay-label");if(!r)continue;const o=s.getBoundingClientRect(),l=r.getBoundingClientRect();i.set(s,{sectionRect:o,labelRect:l,label:r})}const n=30;for(const s of e){const r=i.get(s);if(!r)break;const{labelRect:o,sectionRect:l,label:d}=r,c=l.width<n,h=l.width-5<=o.width;if(d.classList.toggle("labelHidden",c),d.classList.toggle("labelTruncated",h),c||h)continue;const u=(l.width-o.width)/2,v=l.x+u<this.#t.x;d.classList.toggle("offScreenLeft",v);const T=this.#t.x+this.#t.width,U=l.x+u+o.width>T;if(d.classList.toggle("offScreenRight",U),v)d.style.marginLeft=`${Math.abs(this.#t.x-l.x)+t}px`;else if(U){const w=T-o.width-l.x;d.style.marginLeft=`${w}px`}else d.style.marginLeft=`${u}px`}}renderedSections(){return Array.from(this.#e.querySelectorAll(".timespan-breakdown-overlay-section"))}#n(e){return Rr`
      <div class="timespan-breakdown-overlay-section">
        <div class="timespan-breakdown-overlay-label">
        ${e.showDuration?Rr`
            <span class="duration-text">${Bt(e.bounds.range)}</span>
          `:V}
          <span class="section-label-text">
            ${e.label}
          </span>
        </div>
      </div>`}#s(){this.#i&&(this.classList.toggle("odd-number-of-sections",this.#i.length%2===1),this.classList.toggle("even-number-of-sections",this.#i.length%2===0)),q(Rr`${this.#i?.map(this.#n)}`,this.#e,{host:this}),this.checkSectionLabelPositioning()}}customElements.define("devtools-timespan-breakdown-overlay",Tc);const dg=8;function Sc(a){let e=_(Number.POSITIVE_INFINITY),t=_(Number.NEGATIVE_INFINITY);for(const i of a){const n=hg(i);n.min<e&&(e=n.min),n.max>t&&(t=n.max)}return Pe(e,t)}function hg(a){const e=[],t=[];switch(a.type){case"ENTRY_SELECTED":{const s=yt(a.entry);e.push(s.startTime),t.push(s.endTime);break}case"ENTRY_OUTLINE":{const s=yt(a.entry);e.push(s.startTime),t.push(s.endTime);break}case"TIME_RANGE":{e.push(a.bounds.min),t.push(a.bounds.max);break}case"ENTRY_LABEL":{const s=yt(a.entry);e.push(s.startTime),t.push(s.endTime);break}case"ENTRIES_LINK":{const s=yt(a.entryFrom);if(e.push(s.startTime),a.entryTo){const r=yt(a.entryTo);t.push(r.endTime)}else t.push(s.endTime);break}case"TIMESPAN_BREAKDOWN":{if(a.entry){const s=yt(a.entry);e.push(s.startTime),t.push(s.endTime)}for(const s of a.sections)e.push(s.bounds.min),t.push(s.bounds.max);break}case"CURSOR_TIMESTAMP_MARKER":{e.push(a.timestamp);break}case"CANDY_STRIPED_TIME_RANGE":{const s=yt(a.entry);e.push(s.startTime),t.push(s.endTime),e.push(a.bounds.min),t.push(a.bounds.max);break}default:ke(a,`Unexpected overlay ${a}`)}const i=_(Math.min(...e)),n=_(Math.max(...t));return Pe(i,n)}function ug(a){const e=[];switch(a.type){case"ENTRY_SELECTED":{e.push(a.entry);break}case"ENTRY_OUTLINE":{e.push(a.entry);break}case"TIME_RANGE":break;case"ENTRY_LABEL":{e.push(a.entry);break}case"ENTRIES_LINK":{e.push(a.entryFrom),a.entryTo&&e.push(a.entryTo);break}case"TIMESPAN_BREAKDOWN":{a.entry&&e.push(a.entry);break}case"CURSOR_TIMESTAMP_MARKER":break;case"CANDY_STRIPED_TIME_RANGE":{e.push(a.entry);break}default:ke(a,`Unknown overlay type ${JSON.stringify(a)}`)}return e}function It(a){return ca(a)?"network":"main"}function pg(a){return a.type==="CURSOR_TIMESTAMP_MARKER"||a.type==="ENTRY_SELECTED"}class jt extends Event{overlay;action;static eventName="annotationoverlayactionsevent";constructor(e,t){super(jt.eventName),this.overlay=e,this.action=t}}class mg extends EventTarget{#e=new Map;#t=null;#i=null;#n;#s={trace:{visibleWindow:null},charts:{main:null,network:null}};#r;#a;#o;#l;constructor(e){super(),this.#a=e.container,this.#r=e.charts,this.#l=e.entryQueries,this.#n=null,this.#o=Te.instance().moduleSetting("annotations-hidden"),this.#o.addChangeListener(this.update.bind(this)),e.flameChartsContainers.main.addEventListener("mousemove",t=>this.#p.bind(this)(t,"main")),e.flameChartsContainers.network.addEventListener("mousemove",t=>this.#p.bind(this)(t,"network"))}#p(e,t){const i=e;if(this.#t=i.offsetX,this.#i=i.offsetY,this.#n?.state!=="pending_to_event")return;const n=this.#s.charts.network?.heightPixels??0,s=this.#e.get(this.#n);if(s){const r=s.querySelector("devtools-entries-link-overlay"),o=i.offsetY+(t==="main"?n:0);r.toEntryCoordinateAndDimentions={x:i.offsetX,y:o}}}add(e){if(this.#e.has(e))return e;const t=this.overlaysOfType(e.type);return pg(e)&&t[0]?(this.updateExisting(t[0],e),t[0]):(this.#e.set(e,null),e)}updateExisting(e,t){if(!this.#e.has(e)){console.error("Trying to update an overlay that does not exist.");return}for(const[i,n]of Object.entries(t)){const s=i;e[s]=n}}enterLabelEditMode(e){const i=this.#e.get(e)?.querySelector("devtools-entry-label-overlay");i&&i.setLabelEditabilityAndRemoveEmptyLabel(!0)}overlaysForEntry(e){const t=[];for(const[i]of this.#e)"entry"in i&&i.entry===e&&t.push(i);return t}removeOverlaysOfType(e){const t=Array.from(this.#e.keys()).filter(i=>i.type===e);for(const i of t)this.remove(i);return t.length}overlaysOfType(e){const t=[];function i(n){return n.type===e}for(const[n]of this.#e)i(n)&&t.push(n);return t}remove(e){const t=this.#e.get(e);t&&this.#a&&this.#a.removeChild(t),this.#e.delete(e)}updateChartDimensions(e,t){this.#s.charts[e]=t}updateVisibleWindow(e){this.#s.trace.visibleWindow=e}reset(){this.#a&&(this.#a.innerHTML=""),this.#e.clear(),this.#s.trace.visibleWindow=null,this.#s.charts.main=null,this.#s.charts.network=null}async update(){const e=[];for(const[t,i]of this.#e){const n=i||this.#E(t);i||(this.#e.set(t,n),this.#a.appendChild(n)),this.#T(t,n),this.#d(t,n),this.#x(t,n),t.type==="TIME_RANGE"&&e.push(t)}e.length>1&&this.#h(e)}#h(e){const t=e.toSorted((n,s)=>n.bounds.min-s.bounds.min),i=new Map;for(let n=0;n<t.length;n++){const s=t[n],r=[];for(let o=n+1;o<t.length;o++){const l=t[o];if(Qn({bounds:s.bounds,timeRange:l.bounds}))r.push(l);else break}i.set(s,r)}for(const[n,s]of i){const r=this.#e.get(n);if(!r)continue;let o=1;r.getAttribute("class")?.includes("overlap-")&&(o=0),s.forEach(l=>{this.#e.get(l)?.classList.add(`overlap-${o++}`)})}}#d(e,t){const i=this.#o.get();switch(e.type){case"ENTRY_SELECTED":{const n=this.entryIsVisibleOnChart(e.entry);this.#k(t,n),n&&this.#b(e.entry,t);break}case"ENTRY_OUTLINE":{const n=this.overlaysOfType("ENTRY_SELECTED")?.at(0);!!!(n&&n.entry===e.entry)&&this.entryIsVisibleOnChart(e.entry)?(this.#k(t,!0),this.#b(e.entry,t)):this.#k(t,!1);break}case"TIME_RANGE":{e.label.length&&this.#k(t,!i),this.#v(e,t);break}case"ENTRY_LABEL":{const n=this.entryIsVisibleOnChart(e.entry);if(this.#k(t,n&&!i),n){const s=this.#f(e,t),r=t.querySelector("devtools-entry-label-overlay");r&&s&&(r.entryLabelVisibleHeight=s)}break}case"ENTRIES_LINK":{const n=this.#y(e),s=n!==null&&!i;this.#k(t,s),s&&this.#m(e,t,n);break}case"TIMESPAN_BREAKDOWN":{if(this.#c(e,t),e.entry){const{visibleWindow:n}=this.#s.trace,s=!!(n&&this.#L(e.entry)&&Qn({bounds:n,timeRange:e.sections[0].bounds}));this.#k(t,s)}break}case"CURSOR_TIMESTAMP_MARKER":{const{visibleWindow:n}=this.#s.trace,s=!!(n&&lh(n,e.timestamp));this.#k(t,s),s&&this.#u(e,t);break}case"CANDY_STRIPED_TIME_RANGE":{const{visibleWindow:n}=this.#s.trace,s=!!(n&&this.#L(e.entry)&&Qn({bounds:n,timeRange:e.bounds}));this.#k(t,s),s&&this.#w(e,t);break}default:ke(e,`Unknown overlay: ${JSON.stringify(e)}`)}}#u(e,t){const i=this.#C("main",e.timestamp);t.style.left=`${i}px`}#c(e,t){if(e.sections.length===0)return;const n=t.querySelector("devtools-timespan-breakdown-overlay")?.renderedSections()??[],s=this.#C("main",e.sections[0].bounds.min),r=this.#C("main",e.sections[e.sections.length-1].bounds.max);if(s===null||r===null)return;const o=r-s;if(t.style.left=`${s}px`,t.style.width=`${o}px`,n.length===0)return;let l=0;for(const d of e.sections){const c=this.#C("main",d.bounds.min),h=this.#C("main",d.bounds.max);if(c===null||h===null)return;const u=h-c,m=n[l];m.style.left=`${c}px`,m.style.width=`${u}px`,l++}if(e.entry&&(e.renderLocation==="BELOW_EVENT"||e.renderLocation==="ABOVE_EVENT")){t.style.maxHeight="50px";const c=this.yPixelForEventOnChart(e.entry);if(c===null)return;const h=this.pixelHeightForEventOnChart(e.entry);if(h===null)return;if(e.renderLocation==="BELOW_EVENT"){const u=c+h;t.style.top=`${u}px`}else{const m=c-7,v=Math.max(m,0),T=Math.min(50,v),E=m-T;t.style.top=`${E}px`}}}#m(e,t,i){const n=t.querySelector("devtools-entries-link-overlay");if(n){const s=this.#I(i.entryFrom),r=i.entryTo&&this.#I(i.entryTo);if(!!(s&&r)){this.#k(t,!1);return}const l=!!(s||r);n.hideArrow=l;const{entryFrom:d,entryTo:c,entryFromIsSource:h,entryToIsSource:u}=i,m=n.entryFromWrapper();if(!m)return;const v=this.#b(i.entryFrom,m);if(!v)return;const{entryHeight:T,entryWidth:E,cutOffHeight:U=0,x:w,y:x}=v,C=this.entryIsVisibleOnChart(d)&&!s,W=c?this.entryIsVisibleOnChart(c)&&!r:!1;!C&&e.state==="creation_not_started"&&this.dispatchEvent(new jt(e,"Remove"));const O=(C?x:this.#g(d))??0;n.fromEntryIsSource=h,n.toEntryIsSource=u,n.entriesVisibility={fromEntryVisibility:C,toEntryVisibility:W},n.fromEntryCoordinateAndDimentions={x:w,y:O,length:E,height:T-U};const j=n.entryToWrapper();if(c&&j){const S=this.#b(c,j);if(!S)return;const{entryHeight:k,entryWidth:Z,cutOffHeight:Re=0,x:st,y:rt}=S,at=this.entryIsVisibleOnChart(c)?rt:this.#g(c)??0;n.toEntryCoordinateAndDimentions={x:st,y:at,length:Z,height:k-Re}}else this.#t&&this.#i&&(this.#n=e)}}#g(e){const t=It(e),i=this.yPixelForEventOnChart(e);if(i===null)return 0;if(t==="main"){if(!this.#s.charts.main?.heightPixels)return 0;if(i-this.networkChartOffsetHeight()<0)return this.networkChartOffsetHeight()}if(t==="network"){if(!this.#s.charts.network)return 0;if(i>this.#s.charts.network.heightPixels)return this.#s.charts.network.heightPixels}return i}#v(e,t){const i=this.#C("main",e.bounds.min),n=this.#C("main",e.bounds.max);if(i===null||n===null)return;const s=n-i;t.style.left=`${i}px`,t.style.width=`${s}px`}#f(e,t){const i=t.querySelector("devtools-entry-label-overlay");if(!i)return null;const n=i.entryHighlightWrapper();if(!n)return null;const{entryHeight:s,entryWidth:r,cutOffHeight:o=0,x:l,y:d}=this.#b(e.entry,n)||{};return!s||!r||l===null||!d?null:(t.style.top=`${d-Ce.LABEL_AND_CONNECTOR_HEIGHT}px`,t.style.left=`${l}px`,t.style.width=`${r}px`,s-o)}#w(e,t){const i=It(e.entry),n=this.#C(i,e.bounds.min),s=this.#C(i,e.bounds.max);if(n===null||s===null)return;const r=s-n,o=Math.max(2,r);t.style.width=`${o}px`,t.style.left=`${n}px`;let l=this.yPixelForEventOnChart(e.entry);if(l===null)return;const d=this.pixelHeightForEventOnChart(e.entry)??0;let c=d;if(c!==null){if(i==="main"){const h=this.networkChartOffsetHeight(),u=l<h;c=u?Math.abs(l+c-h):c,t.classList.toggle("cut-off-top",u),u&&(l=l+d-c)}else{const h=this.#s.charts.network?.heightPixels??0,m=l+d>h,v=l>h;t.classList.toggle("cut-off-top",v),t.classList.toggle("cut-off-bottom",m),m&&(c=h-l)}t.style.height=`${c}px`,t.style.top=`${l}px`}}#b(e,t){const i=It(e);let n=this.xPixelForEventStartOnChart(e),s=this.yPixelForEventOnChart(e);const r=i==="main"?this.#s.charts.main?.widthPixels:this.#s.charts.network?.widthPixels;if(n===null||s===null||!r)return null;const{endTime:o}=yt(e),l=this.#C(i,o);if(l===null)return null;const d=this.pixelHeightForEventOnChart(e)??0;let c=d;if(c===null)return null;let h=l-n;const u=i==="main"?this.#r.mainProvider:this.#r.networkProvider,m=i==="main"?this.#r.mainChart:this.#r.networkChart,v=u.indexForEvent?.(e),T=m.getCustomDrawnPositionForEntryIndex(v??-1);T&&(n=T.x,h=T.width);const E=n+h>r?n+h-r:null,U=n<0?Math.abs(n):null;t.classList.toggle("cut-off-right",E!==null),E&&(h=h-E),U&&(n=0,h=h-U);const w=Math.max(2,h);if(t.style.width=`${w}px`,i==="main"){const x=this.networkChartOffsetHeight(),C=s<x;c=C?Math.abs(s+c-x):c,t.classList.toggle("cut-off-top",C),C&&(s=s+d-c)}else{const x=this.#s.charts.network?.heightPixels??0,W=s+d>x;t.classList.toggle("cut-off-bottom",W),W&&(c=x-s)}return t.style.height=`${c}px`,t.style.top=`${s}px`,t.style.left=`${n}px`,{entryHeight:d,entryWidth:w,cutOffHeight:d-c,x:n,y:s}}#y(e){if(!e.entryTo)return{entryFrom:e.entryFrom,entryTo:e.entryTo,entryFromIsSource:!0,entryToIsSource:!0};let t=e.entryFrom,i=e.entryTo??null;return this.#l.isEntryCollapsedByUser(e.entryFrom)&&(t=this.#l.firstVisibleParentForEntry(e.entryFrom)),e.entryTo&&this.#l.isEntryCollapsedByUser(e.entryTo)&&(i=this.#l.firstVisibleParentForEntry(e.entryTo)),t===null||i===null?null:{entryFrom:t,entryFromIsSource:t===e.entryFrom,entryTo:i,entryToIsSource:i===e.entryTo}}#E(e){const t=document.createElement("div");t.classList.add("overlay-item",`overlay-type-${e.type}`);const i=gg(e);switch(i&&t.setAttribute("jslog",`${Gn(i)}`),e.type){case"ENTRY_LABEL":{const n=jn(e.entry),s=new Ce(e.label,n);return s.addEventListener(rr.eventName,()=>{this.dispatchEvent(new jt(e,"Remove"))}),s.addEventListener(ar.eventName,r=>{const o=r.newLabel;e.label=o,this.dispatchEvent(new jt(e,"Update"))}),t.appendChild(s),t}case"ENTRIES_LINK":{const n=this.#y(e);if(n===null)return t;const s=this.xPixelForEventEndOnChart(n.entryFrom)??0,r=this.xPixelForEventEndOnChart(n.entryFrom)??0,o=this.yPixelForEventOnChart(n.entryFrom)??0,l=s-r,d=this.pixelHeightForEventOnChart(n.entryFrom)??0,c=new gc({x:s,y:o,width:l,height:d},e.state);return c.addEventListener(Jn.eventName,()=>{e.state="pending_to_event",this.dispatchEvent(new jt(e,"Update"))}),t.appendChild(c),t}case"ENTRY_OUTLINE":return t.classList.add(`outline-reason-${e.outlineReason}`),t;case"TIME_RANGE":{const n=new bc(e.label);return n.duration=e.showDuration?e.bounds.range:null,n.canvasRect=this.#r.mainChart.canvasBoundingClientRect(),n.addEventListener(or.eventName,s=>{const r=s.newLabel;e.label=r,this.dispatchEvent(new jt(e,"Update"))}),n.addEventListener(lr.eventName,()=>{this.dispatchEvent(new jt(e,"Remove"))}),t.appendChild(n),t}case"TIMESPAN_BREAKDOWN":{const n=new Tc;return n.sections=e.sections,n.canvasRect=this.#r.mainChart.canvasBoundingClientRect(),n.isBelowEntry=e.renderLocation==="BELOW_EVENT",t.appendChild(n),t}default:return t}}#T(e,t){switch(e.type){case"ENTRY_SELECTED":break;case"TIME_RANGE":{const i=t.querySelector("devtools-time-range-overlay");i&&(i.duration=e.showDuration?e.bounds.range:null,i.canvasRect=this.#r.mainChart.canvasBoundingClientRect());break}case"ENTRY_LABEL":case"ENTRY_OUTLINE":case"ENTRIES_LINK":{const i=t.querySelector("devtools-entries-link-overlay");i&&(i.canvasRect=this.#r.mainChart.canvasBoundingClientRect());break}case"TIMESPAN_BREAKDOWN":{const i=t.querySelector("devtools-timespan-breakdown-overlay");i&&(i.sections=e.sections,i.canvasRect=this.#r.mainChart.canvasBoundingClientRect());break}case"CURSOR_TIMESTAMP_MARKER":break;case"CANDY_STRIPED_TIME_RANGE":break;default:ke(e,`Unexpected overlay ${e}`)}}#x(e,t){switch(e.type){case"ENTRY_SELECTED":break;case"TIME_RANGE":{t.querySelector("devtools-time-range-overlay")?.updateLabelPositioning();break}case"ENTRY_LABEL":break;case"ENTRY_OUTLINE":break;case"ENTRIES_LINK":break;case"TIMESPAN_BREAKDOWN":{t.querySelector("devtools-timespan-breakdown-overlay")?.checkSectionLabelPositioning();break}case"CURSOR_TIMESTAMP_MARKER":break;case"CANDY_STRIPED_TIME_RANGE":break;default:ke(e,`Unexpected overlay ${e}`)}}entryIsVisibleOnChart(e){const t=this.#L(e),i=this.#P(e);return t&&i}#P(e){if(this.#s.trace.visibleWindow===null)return!1;const{startTime:t,endTime:i}=yt(e),n=Pe(t,i);return Qn({bounds:this.#s.trace.visibleWindow,timeRange:n})}#I(e){const i=It(e)==="main"?this.#r.mainProvider:this.#r.networkProvider,n=i.indexForEvent?.(e)??null;if(n===null)return!1;const s=i.groupForEvent?.(n)??null;return s?!s.expanded:!1}#L(e){const t=It(e),i=this.yPixelForEventOnChart(e);if(i===null)return!1;const n=this.pixelHeightForEventOnChart(e);if(!n)return!1;if(t==="main"){if(!this.#s.charts.main?.heightPixels)return!1;const s=i-this.networkChartOffsetHeight();if(s+n<0||s>this.#s.charts.main.heightPixels)return!1}return!(t==="network"&&(!this.#s.charts.network||i<=-14||i>this.#s.charts.network.heightPixels))}xPixelForEventStartOnChart(e){const t=It(e),{startTime:i}=yt(e);return this.#C(t,i)}xPixelForEventEndOnChart(e){const t=It(e),{endTime:i}=yt(e);return this.#C(t,i)}#C(e,t){if(this.#s.trace.visibleWindow===null)return console.error("Cannot calculate xPixel without visible trace window."),null;const i=this.#s.charts[e]?.widthPixels??null;if(i===null)return console.error(`Cannot calculate xPixel without ${e} dimensions.`),null;const n=t-this.#s.trace.visibleWindow.min,s=this.#s.trace.visibleWindow.range;return Math.floor(n/s*i)}yPixelForEventOnChart(e){const t=It(e),i=t==="main"?this.#r.mainChart:this.#r.networkChart,n=t==="main"?this.#r.mainProvider:this.#r.networkProvider,s=n.indexForEvent?.(e);if(typeof s!="number")return null;const r=n.timelineData();if(r===null)return null;const o=r.entryLevels.at(s);if(typeof o>"u"||!i.levelIsVisible(o))return null;let d=i.levelToOffset(o)-(this.#s.charts[t]?.scrollOffsetPixels??0);return t==="main"&&(d+=this.networkChartOffsetHeight()),d}pixelHeightForEventOnChart(e){const t=It(e),i=t==="main"?this.#r.mainChart:this.#r.networkChart,n=t==="main"?this.#r.mainProvider:this.#r.networkProvider,s=n.indexForEvent?.(e);if(typeof s!="number")return null;const r=n.timelineData();if(r===null)return null;const o=r.entryLevels.at(s);return typeof o>"u"?null:i.levelHeight(o)}networkChartOffsetHeight(){return this.#s.charts.network===null||this.#s.charts.network.heightPixels===0?0:this.#s.charts.network.allGroupsCollapsed?this.#s.charts.network.heightPixels:this.#s.charts.network.heightPixels+dg}#k(e,t){e.style.display=t?"block":"none"}}function yt(a){return jn(a)?{startTime:a.startTime,endTime:a.endTime,duration:a.duration}:Gi(a)}function gg(a){switch(a.type){case"ENTRY_SELECTED":return null;case"ENTRY_OUTLINE":return`timeline.overlays.entry-outline-${Fo(a.outlineReason)}`;case"ENTRY_LABEL":return"timeline.overlays.entry-label";case"ENTRIES_LINK":return a.state!=="connected"?null:"timeline.overlays.entries-link";case"TIME_RANGE":return"timeline.overlays.time-range";case"TIMESPAN_BREAKDOWN":return"timeline.overlays.timespan-breakdown";case"CURSOR_TIMESTAMP_MARKER":return"timeline.overlays.cursor-timestamp-marker";case"CANDY_STRIPED_TIME_RANGE":return"timeline.overlays.candy-striped-time-range";default:ke(a,"Unknown overlay type")}}function*Ec(a){if(yield`[
`,a.length>0){const t=a[Symbol.iterator](),i=t.next().value;yield`  ${JSON.stringify(i)}`;let n=1e4,s="";for(const r of t)s+=`,
  ${JSON.stringify(r)}`,n--,n===0&&(yield s,n=1e4,s="");yield s}yield`
]`}function*ka(a,e){yield`{"metadata": ${JSON.stringify(e||{},null,2)}`,yield`,
"traceEvents": `,yield*Ec(a),yield`}
`}function Cc(a){return JSON.stringify(a)}const Wf=Object.freeze(Object.defineProperty({__proto__:null,arrayOfObjectsJsonGenerator:Ec,cpuprofileJsonGenerator:Cc,traceJsonGenerator:ka},Symbol.toStringTag,{value:"Module"})),kc={tracingNotSupported:"Performance trace recording not supported for this type of target"},fg=A("panels/timeline/TimelineController.ts",kc),vg=N.bind(void 0,fg);class xa{primaryPageTarget;rootTarget;tracingManager;#e=[];#t=null;client;tracingCompletePromise=null;constructor(e,t,i){this.primaryPageTarget=t,this.rootTarget=e,this.tracingManager=e.model(ch),this.client=i}async dispose(){this.tracingManager&&await this.tracingManager.reset()}async startRecording(e){function t(s){return"disabled-by-default-"+s}const i=[ne.isEnabled("timeline-show-all-events")?"*":"-*",dt.Console,dt.Loading,dt.UserTiming,"devtools.timeline",t("devtools.timeline"),t("devtools.timeline.frame"),t("devtools.timeline.stack"),t("v8.compile"),t("v8.cpu_profiler.hires"),t("lighthouse"),"v8.execute","v8","cppgc","navigation,rail"];ne.isEnabled("timeline-v8-runtime-call-stats")&&e.enableJSSampling&&i.push(t("v8.runtime_stats_sampling")),e.enableJSSampling&&i.push(t("v8.cpu_profiler")),ne.isEnabled("timeline-invalidation-tracking")&&i.push(t("devtools.timeline.invalidationTracking")),e.capturePictures&&i.push(t("devtools.timeline.layers"),t("devtools.timeline.picture"),t("blink.graphics_context_annotations")),e.captureFilmStrip&&i.push(t("devtools.screenshot")),e.captureSelectorStats&&i.push(t("blink.debug")),ne.isEnabled("timeline-enhanced-traces")&&(i.push(t("devtools.target-rundown")),i.push(t("devtools.v8-source-rundown"))),ne.isEnabled("timeline-compiled-sources")&&i.push(t("devtools.v8-source-rundown-sources")),await Fn.instance().disable(),this.#t=Date.now();const n=await this.startRecordingWithCategories(i.join(","));return n.getError()&&await Y.instance().resumeAllTargets(),n}async stopRecording(){this.tracingManager&&this.tracingManager.stop(),this.client.loadingStarted(),await this.waitForTracingToStop(),await this.allSourcesFinished(),await Fn.instance().enable()}async waitForTracingToStop(){this.tracingManager&&await this.tracingCompletePromise?.promise}async startRecordingWithCategories(e){if(!this.tracingManager)throw new Error(vg(kc.tracingNotSupported));await Y.instance().suspendAllTargets("performance-timeline"),this.tracingCompletePromise=Promise.withResolvers();const t=await this.tracingManager.start(this,e,"");return await this.warmupJsProfiler(),Wa.instance().profilingStarted(),t}async warmupJsProfiler(){const e=this.primaryPageTarget.model(la);e&&await e.agent.invoke_evaluate({expression:"(async function(){ await 1; })()",throwOnSideEffect:!0})}traceEventsCollected(e){this.#e.push(...e)}tracingComplete(){this.tracingCompletePromise&&(this.tracingCompletePromise.resolve(void 0),this.tracingCompletePromise=null)}async allSourcesFinished(){await Y.instance().resumeAllTargets(),Wa.instance().profilingStopped(),this.client.processingStarted(),await this.client.loadingComplete(this.#e,null,!1,this.#t,null),this.client.loadingCompleteForTest()}tracingBufferUsage(e){this.client.recordingProgress(e)}eventsRetrievalProgress(e){this.client.loadingProgress(e)}}const Vf=Object.freeze(Object.defineProperty({__proto__:null,TimelineController:xa},Symbol.toStringTag,{value:"Module"})),ai={jsHeap:"JS heap",documents:"Documents",nodes:"Nodes",listeners:"Listeners",gpuMemory:"GPU memory",ss:"[{PH1}Â â€“Â {PH2}]",noEventsFound:"No memory usage data found within selected events."},yg=A("panels/timeline/CountersGraph.ts",ai),Ci=N.bind(void 0,yg);class xc extends xe{delegate;calculator;header;toolbar;graphsContainer;canvasContainer;canvas;timelineGrid;counters;counterUI;countersByName;gpuMemoryCounter;#e=null;currentValuesBar;markerXPosition;#t=this.#s.bind(this);#i=document.createElement("div");#n=!1;constructor(e){super(),this.element.id="memory-graphs-container",this.delegate=e,this.calculator=new Lc,this.header=new Oo,this.header.element.classList.add("timeline-memory-header"),this.header.show(this.element),this.toolbar=new et("timeline-memory-toolbar"),this.header.element.appendChild(this.toolbar.element),this.graphsContainer=new xe,this.graphsContainer.show(this.element);const t=new dh(this.resize.bind(this));t.show(this.graphsContainer.element),this.createCurrentValuesBar(),this.canvasContainer=t.element,this.canvasContainer.id="memory-graphs-canvas-container",this.canvas=document.createElement("canvas"),this.canvasContainer.appendChild(this.canvas),this.canvas.id="memory-counters-graph";const i=document.createElement("p");i.innerText=Ci(ai.noEventsFound),this.#i.classList.add("no-events-found"),this.#i.setAttribute("hidden","hidden"),this.#i.appendChild(i),this.canvasContainer.appendChild(this.#i),this.canvasContainer.addEventListener("mouseover",this.onMouseMove.bind(this),!0),this.canvasContainer.addEventListener("mousemove",this.onMouseMove.bind(this),!0),this.canvasContainer.addEventListener("mouseleave",this.onMouseLeave.bind(this),!0),this.canvasContainer.addEventListener("click",this.onClick.bind(this),!0),this.timelineGrid=new ju,this.canvasContainer.appendChild(this.timelineGrid.dividersElement),this.counters=[],this.counterUI=[],this.countersByName=new Map,this.countersByName.set("jsHeapSizeUsed",this.createCounter(Ci(ai.jsHeap),"js-heap-size-used","hsl(220, 90%, 43%)",Ke)),this.countersByName.set("documents",this.createCounter(Ci(ai.documents),"documents","hsl(0, 90%, 43%)")),this.countersByName.set("nodes",this.createCounter(Ci(ai.nodes),"nodes","hsl(120, 90%, 43%)")),this.countersByName.set("jsEventListeners",this.createCounter(Ci(ai.listeners),"js-event-listeners","hsl(38, 90%, 43%)")),this.gpuMemoryCounter=this.createCounter(Ci(ai.gpuMemory),"gpu-memory-used-kb","hsl(300, 90%, 43%)",Ke),this.countersByName.set("gpuMemoryUsedKB",this.gpuMemoryCounter),Ys(this.#t)}#s(e){if(e.updateType==="RESET"||e.updateType==="VISIBLE_WINDOW"){const t=e.state.milli.timelineTraceWindow;this.calculator.setWindow(t.min,t.max),this.#r()}}setModel(e,t){if(this.#e=t,!t||!e)return;const i=wt(e.Meta.traceBounds).min;this.calculator.setZeroTime(i);for(let s=0;s<this.counters.length;++s)this.counters[s].reset(),this.counterUI[s].reset();this.#r();let n=0;for(let s=0;s<t.length;++s){const r=t[s];if(!Ho(r))continue;n++;const o=r.args.data;if(!o)return;for(const l in o){const d=this.countersByName.get(l);if(d){const{startTime:c}=fe(r);d.appendSample(c,o[l])}}typeof o.gpuMemoryLimitKB<"u"&&this.gpuMemoryCounter.setLimit(o.gpuMemoryLimitKB)}this.#n=n===0}createCurrentValuesBar(){this.currentValuesBar=this.graphsContainer.element.createChild("div"),this.currentValuesBar.id="counter-values-bar"}createCounter(e,t,i,n){const s=new Ic;return this.counters.push(s),this.counterUI.push(new Pc(this,e,t,i,s,n)),s}resizerElement(){return this.header.element}resize(){const e=this.canvas.parentElement;this.canvas.width=e.clientWidth*window.devicePixelRatio,this.canvas.height=e.clientHeight*window.devicePixelRatio,this.calculator.setDisplayWidth(this.canvas.width),this.refresh()}#r(){hh(this,this.refresh)}draw(){this.clear(),this.#n?this.#i.removeAttribute("hidden"):this.#i.setAttribute("hidden","hidden");for(const e of this.counters)e.calculateVisibleIndexes(this.calculator),e.calculateXValues(this.canvas.width);for(const e of this.counterUI)e.drawGraph(this.canvas)}onClick(e){const t=e.x-this.canvasContainer.getBoundingClientRect().left;let i=1/0,n;for(const s of this.counterUI){if(!s.counter.times.length)continue;const r=s.recordIndexAt(t),o=Math.abs(t*window.devicePixelRatio-s.counter.x[r]);o<i&&(i=o,n=s.counter.times[r])}n!==void 0&&this.#e&&this.delegate.selectEntryAtTime(this.#e,n)}onMouseLeave(e){delete this.markerXPosition,this.clearCurrentValueAndMarker()}clearCurrentValueAndMarker(){for(let e=0;e<this.counterUI.length;e++)this.counterUI[e].clearCurrentValueAndMarker()}onMouseMove(e){const t=e.x-this.canvasContainer.getBoundingClientRect().left;this.markerXPosition=t,this.refreshCurrentValues()}refreshCurrentValues(){if(this.markerXPosition!==void 0)for(let e=0;e<this.counterUI.length;++e)this.counterUI[e].updateCurrentValue(this.markerXPosition)}refresh(){this.timelineGrid.updateDividers(this.calculator),this.draw(),this.refreshCurrentValues()}clear(){const e=this.canvas.getContext("2d");if(!e)throw new Error("Unable to get canvas context");e.clearRect(0,0,e.canvas.width,e.canvas.height)}}class Ic{times;values;x;minimumIndex;maximumIndex;maxTime;minTime;limitValue;constructor(){this.times=[],this.values=[],this.x=[],this.minimumIndex=0,this.maximumIndex=0,this.maxTime=0,this.minTime=0}appendSample(e,t){this.values.length&&this.values[this.values.length-1]===t||(this.times.push(e),this.values.push(t))}reset(){this.times=[],this.values=[]}setLimit(e){this.limitValue=e}calculateBounds(){let e,t;for(let i=this.minimumIndex;i<=this.maximumIndex;i++){const n=this.values[i];(t===void 0||n<t)&&(t=n),(e===void 0||n>e)&&(e=n)}return t=t||0,e=e||1,this.limitValue&&(e>this.limitValue*.5&&(e=Math.max(e,this.limitValue)),t=Math.min(t,this.limitValue)),{min:t,max:e}}calculateVisibleIndexes(e){const t=e.minimumBoundary(),i=e.maximumBoundary();this.minimumIndex=Mn(js(this.times,t,ks)-1,0,this.times.length-1),this.maximumIndex=Mn(uh(this.times,i,ks),0,this.times.length-1),this.minTime=t,this.maxTime=i}calculateXValues(e){if(!this.values.length)return;const t=e/(this.maxTime-this.minTime);this.x=new Array(this.values.length);for(let i=this.minimumIndex+1;i<=this.maximumIndex;i++)this.x[i]=t*(this.times[i]-this.minTime)}}class Pc{countersPane;counter;formatter;setting;filter;range;value;graphColor;limitColor;graphYValues;verticalPadding;currentValueLabel;marker;constructor(e,t,i,n,s,r){this.countersPane=e,this.counter=s,this.formatter=r||Va,this.setting=Te.instance().createSetting("timeline-counters-graph-"+i,!0),this.setting.setTitle(t),this.filter=new _o(this.setting,t),this.filter.inputElement.classList.add("-theme-preserve-input");const o=Cs(n);if(o){const l=o.setAlpha(.5).asString("rgba"),d=this.filter.element;l&&(d.style.backgroundColor=l),d.style.borderColor="transparent"}this.filter.inputElement.addEventListener("click",this.toggleCounterGraph.bind(this)),e.toolbar.appendToolbarItem(this.filter),this.range=this.filter.element.createChild("span","range"),this.value=e.currentValuesBar.createChild("span","memory-counter-value"),this.value.style.color=n,this.graphColor=n,o&&(this.limitColor=o.setAlpha(.3).asString("rgba")),this.graphYValues=[],this.verticalPadding=10,this.currentValueLabel=t,this.marker=e.canvasContainer.createChild("div","memory-counter-marker"),this.marker.style.backgroundColor=n,this.clearCurrentValueAndMarker()}reset(){this.range.textContent=""}setRange(e,t){const i=this.formatter(e),n=this.formatter(t);this.range.textContent=Ci(ai.ss,{PH1:i,PH2:n})}toggleCounterGraph(){this.value.classList.toggle("hidden",!this.filter.checked()),this.countersPane.refresh()}recordIndexAt(e){return js(this.counter.x,e*window.devicePixelRatio,ks,this.counter.minimumIndex+1,this.counter.maximumIndex+1)-1}updateCurrentValue(e){if(!this.visible()||!this.counter.values.length||!this.counter.x)return;const t=this.recordIndexAt(e),i=Va(this.counter.values[t]);this.value.textContent=`${this.currentValueLabel}: ${i}`;const n=this.graphYValues[t]/window.devicePixelRatio;this.marker.style.left=e+"px",this.marker.style.top=n+"px",this.marker.classList.remove("hidden")}clearCurrentValueAndMarker(){this.value.textContent="",this.marker.classList.add("hidden")}drawGraph(e){const t=e.getContext("2d");if(!t)throw new Error("Unable to get canvas context");const i=e.width,n=e.height-2*this.verticalPadding;if(n<=0){this.graphYValues=[];return}const s=this.verticalPadding,r=this.counter,o=r.values;if(!o.length)return;const l=r.calculateBounds(),d=l.min,c=l.max;if(this.setRange(d,c),!this.visible())return;const h=this.graphYValues,u=c-d,m=u?n/u:1;t.save(),t.lineWidth=window.devicePixelRatio,t.lineWidth%2&&t.translate(.5,.5),t.beginPath();let v=o[r.minimumIndex],T=Math.round(s+n-(v-d)*m);t.moveTo(0,T);let E=r.minimumIndex;for(;E<=r.maximumIndex;E++){const U=Math.round(r.x[E]);t.lineTo(U,T);const w=o[E];typeof w<"u"&&(v=w),T=Math.round(s+n-(v-d)*m),t.lineTo(U,T),h[E]=T}if(h.length=E,t.lineTo(i,T),t.strokeStyle=this.graphColor,t.stroke(),r.limitValue){const U=Math.round(s+n-(r.limitValue-d)*m);t.moveTo(0,U),t.lineTo(i,U),this.limitColor&&(t.strokeStyle=this.limitColor),t.stroke()}t.closePath(),t.restore()}visible(){return this.filter.checked()}}class Lc{minimumBoundaryInternal;maximumBoundaryInternal;workingArea;zeroTimeInternal;constructor(){this.minimumBoundaryInternal=0,this.maximumBoundaryInternal=0,this.workingArea=0,this.zeroTimeInternal=0}setZeroTime(e){this.zeroTimeInternal=e}computePosition(e){return(e-this.minimumBoundaryInternal)/this.boundarySpan()*this.workingArea}setWindow(e,t){this.minimumBoundaryInternal=e,this.maximumBoundaryInternal=t}setDisplayWidth(e){this.workingArea=e}formatValue(e,t){return Ye(e-this.zeroTime(),t)}maximumBoundary(){return this.maximumBoundaryInternal}minimumBoundary(){return this.minimumBoundaryInternal}zeroTime(){return this.zeroTimeInternal}boundarySpan(){return this.maximumBoundaryInternal-this.minimumBoundaryInternal}}const Uf=Object.freeze(Object.defineProperty({__proto__:null,Calculator:Lc,Counter:Ic,CounterUI:Pc,CountersGraph:xc},Symbol.toStringTag,{value:"Module"}));function Yt(a,e){const t=Y.instance(),i=a.Workers.workerIdByThread.get(e.tid);return i?t.targetById(i):t.primaryPageTarget()}const zf=Object.freeze(Object.defineProperty({__proto__:null,targetForEvent:Yt},Symbol.toStringTag,{value:"Module"})),Rc={threadS:"Thread {PH1}"},bg=A("models/timeline_model/TimelineJSProfile.ts",Rc),wg=N.bind(void 0,bg);class sn{static isNativeRuntimeFrame(e){return e.url==="native V8Runtime"}static nativeGroup(e){return e.startsWith("Parse")?"Parse":e.startsWith("Compile")||e.startsWith("Recompile")?"Compile":null}static createFakeTraceFromCpuProfile(e,t){const i=[],n=wg(Rc.threadS,{PH1:t});if(s("TracingStartedInPage",{data:{sessionId:"1"}},0,0,"M"),s("thread_name",{name:n},0,0,"M","__metadata"),!e)return i;return s("JSRoot",{},e.startTime,e.endTime-e.startTime,"X","toplevel"),s("CpuProfile",{data:{cpuProfile:e}},e.endTime,0,"X"),i;function s(r,o,l,d,c,h){const u={cat:h||"disabled-by-default-devtools.timeline",name:r,ph:c||"X",pid:ph(1),tid:t,ts:_(l),args:o};return d&&(u.dur=_(d)),i.push(u),u}}}class Zn{}class Ia extends Zn{visibleTypes;constructor(e){super(),this.visibleTypes=new Set(e)}accept(e){return pt(e)?!0:this.visibleTypes.has(Ia.eventType(e))}static eventType(e){return zt(e,"blink.console")?"ConsoleTime":zt(e,"blink.user_timing")?"UserTiming":e.name}}class Tg extends Zn{#e;constructor(e){super(),this.#e=new Set(e)}accept(e){return!this.#e.has(e.name)}}let cr=class{totalTime;selfTime;id;event;parent;groupId;isGroupNodeInternal;depth;constructor(e,t){this.totalTime=0,this.selfTime=0,this.id=e,this.event=t,this.groupId="",this.isGroupNodeInternal=!1,this.depth=0}isGroupNode(){return this.isGroupNodeInternal}hasChildren(){throw"Not implemented"}setHasChildren(e){throw"Not implemented"}children(){throw"Not implemented"}searchTree(e,t){t=t||[],this.event&&e(this.event)&&t.push(this);for(const i of this.children().values())i.searchTree(e,t);return t}};class Pa extends cr{root;hasChildrenInternal;childrenInternal;parent;constructor(e,t,i){super(e,t),this.root=i&&i.root,this.hasChildrenInternal=!1,this.childrenInternal=null,this.parent=i}hasChildren(){return this.hasChildrenInternal}setHasChildren(e){this.hasChildrenInternal=e}children(){return this.childrenInternal||this.buildChildren()}buildChildren(){const e=[];for(let w=this;w.parent&&!w.isGroupNode();w=w.parent)e.push(w);e.reverse();const t=new Map,i=this,n=this.root;if(!n)return this.childrenInternal=t,this.childrenInternal;const s=n.startTime,r=n.endTime,o=n.doNotAggregate?v:void 0,l=n.doNotAggregate?void 0:$s,d=n.getEventGroupIdCallback();let c=0,h=0,u=null;qs(n.events,{onStartEvent:m,onEndEvent:U,onInstantEvent:o,startTime:ee(s),endTime:ee(r),eventFilter:n.filter,ignoreAsyncEvents:!1});function m(w){const{startTime:x,endTime:C}=fe(w);if(++c,c>e.length+2||!E(w))return;const O=(C!==void 0?Math.min(C,r):r)-Math.max(s,x);O<0&&console.error("Negative event duration"),T(w,O)}function v(w){++c,h===e.length&&c<=e.length+2&&T(w,0),--c}function T(w,x){if(c===e.length+2){if(!u)return;u.setHasChildren(!0),u.selfTime-=x;return}let C,W="";l?(C=l(w),W=d?d(w):"",W&&(C+="/"+W)):C=Symbol("uniqueId");let O=t.get(C);O||(O=new Pa(C,w,i),O.groupId=W,t.set(C,O)),O.selfTime+=x,O.totalTime+=x,u=O}function E(w){const{endTime:x}=fe(w);if(h===e.length)return!0;if(h!==c-1||!x)return!1;if(!l)return w===e[h].event&&++h,!1;let C=l(w);const W=d?d(w):"";return W&&(C+="/"+W),C===e[h].id&&++h,!1}function U(){--c,h>c&&(h=c)}return this.childrenInternal=t,t}getRoot(){return this.root}}class Sg extends Pa{filter;events;startTime;endTime;eventGroupIdCallback;doNotAggregate;totalTime;selfTime;constructor(e,t,i,n,s,r){super("",null,null),this.root=this,this.events=e,this.filter=o=>t.every(l=>l.accept(o)),this.startTime=i,this.endTime=n,this.eventGroupIdCallback=r,this.doNotAggregate=s,this.totalTime=n-i,this.selfTime=this.totalTime}children(){return this.childrenInternal||this.grouppedTopNodes()}grouppedTopNodes(){const e=super.children();for(const i of e.values())this.selfTime-=i.totalTime;if(!this.eventGroupIdCallback)return e;const t=new Map;for(const i of e.values()){if(!i.event)continue;const n=this.eventGroupIdCallback(i.event);let s=t.get(n);s||(s=new Ac(n,this,i.event),t.set(n,s)),s.addChild(i,i.selfTime,i.totalTime)}return this.childrenInternal=t,t}getEventGroupIdCallback(){return this.eventGroupIdCallback}}class Eg extends cr{childrenInternal;events;textFilter;filter;startTime;endTime;eventGroupIdCallback;totalTime;constructor(e,t,i,n,s,r){super("",null),this.childrenInternal=null,this.events=e,this.textFilter=t,this.filter=o=>i.every(l=>l.accept(o)),this.startTime=n,this.endTime=s,this.eventGroupIdCallback=r,this.totalTime=s-n}hasChildren(){return!0}filterChildren(e){for(const[t,i]of e)i.event&&i.depth<=1&&!this.textFilter.accept(i.event)&&e.delete(t);return e}children(){return this.childrenInternal||(this.childrenInternal=this.filterChildren(this.grouppedTopNodes())),this.childrenInternal}ungrouppedTopNodes(){const e=this,t=this.startTime,i=this.endTime,n=new Map,s=[i-t],r=[],o=new Map;qs(this.events,{onStartEvent:l,onEndEvent:d,startTime:ee(this.startTime),endTime:ee(this.endTime),eventFilter:this.filter,ignoreAsyncEvents:!1});function l(c){const{startTime:h,endTime:u}=fe(c),v=(u!==void 0?Math.min(u,i):i)-Math.max(h,t);s[s.length-1]-=v,s.push(v);const T=$s(c),E=!o.has(T);E&&o.set(T,v),r.push(E)}function d(c){const h=$s(c);let u=n.get(h);u||(u=new La(e,h,c,!1,e),n.set(h,u)),u.selfTime+=s.pop()||0,r.pop()&&(u.totalTime+=o.get(h)||0,o.delete(h)),r.length&&u.setHasChildren(!0)}this.selfTime=s.pop()||0;for(const c of n)c[1].selfTime<=0&&n.delete(c[0]);return n}grouppedTopNodes(){const e=this.ungrouppedTopNodes();if(!this.eventGroupIdCallback)return e;const t=new Map;for(const i of e.values()){if(!i.event)continue;const n=this.eventGroupIdCallback(i.event);let s=t.get(n);s||(s=new Ac(n,this,i.event),t.set(n,s)),s.addChild(i,i.selfTime,i.selfTime)}return t}}class Ac extends cr{childrenInternal;isGroupNodeInternal;constructor(e,t,i){super(e,i),this.childrenInternal=new Map,this.parent=t,this.isGroupNodeInternal=!0}addChild(e,t,i){this.childrenInternal.set(e.id,e),this.selfTime+=t,this.totalTime+=i,e.parent=this}hasChildren(){return!0}children(){return this.childrenInternal}}class La extends cr{parent;root;depth;cachedChildren;hasChildrenInternal;constructor(e,t,i,n,s){super(t,i),this.parent=s,this.root=e,this.depth=(s.depth||0)+1,this.cachedChildren=null,this.hasChildrenInternal=n}hasChildren(){return this.hasChildrenInternal}setHasChildren(e){this.hasChildrenInternal=e}children(){if(this.cachedChildren)return this.cachedChildren;const e=[0],t=[],i=[],n=new Map,s=this.root.startTime,r=this.root.endTime;let o=s;const l=this;qs(this.root.events,{onStartEvent:d,onEndEvent:c,startTime:ee(s),endTime:ee(r),eventFilter:this.root.filter,ignoreAsyncEvents:!1});function d(h){const{startTime:u,endTime:m}=fe(h),T=(m!==void 0?Math.min(m,r):r)-Math.max(u,s);T<0&&console.assert(!1,"Negative duration of an event"),e[e.length-1]-=T,e.push(T);const E=$s(h);t.push(E),i.push(h)}function c(h){const{startTime:u,endTime:m}=fe(h),v=e.pop(),T=t.pop();i.pop();let E;for(E=l;E.depth>1;E=E.parent)if(E.id!==t[t.length+1-E.depth])return;if(E.id!==T||t.length<l.depth)return;const U=t[t.length-l.depth];if(E=n.get(U),!E){const C=i[i.length-l.depth],W=i.length>l.depth;E=new La(l.root,U,C,W,l),n.set(U,E)}const w=m!==void 0?Math.min(m,r):r,x=w-Math.max(u,o);E.selfTime+=v||0,E.totalTime+=x,o=w}return this.cachedChildren=this.root.filterChildren(n),this.cachedChildren}searchTree(e,t){return t=t||[],this.event&&e(this.event)&&t.push(this),t}}function $s(a){if(We(a)){const e=sn.isNativeRuntimeFrame(a.callFrame)?sn.nativeGroup(a.callFrame.functionName):a.callFrame.functionName,t=a.callFrame.scriptId||a.callFrame.url||"";return`f:${e}@${t}`}return xs(a)?`${a.name}:${a.args.data.message}`:a.name}class Cg extends ip{tileById;paintProfilerModel;constructor(e){super(e),this.tileById=new Map,this.paintProfilerModel=e&&e.model(da)}async setLayers(e,t,i){const n=new Set;if(e)this.extractNodeIdsToResolve(n,{},e);else if(t)for(let r=0;r<t.length;++r)this.extractNodeIdsToResolve(n,{},t[r]);await this.resolveBackendNodeIds(n);const s=this.layersById;if(this.layersById=new Map,this.setContentRoot(null),e){const r=this.innerSetLayers(s,e);this.setRoot(r)}else if(t){const r=t.map(this.innerSetLayers.bind(this,s)),o=this.contentRoot();if(!o)throw new Error("Content root is not set.");this.setRoot(o);for(let l=0;l<r.length;++l)r[l].id()!==o.id()&&o.addChild(r[l])}this.setPaints(i)}setTiles(e){this.tileById=new Map;for(const t of e)this.tileById.set(t.id,t)}pictureForRasterTile(e){const t=this.tileById.get("cc::Tile/"+e);if(!t)return Is.instance().error(`Tile ${e} is missing`),Promise.resolve(null);const i=this.layerById(t.layer_id);return i?i.pictureForRect(t.content_rect):(Is.instance().error(`Layer ${t.layer_id} for tile ${e} is not found`),Promise.resolve(null))}setPaints(e){for(let t=0;t<e.length;++t){const i=this.layersById.get(e[t].layerId());i&&i.addPaintEvent(e[t])}}innerSetLayers(e,t){let i=e.get(t.layer_id);i?i.reset(t):i=new kg(this.paintProfilerModel,t),this.layersById.set(t.layer_id,i),t.owner_node&&i.setNode(this.backendNodeIdToNode().get(t.owner_node)||null),!this.contentRoot()&&i.drawsContent()&&this.setContentRoot(i);for(let n=0;t.children&&n<t.children.length;++n)i.addChild(this.innerSetLayers(e,t.children[n]));return i}extractNodeIdsToResolve(e,t,i){const n=i.owner_node;n&&!this.backendNodeIdToNode().has(n)&&e.add(n);for(let s=0;i.children&&s<i.children.length;++s)this.extractNodeIdsToResolve(e,t,i.children[s])}}class Nc{#e;#t;#i=[];constructor(e,t){this.#e=e,this.#t=t.entry,this.#i=t.paints}async layerTreePromise(){const e=this.#t.args.snapshot,t=e.device_viewport_size,i=e.active_tiles,n=e.active_tree.root_layer,s=e.active_tree.layers,r=new Cg(this.#e);return r.setViewportSize(t),r.setTiles(i),await r.setLayers(n,s,this.#i||[]),r}paints(){return this.#i}}class kg{parentLayerId;parentInternal;layerId;nodeInternal;offsetXInternal;offsetYInternal;widthInternal;heightInternal;childrenInternal;quadInternal;scrollRectsInternal;gpuMemoryUsageInternal;paints;compositingReasons;compositingReasonIds;drawsContentInternal;paintProfilerModel;constructor(e,t){this.parentLayerId=null,this.parentInternal=null,this.layerId="",this.nodeInternal=null,this.offsetXInternal=-1,this.offsetYInternal=-1,this.widthInternal=-1,this.heightInternal=-1,this.childrenInternal=[],this.quadInternal=[],this.scrollRectsInternal=[],this.gpuMemoryUsageInternal=-1,this.paints=[],this.compositingReasons=[],this.compositingReasonIds=[],this.drawsContentInternal=!1,this.paintProfilerModel=e,this.reset(t)}reset(e){this.nodeInternal=null,this.layerId=String(e.layer_id),this.offsetXInternal=e.position[0],this.offsetYInternal=e.position[1],this.widthInternal=e.bounds.width,this.heightInternal=e.bounds.height,this.childrenInternal=[],this.parentLayerId=null,this.parentInternal=null,this.quadInternal=e.layer_quad||[],this.createScrollRects(e),this.compositingReasons=e.compositing_reasons||[],this.compositingReasonIds=e.compositing_reason_ids||[],this.drawsContentInternal=!!e.draws_content,this.gpuMemoryUsageInternal=e.gpu_memory_usage,this.paints=[]}id(){return this.layerId}parentId(){return this.parentLayerId}parent(){return this.parentInternal}isRoot(){return!this.parentId()}children(){return this.childrenInternal}addChild(e){const t=e;t.parentInternal&&console.assert(!1,"Child already has a parent"),this.childrenInternal.push(t),t.parentInternal=this,t.parentLayerId=this.layerId}setNode(e){this.nodeInternal=e}node(){return this.nodeInternal}nodeForSelfOrAncestor(){let e=this;for(;e;e=e.parent())if(e.node())return e.node();return null}offsetX(){return this.offsetXInternal}offsetY(){return this.offsetYInternal}width(){return this.widthInternal}height(){return this.heightInternal}transform(){return null}quad(){return this.quadInternal}anchorPoint(){return[.5,.5,0]}invisible(){return!1}paintCount(){return 0}lastPaintRect(){return null}scrollRects(){return this.scrollRectsInternal}stickyPositionConstraint(){return null}gpuMemoryUsage(){return this.gpuMemoryUsageInternal}snapshots(){return this.paints.map(async e=>{if(!this.paintProfilerModel)return null;const t=await xg(this.paintProfilerModel,e);return t?{rect:{x:t.rect[0],y:t.rect[1],width:t.rect[2],height:t.rect[3]},snapshot:t.snapshot}:null})}async pictureForRect(e){return Promise.all(this.paints.map(n=>n.picture())).then(n=>{const r=n.filter(c=>c&&i(c.rect,e)).map(c=>({x:c.rect[0],y:c.rect[1],picture:c.serializedPicture}));if(!r.length||!this.paintProfilerModel)return null;const o=r.reduce((c,h)=>Math.min(c,h.x),1/0),l=r.reduce((c,h)=>Math.min(c,h.y),1/0),d={x:e[0]-o,y:e[1]-l,width:e[2],height:e[3]};return this.paintProfilerModel.loadSnapshotFromFragments(r).then(c=>c?{rect:d,snapshot:c}:null)});function t(n,s,r,o){return console.assert(n<=s&&r<=o,"segments should be specified as ordered pairs"),s>r&&n<o}function i(n,s){return t(n[0],n[0]+n[2],s[0],s[0]+s[2])&&t(n[1],n[1]+n[3],s[1],s[1]+s[3])}}scrollRectsFromParams(e,t){return{rect:{x:e[0],y:e[1],width:e[2],height:e[3]},type:t}}createScrollRects(e){const t=[];e.non_fast_scrollable_region&&t.push(this.scrollRectsFromParams(e.non_fast_scrollable_region,"NonFastScrollable")),e.touch_event_handler_region&&t.push(this.scrollRectsFromParams(e.touch_event_handler_region,"TouchEventHandler")),e.wheel_event_handler_region&&t.push(this.scrollRectsFromParams(e.wheel_event_handler_region,"WheelEventHandler")),e.scroll_event_handler_region&&t.push(this.scrollRectsFromParams(e.scroll_event_handler_region,"RepaintsOnScroll")),this.scrollRectsInternal=t}addPaintEvent(e){this.paints.push(e)}requestCompositingReasons(){return Promise.resolve(this.compositingReasons)}requestCompositingReasonIds(){return Promise.resolve(this.compositingReasonIds)}drawsContent(){return this.drawsContentInternal}}async function xg(a,e){const t=e.picture();if(!t||!a)return null;const i=await a.loadSnapshot(t.serializedPicture);return i?{rect:t.rect,snapshot:i}:null}function _n(a){const e=a.args.color;let t="--ref-palette-primary70";switch(e){case"primary":t="--ref-palette-primary70";break;case"primary-light":t="--ref-palette-primary80";break;case"primary-dark":t="--ref-palette-primary60";break;case"secondary":t="--ref-palette-purple80";break;case"secondary-light":t="--ref-palette-purple90";break;case"secondary-dark":t="--ref-palette-purple70";break;case"tertiary":t="--ref-palette-tertiary70";break;case"tertiary-light":t="--ref-palette-tertiary80";break;case"tertiary-dark":t="--ref-palette-tertiary60";break;case"warning":t="--ref-palette-yellow70";break;case"error":t="--ref-palette-error60";break}return ie.instance().getComputedValue(t)}const So=Symbol("SelectionRange");class B{startTime;endTime;object;constructor(e,t,i){this.startTime=e,this.endTime=t,this.object=i}static isLegacyTimelineFrame(e){return typeof e!="symbol"&&jn(e)}static fromFrame(e){return new B($(e.startTime),$(e.endTime),e)}static isSyntheticNetworkRequestDetailsEventSelection(e){return B.isLegacyTimelineFrame(e)||B.isRangeSelection(e)?!1:Dt(e)}static isNetworkEventSelection(e){return B.isLegacyTimelineFrame(e)||B.isRangeSelection(e)?!1:ca(e)}static isTraceEventSelection(e){return!(B.isLegacyTimelineFrame(e)||B.isRangeSelection(e)||Dt(e))}static fromTraceEvent(e){const{startTime:t,endTime:i}=fe(e);return new B(t,se(i||t+1),e)}static isRangeSelection(e){return e===So}static fromRange(e,t){return new B(se(e),se(t),So)}}const jf=Object.freeze(Object.defineProperty({__proto__:null,TimelineSelection:B},Symbol.toStringTag,{value:"Module"})),p={emptyPlaceholder:"{PH1}",timestamp:"Timestamp",interactionID:"ID",inputDelay:"Input delay",processingDuration:"Processing duration",presentationDelay:"Presentation delay",compile:"Compile",parse:"Parse",sS:"{PH1}: {PH2}",sCollected:"{PH1} collected",sSs:"{PH1} [{PH2}â€¦{PH3}]",sSSquareBrackets:"{PH1} [{PH2}â€¦]",learnMore:"Learn more",compilationCacheStatus:"Compilation cache status",compilationCacheSize:"Compilation cache size",compilationCacheKind:"Compilation cache kind",scriptLoadedFromCache:"script loaded from cache",failedToLoadScriptFromCache:"failed to load script from cache",scriptNotEligibleToBeLoadedFromCache:"script not eligible",totalTime:"Total time",selfTime:"Self time",collected:"Collected",function:"Function",timerId:"Timer ID",timeout:"Timeout",repeats:"Repeats",callbackId:"Callback ID",module:"Module",script:"Script",streamed:"Streamed",eagerCompile:"Compiling all functions eagerly",url:"Url",producedCacheSize:"Produced cache size",consumedCacheSize:"Consumed cache size",location:"Location",sSCurlyBrackets:"({PH1}, {PH2})",dimensions:"Dimensions",sSDimensions:"{PH1} Ã— {PH2}",layerRoot:"Layer root",ownerElement:"Owner element",imageUrl:"Image URL",stylesheetUrl:"Stylesheet URL",elementsAffected:"Elements affected",nodesThatNeedLayout:"Nodes that need layout",sOfS:"{PH1} of {PH2}",layoutRoot:"Layout root",message:"Message",callbackFunction:"Callback function",range:"Range",allottedTime:"Allotted time",invokedByTimeout:"Invoked by timeout",type:"Type",size:"Size",details:"Details",cumulativeLayoutShifts:"Cumulative Layout Shifts",evolvedClsLink:"evolved",sCLSInformation:"{PH1} can result in poor user experiences. It has recently {PH2}.",warning:"Warning",score:"Score",cumulativeScore:"Cumulative score",currentClusterScore:"Current cluster score",currentClusterId:"Current cluster ID",hadRecentInput:"Had recent input",yes:"Yes",no:"No",movedFrom:"Moved from",movedTo:"Moved to",relatedNode:"Related node",preview:"Preview",aggregatedTime:"Aggregated time",duration:"Duration",initiatorStackTrace:"Initiator stack trace",initiatedBy:"Initiated by",initiatorFor:"Initiator for",traceEvent:"Trace event",timerInstalled:"Timer installed",animationFrameRequested:"Animation frame requested",idleCallbackRequested:"Idle callback requested",recalculationForced:"Recalculation forced",firstLayoutInvalidation:"First layout invalidation",layoutForced:"Layout forced",animating:"Animating",compositingFailed:"Compositing failed",compositingFailedAcceleratedAnimationsDisabled:"Accelerated animations disabled",compositingFailedEffectSuppressedByDevtools:"Effect suppressed by DevTools ",compositingFailedInvalidAnimationOrEffect:"Invalid animation or effect",compositingFailedEffectHasUnsupportedTimingParams:"Effect has unsupported timing parameters",compositingFailedEffectHasNonReplaceCompositeMode:'Effect has composite mode other than "replace"',compositingFailedTargetHasInvalidCompositingState:"Target has invalid compositing state",compositingFailedTargetHasIncompatibleAnimations:"Target has another animation which is incompatible",compositingFailedTargetHasCSSOffset:"Target has CSS offset",compositingFailedAnimationAffectsNonCSSProperties:"Animation affects non-CSS properties",compositingFailedTransformRelatedPropertyCannotBeAcceleratedOnTarget:"Transform-related property cannot be accelerated on target",compositingFailedTransformDependsBoxSize:"Transform-related property depends on box size",compositingFailedFilterRelatedPropertyMayMovePixels:"Filter-related property may move pixels",compositingFailedUnsupportedCSSProperty:`{propertyCount, plural,
    =1 {Unsupported CSS property: {properties}}
    other {Unsupported CSS properties: {properties}}
  }`,compositingFailedMixedKeyframeValueTypes:"Mixed keyframe value types",compositingFailedTimelineSourceHasInvalidCompositingState:"Timeline source has invalid compositing state",compositingFailedAnimationHasNoVisibleChange:"Animation has no visible change",compositingFailedAffectsImportantProperty:"Effect affects a property with !important",compositingFailedSVGTargetHasIndependentTransformProperty:"SVG target has independent transform property",compositingFailedUnknownReason:"Unknown Reason",stackTrace:"Stack trace",invalidations:"Invalidations ({PH1} total)",pendingFor:"Pending for",firstInvalidated:"First invalidated",paintProfiler:"Paint profiler",sAtS:"{PH1} at {PH2}",sSelf:"{PH1} (self)",sChildren:"{PH1} (children)",timeSpentInRendering:"Time spent in rendering",frame:"Frame",sAtSParentheses:"{PH1} (at {PH2})",UnknownNode:"[ unknown node ]",invalidationWithCallFrame:"{PH1} at {PH2}",outsideBreadcrumbRange:"(outside of the breadcrumb range)",entryIsHidden:"(entry is hidden)",selectorStatsTitle:"Selector stats",sSelectorStatsInfo:'Select "{PH1}" to collect detailed CSS selector matching statistics.',description:"Description"},vs=A("panels/timeline/TimelineUIUtils.ts",p),g=N.bind(void 0,vs);let ds,hs;class R{static frameDisplayName(e){if(!sn.isNativeRuntimeFrame(e))return mh(e.functionName);switch(sn.nativeGroup(e.functionName)){case"Compile":return g(p.compile);case"Parse":return g(p.parse)}return e.functionName}static testContentMatching(e,t,i){const s=[R.eventStyle(e).title];if(We(e)&&(!i||!i.Samples?s.push(e.callFrame.functionName):s.push(Lo(i.Samples,e))),i){const l=Kt(i,e);l&&s.push(l)}o(e.args,2);const r=s.join("|").match(t);return r?r.length>0:!1;function o(l,d){if(d)for(const c in l){const h=l[c];typeof h=="string"?s.push(h):typeof h=="number"?s.push(String(h)):typeof h=="object"&&h!==null&&o(h,d-1)}}}static eventStyle(e){return We(e)&&e.callFrame.functionName==="(idle)"?new f(e.name,$e().idle):e.cat===dt.Console||e.cat===dt.UserTiming?new f(e.name,$e().scripting):tn(e.name)??new f(e.name,$e().other)}static eventColor(e){if(We(e)){const i=e.callFrame;if(R.isUserFrame(i))return R.colorForId(i.url)}if(pt(e))return _n(e);let t=R.eventStyle(e).category.getComputedColorValue();if(e.name==="v8.parseOnBackgroundWaiting"&&(t=$e().scripting.getComputedColorValue(),!t))throw new Error("Unable to parse color from getCategoryStyles().scripting.color");return t}static eventTitle(e){if(We(e))return Ot.resolvedCodeLocationForEntry(e)?.name||R.frameDisplayName(e.callFrame);if(e.name==="EventTiming"&&Ni(e))return Ge(e);const t=R.eventStyle(e).title;return zt(e,dt.Console)?t:xs(e)?g(p.sS,{PH1:t,PH2:e.args.data.message}):gh(e)&&e.args.data.name?g(p.sS,{PH1:t,PH2:e.args.data.name}):Ro(e)?g(p.sS,{PH1:t,PH2:e.args.data.type}):t}static isUserFrame(e){return e.scriptId!=="0"&&!(e.url&&e.url.startsWith("native "))}static async buildDetailsTextForTraceEvent(e,t){let i;const n=e.args,s=e.args?.data;switch(e.name){case"GCEvent":case"MajorGC":case"MinorGC":{const o=n.usedHeapSizeBefore-n.usedHeapSizeAfter;i=g(p.sCollected,{PH1:Ke(o)});break}case"FunctionCall":{const{lineNumber:o,columnNumber:l}=mi(e);o!==void 0&&l!==void 0&&(i=s.url+":"+(o+1)+":"+(l+1));break}case"EventDispatch":i=s?s.type:null;break;case"Paint":{const o=R.quadWidth(s.clip),l=R.quadHeight(s.clip);o&&l&&(i=g(p.sSDimensions,{PH1:o,PH2:l}));break}case"ParseHTML":{const o=n.beginData.startLine,l=n.endData&&n.endData.endLine,d=ri(n.beginData.url);l>=0?i=g(p.sSs,{PH1:d,PH2:o+1,PH3:l+1}):i=g(p.sSSquareBrackets,{PH1:d,PH2:o+1});break}case"V8.CompileModule":case"v8.produceModuleCache":i=ri(n.fileName);break;case"V8.CompileScript":case"v8.produceCache":case"EvaluateScript":{const{lineNumber:o}=mi(e),l=s&&s.url;l&&(i=ri(l)+":"+((o||0)+1));break}case"v8.wasm.compiledModule":case"v8.wasm.moduleCacheHit":{const o=n.url;o&&(i=ri(o));break}case"v8.parseOnBackground":case"v8.deserializeOnBackground":case"XHRReadyStateChange":case"XHRLoad":{const o=s.url;o&&(i=ri(o));break}case"TimeStamp":i=s.message;break;case"WebSocketCreate":case"WebSocketSendHandshakeRequest":case"WebSocketReceiveHandshakeResponse":case"WebSocketSend":case"WebSocketReceive":case"WebSocketDestroy":case"ResourceWillSendRequest":case"ResourceSendRequest":case"ResourceReceivedData":case"ResourceReceiveResponse":case"ResourceFinish":case"PaintImage":case"Decode Image":case"Decode LazyPixelRef":{const o=Kt(t,e);o&&(i=ri(o));break}case"EmbedderCallback":i=s.callbackName;break;case"AsyncTask":i=s?s.name:null;break;default:zt(e,dt.Console)?i=null:i=r();break}return i;function r(){const o=si(e)?.at(0)??null;return o?o.url+":"+(o.lineNumber+1)+":"+(o.columnNumber+1):null}}static async buildDetailsNodeForTraceEvent(e,t,i,n=!1,s){let r=null,o;const l=e.args,d=e.args?.data;switch(e.name){case"GCEvent":case"MajorGC":case"MinorGC":case"EventDispatch":case"Paint":case"Animation":case"EmbedderCallback":case"ParseHTML":case"v8.wasm.streamFromResponseCallback":case"v8.wasm.compiledModule":case"v8.wasm.moduleCacheHit":case"v8.wasm.cachedModule":case"v8.wasm.moduleCacheInvalid":case"WebSocketCreate":case"WebSocketSendHandshakeRequest":case"WebSocketReceiveHandshakeResponse":case"WebSocketSend":case"WebSocketReceive":case"WebSocketDestroy":{o=await R.buildDetailsTextForTraceEvent(e,s);break}case"PaintImage":case"Decode Image":case"Decode LazyPixelRef":case"XHRReadyStateChange":case"XHRLoad":case"ResourceWillSendRequest":case"ResourceSendRequest":case"ResourceReceivedData":case"ResourceReceiveResponse":case"ResourceFinish":{const c=Kt(s,e);if(c){const h={tabStop:!0,showColumnNumber:!1,inlineFrameIndex:0};r=Mt.linkifyURL(c,h)}break}case"FunctionCall":{r=document.createElement("span"),vh(e)&&e.args.data&&yh(e.args.data)&&qt(r,R.frameDisplayName({...e.args.data,scriptId:String(e.args.data.scriptId)}));const{lineNumber:c,columnNumber:h}=mi(e),u=this.linkifyLocation({scriptId:d.scriptId,url:d.url,lineNumber:c||0,columnNumber:h,target:t,isFreshRecording:n,linkifier:i});u&&(qt(r," @ "),r.appendChild(u));break}case"V8.CompileModule":case"v8.produceModuleCache":{r=this.linkifyLocation({scriptId:null,url:l.fileName,lineNumber:0,columnNumber:0,target:t,isFreshRecording:n,linkifier:i});break}case"V8.CompileScript":case"v8.produceCache":case"EvaluateScript":{const c=d.url;if(c){const{lineNumber:h}=mi(e);r=this.linkifyLocation({scriptId:null,url:c,lineNumber:h||0,columnNumber:0,target:t,isFreshRecording:n,linkifier:i})}break}case"v8.deserializeOnBackground":case"v8.parseOnBackground":{const c=d.url;c&&(r=this.linkifyLocation({scriptId:null,url:c,lineNumber:0,columnNumber:0,target:t,isFreshRecording:n,linkifier:i}));break}case"ProfileCall":{if(r=document.createElement("span"),!We(e))break;const h=Ot.resolvedCodeLocationForEntry(e)?.name||R.frameDisplayName(e.callFrame);qt(r,h);const u=this.linkifyLocation({scriptId:e.callFrame.scriptId,url:e.callFrame.url,lineNumber:e.callFrame.lineNumber,columnNumber:e.callFrame.columnNumber,target:t,isFreshRecording:n,linkifier:i});u&&(qt(r," @ "),r.appendChild(u));break}default:{zt(e,dt.Console)||fh(e)||pt(e)?o=null:r=this.linkifyTopCallFrame(e,t,i,n)??null;break}}return!r&&o&&(r=document.createTextNode(o)),r}static linkifyLocation(e){const{scriptId:t,url:i,lineNumber:n,columnNumber:s,isFreshRecording:r,linkifier:o,target:l}=e,d={lineNumber:n,columnNumber:s,showColumnNumber:!0,inlineFrameIndex:0,className:"timeline-details",tabStop:!0};return r?o.linkifyScriptLocation(l,t,i,n,d):Mt.linkifyURL(i,d)}static linkifyTopCallFrame(e,t,i,n=!1){let s=si(e)?.[0];if(We(e)&&(s=e.callFrame),!s)return null;const r={className:"timeline-details",tabStop:!0,inlineFrameIndex:0,showColumnNumber:!0,columnNumber:s.columnNumber,lineNumber:s.lineNumber};return n?i.maybeLinkifyConsoleCallFrame(t,s,{showColumnNumber:!0,inlineFrameIndex:0}):Mt.linkifyURL(s.url,r)}static buildDetailsNodeForMarkerEvents(e){let t="https://web.dev/user-centric-performance-metrics/",i="page performance metrics";switch(e.name){case"largestContentfulPaint::Candidate":t="https://web.dev/lcp/",i="largest contentful paint";break;case"firstContentfulPaint":t="https://web.dev/first-contentful-paint/",i="first contentful paint";break}return Wo`<div>${tt.create(t,g(p.learnMore),void 0,void 0,"learn-more")} about ${i}.</div>`}static buildConsumeCacheDetails(e,t){if(typeof e.consumedCacheSize=="number"){t.appendTextRow(g(p.compilationCacheStatus),g(p.scriptLoadedFromCache)),t.appendTextRow(g(p.compilationCacheSize),Ke(e.consumedCacheSize));const i=e.cacheKind;i&&t.appendTextRow(g(p.compilationCacheKind),i)}else"cacheRejected"in e&&e.cacheRejected?t.appendTextRow(g(p.compilationCacheStatus),g(p.failedToLoadScriptFromCache)):t.appendTextRow(g(p.compilationCacheStatus),g(p.scriptNotEligibleToBeLoadedFromCache))}static async buildTraceEventDetails(e,t,i,n){const s=Yt(e,t),{duration:r}=fe(t),o=Eo(t,e),l=await gp(e,t);if(s&&typeof t[Cn]>"u"){let S=null;const k=Kt(e,t);k?S=await In.build(s,k,!1,{imageAltText:In.defaultAltTextForImageURL(k),precomputedFeatures:void 0,align:"start"}):Rn(t)&&(S=await R.buildPicturePreviewContent(e,t,s)),t[Cn]=S}Ai(t)&&(n=!1);let d;const c=new Bs(Yt(e,t),i),h=this.eventColor(t),m=e&&Fc(e,t)?R.markerStyleForEvent(t).color:h;c.addSection(R.eventTitle(t),m);const v=t.args,T=t.args?.data,E=e.Initiators.eventToInitiator.get(t)??null,U=e.Initiators.initiatorToEvents.get(t)??null;let w=null;if(e){const S=Tl(t,e);for(const k of S)c.appendElementRow(g(p.warning),k,!0)}if(zt(t,dt.UserTiming)){const S=Zr(t,e);c.appendTextRow(g(p.timestamp),Ye(S,1))}if(n&&!Number.isNaN(r||0)&&r!==0&&(c.appendTextRow(g(p.totalTime),ve(r||0,!0)),c.appendTextRow(g(p.selfTime),ve(o,!0))),Ps(t)&&t.args.data?.detail){const S=R.renderObjectJson(JSON.parse(t.args.data?.detail));c.appendElementRow(g(p.details),S)}if(bh(t)&&t.args?.data?.beginEvent.args.detail){const S=R.renderObjectJson(JSON.parse(t.args?.data?.beginEvent.args.detail));c.appendElementRow(g(p.details),S)}if(e.Meta.traceIsGeneric)return R.renderEventJson(t,c),c.fragment;if(wh(t)){if(w=t.args.data?.url,w){const{lineNumber:Z,columnNumber:Re}=mi(t);c.appendLocationRow(g(p.script),w,Z||0,Re)}!!t.args.data?.eager&&c.appendTextRow(g(p.eagerCompile),!0);const k=!!t.args.data?.streamed;c.appendTextRow(g(p.streamed),k+(k?"":`: ${t.args.data?.notStreamedReason||""}`)),t.args.data&&R.buildConsumeCacheDetails(t.args.data,c)}if(pt(t))for(const[S,k]of t.args.properties||[])c.appendTextRow(S,k);Vo(t)&&t.args.data.desc&&c.appendTextRow(g(p.description),t.args.data.desc);const x=!!(e&&Di.instance().recordingIsFresh(e));switch(t.name){case"GCEvent":case"MajorGC":case"MinorGC":{const S=v.usedHeapSizeBefore-v.usedHeapSizeAfter;c.appendTextRow(g(p.collected),Ke(S));break}case"ProfileCall":case"FunctionCall":{const S=await R.buildDetailsNodeForTraceEvent(t,Yt(e,t),i,x,e);S&&c.appendElementRow(g(p.function),S);break}case"TimerFire":case"TimerInstall":case"TimerRemove":{c.appendTextRow(g(p.timerId),T.timerId),t.name==="TimerInstall"&&(c.appendTextRow(g(p.timeout),ve(T.timeout)),c.appendTextRow(g(p.repeats),!T.singleShot));break}case"FireAnimationFrame":{c.appendTextRow(g(p.callbackId),T.id);break}case"V8.CompileModule":{c.appendLocationRow(g(p.module),v.fileName,0);break}case"V8.CompileScript":break;case"v8.produceModuleCache":{w=T&&T.url,c.appendTextRow(g(p.compilationCacheSize),Ke(T.producedCacheSize));break}case"v8.produceCache":{if(w=T&&T.url,w){const{lineNumber:S,columnNumber:k}=mi(t);c.appendLocationRow(g(p.script),w,S||0,k)}c.appendTextRow(g(p.compilationCacheSize),Ke(T.producedCacheSize));break}case"EvaluateScript":{if(w=T&&T.url,w){const{lineNumber:S,columnNumber:k}=mi(t);c.appendLocationRow(g(p.script),w,S||0,k)}break}case"v8.wasm.streamFromResponseCallback":case"v8.wasm.compiledModule":case"v8.wasm.cachedModule":case"v8.wasm.moduleCacheHit":case"v8.wasm.moduleCacheInvalid":{if(T){w=v.url,w&&c.appendTextRow(g(p.url),w);const S=v.producedCachedSize;S&&c.appendTextRow(g(p.producedCacheSize),S);const k=v.consumedCachedSize;k&&c.appendTextRow(g(p.consumedCacheSize),k)}break}case"Paint":{const S=T.clip;c.appendTextRow(g(p.location),g(p.sSCurlyBrackets,{PH1:S[0],PH2:S[1]}));const k=R.quadWidth(S),Z=R.quadHeight(S);c.appendTextRow(g(p.dimensions),g(p.sSDimensions,{PH1:k,PH2:Z}))}case"PaintSetup":case"Rasterize":case"ScrollLayer":{d=g(p.layerRoot);break}case"PaintImage":case"Decode LazyPixelRef":case"Decode Image":case"Draw LazyPixelRef":{if(d=g(p.ownerElement),w=Kt(e,t),w){const S={tabStop:!0,showColumnNumber:!1,inlineFrameIndex:0};c.appendElementRow(g(p.imageUrl),Mt.linkifyURL(w,S))}break}case"ParseAuthorStyleSheet":{if(w=T.styleSheetUrl,w){const S={tabStop:!0,showColumnNumber:!1,inlineFrameIndex:0};c.appendElementRow(g(p.stylesheetUrl),Mt.linkifyURL(w,S))}break}case"UpdateLayoutTree":{c.appendTextRow(g(p.elementsAffected),v.elementCount);const S=Te.instance().createSetting("timeline-capture-selector-stats",!1);if(!S.get()){const k=document.createElement("span");k.textContent=g(p.sSelectorStatsInfo,{PH1:S.title()}),c.appendElementRow(g(p.selectorStatsTitle),k)}break}case"Layout":{const S=v.beginData;c.appendTextRow(g(p.nodesThatNeedLayout),g(p.sOfS,{PH1:S.dirtyObjects,PH2:S.totalObjects})),d=g(p.layoutRoot);break}case"ConsoleTime":{c.appendTextRow(g(p.message),t.name);break}case"WebSocketCreate":case"WebSocketSendHandshakeRequest":case"WebSocketReceiveHandshakeResponse":case"WebSocketSend":case"WebSocketReceive":case"WebSocketDestroy":{if(zo(t)){const S=Rp(t,e);for(const{key:k,value:Z}of S)c.appendTextRow(k,Z)}break}case"EmbedderCallback":{c.appendTextRow(g(p.callbackFunction),T.callbackName);break}case"Animation":{if(!ra(t))break;const{displayName:S,nodeName:k}=t.args.data.beginEvent.args.data;S&&c.appendTextRow(g(p.animating),S),!l?.size&&k&&c.appendTextRow(g(p.relatedNode),k);const Re=rl.getNonCompositedFailure(t);if(!Re.length)break;const st=new Set(Re.map(at=>at.failureReasons).flat().filter(Boolean)),rt=new Set(Re.map(at=>at.unsupportedProperties).flat().filter(Boolean));if(st.size===0)c.appendElementRow(g(p.compositingFailed),g(p.compositingFailedUnknownReason),!0);else for(const at of st){let ce;switch(at){case"ACCELERATED_ANIMATIONS_DISABLED":ce=g(p.compositingFailedAcceleratedAnimationsDisabled);break;case"EFFECT_SUPPRESSED_BY_DEVTOOLS":ce=g(p.compositingFailedEffectSuppressedByDevtools);break;case"INVALID_ANIMATION_OR_EFFECT":ce=g(p.compositingFailedInvalidAnimationOrEffect);break;case"EFFECT_HAS_UNSUPPORTED_TIMING_PARAMS":ce=g(p.compositingFailedEffectHasUnsupportedTimingParams);break;case"EFFECT_HAS_NON_REPLACE_COMPOSITE_MODE":ce=g(p.compositingFailedEffectHasNonReplaceCompositeMode);break;case"TARGET_HAS_INVALID_COMPOSITING_STATE":ce=g(p.compositingFailedTargetHasInvalidCompositingState);break;case"TARGET_HAS_INCOMPATIBLE_ANIMATIONS":ce=g(p.compositingFailedTargetHasIncompatibleAnimations);break;case"TARGET_HAS_CSS_OFFSET":ce=g(p.compositingFailedTargetHasCSSOffset);break;case"ANIMATION_AFFECTS_NON_CSS_PROPERTIES":ce=g(p.compositingFailedAnimationAffectsNonCSSProperties);break;case"TRANSFORM_RELATED_PROPERTY_CANNOT_BE_ACCELERATED_ON_TARGET":ce=g(p.compositingFailedTransformRelatedPropertyCannotBeAcceleratedOnTarget);break;case"TRANSFROM_BOX_SIZE_DEPENDENT":ce=g(p.compositingFailedTransformDependsBoxSize);break;case"FILTER_RELATED_PROPERTY_MAY_MOVE_PIXELS":ce=g(p.compositingFailedFilterRelatedPropertyMayMovePixels);break;case"UNSUPPORTED_CSS_PROPERTY":ce=g(p.compositingFailedUnsupportedCSSProperty,{propertyCount:rt.size,properties:new Intl.ListFormat(void 0,{style:"short",type:"conjunction"}).format(rt)});break;case"MIXED_KEYFRAME_VALUE_TYPES":ce=g(p.compositingFailedMixedKeyframeValueTypes);break;case"TIMELINE_SOURCE_HAS_INVALID_COMPOSITING_STATE":ce=g(p.compositingFailedTimelineSourceHasInvalidCompositingState);break;case"ANIMATION_HAS_NO_VISIBLE_CHANGE":ce=g(p.compositingFailedAnimationHasNoVisibleChange);break;case"AFFECTS_IMPORTANT_PROPERTY":ce=g(p.compositingFailedAffectsImportantProperty);break;case"SVG_TARGET_HAS_INDEPENDENT_TRANSFORM_PROPERTY":ce=g(p.compositingFailedSVGTargetHasIndependentTransformProperty);break;default:ce=g(p.compositingFailedUnknownReason);break}ce&&c.appendElementRow(g(p.compositingFailed),ce,!0)}break}case"ParseHTML":{const S=v.beginData,k=S.startLine-1,Z=v.endData?v.endData.endLine-1:void 0;w=S.url,w&&c.appendLocationRange(g(p.range),w,k,Z);break}case"FireIdleCallback":c.appendTextRow(g(p.allottedTime),ve(T.allottedMilliseconds)),c.appendTextRow(g(p.invokedByTimeout),T.timedOut);case"RequestIdleCallback":case"CancelIdleCallback":{c.appendTextRow(g(p.callbackId),T.id);break}case"EventDispatch":{c.appendTextRow(g(p.type),T.type);break}case"largestContentfulPaint::Candidate":c.appendTextRow(g(p.type),String(T.type)),c.appendTextRow(g(p.size),String(T.size));case"firstPaint":case"firstContentfulPaint":case"MarkLoad":case"MarkDOMContent":{const S=Zr(t,e);c.appendTextRow(g(p.timestamp),Ye(S,1)),Uo(t)&&c.appendElementRow(g(p.details),R.buildDetailsNodeForMarkerEvents(t));break}case"EventTiming":{const S=await R.buildDetailsNodeForTraceEvent(t,Yt(e,t),i,x,e);if(S&&c.appendElementRow(g(p.details),S),Ni(t)){const k=Bt(t.inputDelay),Z=Bt(t.mainThreadHandling),Re=Bt(t.presentationDelay);c.appendTextRow(g(p.interactionID),t.interactionId),c.appendTextRow(g(p.inputDelay),k),c.appendTextRow(g(p.processingDuration),Z),c.appendTextRow(g(p.presentationDelay),Re)}break}case"LayoutShift":{if(!Ai(t)){console.error("Unexpected type for LayoutShift event");break}const S=t,k=S.args.data,Z=document.createElement("span"),Re=tt.create("https://web.dev/cls/",g(p.cumulativeLayoutShifts),void 0,void 0,"cumulative-layout-shifts"),st=tt.create("https://web.dev/evolving-cls/",g(p.evolvedClsLink),void 0,void 0,"evolved-cls");if(Z.appendChild(z(vs,p.sCLSInformation,{PH1:Re,PH2:st})),c.appendElementRow(g(p.warning),Z,!0),!k)break;c.appendTextRow(g(p.score),k.weighted_score_delta.toPrecision(4)),c.appendTextRow(g(p.cumulativeScore),k.cumulative_score.toPrecision(4)),c.appendTextRow(g(p.currentClusterId),S.parsedData.sessionWindowData.id),c.appendTextRow(g(p.currentClusterScore),S.parsedData.sessionWindowData.cumulativeWindowScore.toPrecision(4)),c.appendTextRow(g(p.hadRecentInput),T.had_recent_input?g(p.yes):g(p.no));for(const rt of T.impacted_nodes){const at=new Xr(rt.old_rect),ce=new Xr(rt.new_rect),Se=await ci.linkify(at),Ve=await ci.linkify(ce);c.appendElementRow(g(p.movedFrom),Se),c.appendElementRow(g(p.movedTo),Ve)}break}default:{const S=await R.buildDetailsNodeForTraceEvent(t,Yt(e,t),i,x,e);S&&c.appendElementRow(g(p.details),S);break}}const C=l?.values()||[];for(const S of C)if(S){const k=await ci.linkify(S);c.appendElementRow(d||g(p.relatedNode),k)}t[Cn]&&(c.addSection(g(p.preview)),c.appendElementRow("",t[Cn]));const W=si(t);(E||U||W||e?.Invalidations.invalidationsForEvent.get(t))&&await R.generateCauses(t,c,e),ne.isEnabled("timeline-debug-mode")&&R.renderEventJson(t,c);const O={};if(n&&e&&R.aggregatedStatsForTraceEvent(O,e,t)){c.addSection(g(p.aggregatedTime));const S=R.generatePieChart(O,R.eventStyle(t).category,o);c.appendElementRow("",S)}return c.fragment}static statsForTimeRange(e,t,i){if(!e.length)return{idle:i-t};l(e);const n=o(r(i),r(t)),s=Object.values(n).reduce((d,c)=>d+c,0);return n.idle=Math.max(0,i-t-s),n;function r(d){const c={},h=e[ys];for(const u in h){const m=h[u],v=js(m.time,d,ks);let T;if(v===0)T=0;else if(v===m.time.length)T=m.value[m.value.length-1];else{const E=m.time[v-1],U=m.time[v],w=m.value[v-1],x=m.value[v];T=w+(x-w)*(d-E)/(U-E)}c[u]=T}return c}function o(d,c){const h=Object.assign({},d);for(const u in c)h[u]-=c[u];return h}function l(d){if(d[ys])return;const c={},h=[];let u=0;qs(d,{onStartEvent:T,onEndEvent:E});function m(w,x){let C=c[w];if(C||(C={time:[],value:[]},c[w]=C),C.time.length&&C.time[C.time.length-1]===x||u>x)return;const W=C.value.length>0?C.value[C.value.length-1]:0;C.value.push(W+x-u),C.time.push(x)}function v(w,x,C){w&&m(w,C),u=C,x&&m(x,C)}function T(w){const{startTime:x}=fe(w),C=tn(w.name)?.category.name||$e().other.name,W=h.length?h[h.length-1]:null;C!==W&&v(W||null,C,x),h.push(C)}function E(w){const{endTime:x}=fe(w),C=h.pop(),W=h.length?h[h.length-1]:null;C!==W&&v(C||null,W||null,x||0)}const U=d;U[ys]=c}}static renderEventJson(e,t){t.addSection(g(p.traceEvent));const i={args:e.args,...e},n=R.renderObjectJson(i);t.appendElementRow("",n)}static renderObjectJson(e){const t=Te.instance().moduleSetting("text-editor-indent").get().length,i=JSON.stringify(e,null,t).slice(0,1e4).replace(/{\n  /,"{ "),n=document.createElement("div"),r=Dn(n,{cssFile:[Th]}).createChild("div");return r.classList.add("monospace","source-code"),r.textContent=i,Sh(r,"text/javascript"),n}static stackTraceFromCallFrames(e){return{callFrames:e}}static async generateCauses(e,t,i){const{startTime:n}=fe(e);let s=g(p.initiatorStackTrace),r=g(p.stackTrace);switch(e.name){case"TimerFire":s=g(p.timerInstalled);break;case"FireAnimationFrame":s=g(p.animationFrameRequested);break;case"FireIdleCallback":s=g(p.idleCallbackRequested);break;case"UpdateLayoutTree":s=g(p.firstInvalidated),r=g(p.recalculationForced);break;case"Layout":s=g(p.firstLayoutInvalidation),r=g(p.layoutForced);break}const o=si(e);o&&o.length&&(t.addSection(r),t.createChildStackTraceElement(R.stackTraceFromCallFrames(o)));const l=i.Initiators.eventToInitiator.get(e),d=i.Initiators.initiatorToEvents.get(e),c=i.Invalidations.invalidationsForEvent.get(e);if(l){const h=si(l);h&&(t.addSection(s),t.createChildStackTraceElement(R.stackTraceFromCallFrames(h.map(T=>({...T,scriptId:String(T.scriptId)})))));const u=this.createEntryLink(l);t.appendElementRow(g(p.initiatedBy),u);const{startTime:m}=fe(l),v=n-m;t.appendTextRow(g(p.pendingFor),Ye(v,1))}if(d){const h=document.createElement("div");d.map((u,m)=>{h.appendChild(this.createEntryLink(u)),m<d.length-1&&h.append(" ")}),t.appendElementRow(p.initiatorFor,h)}if(c&&c.length){const h=i.Invalidations.invalidationCountForEvent.get(e)??0;t.addSection(g(p.invalidations,{PH1:h})),await R.generateInvalidationsList(c,t)}}static createEntryLink(e){const t=document.createElement("span"),i=ae.instance().state();if(!i)return console.error("Tried to link to an entry without any traceBoundsState. This should never happen."),t;const n=i.micro.minimapTraceBounds.min>e.ts+(e.dur||0)||i.micro.minimapTraceBounds.max<e.ts,s=H.activeManager()?.getEntriesFilter().entryIsInvisible(e);return n||(t.classList.add("timeline-link"),Ua(t),t.tabIndex=0,t.addEventListener("click",()=>{Xe.instance().select(B.fromTraceEvent(e))}),t.addEventListener("keydown",r=>{r.key==="Enter"&&(Xe.instance().select(B.fromTraceEvent(e)),r.consume(!0))})),s?t.textContent=this.eventTitle(e)+" "+g(p.entryIsHidden):n?t.textContent=this.eventTitle(e)+" "+g(p.outsideBreadcrumbRange):t.textContent=this.eventTitle(e),t}static async generateInvalidationsList(e,t){const{groupedByReason:i,backendNodeIds:n}=Ap(e);let s=null;const o=Y.instance().primaryPageTarget()?.model(aa);o&&(s=await o.pushNodesByBackendIdsToFrontend(n)),Object.keys(i).forEach(l=>{R.generateInvalidationsForReason(l,i[l],s,t)})}static generateInvalidationsForReason(e,t,i,n){function s(o){const l=o.args.data.nodeId&&i?i.get(o.args.data.nodeId):null;if(l){const c=document.createElement("span");return ci.linkify(l).then(h=>c.appendChild(h)),c}if(o.args.data.nodeName){const c=document.createElement("span");return c.textContent=o.args.data.nodeName,c}const d=document.createElement("span");return qt(d,g(p.UnknownNode)),d}const r=new Set;for(const o of t){const l=si(o);let d=null;const c=l?.at(0);c&&(d=n.linkifier()?.maybeLinkifyScriptLocation(Y.instance().rootTarget(),c.scriptId,c.url,c.lineNumber)||null);const h=s(o),u=d?z(vs,p.invalidationWithCallFrame,{PH1:h,PH2:d}):h,m=typeof u=="string"?u:u.innerText;r.has(m)||(r.add(m),n.appendElementRow(e,u))}}static aggregatedStatsForTraceEvent(e,t,i){const n=t.Renderer?.allTraceEntries||[],{startTime:s,endTime:r}=fe(i);function o(c,h){const{startTime:u}=fe(h);return c-u}const l=Eh(n,s,o);if(l<0)return!1;let d=!1;if(r)for(let c=l;c<n.length;c++){const h=n[c],{startTime:u}=fe(h);if(u>=r)break;const m=Eo(h,t);if(!m||h.tid!==i.tid)continue;c>l&&(d=!0);const v=R.eventStyle(h).category.name;e[v]=(e[v]||0)+m}if(Go(i.ph)){if(r){let c=0;for(const h in e)c+=e[h];e.idle=Math.max(0,r-s-c)}return!1}return d}static async buildPicturePreviewContent(e,t,i){const n=e.LayerTree.paintsToSnapshots.get(t);if(!n)return null;const s=i.model(da);if(!s)return null;const r=await s.loadSnapshot(n.args.snapshot.skp64);if(!r)return null;const o={snapshot:r,rect:n.args.snapshot.params?.layer_rect};if(!o)return null;const l=o.snapshot.replay();o.snapshot.release();const d=await l;if(!d)return null;const c=document.createElement("div"),h=c.attachShadow({mode:"open"});h.adoptedStyleSheets=[Ch];const u=h.createChild("div");u.classList.add("image-preview-container","vbox","link");const m=u.createChild("img");m.src=d,m.alt=In.defaultAltTextForImageURL(d);const v=u.createChild("a");return v.textContent=g(p.paintProfiler),Ua(u),u.tabIndex=0,u.addEventListener("click",()=>Xe.instance().select(B.fromTraceEvent(t)),!1),u.addEventListener("keydown",T=>{T.key==="Enter"&&(Xe.instance().select(B.fromTraceEvent(t)),T.consume(!0))}),c}static createEventDivider(e,t){const i=document.createElement("div");i.classList.add("resources-event-divider");const{startTime:n}=fe(e),s=ve(n-t);kh.install(i,g(p.sAtS,{PH1:R.eventTitle(e),PH2:s}));const r=R.markerStyleForEvent(e);return r.tall&&(i.style.backgroundColor=r.color),i}static visibleEventsFilter(){return new Ia(Dp())}static categories(){return $e()}static generatePieChart(e,t,i){let n=0;for(const c in e)n+=e[c];const s=document.createElement("div");s.classList.add("timeline-details-view-pie-chart-wrapper"),s.classList.add("hbox");const r=new qu,o=[];function l(c,h,u,m){u&&o.push({value:u,color:m,title:h})}if(t){i&&l(t.name,g(p.sSelf,{PH1:t.title}),i,t.getCSSValue());const h=e[t.name]-(i||0);h>0&&l(t.name,g(p.sChildren,{PH1:t.title}),h,t.getCSSValue())}for(const c in $e()){const h=$e()[c];c!==t?.name&&l(h.name,h.title,e[h.name],h.getCSSValue())}return r.data={chartName:g(p.timeSpentInRendering),size:110,formatter:c=>Ye(c),showLegend:!0,total:n,slices:o},s.createChild("div","vbox").appendChild(r),s}static generateDetailsContentForFrame(e,t,i){const n=new Bs(null,null);n.addSection(g(p.frame));const s=R.frameDuration(e);if(n.appendElementRow(g(p.duration),s),t&&i){const o=document.createElement("div");o.classList.add("timeline-filmstrip-preview"),ha(i.screenshotEvent.args.dataUri).then(l=>l&&o.appendChild(l)),n.appendElementRow("",o),o.addEventListener("click",r.bind(null,t,i),!1)}function r(o,l){Ku.fromFilmStrip(o,l.index)}return n.fragment}static frameDuration(e){const t=$(e.startTimeOffset),i=$(_(e.endTime-e.startTime)),n=g(p.sAtSParentheses,{PH1:ve(i,!0),PH2:ve(t,!0)});return z(vs,p.emptyPlaceholder,{PH1:n})}static quadWidth(e){return Math.round(Math.sqrt(Math.pow(e[0]-e[2],2)+Math.pow(e[1]-e[3],2)))}static quadHeight(e){return Math.round(Math.sqrt(Math.pow(e[0]-e[6],2)+Math.pow(e[1]-e[7],2)))}static eventDispatchDesciptors(){if(ds)return ds;const e="hsl(40,100%,80%)",t="hsl(40,100%,50%)",i="hsl(90,100%,40%)",n="hsl(256,100%,75%)";return ds=[new ni(1,e,["mousemove","mouseenter","mouseleave","mouseout","mouseover"]),new ni(1,e,["pointerover","pointerout","pointerenter","pointerleave","pointermove"]),new ni(2,i,["wheel"]),new ni(3,t,["click","mousedown","mouseup"]),new ni(3,t,["touchstart","touchend","touchmove","touchcancel"]),new ni(3,t,["pointerdown","pointerup","pointercancel","gotpointercapture","lostpointercapture"]),new ni(3,n,["keydown","keyup","keypress"])],ds}static markerStyleForEvent(e){const t=[6,4],i=R.eventTitle(e);if(e.name!=="navigationStart"&&zt(e,dt.Console)||zt(e,dt.UserTiming))return{title:i,dashStyle:t,lineWidth:.5,color:zt(e,dt.Console)?"purple":"orange",tall:!1,lowPriority:!1};let n=!1,s="grey";switch(e.name){case"navigationStart":s="#FF9800",n=!0;break;case"FrameStartedLoading":s="green",n=!0;break;case"MarkDOMContent":s="#0867CB",n=!0;break;case"MarkLoad":s="#B31412",n=!0;break;case"firstPaint":s="#228847",n=!0;break;case"firstContentfulPaint":s="#1A6937",n=!0;break;case"largestContentfulPaint::Candidate":s="#1A3422",n=!0;break;case"TimeStamp":s="orange";break}return{title:i,dashStyle:t,lineWidth:.5,color:s,tall:n,lowPriority:!1}}static colorForId(e){return hs||(hs=new ua({min:30,max:330,count:void 0},{min:50,max:80,count:3},85),hs.setColorForID("","#f2ecdc")),hs.colorForID(e)}static displayNameForFrame(e,t=80){const i=e.url;return xh(i,"about:")?`"${na(e.name,t)}"`:e.url.slice(0,t)}}const Ig=Symbol("aggregatedStats"),Cn=Symbol("previewElement");class ni{priority;color;eventTypes;constructor(e,t,i){this.priority=e,this.color=t,this.eventTypes=i}}class Bs{fragment;linkifierInternal;target;element;tableElement;constructor(e,t){this.fragment=document.createDocumentFragment(),this.linkifierInternal=t,this.target=e,this.element=document.createElement("div"),this.element.classList.add("timeline-details-view-block"),this.tableElement=this.element.createChild("div","vbox timeline-details-chip-body"),this.fragment.appendChild(this.element)}addSection(e,t){if(this.tableElement.hasChildNodes()?(this.element=document.createElement("div"),this.element.classList.add("timeline-details-view-block"),this.fragment.appendChild(this.element)):this.element.removeChildren(),e){const i=this.element.createChild("div","timeline-details-chip-title");t&&(i.createChild("div").style.backgroundColor=t),qt(i,e)}this.tableElement=this.element.createChild("div","vbox timeline-details-chip-body"),this.fragment.appendChild(this.element)}linkifier(){return this.linkifierInternal}appendTextRow(e,t){const i=this.tableElement.createChild("div","timeline-details-view-row");i.createChild("div","timeline-details-view-row-title").textContent=e,i.createChild("div","timeline-details-view-row-value").textContent=t.toString()}appendElementRow(e,t,i,n){const s=this.tableElement.createChild("div","timeline-details-view-row");s.setAttribute("data-row-title",e),i&&s.classList.add("timeline-details-warning"),n&&s.classList.add("timeline-details-stack-values");const r=s.createChild("div","timeline-details-view-row-title");r.textContent=e;const o=s.createChild("div","timeline-details-view-row-value");t instanceof Node?o.appendChild(t):qt(o,t||"")}appendLocationRow(e,t,i,n){if(!this.linkifierInternal)return;const s={tabStop:!0,columnNumber:n,showColumnNumber:!0,inlineFrameIndex:0},r=this.linkifierInternal.maybeLinkifyScriptLocation(this.target,null,t,i,s);r&&this.appendElementRow(e,r)}appendLocationRange(e,t,i,n){if(!this.linkifierInternal||!this.target)return;const s=document.createElement("span"),r=this.linkifierInternal.maybeLinkifyScriptLocation(this.target,null,t,i,{tabStop:!0,inlineFrameIndex:0});r&&(s.appendChild(r),qt(s,Ih(" [%sâ€¦%s]",i+1,(n||0)+1||"")),this.appendElementRow(e,s))}createChildStackTraceElement(e){if(!this.linkifierInternal)return;const t=this.tableElement.createChild("div","timeline-details-view-row timeline-details-stack-values"),i=Ph(this.target,this.linkifierInternal,{stackTrace:e,tabStops:!0,showColumnNumber:!0});t.appendChild(i.element)}}const ys=Symbol("categoryBreakdownCache");function Zr(a,e){if(!e){const{startTime:i}=fe(a);return i}const t=jo(a,e.Meta.traceBounds,e.Meta.navigationsByNavigationId,e.Meta.navigationsByFrameId);return $(t)}function Fc(a,e){if(e.name==="TimeStamp")return!0;if(qo(e)||Ko(e))return e.args.frame===a.Meta.mainFrameId;if(Yo(e)||Xo(e)||sa(e)){if(!e.args.data)return!1;const{isOutermostMainFrame:t,isMainFrame:i}=e.args.data;return typeof t<"u"?t:!!i}return!1}function Eo(a,e){const i=(pt(a)?e.ExtensionTraceData.entryToNode:e.Renderer.entryToNode).get(a)?.selfTime;return i?$(i):se(0)}const qf=Object.freeze(Object.defineProperty({__proto__:null,EventDispatchTypeDescriptor:ni,TimelineDetailsContentHelper:Bs,TimelineUIUtils:R,aggregatedStatsKey:Ig,categoryBreakdownCacheSymbol:ys,isMarkerEvent:Fc,previewElementSymbol:Cn,timeStampForEventAdjustedForClosestNavigationIfPossible:Zr},Symbol.toStringTag,{value:"Module"}));class Mc extends Zn{#e=se(0);constructor(){super()}setMinimumRecordDuration(e){this.#e=e}accept(e){const{duration:t}=fe(e);return t>=this.#e}}class Dc extends Zn{constructor(){super()}accept(e){return!R.eventStyle(e).category.hidden}}class Ra extends Zn{regExpInternal;constructor(e){super(),this.setRegExp(e||null)}setRegExp(e){this.regExpInternal=e}regExp(){return this.regExpInternal}accept(e,t){return!this.regExpInternal||R.testContentMatching(e,this.regExpInternal,t)}}const Kf=Object.freeze(Object.defineProperty({__proto__:null,Category:Dc,IsLong:Mc,TimelineRegExp:Ra},Symbol.toStringTag,{value:"Module"})),J={performance:"Performance",selfTime:"Self time",totalTime:"Total time",activity:"Activity",selectItemForDetails:"Select item for details.",fms:"{PH1}Â ms",percentPlaceholder:"{PH1}Â %",chromeExtensionsOverhead:"[`Chrome` extensions overhead]",vRuntime:"[`V8` Runtime]",unattributed:"[unattributed]",page:"Page",noGrouping:"No grouping",groupByActivity:"Group by activity",groupByCategory:"Group by category",groupByDomain:"Group by domain",groupByFrame:"Group by frame",groupBySubdomain:"Group by subdomain",groupByUrl:"Group by URL",groupByThirdParties:"Group by Third Parties",groupBy:"Group by",heaviestStack:"Heaviest stack",showHeaviestStack:"Show heaviest stack",hideHeaviestStack:"Hide heaviest stack",heaviestStackShown:"Heaviest stack sidebar shown",heaviestStackHidden:"Heaviest stack sidebar hidden",timelineStack:"Timeline stack",matchCase:"Match case",useRegularExpression:"Use regular expression",matchWholeWord:"Match whole word"},Pg=A("panels/timeline/TimelineTreeView.ts",J),Q=N.bind(void 0,Pg);class Aa extends xe{#e;searchResults;linkifier;dataGrid;lastHoveredProfileNode;textFilterInternal;taskFilter;startTime;endTime;splitWidget;detailsView;searchableView;currentThreadSetting;lastSelectedNodeInternal;root;currentResult;textFilterUI;caseSensitiveButton;regexButton;matchWholeWord;#t=null;constructor(){super(),this.#e=null,this.element.classList.add("timeline-tree-view"),this.searchResults=[]}#i(e){const t=R.eventTitle(e)||e.name;return this.#t?t+":@"+Kt(this.#t,e):t}setSearchableView(e){this.searchableView=e}setModelWithEvents(e,t=null){this.#t=t,this.#e=e}parsedTrace(){return this.#t}init(){this.linkifier=new Mt,this.taskFilter=new Tg(["RunTask"]),this.textFilterInternal=new Ra,this.currentThreadSetting=Te.instance().createSetting("timeline-tree-current-thread",0),this.currentThreadSetting.addChangeListener(this.refreshTree,this);const e=[];this.populateColumns(e),this.splitWidget=new Zt(!0,!0,"timeline-tree-view-details-split-widget");const t=new xe,i=new et("",t.element);i.element.setAttribute("jslog",`${pa()}`),i.makeWrappable(!0),this.populateToolbar(i),this.dataGrid=new Lh({displayName:Q(J.performance),columns:e,refreshCallback:void 0,editCallback:void 0,deleteCallback:void 0}),this.dataGrid.addEventListener("SortingChanged",this.sortingChanged,this),this.dataGrid.element.addEventListener("mousemove",this.onMouseMove.bind(this),!0),this.dataGrid.setResizeMethod("last"),this.dataGrid.setRowContextMenuCallback(this.onContextMenu.bind(this)),this.dataGrid.asWidget().show(t.element),this.dataGrid.addEventListener("SelectedNode",this.updateDetailsForSelection,this),this.detailsView=new xe,this.detailsView.element.classList.add("timeline-details-view","timeline-details-view-body"),this.splitWidget.setMainWidget(t),this.splitWidget.setSidebarWidget(this.detailsView),this.splitWidget.hideSidebar(),this.splitWidget.show(this.element),this.splitWidget.addEventListener("ShowModeChanged",this.onShowModeChanged,this),this.lastSelectedNodeInternal}lastSelectedNode(){return this.lastSelectedNodeInternal}updateContents(e){this.setRange(e.startTime,e.endTime)}setRange(e,t){this.startTime=e,this.endTime=t,this.refreshTree()}filters(){return[this.taskFilter,this.textFilterInternal,...nn.instance().activeFilters()]}filtersWithoutTextFilter(){return[this.taskFilter,...nn.instance().activeFilters()]}textFilter(){return this.textFilterInternal}exposePercentages(){return!1}populateToolbar(e){this.caseSensitiveButton=new gr(Q(J.matchCase),"match-case",void 0,"match-case"),this.caseSensitiveButton.addEventListener("Click",()=>{this.#n()},this),e.appendToolbarItem(this.caseSensitiveButton),this.regexButton=new gr(Q(J.useRegularExpression),"regular-expression",void 0,"regular-expression"),this.regexButton.addEventListener("Click",()=>{this.#n()},this),e.appendToolbarItem(this.regexButton),this.matchWholeWord=new gr(Q(J.matchWholeWord),"match-whole-word",void 0,"match-whole-word"),this.matchWholeWord.addEventListener("Click",()=>{this.#n()},this),e.appendToolbarItem(this.matchWholeWord);const t=new Rh;this.textFilterUI=t,t.addEventListener("TextChanged",this.#n,this),e.appendToolbarItem(t)}selectedEvents(){return this.#e||[]}onHover(e){}appendContextMenuItems(e,t){}selectProfileNode(e,t){const i=[];let n=e;for(;n;n=n.parent)i.push(n);for(let r=i.length-1;r>0;--r){const o=this.dataGridNodeForTreeNode(i[r]);o&&o.dataGrid&&o.expand()}const s=this.dataGridNodeForTreeNode(e);s&&s.dataGrid&&(s.reveal(),s.select(t))}refreshTree(){if(!this.element.parentElement)return;if(this.linkifier.reset(),this.dataGrid.rootNode().removeChildren(),!this.#t){this.updateDetailsForSelection();return}this.root=this.buildTree();const e=this.root.children();let t=0,i=0;const n=this.root.totalTime-this.root.selfTime;for(const r of e.values())t=Math.max(t,r.selfTime),i=Math.max(i,r.totalTime);for(const r of e.values()){const o=new dr(r,n,t,i,this);this.dataGrid.insertChild(o)}this.sortingChanged(),this.updateDetailsForSelection(),this.searchableView&&this.searchableView.refreshSearch();const s=this.dataGrid.rootNode();s.children.length>0&&s.children[0].select(!0)}buildTree(){throw new Error("Not Implemented")}buildTopDownTree(e,t){return new Sg(this.selectedEvents(),this.filters(),this.startTime,this.endTime,e,t)}populateColumns(e){e.push({id:"self",title:Q(J.selfTime),width:"120px",fixedWidth:!0,sortable:!0}),e.push({id:"total",title:Q(J.totalTime),width:"120px",fixedWidth:!0,sortable:!0}),e.push({id:"activity",title:Q(J.activity),disclosure:!0,sortable:!0})}sortingChanged(){const e=this.dataGrid.sortColumnId();if(!e)return;let t;const i=(o,l)=>{const d=o,c=l,h=d.profileNode.event,u=c.profileNode.event;if(!h||!u||!this.#t)return 0;const m=this.#i(h),v=this.#i(u);return m.localeCompare(v)};switch(e){case"start-time":t=s;break;case"self":t=n;break;case"total":t=r;break;case"activity":t=i;break;default:console.assert(!1,"Unknown sort field: "+e);return}this.dataGrid.sortNodes(t,!this.dataGrid.isSortOrderAscending());function n(o,l){const d=o,c=l;return d.profileNode.selfTime-c.profileNode.selfTime}function s(o,l){const d=o,c=l,h=d.profileNode.event,u=c.profileNode.event;return!h||!u?0:h.ts-u.ts}function r(o,l){const d=o,c=l;return d.profileNode.totalTime-c.profileNode.totalTime}}#n(){const e=this.textFilterUI&&this.textFilterUI.value(),t=this.caseSensitiveButton!==void 0&&this.caseSensitiveButton.isToggled(),i=this.regexButton!==void 0&&this.regexButton.isToggled(),n=this.matchWholeWord!==void 0&&this.matchWholeWord.isToggled();this.textFilterInternal.setRegExp(e?Ah(e,t,i,n):null),this.refreshTree()}onShowModeChanged(){this.splitWidget.showMode()!=="OnlyMain"&&(this.lastSelectedNodeInternal=void 0,this.updateDetailsForSelection())}updateDetailsForSelection(){const e=this.dataGrid.selectedNode?this.dataGrid.selectedNode.profileNode:null;if(e===this.lastSelectedNodeInternal||(this.lastSelectedNodeInternal=e,this.splitWidget.showMode()==="OnlyMain")||(this.detailsView.detachChildWidgets(),this.detailsView.element.removeChildren(),e&&this.showDetailsForNode(e)))return;const t=this.detailsView.element.createChild("div","full-widget-dimmed-banner");qt(t,Q(J.selectItemForDetails))}showDetailsForNode(e){return!1}onMouseMove(e){const t=e.target&&e.target instanceof Node?this.dataGrid.dataGridNodeFromNode(e.target):null,i=t&&t._profileNode;i!==this.lastHoveredProfileNode&&(this.lastHoveredProfileNode=i,this.onHover(i))}onContextMenu(e,t){const i=t;i.linkElement&&e.appendApplicableItems(i.linkElement);const n=i.profileNode;n&&this.appendContextMenuItems(e,n)}dataGridNodeForTreeNode(e){return $c.get(e)||null}onSearchCanceled(){this.searchResults=[],this.currentResult=0}performSearch(e,t,i){if(this.searchResults=[],this.currentResult=0,!this.root)return;const n=e.toSearchRegex();this.searchResults=this.root.searchTree(s=>R.testContentMatching(s,n.regex,this.#t||void 0)),this.searchableView.updateSearchMatchesCount(this.searchResults.length)}jumpToNextSearchResult(){!this.searchResults.length||this.currentResult===void 0||(this.selectProfileNode(this.searchResults[this.currentResult],!1),this.currentResult=Ls(this.currentResult+1,this.searchResults.length))}jumpToPreviousSearchResult(){!this.searchResults.length||this.currentResult===void 0||(this.selectProfileNode(this.searchResults[this.currentResult],!1),this.currentResult=Ls(this.currentResult-1,this.searchResults.length))}supportsCaseSensitiveSearch(){return!0}supportsRegexSearch(){return!0}}class Na extends Nh{populated;profileNode;treeView;grandTotalTime;maxSelfTime;maxTotalTime;linkElement;constructor(e,t,i,n,s){super(null,!1),this.populated=!1,this.profileNode=e,this.treeView=s,this.grandTotalTime=t,this.maxSelfTime=i,this.maxTotalTime=n,this.linkElement=null}createCell(e){return e==="activity"?this.createNameCell(e):this.createValueCell(e)||super.createCell(e)}createNameCell(e){const t=this.createTD(e),i=t.createChild("div","name-container"),n=i.createChild("div","activity-icon-container"),s=n.createChild("div","activity-icon"),r=i.createChild("div","activity-name"),o=this.profileNode.event;if(this.profileNode.isGroupNode()){const d=this.treeView.displayInfoForGroupNode(this.profileNode);r.textContent=d.name,s.style.backgroundColor=d.color,d.icon&&n.insertBefore(d.icon,s)}else if(o){r.textContent=R.eventTitle(o);const l=this.treeView.parsedTrace(),d=l?Yt(l,o):null,c=this.treeView.linkifier,h=!!(l&&Di.instance().recordingIsFresh(l));this.linkElement=R.linkifyTopCallFrame(o,d,c,h),this.linkElement&&i.createChild("div","activity-link").appendChild(this.linkElement);const m=R.eventStyle(o).category;Pn(s,m.title),s.style.backgroundColor=m.getComputedColorValue(),pt(o)&&(s.style.backgroundColor=_n(o))}return t}createValueCell(e){if(e!=="self"&&e!=="total"&&e!=="start-time")return null;let t=!1,i,n,s;switch(e){case"start-time":{s=this.profileNode.event;const l=this.treeView.parsedTrace();if(!l)throw new Error("Unable to load trace data for tree view");i=((s&&fe(s))?.startTime??0)-$(l.Meta.traceBounds.min)}break;case"self":i=this.profileNode.selfTime,n=this.maxSelfTime,t=!0;break;case"total":i=this.profileNode.totalTime,n=this.maxTotalTime,t=!0;break;default:return null}const r=this.createTD(e);r.className="numeric-column",r.setAttribute("title",Q(J.fms,{PH1:i.toFixed(4)}));const o=r.createChild("div");return o.createChild("span").textContent=Q(J.fms,{PH1:i.toFixed(1)}),t&&this.treeView.exposePercentages()&&(o.createChild("span","percent-column").textContent=Q(J.percentPlaceholder,{PH1:(i/this.grandTotalTime*100).toFixed(1)})),n&&(o.classList.add("background-percent-bar"),r.createChild("div","background-bar-container").createChild("div","background-bar").style.width=(i*100/n).toFixed(1)+"%"),r}}class dr extends Na{constructor(e,t,i,n,s){super(e,t,i,n,s),this.setHasChildren(this.profileNode.hasChildren()),$c.set(e,this)}populate(){if(!this.populated&&(this.populated=!0,!!this.profileNode.children))for(const e of this.profileNode.children().values()){const t=new dr(e,this.grandTotalTime,this.maxSelfTime,this.maxTotalTime,this.treeView);this.insertChildOrdered(t)}}}const $c=new WeakMap;class re extends Aa{groupBySetting;stackView;executionContextNamesByOrigin=new Map;constructor(){super(),this.groupBySetting=Te.instance().createSetting("timeline-tree-group-by",re.GroupBy.None),this.groupBySetting.addChangeListener(this.refreshTree.bind(this)),this.init(),this.stackView=new Hc(this),this.stackView.addEventListener("SelectionChanged",this.onStackViewSelectionChanged,this)}setGroupBySettingForTests(e){this.groupBySetting.set(e)}updateContents(e){this.updateExtensionResolver(),super.updateContents(e);const t=this.dataGrid.rootNode();t.children.length&&t.children[0].select(!0)}updateExtensionResolver(){this.executionContextNamesByOrigin=new Map;for(const e of Y.instance().models(la))for(const t of e.executionContexts())this.executionContextNamesByOrigin.set(t.origin,t.name)}beautifyDomainName(e){return re.isExtensionInternalURL(e)?e=Q(J.chromeExtensionsOverhead):re.isV8NativeURL(e)?e=Q(J.vRuntime):e.startsWith("chrome-extension")&&(e=this.executionContextNamesByOrigin.get(e)||e),e}displayInfoForGroupNode(e){const t=$e(),i=e.id&&e.event?R.eventColor(e.event):t.other.color,n=Q(J.unattributed),s=typeof e.id=="symbol"?void 0:e.id;switch(this.groupBySetting.get()){case re.GroupBy.Category:{const o=s&&Sl(s)?t[s]||t.other:{title:n,color:n};return{name:o.title,color:o.color,icon:void 0}}case re.GroupBy.Domain:case re.GroupBy.Subdomain:case re.GroupBy.ThirdParties:return{name:(s?this.beautifyDomainName(s):void 0)||n,color:i,icon:void 0};case re.GroupBy.EventName:{if(!e.event)throw new Error("Unable to find event for group by operation");return{name:R.eventTitle(e.event),color:i,icon:void 0}}case re.GroupBy.URL:break;case re.GroupBy.Frame:{const r=s?this.parsedTrace()?.PageFrames.frames.get(s):void 0;return{name:r?R.displayNameForFrame(r):Q(J.page),color:i,icon:void 0}}default:console.assert(!1,"Unexpected grouping type")}return{name:s||n,color:i,icon:void 0}}populateToolbar(e){super.populateToolbar(e);const t=re.GroupBy,i=[{label:Q(J.noGrouping),value:t.None},{label:Q(J.groupByActivity),value:t.EventName},{label:Q(J.groupByCategory),value:t.Category},{label:Q(J.groupByDomain),value:t.Domain},{label:Q(J.groupByFrame),value:t.Frame},{label:Q(J.groupBySubdomain),value:t.Subdomain},{label:Q(J.groupByUrl),value:t.URL},{label:Q(J.groupByThirdParties),value:t.ThirdParties}];e.appendToolbarItem(new Fh(i,this.groupBySetting,Q(J.groupBy))),e.appendSpacer(),e.appendToolbarItem(this.splitWidget.createShowHideSidebarButton(Q(J.showHeaviestStack),Q(J.hideHeaviestStack),Q(J.heaviestStackShown),Q(J.heaviestStackHidden)))}buildHeaviestStack(e){console.assert(!!e.parent,"Attempt to build stack for tree root");let t=[];for(let i=e;i&&i.parent;i=i.parent)t.push(i);t=t.reverse();for(let i=e;i&&i.children()&&i.children().size;)i=Array.from(i.children().values()).reduce((s,r)=>s.totalTime>r.totalTime?s:r),t.push(i);return t}exposePercentages(){return!0}onStackViewSelectionChanged(){const e=this.stackView.selectedTreeNode();e&&this.selectProfileNode(e,!0)}showDetailsForNode(e){const t=this.buildHeaviestStack(e);return this.stackView.setStack(t,e),this.stackView.show(this.detailsView.element),!0}groupingFunction(e){const t=re.GroupBy;switch(e){case t.None:return null;case t.EventName:return i=>R.eventStyle(i).title;case t.Category:return i=>R.eventStyle(i).category.name;case t.Subdomain:case t.Domain:case t.ThirdParties:return this.domainByEvent.bind(this,e);case t.URL:return i=>{const n=this.parsedTrace();return n?Kt(n,i)??"":""};case t.Frame:return i=>Mh(i)||this.parsedTrace()?.Meta.mainFrameId||"";default:return console.assert(!1,`Unexpected aggregation setting: ${e}`),null}}domainByEvent(e,t){const i=this.parsedTrace();if(!i)return"";const n=Kt(i,t);if(!n)return"";if(re.isExtensionInternalURL(n))return re.extensionInternalPrefix;if(re.isV8NativeURL(n))return re.v8NativePrefix;const s=qn.fromString(n);if(!s)return"";if(s.scheme==="chrome-extension")return s.scheme+"://"+s.host;if(e===re.GroupBy.ThirdParties){const o=Dh.getEntity(n);return o?o.name:s.host}if(e===re.GroupBy.Subdomain||/^[.0-9]+$/.test(s.host))return s.host;const r=/([^.]*\.)?[^.]*$/.exec(s.host);return r&&r[0]||""}static isExtensionInternalURL(e){return e.startsWith(re.extensionInternalPrefix)}static isV8NativeURL(e){return e.startsWith(re.v8NativePrefix)}static extensionInternalPrefix="extensions::";static v8NativePrefix="native "}(function(a){(function(e){e.None="None",e.EventName="EventName",e.Category="Category",e.Domain="Domain",e.Subdomain="Subdomain",e.URL="URL",e.Frame="Frame",e.ThirdParties="ThirdParties"})(a.GroupBy||(a.GroupBy={}))})(re||(re={}));class Bc extends re{constructor(){super(),this.element.setAttribute("jslog",`${rn("call-tree").track({resize:!0})}`),this.dataGrid.markColumnAsSortedBy("total",ma.Descending)}buildTree(){const e=this.groupBySetting.get();return this.buildTopDownTree(!1,this.groupingFunction(e))}}class Oc extends re{constructor(){super(),this.element.setAttribute("jslog",`${rn("bottom-up").track({resize:!0})}`),this.dataGrid.markColumnAsSortedBy("self",ma.Descending)}buildTree(){return new Eg(this.selectedEvents(),this.textFilter(),this.filtersWithoutTextFilter(),this.startTime,this.endTime,this.groupingFunction(this.groupBySetting.get()))}}class Hc extends Jo(xe){treeView;dataGrid;constructor(e){super();const t=this.element.createChild("div","timeline-stack-view-header");t.textContent=Q(J.heaviestStack),this.treeView=e;const i=[{id:"total",title:Q(J.totalTime),fixedWidth:!0,width:"110px"},{id:"activity",title:Q(J.activity)}];this.dataGrid=new $h({displayName:Q(J.timelineStack),columns:i,deleteCallback:void 0,editCallback:void 0,refreshCallback:void 0}),this.dataGrid.setResizeMethod("last"),this.dataGrid.addEventListener("SelectedNode",this.onSelectionChanged,this),this.dataGrid.asWidget().show(this.element)}setStack(e,t){const i=this.dataGrid.rootNode();i.removeChildren();let n=null;const s=Math.max.apply(Math,e.map(r=>r.totalTime));for(const r of e){const o=new Na(r,s,s,s,this.treeView);i.appendChild(o),r===t&&(n=o)}n&&n.revealAndSelect()}selectedTreeNode(){const e=this.dataGrid.selectedNode;return e&&e.profileNode}onSelectionChanged(){this.dispatchEventToListeners("SelectionChanged")}}const Yf=Object.freeze(Object.defineProperty({__proto__:null,get AggregatedTimelineTreeView(){return re},BottomUpTimelineTreeView:Oc,CallTreeTimelineTreeView:Bc,GridNode:Na,TimelineStackView:Hc,TimelineTreeView:Aa,TreeGridNode:dr},Symbol.toStringTag,{value:"Module"})),Ln={startTime:"Start time",durationFilter:"Duration filter",Dms:"{PH1}Â ms",all:"All"},Lg=A("panels/timeline/EventsTimelineTreeView.ts",Ln),bs=N.bind(void 0,Lg);class _c extends Aa{filtersControl;delegate;currentTree;constructor(e){super(),this.element.setAttribute("jslog",`${rn("event-log").track({resize:!0})}`),this.filtersControl=new hr,this.filtersControl.addEventListener("FilterChanged",this.onFilterChanged,this),this.init(),this.delegate=e,this.dataGrid.markColumnAsSortedBy("start-time",ma.Ascending),this.splitWidget.showBoth()}filters(){return[...super.filters(),...this.filtersControl.filters()]}updateContents(e){super.updateContents(e),B.isTraceEventSelection(e.object)&&this.selectEvent(e.object,!0)}buildTree(){return this.currentTree=this.buildTopDownTree(!0,null),this.currentTree}onFilterChanged(){const e=this.lastSelectedNode(),t=e&&e.event;this.refreshTree(),t&&this.selectEvent(t,!1)}findNodeWithEvent(e){if(e.name==="RunTask")return null;const t=[this.currentTree.children().values()];for(;t.length;){const{done:i,value:n}=t[t.length-1].next();if(i){t.pop();continue}if(n.event===e)return n;t.push(n.children().values())}return null}selectEvent(e,t){const i=this.findNodeWithEvent(e);if(i&&(this.selectProfileNode(i,!1),t)){const n=this.dataGridNodeForTreeNode(i);n&&n.expand()}}populateColumns(e){e.push({id:"start-time",title:bs(Ln.startTime),width:"80px",fixedWidth:!0,sortable:!0}),super.populateColumns(e),e.filter(t=>t.fixedWidth).forEach(t=>{t.width="80px"})}populateToolbar(e){super.populateToolbar(e),this.filtersControl.populateToolbar(e)}showDetailsForNode(e){const t=this.parsedTrace();if(!t)return!1;const i=e.event;return i?(R.buildTraceEventDetails(t,i,this.linkifier,!1).then(n=>this.detailsView.element.appendChild(n)),!0):!1}onHover(e){this.delegate.highlightEvent(e&&e.event)}}class hr extends Zo{categoryFilter;durationFilter;filtersInternal;constructor(){super(),this.categoryFilter=new Dc,this.durationFilter=new Mc,this.filtersInternal=[this.categoryFilter,this.durationFilter]}filters(){return this.filtersInternal}populateToolbar(e){const t=new Qo(s.bind(this),bs(Ln.durationFilter),void 0,"duration");for(const o of hr.durationFilterPresetsMs)t.addOption(t.createOption(o?`â‰¥ ${bs(Ln.Dms,{PH1:o})}`:bs(Ln.all),String(o)));e.appendToolbarItem(t);const i=new Map,n=$e();for(const o in n){const l=n[o];if(!l.visible)continue;const d=new Bh(l.title,void 0,r.bind(this,o),o);d.setChecked(!0),d.inputElement.style.backgroundColor=l.color,i.set(l.name,d),e.appendToolbarItem(d)}function s(){const o=t.selectedOption().value,l=parseInt(o,10);this.durationFilter.setMinimumRecordDuration(se(l)),this.notifyFiltersChanged()}function r(o){const l=$e(),d=i.get(o);l[o].hidden=!d||!d.checked(),this.notifyFiltersChanged()}}notifyFiltersChanged(){this.dispatchEventToListeners("FilterChanged")}static durationFilterPresetsMs=[0,1,15]}const Xf=Object.freeze(Object.defineProperty({__proto__:null,EventsTimelineTreeView:_c,Filters:hr},Symbol.toStringTag,{value:"Module"}));class Wc extends Zt{showPaintProfilerCallback;rightSplitWidget;layerViewHost;layers3DView;frameLayerTree;updateWhenVisible;constructor(e){super(!0,!1,"timeline-layers-view"),this.showPaintProfilerCallback=e,this.element.classList.add("timeline-layers-view"),this.rightSplitWidget=new Zt(!0,!0,"timeline-layers-view-details"),this.rightSplitWidget.element.classList.add("timeline-layers-view-properties"),this.setMainWidget(this.rightSplitWidget);const t=new xe;this.setSidebarWidget(t),this.layerViewHost=new np;const i=new sp(this.layerViewHost);t.element.appendChild(i.element),this.layers3DView=new rp(this.layerViewHost),this.layers3DView.addEventListener("PaintProfilerRequested",this.onPaintProfilerRequested,this),this.rightSplitWidget.setMainWidget(this.layers3DView);const n=new ap(this.layerViewHost);this.rightSplitWidget.setSidebarWidget(n),n.addEventListener("PaintProfilerRequested",this.onPaintProfilerRequested,this)}showLayerTree(e){this.frameLayerTree=e,this.isShowing()?this.update():this.updateWhenVisible=!0}wasShown(){this.updateWhenVisible&&(this.updateWhenVisible=!1,this.update())}async onPaintProfilerRequested(e){const t=e.data,i=await this.layers3DView.snapshotForSelection(t);i&&this.showPaintProfilerCallback(i.snapshot)}update(){this.frameLayerTree&&this.frameLayerTree.layerTreePromise().then(e=>this.layerViewHost.setLayerTree(e))}}const Jf=Object.freeze(Object.defineProperty({__proto__:null,TimelineLayersView:Wc},Symbol.toStringTag,{value:"Module"})),Vc=new CSSStyleSheet;Vc.replaceSync(`/*
 * Copyright 2016 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

.paint-profiler-image-view {
  overflow: hidden;
}

.paint-profiler-image-view .paint-profiler-image-container {
  transform-origin: 0 0;
}

.paint-profiler-image-view .paint-profiler-image-container div {
  border-color: 1px solid var(--sys-color-divider);
  border-style: solid;
  z-index: 100;
  position: absolute;
  top: 0;
  left: 0;
}

.paint-profiler-image-view img {
  border: solid 1px var(--sys-color-inverse-surface);
}

/*# sourceURL=timelinePaintProfiler.css */
`);class Uc extends Zt{logAndImageSplitWidget;imageView;paintProfilerView;logTreeView;needsUpdateWhenVisible;pendingSnapshot;event;paintProfilerModel;lastLoadedSnapshot;#e;constructor(e){super(!1,!1),this.element.classList.add("timeline-paint-profiler-view"),this.setSidebarSize(60),this.setResizable(!1),this.#e=e,this.logAndImageSplitWidget=new Zt(!0,!1),this.logAndImageSplitWidget.element.classList.add("timeline-paint-profiler-log-split"),this.setMainWidget(this.logAndImageSplitWidget),this.imageView=new zc,this.logAndImageSplitWidget.setMainWidget(this.imageView),this.paintProfilerView=new op(this.imageView.showImage.bind(this.imageView)),this.paintProfilerView.addEventListener("WindowChanged",this.onWindowChanged,this),this.setSidebarWidget(this.paintProfilerView),this.logTreeView=new lp,this.logAndImageSplitWidget.setSidebarWidget(this.logTreeView),this.needsUpdateWhenVisible=!1,this.pendingSnapshot=null,this.event=null,this.paintProfilerModel=null,this.lastLoadedSnapshot=null}wasShown(){super.wasShown(),this.needsUpdateWhenVisible&&(this.needsUpdateWhenVisible=!1,this.update())}setSnapshot(e){this.releaseSnapshot(),this.pendingSnapshot=e,this.event=null,this.updateWhenVisible()}#t(e){const t=e.args.tileData;if(!t)return!1;const i=this.#e.Frames.framesById[t.sourceFrameNumber];return!(!i||!i.layerTree)}setEvent(e,t){return this.releaseSnapshot(),this.paintProfilerModel=e,this.pendingSnapshot=null,this.event=t,this.updateWhenVisible(),Rn(t)?!!this.#e.LayerTree.paintsToSnapshots.get(t):_r(t)?this.#t(t):!1}updateWhenVisible(){this.isShowing()?this.update():this.needsUpdateWhenVisible=!0}async#i(e){const t=e.args.tileData;if(!t||!t.tileId.id_ref)return null;const i=Y.instance().rootTarget();if(!i)return null;const n=this.#e.Frames.framesById[t.sourceFrameNumber];if(!n||!n.layerTree)return null;const r=await new Nc(i,n.layerTree).layerTreePromise();return r?r.pictureForRasterTile(t.tileId.id_ref):null}update(){this.logTreeView.setCommandLog([]),this.paintProfilerView.setSnapshotAndLog(null,[],null);let e;if(this.pendingSnapshot)e=Promise.resolve({rect:null,snapshot:this.pendingSnapshot});else if(this.event&&this.paintProfilerModel&&Rn(this.event)){const i=this.#e.LayerTree.paintsToSnapshots.get(this.event);if(i){const n=i.args.snapshot.skp64;e=this.paintProfilerModel.loadSnapshot(n).then(s=>s&&{rect:null,snapshot:s})}else e=Promise.resolve(null)}else if(this.event&&_r(this.event))e=this.#i(this.event);else{console.assert(!1,"Unexpected event type or no snapshot");return}e.then(i=>{if(this.releaseSnapshot(),!i){this.imageView.showImage();return}const n=i.snapshot;this.lastLoadedSnapshot=n,this.imageView.setMask(i.rect),n.commandLog().then(s=>t.call(this,n,i.rect,s||[]))});function t(i,n,s){this.logTreeView.setCommandLog(s||[]),this.paintProfilerView.setSnapshotAndLog(i,s||[],n)}}releaseSnapshot(){this.lastLoadedSnapshot&&(this.lastLoadedSnapshot.release(),this.lastLoadedSnapshot=null)}onWindowChanged(){this.logTreeView.updateWindow(this.paintProfilerView.selectionWindow())}}class zc extends xn{imageContainer;imageElement;maskElement;transformController;maskRectangle;constructor(){super(!0),this.contentElement.classList.add("fill","paint-profiler-image-view"),this.imageContainer=this.contentElement.createChild("div","paint-profiler-image-container"),this.imageElement=this.imageContainer.createChild("img"),this.maskElement=this.imageContainer.createChild("div"),this.imageElement.addEventListener("load",this.updateImagePosition.bind(this),!1),this.transformController=new cp(this.contentElement,!0),this.transformController.addEventListener("TransformChanged",this.updateImagePosition,this)}onResize(){this.imageElement.src&&this.updateImagePosition()}updateImagePosition(){const e=this.imageElement.naturalWidth,t=this.imageElement.naturalHeight,i=this.contentElement.clientWidth,n=this.contentElement.clientHeight,s=.1,r=i*s,o=n*s,l=(i-r)/e,d=(n-o)/t,c=Math.min(l,d);if(this.maskRectangle){const m=this.maskElement.style;m.width=e+"px",m.height=t+"px",m.borderLeftWidth=this.maskRectangle.x+"px",m.borderTopWidth=this.maskRectangle.y+"px",m.borderRightWidth=e-this.maskRectangle.x-this.maskRectangle.width+"px",m.borderBottomWidth=t-this.maskRectangle.y-this.maskRectangle.height+"px"}this.transformController.setScaleConstraints(.5,10/c);let h=new WebKitCSSMatrix().scale(this.transformController.scale(),this.transformController.scale()).translate(i/2,n/2).scale(c,c).translate(-e/2,-t/2);const u=Oh(h,[0,0,0,e,t,0]);this.transformController.clampOffsets(r-u.maxX,i-r-u.minX,o-u.maxY,n-o-u.minY),h=new WebKitCSSMatrix().translate(this.transformController.offsetX(),this.transformController.offsetY()).multiply(h),this.imageContainer.style.webkitTransform=h.toString()}showImage(e){this.imageContainer.classList.toggle("hidden",!e),e&&(this.imageElement.src=e)}setMask(e){this.maskRectangle=e,this.maskElement.classList.toggle("hidden",!e)}wasShown(){super.wasShown(),this.registerCSSFiles([Vc])}}const Zf=Object.freeze(Object.defineProperty({__proto__:null,TimelinePaintImageView:zc,TimelinePaintProfilerView:Uc},Symbol.toStringTag,{value:"Module"})),{html:bi}=K,Le={selectorStats:"Selector stats",elapsed:"Elapsed (ms)",rejectPercentage:"% of slow-path non-matches",rejectPercentageExplanation:"The percentage of non-matching nodes (Match Attempts - Match Count) that couldn't be quickly ruled out by the bloom filter due to high selector complexity. Lower is better.",matchAttempts:"Match attempts",matchCount:"Match count",selector:"Selector",styleSheetId:"Style Sheet",copyTable:"Copy table",unableToLink:"Unable to link",unableToLinkViaStyleSheetId:"Unable to link via {PH1}",tableCopiedToClipboard:"Table copied to clipboard",totalForAllSelectors:"(Totals for all selectors)",lineNumber:"Line {PH1}:{PH2}"},Rg=A("panels/timeline/TimelineSelectorStatsView.ts",Le),Fe=N.bind(void 0,Rg),F=Hh;class Ag extends xe{#e;#t;#i=null;#n=null;constructor(e){super(),this.#e=new Zu,this.element.setAttribute("jslog",`${rn("selector-stats").track({resize:!0})}`),this.#t=new Map,this.#i=e,this.#e.data={label:Fe(Le.selectorStats),showScrollbar:!0,autoScrollToBottom:!1,initialSort:{columnId:F.Elapsed,direction:"DESC"},columns:[{id:F.Elapsed,title:Fe(Le.elapsed),sortable:!0,widthWeighting:1,visible:!0,hideable:!0,styles:{"text-align":"right"}},{id:F.MatchAttempts,title:Fe(Le.matchAttempts),sortable:!0,widthWeighting:1,visible:!0,hideable:!0,styles:{"text-align":"right"}},{id:F.MatchCount,title:Fe(Le.matchCount),sortable:!0,widthWeighting:1,visible:!0,hideable:!0,styles:{"text-align":"right"}},{id:F.RejectPercentage,title:Fe(Le.rejectPercentage),titleElement:bi`<span title=${Fe(Le.rejectPercentageExplanation)}>${Fe(Le.rejectPercentage)}</span>`,sortable:!0,widthWeighting:1,visible:!0,hideable:!0,styles:{"text-align":"right"}},{id:F.Selector,title:Fe(Le.selector),sortable:!0,widthWeighting:3,visible:!0,hideable:!0},{id:F.StyleSheetId,title:Fe(Le.styleSheetId),sortable:!0,widthWeighting:1.5,visible:!0,hideable:!0}],rows:[],contextMenus:{bodyRow:(t,i,n,s)=>{t.defaultSection().appendItem(Fe(Le.copyTable),()=>{const r=[],o=i.map(d=>d.title);r.push(o.join("	"));for(const d of s){const h=d.cells.map(u=>{if(u.columnId===F.StyleSheetId){const m=Fe(Le.unableToLink);let v="";const E=Y.instance().primaryPageTarget()?.model($r);if(E){const U=E.styleSheetHeaderForId(u.value);U&&(v=U.resourceURL().toString())}return v?v.toString():m}return String(u.value)});r.push(h.join("	"))}const l=r.join(`
`);navigator.clipboard.writeText(l),Vi(Fe(Le.tableCopiedToClipboard))})}}},this.contentElement.appendChild(this.#e)}setEvent(e){if(!this.#i||this.#n===e)return!1;this.#n=e;const t=this.#i.SelectorStats.dataForUpdateLayoutEvent.get(e);if(!t)return this.#e.data={...this.#e.data,rows:[]},!1;const i=t.timings;return this.createRowsForTable(i).then(n=>{this.#e.data={...this.#e.data,rows:n}}),!0}setAggregatedEvents(e){const t=[],i=new Map;if(!this.#i)return;const n={[F.Elapsed]:0,[F.MatchAttempts]:0,[F.MatchCount]:0,[F.FastRejectCount]:0};if(!(Array.isArray(this.#n)&&this.#n.length===e.length&&e.every((s,r)=>{const o=this.#n;return s===o[r]}))){this.#n=e;for(let s=0;s<e.length;s++){const r=e[s],o=r?this.#i.SelectorStats.dataForUpdateLayoutEvent.get(r):void 0;if(o){const l=o.timings;for(const d of l){const c=d[F.Selector]+"_"+d[F.StyleSheetId],h=i.get(c);h!==void 0?(h[F.Elapsed]+=d[F.Elapsed],h[F.FastRejectCount]+=d[F.FastRejectCount],h[F.MatchAttempts]+=d[F.MatchAttempts],h[F.MatchCount]+=d[F.MatchCount]):i.set(c,structuredClone(d)),n[F.Elapsed]+=d[F.Elapsed],n[F.MatchAttempts]+=d[F.MatchAttempts],n[F.MatchCount]+=d[F.MatchCount],n[F.FastRejectCount]+=d[F.FastRejectCount]}}else continue}if(i.size>0)i.forEach(s=>{t.push(s)}),i.clear();else{this.#e.data={...this.#e.data,rows:[]};return}t.unshift({[F.Elapsed]:n[F.Elapsed],[F.FastRejectCount]:n[F.FastRejectCount],[F.MatchAttempts]:n[F.MatchAttempts],[F.MatchCount]:n[F.MatchCount],[F.Selector]:Fe(Le.totalForAllSelectors),[F.StyleSheetId]:"n/a"}),this.createRowsForTable(t).then(s=>{this.#e.data={...this.#e.data,rows:s}})}}async createRowsForTable(e){async function t(r,o,l,d){if(!r)return;const c=r.styleSheetHeaderForId(o);if(!c||!c.resourceURL())return;const h=JSON.stringify({selectorText:l,styleSheetId:o});let u=d.get(h);if(!u){const v=await r.agent.invoke_getLocationForSelector({styleSheetId:o,selectorText:l});if(v.getError()||!v.ranges)return;u=v.ranges,d.set(h,u)}return u.map(v=>({url:c.resourceURL(),lineNumber:v.startLine,columnNumber:v.startColumn,linkText:Fe(Le.lineNumber,{PH1:v.startLine+1,PH2:v.startColumn+1}),title:`${c.id} line ${v.startLine+1}:${v.startColumn+1}`}))}const n=Y.instance().primaryPageTarget()?.model($r);return n?await Promise.all(e.map(async r=>{const o=r[F.StyleSheetId],l=r[F.Selector].trim(),d=r[F.Elapsed]/1e3,c=r[F.MatchAttempts]-r[F.MatchCount],h=(c?r[F.FastRejectCount]/c:1)*100,u=o==="n/a"?null:await t(n,o,l,this.#t);return{cells:[{columnId:F.Elapsed,value:d,renderer(){return bi`${d.toFixed(3)}`}},{columnId:F.MatchAttempts,value:r[F.MatchAttempts]},{columnId:F.MatchCount,value:r[F.MatchCount]},{columnId:F.RejectPercentage,value:h,renderer(){return bi`${h.toFixed(1)}`}},{columnId:F.Selector,title:r[F.Selector],value:r[F.Selector]},{columnId:F.StyleSheetId,value:r[F.StyleSheetId],renderer(){return u===null?bi`<span></span>`:u===void 0?bi`<span title=${Fe(Le.unableToLinkViaStyleSheetId,{PH1:r[F.StyleSheetId]})} aria-label=${Fe(Le.unableToLinkViaStyleSheetId,{PH1:r[F.StyleSheetId]})}>${Fe(Le.unableToLink)}</span>`:bi`
              ${u.map((m,v)=>{const T=v!==u.length-1?", ":"";return bi`<devtools-linkifier .data=${m}></devtools-linkifier>${T}`})}
              `}}]}})):[]}}const Pt={summary:"Summary",bottomup:"Bottom-up",callTree:"Call tree",eventLog:"Event log",paintProfiler:"Paint profiler",layers:"Layers",rangeSS:"Range:  {PH1} â€“ {PH2}",selectorStats:"Selector stats"},Ng=A("panels/timeline/TimelineDetailsView.ts",Pt),Ut=N.bind(void 0,Ng);class Gc extends xe{detailsLinkifier;tabbedPane;defaultDetailsWidget;defaultDetailsContentElement;rangeDetailViews;#e;lazyPaintProfilerView;lazyLayersView;preferredTabId;selection;updateContentsScheduled;lazySelectorStatsView;#t=null;#i=null;#n=null;#s=null;#r;#a;#o=this.#p.bind(this);#l=new tc;constructor(e){super(),this.element.classList.add("timeline-details"),this.detailsLinkifier=new Mt,this.tabbedPane=new oa,this.tabbedPane.show(this.element),this.tabbedPane.headerElement().setAttribute("jslog",`${pa("sidebar").track({keydown:"ArrowUp|ArrowLeft|ArrowDown|ArrowRight|Enter|Space"})}`),this.defaultDetailsWidget=new xe,this.defaultDetailsWidget.element.classList.add("timeline-details-view"),this.defaultDetailsWidget.element.setAttribute("jslog",`${rn("details").track({resize:!0})}`),this.defaultDetailsContentElement=this.defaultDetailsWidget.element.createChild("div","timeline-details-view-body vbox"),this.appendTab(we.Details,Ut(Pt.summary),this.defaultDetailsWidget),this.setPreferredTab(we.Details),this.rangeDetailViews=new Map,this.updateContentsScheduled=!1;const t=new Oc;this.appendTab(we.BottomUp,Ut(Pt.bottomup),t),this.rangeDetailViews.set(we.BottomUp,t);const i=new Bc;this.appendTab(we.CallTree,Ut(Pt.callTree),i),this.rangeDetailViews.set(we.CallTree,i);const n=new _c(e);this.appendTab(we.EventLog,Ut(Pt.eventLog),n),this.rangeDetailViews.set(we.EventLog,n),this.#r=new Zl(this.detailsLinkifier),this.#a=new Vl,this.tabbedPane.addEventListener(_h.TabSelected,this.tabSelected,this),Ys(this.#o),this.lazySelectorStatsView=null}selectorStatsView(){return this.lazySelectorStatsView?this.lazySelectorStatsView:(this.lazySelectorStatsView=new Ag(this.#t),this.lazySelectorStatsView)}getDetailsContentElementForTest(){return this.defaultDetailsContentElement}async#p(e){e.updateType==="MINIMAP_BOUNDS"&&this.selection&&await this.setSelection(this.selection),(e.updateType==="RESET"||e.updateType==="VISIBLE_WINDOW")&&(this.selection||this.scheduleUpdateContentsFromWindow())}async setModel(e){this.#t!==e.parsedTrace&&(this.lazySelectorStatsView=null,this.#t=e.parsedTrace),e.parsedTrace&&(this.#s=Ks(e.parsedTrace)),this.#e=e.selectedEvents,this.#i=e.traceInsightsSets,this.#n=e.eventToRelatedInsightsMap,e.eventToRelatedInsightsMap&&(this.#l.eventToRelatedInsightsMap=e.eventToRelatedInsightsMap),this.tabbedPane.closeTabs([we.PaintProfiler,we.LayerViewer],!1);for(const t of this.rangeDetailViews.values())t.setModelWithEvents(e.selectedEvents,e.parsedTrace);this.lazyPaintProfilerView=null,this.lazyLayersView=null,await this.setSelection(null)}setContent(e){const t=this.tabbedPane.otherTabs(we.Details);for(let i=0;i<t.length;++i)this.rangeDetailViews.has(t[i])||this.tabbedPane.closeTab(t[i]);this.defaultDetailsContentElement.removeChildren(),this.defaultDetailsContentElement.appendChild(e),this.#l&&this.defaultDetailsContentElement.appendChild(this.#l)}updateContents(){const e=this.rangeDetailViews.get(this.tabbedPane.selectedTabId||"");if(e){const t=ae.instance().state();if(!t)return;const i=t.milli.timelineTraceWindow;e.updateContents(this.selection||B.fromRange(i.min,i.max))}}appendTab(e,t,i,n){this.tabbedPane.appendTab(e,t,i,void 0,void 0,n),this.preferredTabId!==this.tabbedPane.selectedTabId&&this.tabbedPane.selectTab(e)}headerElement(){return this.tabbedPane.headerElement()}setPreferredTab(e){this.preferredTabId=e}scheduleUpdateContentsFromWindow(e=!1){if(!this.#t){this.setContent(Wo`<div/>`);return}if(e){this.updateContentsFromWindow();return}this.updateContentsScheduled||(this.updateContentsScheduled=!0,setTimeout(()=>{this.updateContentsScheduled=!1,this.updateContentsFromWindow()},100))}updateContentsFromWindow(){const e=ae.instance().state();if(!e)return;const t=e.milli.timelineTraceWindow;this.updateSelectedRangeStats(t.min,t.max),this.updateContents()}#h(e){if(!this.#s)return null;const t=e.idle?e.startTime:e.endTime,i=Vr(this.#s,t);return i&&$(i.screenshotEvent.ts)-e.endTime<10?i:null}async setSelection(e){if(!this.#t)return;if(this.detailsLinkifier.reset(),this.selection=e,this.#l.activeEvent=null,!this.selection){this.scheduleUpdateContentsFromWindow(!0);return}const t=this.selection.object;if(B.isSyntheticNetworkRequestDetailsEventSelection(t)){const i=t,n=Yt(this.#t,i);await this.#r.setData(this.#t,i,n),this.#l.activeEvent=i,this.#n&&(this.#l.eventToRelatedInsightsMap=this.#n),this.setContent(this.#r)}else if(B.isTraceEventSelection(t)){const i=t;if(this.#l.activeEvent=i,this.#n&&(this.#l.eventToRelatedInsightsMap=this.#n),ne.isEnabled("timeline-rpp-sidebar")&&(Ai(i)||gn(i))){const n=!!(this.#t&&Di.instance().recordingIsFresh(this.#t));this.#a.setData(i,this.#i,this.#t,n),this.setContent(this.#a)}else{const n=await R.buildTraceEventDetails(this.#t,i,this.detailsLinkifier,!0);this.appendDetailsTabsForTraceEventAndShowDetails(i,n)}}else if(B.isLegacyTimelineFrame(t)){const i=t,n=this.#h(i);this.setContent(R.generateDetailsContentForFrame(i,this.#s,n));const s=Y.instance().rootTarget();if(i.layerTree&&s){const r=new Nc(s,i.layerTree),o=this.layersView();o.showLayerTree(r),this.tabbedPane.hasTab(we.LayerViewer)||this.appendTab(we.LayerViewer,Ut(Pt.layers),o)}}else B.isRangeSelection(t)&&this.updateSelectedRangeStats(this.selection.startTime,this.selection.endTime);this.updateContents()}tabSelected(e){e.data.isUserGesture&&(this.setPreferredTab(e.data.tabId),this.updateContents())}layersView(){return this.lazyLayersView?this.lazyLayersView:(this.lazyLayersView=new Wc(this.showSnapshotInPaintProfiler.bind(this)),this.lazyLayersView)}paintProfilerView(){return this.lazyPaintProfilerView?this.lazyPaintProfilerView:this.#t?(this.lazyPaintProfilerView=new Uc(this.#t),this.lazyPaintProfilerView):null}showSnapshotInPaintProfiler(e){const t=this.paintProfilerView();t&&(t.setSnapshot(e),this.tabbedPane.hasTab(we.PaintProfiler)||this.appendTab(we.PaintProfiler,Ut(Pt.paintProfiler),t,!0),this.tabbedPane.selectTab(we.PaintProfiler,!0))}showSelectorStatsForIndividualEvent(e){this.showAggregatedSelectorStats([e])}showAggregatedSelectorStats(e){const t=this.selectorStatsView();t.setAggregatedEvents(e),this.tabbedPane.hasTab(we.SelectorStats)||this.appendTab(we.SelectorStats,Ut(Pt.selectorStats),t)}appendDetailsTabsForTraceEventAndShowDetails(e,t){this.setContent(t),(Rn(e)||_r(e))&&this.showEventInPaintProfiler(e),Wh(e)&&this.showSelectorStatsForIndividualEvent(e)}showEventInPaintProfiler(e){const t=Y.instance().models(da)[0];if(!t)return;const i=this.paintProfilerView();!i||!i.setEvent(t,e)||this.tabbedPane.hasTab(we.PaintProfiler)||this.appendTab(we.PaintProfiler,Ut(Pt.paintProfiler),i)}updateSelectedRangeStats(e,t){if(!this.#e||!this.#t)return;const i=wt(this.#t.Meta.traceBounds).min,n=R.statsForTimeRange(this.#e,e,t),s=e-i,r=t-i,o=new Bs(null,null);o.addSection(Ut(Pt.rangeSS,{PH1:ve(s),PH2:ve(r)}));const l=R.generatePieChart(n);o.appendElementRow("",l),this.setContent(o.fragment);const d=Te.instance().createSetting("timeline-capture-selector-stats",!1).get();if(this.#e&&d){const c=Vh(this.#e,ee(e),ee(t));c.length>0&&this.showAggregatedSelectorStats(c)}}}var we;(function(a){a.Details="details",a.EventLog="event-log",a.CallTree="call-tree",a.BottomUp="bottom-up",a.PaintProfiler="paint-profiler",a.LayerViewer="layer-viewer",a.SelectorStats="selector-stats"})(we||(we={}));const Qf=Object.freeze(Object.defineProperty({__proto__:null,get Tab(){return we},TimelineDetailsView:Gc},Symbol.toStringTag,{value:"Module"}));function jc(a,e,t,i){const n=[...Kc(a,e,a.Initiators.eventToInitiator),...Fg(e,a.Initiators.initiatorToEvents)];return n.forEach(s=>Mg(s,i,t,a)),n}function qc(a,e){return Kc(a,e,a.NetworkRequests.eventToInitiator)}function Kc(a,e,t){const i=[];let n=e;const s=new Set;for(s.add(n);n;){const r=t.get(n);if(r){if(s.has(r))break;i.push({event:n,initiator:r}),n=r,s.add(n);continue}const o=a.Renderer.entryToNode.get(n);if(!o){n=null;break}n=o.parent?.entry||null}return i}function Fg(a,e){const t=[],i=e.get(a);return i&&i.forEach(n=>{t.push({event:n,initiator:a})}),t}function Mg(a,e,t,i){if(t.includes(a.event)){let n=i.Renderer.entryToNode.get(a.event)?.parent;for(;n?.entry&&!e.includes(n?.entry);)n=n.parent??void 0;a.event=n?.entry??a.event,a.isEntryHidden=!0}if(t.includes(a.initiator)){let n=i.Renderer.entryToNode.get(a.initiator)?.parent;for(;n?.entry&&!e.includes(n?.entry);)n=n.parent??void 0;a.initiator=n?.entry??a.initiator,a.isInitiatorHidden=!0}return a}const ev=Object.freeze(Object.defineProperty({__proto__:null,initiatorsDataToDraw:jc,initiatorsDataToDrawForNetwork:qc},Symbol.toStringTag,{value:"Module"})),me={onIgnoreList:"On ignore list",mainS:"Main â€” {PH1}",main:"Main",frameS:"Frame â€” {PH1}",workerS:"`Worker` â€” {PH1}",workerSS:"`Worker`: {PH1} â€” {PH2}",dedicatedWorker:"Dedicated `Worker`",threadS:"Thread {PH1}",raster:"Raster",threadPool:"Thread pool",rasterizerThreadS:"Rasterizer thread {PH1}",threadPoolThreadS:"Thread pool worker {PH1}",bidderWorkletS:"Bidder Worklet â€” {PH1}",bidderWorklet:"Bidder Worklet",sellerWorklet:"Seller Worklet",unknownWorklet:"Auction Worklet",workletService:"Auction Worklet service",sellerWorkletS:"Seller Worklet â€” {PH1}",unknownWorkletS:"Auction Worklet â€” {PH1}",workletServiceS:"Auction Worklet service â€” {PH1}"},Dg=A("panels/timeline/ThreadAppender.ts",me),be=N.bind(void 0,Dg);class li{appenderName="Thread";#e;#t;#i;#n=[];#s;#r;#a;#o;#l=!1;#p=!1;threadType="MAIN_THREAD";isOnMainFrame;#h=ne.isEnabled("timeline-show-all-events");#d="";#u=null;constructor(e,t,i,n,s,r){this.#t=e,this.#e=new ua({min:30,max:330,count:void 0},{min:50,max:80,count:3},85),this.#e.setColorForID("","#f2ecdc"),this.#i=t,this.#r=i,this.#a=n;const o=r==="CPU_PROFILE"?this.#i.Samples?.profilesInProcess.get(i)?.get(n)?.profileCalls:this.#i.Renderer?.processes.get(i)?.threads?.get(n)?.entries,l=r==="CPU_PROFILE"?this.#i.Samples?.profilesInProcess.get(i)?.get(n)?.profileTree:this.#i.Renderer?.processes.get(i)?.threads?.get(n)?.tree;if(!o||!l)throw new Error(`Could not find data for thread with id ${n} in process with id ${i}`);this.#n=o,this.#s=l,this.#o=s||be(me.threadS,{PH1:n}),this.isOnMainFrame=!!this.#i.Renderer?.processes.get(i)?.isOnMainFrame,this.threadType=r,this.#i.AuctionWorklets.worklets.has(i)&&(this.appenderName="Thread_AuctionWorklet"),this.#d=this.#i.Renderer?.processes.get(this.#r)?.url||""}processId(){return this.#r}threadId(){return this.#a}appendTrackAtLevel(e,t=!1){return this.#n.length===0?e:(this.#l=t,this.#b(e))}setHeaderNestingLevel(e){this.#u=e}#c(e){this.#p||(this.threadType==="RASTERIZER"||this.threadType==="THREAD_POOL"?this.#v(e,this.threadType):this.#m(e),this.#p=!0)}setHeaderAppended(e){this.#p=e}headerAppended(){return this.#p}#m(e){const t=this.#n.length>0,i=it({shareHeaderLine:!1,collapsible:t});this.#u!==null&&(i.nestingLevel=this.#u);const n=this.#g(),s=nt(n,e,this.trackName(),i,!0,this.#l,!0);this.#t.registerTrackForGroup(s,this)}#g(){switch(this.threadType){case"MAIN_THREAD":return this.isOnMainFrame?"thread.main":"thread.frame";case"WORKER":return"thread.worker";case"RASTERIZER":return"thread.rasterizer";case"AUCTION_WORKLET":return"thread.auction-worklet";case"OTHER":return"thread.other";case"CPU_PROFILE":return"thread.cpu-profile";case"THREAD_POOL":return"thread.pool";default:return null}}#v(e,t){const i=this.#t.getCurrentTrackCountForThreadType(t);if(i===0){const l=this.#n.length>0,d=it({shareHeaderLine:!1,collapsible:l}),c=nt(null,e,this.trackName(),d,!1,this.#l);this.#t.getFlameChartTimelineData().groups.push(c)}const n=it({padding:2,nestingLevel:1,collapsible:!1}),s=this.threadType==="RASTERIZER"?be(me.rasterizerThreadS,{PH1:i+1}):be(me.threadPoolThreadS,{PH1:i+1}),r=this.#g(),o=nt(r,e,s,n,!0,this.#l);this.#t.registerTrackForGroup(o,this)}trackName(){let e=null;switch(this.threadType){case"MAIN_THREAD":e=this.isOnMainFrame?be(me.mainS,{PH1:this.#d}):be(me.frameS,{PH1:this.#d});break;case"CPU_PROFILE":e=be(me.main);break;case"WORKER":e=this.#w();break;case"RASTERIZER":e=be(me.raster);break;case"THREAD_POOL":e=be(me.threadPool);break;case"OTHER":break;case"AUCTION_WORKLET":e=this.#f();break;default:return ke(this.threadType,`Unknown thread type: ${this.threadType}`)}let t="";return this.#i.Meta.traceIsGeneric&&(t=t+` (${this.threadId()})`),(e||this.#o)+t}getUrl(){return this.#d}getEntries(){return this.#n}#f(){const e=this.#i.AuctionWorklets.worklets.get(this.#r);if(!e)return be(me.unknownWorklet);const t=e.host?`https://${e.host}`:"",i=t.length>0,n=e.args.data.utilityThread.tid===this.#a,s=e.args.data.v8HelperThread.tid===this.#a;if(n)return i?be(me.workletServiceS,{PH1:t}):be(me.workletService);if(s)switch(e.type){case"seller":return i?be(me.sellerWorkletS,{PH1:t}):be(me.sellerWorklet);case"bidder":return i?be(me.bidderWorkletS,{PH1:t}):be(me.bidderWorklet);case"unknown":return i?be(me.unknownWorkletS,{PH1:t}):be(me.unknownWorklet);default:ke(e.type,`Unexpected Auction Worklet Type ${e.type}`)}return i?be(me.unknownWorkletS,{PH1:t}):be(me.unknownWorklet)}#w(){const e=this.#i.Renderer?.processes.get(this.#r)?.url||"",t=this.#i.Workers.workerIdByThread.get(this.#a),i=t?this.#i.Workers.workerURLById.get(t):e;let n=i?be(me.workerS,{PH1:i}):be(me.dedicatedWorker);const s=t!==void 0&&Y.instance().targetById(t);return s&&(n=be(me.workerSS,{PH1:s.name(),PH2:e})),n}#b(e){return this.#y(this.#s.roots,e)}#y(e,t,i=!1){const n=H.activeManager()?.getEntriesFilter().invisibleEntries()??[];let s=t;for(const r of e){let o=t;const l=r.entry,d=On(l);!n.includes(l)&&(pr(l,this.#i)||this.#h)&&!(d&&i)&&(this.#E(l,t),o++);const u=this.#y(r.children,o,d);s=Math.max(u,s)}return s}#E(e,t){this.#c(t);const i=this.#t.appendEventAtLevel(e,t,this);this.#T(e,i)}#T(e,t){const i=this.#t.getFlameChartTimelineData();H.activeManager()?.getEntriesFilter().isEntryExpandable(e)&&qi(i,t,{type:"HIDDEN_DESCENDANTS_ARROW"});const n=this.#i.Warnings.perEvent.get(e);n&&(qi(i,t,{type:"WARNING_TRIANGLE"}),n.includes("LONG_TASK")&&qi(i,t,{type:"CANDY",startAtTime:Wu}))}colorForEvent(e){return this.#i.Meta.traceIsGeneric?e.name?`hsl(${Uh(e.name)%300+30}, 40%, 70%)`:"#ccc":We(e)?e.callFrame.functionName==="(idle)"?$e().idle.getComputedColorValue():e.callFrame.scriptId==="0"?$e().scripting.getComputedColorValue():this.#e.colorForID(e.callFrame.url):tn(e.name)?.category.getComputedColorValue()||$e().other.getComputedColorValue()}titleForEvent(e){return On(e)?be(me.onIgnoreList):Ge(e,this.#i)}highlightedEntryInfo(e){let t=this.titleForEvent(e);if(zh(e)){const n=e.args.beginData.startLine,s=e.args.endData&&e.args.endData.endLine,r=e.args.beginData.url,o=ri(r),l=s!==-1||s===n?`${n}...${s}`:n;t+=` - ${o} [${l}]`}const i=this.#i.Renderer.entryToNode.get(e)?.selfTime;return{title:t,formattedTime:hi(e.dur,i)}}}const tv=Object.freeze(Object.defineProperty({__proto__:null,ThreadAppender:li},Symbol.toStringTag,{value:"Module"})),Os=new CSSStyleSheet;Os.replaceSync(`/*
 * Copyright (c) 2015 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

.timeline-flamechart-popover {
  overflow: hidden;
}

.timeline-flamechart-popover devtools-interaction-breakdown {
  margin-top: 10px;
}

.timeline-flamechart-popover span {
  margin-right: 5px;
}

.timeline-flamechart-popover span.timeline-info-network-time {
  color: var(--sys-color-primary);
}

.timeline-flamechart-popover span.timeline-info-time {
  color: var(--sys-color-green);
}

.timeline-flamechart-popover span.timeline-info-warning {
  color: var(--sys-color-error);
}

.timeline-flamechart-popover span.timeline-info-warning * {
  color: inherit;
}

.layout-shift-viz {
  position: relative;
  margin: var(--sys-size-8) var(--sys-size-5);
  outline: 1px solid var(--sys-color-divider);
}

.layout-shift-viz-rect {
  outline: 1px solid color-mix(in sRGB, var(--color-background-inverted) 20%, var(--app-color-rendering));
  background-color: color-mix(in sRGB, var(--color-background-inverted-opacity-0) 50%, var(--app-color-rendering-children));
  position: absolute;
  z-index: 100;
}

.layout-shift-viz > img {
  position: absolute;
  top: 0;
  left: 0;
}

/*# sourceURL=timelineFlamechartPopover.css */
`);const Ze={frames:"Frames",idleFrame:"Idle frame",droppedFrame:"Dropped frame",partiallyPresentedFrame:"Partially-presented frame",frame:"Frame",hideFunction:"Hide function",hideChildren:"Hide children",hideRepeatingChildren:"Hide repeating children",removeScriptFromIgnoreList:"Remove script from ignore list",addScriptToIgnoreList:"Add script to ignore list",resetChildren:"Reset children",resetTrace:"Reset trace"},$g=A("panels/timeline/TimelineFlameChartDataProvider.ts",Ze),lt=N.bind(void 0,$g);class Xi extends Zo{droppedFramePatternCanvas;partialFramePatternCanvas;timelineDataInternal;currentLevel;compatibilityTracksAppender;parsedTrace;isCpuProfile=!1;minimumBoundaryInternal;timeSpan;headerLevel1;headerLevel2;staticHeader;framesHeader;screenshotsHeader;entryData=[];entryTypeByLevel;entryIndexToTitle;lastInitiatorEntry;lastInitiatorsData=[];lastSelection;#e;#t=new WeakMap;constructor(){super(),this.reset(),this.#e=`${ol} ${ll()}`,this.droppedFramePatternCanvas=document.createElement("canvas"),this.partialFramePatternCanvas=document.createElement("canvas"),this.preparePatternCanvas(),this.timelineDataInternal=null,this.currentLevel=0,this.compatibilityTracksAppender=null,this.parsedTrace=null,this.minimumBoundaryInternal=0,this.timeSpan=0,this.headerLevel1=this.buildGroupStyle({shareHeaderLine:!1}),this.headerLevel2=this.buildGroupStyle({padding:2,nestingLevel:1,collapsible:!1}),this.staticHeader=this.buildGroupStyle({collapsible:!1}),this.framesHeader=this.buildGroupStyle({useFirstLineForOverview:!0}),this.screenshotsHeader=this.buildGroupStyle({useFirstLineForOverview:!0,nestingLevel:1,collapsible:!1,itemsHeight:150}),ie.instance().addEventListener(Rs.eventName,()=>{const e=[this.headerLevel1,this.headerLevel2,this.staticHeader,this.framesHeader,this.screenshotsHeader];for(const t of e)t.color=ie.instance().getComputedValue("--sys-color-on-surface"),t.backgroundColor=ie.instance().getComputedValue("--sys-color-cdt-base-container")}),Gh.addEventListener("screenshot-loaded",()=>this.dispatchEventToListeners("DataChanged"))}hasTrackConfigurationMode(){return!0}getPossibleActions(e,t){const i=this.timelineData();if(!i)return;const n=i.groups.at(t);if(!(!n||!n.expanded||!n.showStackContextMenu))return this.findPossibleContextMenuActions(e)}customizedContextMenu(e,t,i){const n=this.getPossibleActions(t,i);if(!n)return;const s=new Ji(e,{useSoftMenu:!0});if(Fi.instance().hasAction("drjones.performance-panel-context")){const u=this.getTraceEntryTreeForAIFromEntryIndex(t);Li.instance().setFlavor(Hr,u),s.headerSection().appendAction("drjones.performance-panel-context")}s.defaultSection().appendItem(lt(Ze.hideFunction),()=>{this.modifyTree("MERGE_FUNCTION",t)},{disabled:!n?.MERGE_FUNCTION,jslogContext:"hide-function"}).setShortcut("H"),s.defaultSection().appendItem(lt(Ze.hideChildren),()=>{this.modifyTree("COLLAPSE_FUNCTION",t)},{disabled:!n?.COLLAPSE_FUNCTION,jslogContext:"hide-children"}).setShortcut("C"),s.defaultSection().appendItem(lt(Ze.hideRepeatingChildren),()=>{this.modifyTree("COLLAPSE_REPEATING_DESCENDANTS",t)},{disabled:!n?.COLLAPSE_REPEATING_DESCENDANTS,jslogContext:"hide-repeating-children"}).setShortcut("R"),s.defaultSection().appendItem(lt(Ze.resetChildren),()=>{this.modifyTree("RESET_CHILDREN",t)},{disabled:!n?.RESET_CHILDREN,jslogContext:"reset-children"}).setShortcut("U"),s.defaultSection().appendItem(lt(Ze.resetTrace),()=>{this.modifyTree("UNDO_ALL_ACTIONS",t)},{disabled:!n?.UNDO_ALL_ACTIONS,jslogContext:"reset-trace"});const c=this.eventByIndex(t);if(!c||c instanceof Bn||!this.parsedTrace)return s;const h=Ot.resolvedURLForEntry(this.parsedTrace,c);return h&&(On(c)?s.defaultSection().appendItem(lt(Ze.removeScriptFromIgnoreList),()=>{An.instance().unIgnoreListURL(h),this.dispatchEventToListeners("DataChanged")},{jslogContext:"remove-from-ignore-list"}):s.defaultSection().appendItem(lt(Ze.addScriptToIgnoreList),()=>{An.instance().ignoreListURL(h),this.dispatchEventToListeners("DataChanged")},{jslogContext:"add-to-ignore-list"})),s}entryHasAnnotations(e){const t=this.eventByIndex(e);if(!t)return!1;const i=H.activeManager()?.annotationsForEntry(t);return i?i.length>0:!1}deleteAnnotationsForEntry(e){const t=this.eventByIndex(e);t&&H.activeManager()?.deleteEntryAnnotations(t)}modifyTree(e,t){const i=this.entryData[t];H.activeManager()?.getEntriesFilter().applyFilterAction({type:e,entry:i}),this.timelineData(!0),this.buildFlowForInitiator(t),this.dispatchEventToListeners("DataChanged")}getTraceEntryTreeForAIFromEntryIndex(e){const t=this.entryData[e],i=H.activeManager();return i?i.getEntriesFilter().getTraceEntryTreeForAI(t):null}findPossibleContextMenuActions(e){const t=this.entryData[e];return H.activeManager()?.getEntriesFilter().findPossibleActions(t)}handleFlameChartTransformKeyboardEvent(e,t,i){const n=this.getPossibleActions(t,i);if(!n)return;let s=!1;e.code==="KeyH"&&n.MERGE_FUNCTION?(this.modifyTree("MERGE_FUNCTION",t),s=!0):e.code==="KeyC"&&n.COLLAPSE_FUNCTION?(this.modifyTree("COLLAPSE_FUNCTION",t),s=!0):e.code==="KeyR"&&n.COLLAPSE_REPEATING_DESCENDANTS?(this.modifyTree("COLLAPSE_REPEATING_DESCENDANTS",t),s=!0):e.code==="KeyU"&&(this.modifyTree("RESET_CHILDREN",t),s=!0),s&&e.consume(!0)}buildGroupStyle(e){const t={padding:4,height:17,collapsible:!0,color:ie.instance().getComputedValue("--sys-color-on-surface"),backgroundColor:ie.instance().getComputedValue("--sys-color-cdt-base-container"),nestingLevel:0,shareHeaderLine:!0};return Object.assign(t,e)}setModel(e,t=!1){if(this.reset(),this.parsedTrace=e,pi.instance().modelChanged(e),this.isCpuProfile=t,e){const{traceBounds:i}=e.Meta,n=$(i.min),s=$(i.max);this.minimumBoundaryInternal=n,this.timeSpan=n===s?1e3:s-this.minimumBoundaryInternal}}compatibilityTracksAppenderInstance(e=!1){if(!this.compatibilityTracksAppender||e){if(!this.parsedTrace)throw new Error("Attempted to instantiate a CompatibilityTracksAppender without having set the trace parse data first.");this.timelineDataInternal=this.#i(),this.compatibilityTracksAppender=new Sd(this.timelineDataInternal,this.parsedTrace,this.entryData,this.entryTypeByLevel)}return this.compatibilityTracksAppender}#i(){return this.timelineDataInternal||(this.timelineDataInternal=Ns.createEmpty()),this.timelineDataInternal}buildFromTrackAppenders(e){if(!this.compatibilityTracksAppender)return;const t=this.compatibilityTracksAppender.allVisibleTrackAppenders();for(const i of t){if(i instanceof li&&!i.trackName().includes(e?.filterThreadsByName||""))continue;const s=!!e?.expandedTracks?.has(i.appenderName);this.currentLevel=i.appendTrackAtLevel(this.currentLevel,s)}}groupTreeEvents(e){return this.compatibilityTracksAppender?.groupEventsForTreeView(e)??null}mainFrameNavigationStartEvents(){return this.parsedTrace?this.parsedTrace.Meta.mainFrameNavigations:[]}entryTitle(e){const t=this.#o(e);if(t==="Screenshot")return"";if(t==="TrackAppender"){const s=this.timelineDataInternal.entryLevels[e],r=this.entryData[e];return this.compatibilityTracksAppender?.titleForEvent(r,s)||null}let i=this.entryIndexToTitle[e];return i||(i=`Unexpected entryIndex ${e}`,console.error(i)),i}textColor(e){const t=this.entryData[e];return Xi.timelineEntryIsTraceEvent(t)&&On(t)?"#888":_s.textColor}entryFont(e){return this.#e}reset(e=!0){this.currentLevel=0,this.entryData=[],this.entryTypeByLevel=[],this.entryIndexToTitle=[],this.#t=new Map,e?(this.compatibilityTracksAppender?.reset(),this.compatibilityTracksAppender=null,this.timelineDataInternal=null):!e&&this.timelineDataInternal&&(this.compatibilityTracksAppender?.setFlameChartDataAndEntryData(this.timelineDataInternal,this.entryData,this.entryTypeByLevel),this.compatibilityTracksAppender?.threadAppenders().forEach(t=>t.setHeaderAppended(!1))),pi.removeInstance()}maxStackDepth(){return this.currentLevel}timelineData(e=!1){return this.timelineDataInternal&&this.timelineDataInternal.entryLevels.length!==0&&!e?this.timelineDataInternal:(this.timelineDataInternal=Ns.createEmpty(),e&&this.reset(!1),this.currentLevel=0,this.parsedTrace&&(this.compatibilityTracksAppender=this.compatibilityTracksAppenderInstance(),this.parsedTrace.Meta.traceIsGeneric?this.#n():this.#s()),this.timelineDataInternal)}#n(){if(!this.compatibilityTracksAppender)return;const e=this.compatibilityTracksAppender.allThreadAppendersByProcess();for(const[t,i]of e){const n=this.buildGroupStyle({shareHeaderLine:!1}),s=this.parsedTrace?.Meta.processNames.get(t)?.args.name||"Process";this.appendHeader(`${s} (${t})`,n,!0,!1);for(const r of i)r.setHeaderNestingLevel(1),this.currentLevel=r.appendTrackAtLevel(this.currentLevel)}}#s(){this.isCpuProfile||this.#r();const e=i=>{switch(i.appenderName){case"Animations":return 0;case"Timings":return 1;case"Interactions":return 2;case"LayoutShifts":return 3;case"Extension":return 4;case"Thread":return 5;case"ServerTimings":return 6;case"GPU":return 7;case"Thread_AuctionWorklet":return 8;default:return 9}},t=this.compatibilityTracksAppender?this.compatibilityTracksAppender.allVisibleTrackAppenders():[];t.sort((i,n)=>e(i)-e(n));for(const i of t)if(this.parsedTrace&&(this.currentLevel=i.appendTrackAtLevel(this.currentLevel),this.timelineDataInternal&&!this.timelineDataInternal.selectedGroup&&i instanceof li&&(i.threadType==="MAIN_THREAD"||i.threadType==="CPU_PROFILE"))){const n=this.compatibilityTracksAppender?.groupForAppender(i);n&&(this.timelineDataInternal.selectedGroup=n)}this.timelineDataInternal&&this.timelineDataInternal.selectedGroup&&(this.timelineDataInternal.selectedGroup.expanded=!0)}minimumBoundary(){return this.minimumBoundaryInternal}totalTime(){return this.timeSpan}static timelineEntryIsTraceEvent(e){return!(e instanceof Bn)}search(e,t){const i=[];this.timelineData();for(let n=0;n<this.entryData.length;++n){const s=this.entryData[n];if(s&&Xi.timelineEntryIsTraceEvent(s)&&!jh(s)&&el(s,e)&&t.accept(s,this.parsedTrace||void 0)){const r=$(s.ts);i.push({index:n,startTimeMilli:r,provider:"main"})}}return i}getEntryTypeForLevel(e){return this.entryTypeByLevel[e]}#r(){if(!this.parsedTrace)return;const e=Ks(this.parsedTrace),t=e.frames.length>0;this.framesHeader.collapsible=t;const i=ga.queryParam("flamechart-force-expand")==="frames";this.appendHeader(lt(Ze.frames),this.framesHeader,!1,i),this.entryTypeByLevel[this.currentLevel]="Frame";for(const n of this.parsedTrace.Frames.frames)this.#h(n);++this.currentLevel,t&&this.#a(e)}#a(e){if(!this.timelineDataInternal||!this.parsedTrace)return;this.appendHeader("",this.screenshotsHeader,!1),this.entryTypeByLevel[this.currentLevel]="Screenshot";let t;for(const i of e.frames){const n=$(i.screenshotEvent.ts);this.entryData.push(i.screenshotEvent),this.timelineDataInternal.entryLevels.push(this.currentLevel),this.timelineDataInternal.entryStartTimes.push(n),t&&this.timelineDataInternal.entryTotalTimes.push(n-t),t=n}if(e.frames.length&&t!==void 0){const i=wt(this.parsedTrace.Meta.traceBounds).max;this.timelineDataInternal.entryTotalTimes.push(i-t)}++this.currentLevel}#o(e){const t=this.timelineData().entryLevels[e];return this.entryTypeByLevel[t]}prepareHighlightedEntryInfo(e){let t="",i,n=[],s="timeline-info-time";const r=[],o=this.#o(e);if(o==="TrackAppender"){if(!this.compatibilityTracksAppender)return null;const h=this.entryData[e],m=this.timelineDataInternal.entryLevels[e],v=this.compatibilityTracksAppender.highlightedEntryInfo(h,m);i=v.title,t=v.formattedTime,n=v.warningElements||n,v.additionalElement&&r.push(v.additionalElement)}else if(o==="Frame"){const h=this.entryData[e];t=Ye($(h.duration),1),h.idle?i=lt(Ze.idleFrame):h.dropped?(h.isPartial?i=lt(Ze.partiallyPresentedFrame):i=lt(Ze.droppedFrame),s="timeline-info-warning"):i=lt(Ze.frame)}else return null;const l=document.createElement("div"),c=Dn(l,{cssFile:[Os],delegatesFocus:void 0}).createChild("div","timeline-flamechart-popover");if(c.createChild("span",s).textContent=t,c.createChild("span","timeline-info-title").textContent=i,n)for(const h of n)h.classList.add("timeline-info-warning"),c.appendChild(h);for(const h of r)c.appendChild(h);return l}prepareHighlightedHiddenEntriesArrowInfo(e){const t=document.createElement("div"),i=Dn(t,{cssFile:[Os],delegatesFocus:void 0}),n=this.entryData[e],s=H.activeManager()?.getEntriesFilter().findHiddenDescendantsAmount(n);if(!s)return null;const r=i.createChild("div","timeline-flamechart-popover");return r.createChild("span","timeline-info-title").textContent=s+" hidden",t}getDrawOverride(e){if(this.#o(e)!=="TrackAppender")return;const n=this.timelineDataInternal.entryLevels[e],s=this.entryData[e];return this.compatibilityTracksAppender?.getDrawOverride(s,n)}#l(e){const t=this.entryData[e];return t.idle?"white":t.dropped?t.isPartial?"#f0e442":"#f08080":"#d7f0d1"}entryColor(e){const t=this.#o(e);if(t==="Frame")return this.#l(e);if(t==="TrackAppender"){const n=this.timelineDataInternal.entryLevels[e],s=this.entryData[e];return this.compatibilityTracksAppender?.colorForEvent(s,n)||""}return""}preparePatternCanvas(){this.droppedFramePatternCanvas.width=17,this.droppedFramePatternCanvas.height=17,this.partialFramePatternCanvas.width=17,this.partialFramePatternCanvas.height=17;const t=this.droppedFramePatternCanvas.getContext("2d");if(t){t.translate(17*.5,17*.5),t.rotate(Math.PI*.25),t.translate(-17*.5,-17*.5),t.fillStyle="rgb(255, 255, 255)";for(let n=-17;n<17*2;n+=3)t.fillRect(n,-17,1,17*3)}const i=this.partialFramePatternCanvas.getContext("2d");i&&(i.strokeStyle="rgb(255, 255, 255)",i.lineWidth=2,i.beginPath(),i.moveTo(17,0),i.lineTo(10,7),i.moveTo(8,9),i.lineTo(2,15),i.stroke())}drawFrame(e,t,i,n,s,r,o){const d=this.entryData[e];if(n+=1,r-=2*1,t.fillStyle=this.entryColor(e),d.dropped)if(d.isPartial){t.fillRect(n,s,r,o);const u=t.createPattern(this.partialFramePatternCanvas,"repeat");t.fillStyle=u||t.fillStyle}else{t.fillRect(n,s,r,o);const u=t.createPattern(this.droppedFramePatternCanvas,"repeat");t.fillStyle=u||t.fillStyle}t.fillRect(n,s,r,o);const c=Ye($(d.duration),1),h=t.measureText(c).width;h<=r&&(t.fillStyle=this.textColor(e),t.fillText(c,n+(r-h)/2,s+o-4))}async drawScreenshot(e,t,i,n,s,r){const o=this.entryData[e],l=Wr(o);if(!l)return;const d=i+1,c=n+1,h=r-2,u=h/l.naturalHeight,m=Math.floor(l.naturalWidth*u);t.save(),t.beginPath(),t.rect(i,n,s,r),t.clip(),t.drawImage(l,d,c,m,h),t.strokeStyle="#ccc",t.strokeRect(d-.5,c-.5,Math.min(s-1,m+1),h),t.restore()}decorateEntry(e,t,i,n,s,r,o,l,d){const c=this.#o(e);if(c==="Frame")return this.drawFrame(e,t,i,n,s,r,o),!0;if(c==="Screenshot")return this.drawScreenshot(e,t,n,s,r,o),!0;if(c==="TrackAppender"){const h=this.entryData[e];if(Ni(h))return this.#p(t,e,i,h,n,s,l,r,o,d),!0}return!1}#p(e,t,i,n,s,r,o,l,d,c){const h=$(n.ts),u=s+l;function m(O){const j=$(O);return Math.floor(o+(j-h)*c)}e.save(),e.fillStyle=ie.instance().getComputedValue("--sys-color-cdt-base-container");let v=m(n.processingStart);const T=m(n.processingEnd);n.processingEnd-n.processingStart===0&&(v-=1),e.fillRect(s,r-.5,v-s,d),e.fillRect(T,r-.5,u-T,d);function E(O,j,S){e.moveTo(O,S-6/2),e.lineTo(O,S+6/2),e.moveTo(O,S),e.lineTo(j,S)}const U=m(n.ts),w=m(_(n.ts+n.dur));e.beginPath(),e.lineWidth=1,e.strokeStyle="#ccc";const x=Math.floor(r+d/2)+.5,C=U+.5,W=w-.5;if(E(C,v,x),E(W,T,x),e.stroke(),i){const O=v>0?v:s;e.font=this.#e;const j=qh(e,i),S=5,k=5;j<=T-O+S&&(e.fillStyle=this.textColor(t),e.fillText(i,O+S,r+d-k))}e.restore()}forceDecoration(e){const t=this.#o(e);if(t==="Frame"||t==="Screenshot")return!0;const i=this.entryData[e];return Ni(i)?!0:!!this.parsedTrace?.Warnings.perEvent.get(i)}appendHeader(e,t,i,n){const s={startLevel:this.currentLevel,name:e,style:t,selectable:i,expanded:n};return this.timelineDataInternal.groups.push(s),s}#h(e){const t=this.entryData.length;this.entryData.push(e);const i=$(e.duration);this.entryIndexToTitle[t]=ve(i,!0),this.timelineDataInternal&&(this.timelineDataInternal.entryLevels[t]=this.currentLevel,this.timelineDataInternal.entryTotalTimes[t]=i,this.timelineDataInternal.entryStartTimes[t]=$(e.startTime))}createSelection(e){const t=this.#o(e);let i=null;const n=this.entryData[e];if(n&&Xi.timelineEntryIsTraceEvent(n)?i=B.fromTraceEvent(n):t==="Frame"&&(i=B.fromFrame(this.entryData[e])),i&&(this.lastSelection=new Wn(i,e)),Fi.instance().hasAction("drjones.performance-panel-context")){const s=this.getTraceEntryTreeForAIFromEntryIndex(e);Li.instance().setFlavor(Hr,s)}return i}formatValue(e,t){return Ye(e,t)}groupForEvent(e){if(!this.compatibilityTracksAppender)return null;const t=this.timelineDataInternal?.entryLevels[e]??null;if(t===null)return null;const i=this.compatibilityTracksAppender.groupForLevel(t);return i||null}canJumpToEntry(e){return!1}entryIndexForSelection(e){if(!e||B.isRangeSelection(e.object)||B.isSyntheticNetworkRequestDetailsEventSelection(e.object))return-1;if(this.lastSelection&&this.lastSelection.timelineSelection.object===e.object)return this.lastSelection.entryIndex;this.entryData.indexOf(e.object)===-1&&B.isTraceEventSelection(e.object)&&this.timelineDataInternal?.selectedGroup&&(H.activeManager()?.getEntriesFilter().revealEntry(e.object),this.timelineData(!0));const t=this.entryData.indexOf(e.object);return t!==-1&&(this.lastSelection=new Wn(e,t)),t}indexForEvent(e){const t=this.#t.get(e);if(typeof t=="number")return t;const i=this.entryData.indexOf(e),n=i>-1?i:null;return this.#t.set(e,n),n}buildFlowForInitiator(e){if(!this.parsedTrace||!this.timelineDataInternal)return!1;if(this.lastInitiatorEntry===e)return this.lastInitiatorsData&&(this.timelineDataInternal.initiatorsData=this.lastInitiatorsData),!1;if(!this.compatibilityTracksAppender)return!1;const t=this.timelineDataInternal.initiatorsData.length;if(e===-1)return this.lastInitiatorEntry=e,t===0?!1:(this.timelineDataInternal.resetFlowData(),!0);if(this.#o(e)!=="TrackAppender")return!1;const n=this.entryData[e];this.timelineDataInternal.resetFlowData(),this.lastInitiatorEntry=e;const s=H.activeManager()?.getEntriesFilter().invisibleEntries()??[],r=H.activeManager()?.getEntriesFilter().expandableEntries()??[],o=jc(this.parsedTrace,n,s,r);if(t===0&&o.length===0)return!1;for(const l of o){const d=this.indexForEvent(l.event),c=this.indexForEvent(l.initiator);d===null||c===null||this.timelineDataInternal.initiatorsData.push({initiatorIndex:c,eventIndex:d,isInitiatorHidden:l.isInitiatorHidden,isEntryHidden:l.isEntryHidden})}return this.lastInitiatorsData=this.timelineDataInternal.initiatorsData,!0}eventByIndex(e){if(e<0)return null;const t=this.#o(e);return t==="TrackAppender"?this.entryData[e]:t==="Frame"?this.entryData[e]:null}}const Hs=se(.001),iv=Object.freeze(Object.defineProperty({__proto__:null,InstantEventVisibleDurationMs:Hs,TimelineFlameChartDataProvider:Xi},Symbol.toStringTag,{value:"Module"})),Yc={network:"Network"},Bg=A("panels/timeline/NetworkTrackAppender.ts",Yc),Og=N.bind(void 0,Bg);class Xc{appenderName="Network";#e;webSocketIdToLevel=new Map;#t=[];#i;#n;constructor(e,t){this.#e=e,this.#t=t,this.#i=`${ol} ${ll()}`,ie.instance().addEventListener(Rs.eventName,()=>{this.#n&&(this.#n.style.color=ie.instance().getComputedValue("--sys-color-on-surface"),this.#n.style.backgroundColor=ie.instance().getComputedValue("--sys-color-cdt-base-container"))})}group(){return this.#n}font(){return this.#i}appendTrackAtLevel(e,t){return this.#t.length===0?e:(this.#s(e,t),this.#r(this.#t,e))}#s(e,t){const i=it({shareHeaderLine:!1,useFirstLineForOverview:!1,useDecoratorsForOverview:!0});this.#n=nt("network",0,Og(Yc.network),i,!0,t,!1),this.#e.groups.push(this.#n)}#r(e,t){for(let i=0;i<e.length;++i){const n=e[i];this.#a(n,t),Dt(n)&&fa(n)&&qi(this.#e,i,{type:"WARNING_TRIANGLE",customStartTime:n.args.data.syntheticData.sendStartTime,customEndTime:n.args.data.syntheticData.finishTime})}return this.relayoutEntriesWithinBounds(e,se(-1/0),se(1/0))}#a(e,t){const i=this.#e.entryLevels.length;this.#e.entryLevels[i]=t,this.#e.entryStartTimes[i]=$(e.ts);const n=e.dur||ee(Hs);return this.#e.entryTotalTimes[i]=$(n),t}relayoutEntriesWithinBounds(e,t,i){if(!this.#e||e.length===0)return 0;const n=[];this.webSocketIdToLevel=new Map;let s=0;for(let r=0;r<e.length;++r){const o=e[r],l=$(o.ts),d=o.dur?$(o.dur):Hs,c=l+d;if(!(l<i&&c>t)){this.#e.entryLevels[r]=-1;continue}let u;"identifier"in o.args.data&&Kh(o)?u=this.getWebSocketLevel(o,n):u=Fs(o,n),this.#e.entryLevels[r]=u,s=Math.max(s,n.length,u)}for(let r=0;r<e.length;++r)this.#e.entryLevels[r]===-1&&(this.#e.entryLevels[r]=s);return s}getWebSocketLevel(e,t){const i=e.args.data.identifier;let n;return this.webSocketIdToLevel.has(i)?n=this.webSocketIdToLevel.get(i)||0:(n=Fs(e,t),this.webSocketIdToLevel.set(i,n)),n}colorForEvent(e){if(tl(e))return"";if(zo(e))return jl(he.JS);if(!Dt(e))throw new Error(`Unexpected Network Request: The event's type is '${e.name}'`);return Ms(e)}}const nv=Object.freeze(Object.defineProperty({__proto__:null,NetworkTrackAppender:Xc},Symbol.toStringTag,{value:"Module"}));class Jc{#e;#t;#i;#n;#s;#r;#a;#o;#l=new Map;#p=-1;#h=[];constructor(){this.#e=0,this.#t=0,this.#i=[],this.#n=0,this.#s=null,this.#o=null}setModel(e){this.#r=null,this.#i=[],this.#o=e,this.#l.clear(),this.#o&&(this.setEvents(this.#o),this.#c(this.#o))}setEvents(e){e.NetworkRequests.webSocket&&e.NetworkRequests.webSocket.forEach(t=>{t.syntheticConnection&&this.#i.push(t.syntheticConnection),this.#i.push(...t.events)}),e.NetworkRequests.byTime&&this.#i.push(...e.NetworkRequests.byTime)}isEmpty(){return this.timelineData(),!this.#i.length}maxStackDepth(){return this.#n}hasTrackConfigurationMode(){return!1}timelineData(){return this.#r&&this.#r.entryLevels.length!==0?this.#r:(this.#r=Ns.createEmpty(),this.#o?(this.#i.length||this.setEvents(this.#o),this.#s=new Xc(this.#r,this.#i),this.#n=this.#s.appendTrackAtLevel(0),this.#r):this.#r)}minimumBoundary(){return this.#e}totalTime(){return this.#t}setWindowTimes(e,t){this.#m(e,t)}createSelection(e){if(e===-1)return null;const t=this.#i[e];return this.#a=new Wn(B.fromTraceEvent(t),e),this.#a.timelineSelection}customizedContextMenu(e,t,i){const n=this.eventByIndex(t);if(!n||!Dt(n))return;const s=Yh(n),r=new Ji(e,{useSoftMenu:!0});return r.appendApplicableItems(s),r}indexForEvent(e){if(e instanceof Bn||!ca(e))return null;const t=this.#l.get(e);if(t!==void 0)return t;const i=this.#i.indexOf(e),n=i>-1?i:null;return this.#l.set(e,n),n}eventByIndex(e){return this.#i.at(e)??null}entryHasAnnotations(e){const t=this.eventByIndex(e);if(!t)return!1;const i=H.activeManager()?.annotationsForEntry(t);return i!==void 0&&i.length>0}deleteAnnotationsForEntry(e){const t=this.eventByIndex(e);t&&H.activeManager()?.deleteEntryAnnotations(t)}entryIndexForSelection(e){if(!e)return-1;if(this.#a&&this.#a.timelineSelection.object===e.object)return this.#a.entryIndex;if(!B.isNetworkEventSelection(e.object))return-1;const t=this.#i.indexOf(e.object);return t!==-1&&(this.#a=new Wn(B.fromTraceEvent(e.object),t)),t}groupForEvent(e){return this.#s?.group()??null}entryColor(e){if(!this.#s)throw new Error("networkTrackAppender should not be empty");return this.#s.colorForEvent(this.#i[e])}textColor(e){return _s.textColor}entryTitle(e){const t=this.#i[e];return Ge(t)}entryFont(e){return this.#s?.font()||null}getDecorationPixels(e,t,i){const n=$(e.ts),s=T=>t+(T-n)*i,r=$(e.ts),o=$(e.ts+e.dur),l=$(e.args.data.syntheticData.sendStartTime),d=$(e.args.data.syntheticData.downloadStart),c=Math.max(s(l),t),h=Math.max(s(d),c),u=Math.max(s($(e.args.data.syntheticData.finishTime)),h),m=s(r),v=Math.max(s(o),u);return{sendStart:c,headersEnd:h,finish:u,start:m,end:v}}decorateEntry(e,t,i,n,s,r,o,l,d){const c=this.#i[e];return tl(c)?this.#u(e,t,s,o,l,d):Dt(c)?this.#d(e,t,i,n,s,r,o,l,d):!1}#d(e,t,i,n,s,r,o,l,d){const c=this.#i[e];if(!Dt(c))return!1;const{sendStart:h,headersEnd:u,finish:m,start:v,end:T}=this.getDecorationPixels(c,l,d);t.fillStyle="hsla(0, 100%, 100%, 0.8)",t.fillRect(h+.5,s+.5,u-h-.5,o-2),t.fillStyle=ie.instance().getComputedValue("--sys-color-cdt-base-container"),t.fillRect(n,s-.5,h-n,o),t.fillRect(m,s-.5,n+r-m,o);function E(j,S,k){t.moveTo(j,k-6/2),t.lineTo(j,k+6/2),t.moveTo(j,k),t.lineTo(S,k)}t.beginPath(),t.lineWidth=1,t.strokeStyle="#ccc";const U=Math.floor(s+o/2)+.5,w=v+.5,x=T-.5;E(w,h,U),E(x,m,U),t.stroke();const C=Math.max(h,0),W=m-C;if(W>=20){let j=this.entryTitle(e)||"";if(c.args.data.fromServiceWorker&&(j="âš™ "+j),j){const Z=o-5,Re=Xh(t,j,W-2*4);t.fillStyle="#333",t.fillText(Re,C+4,s+Z)}}return!0}#u(e,t,i,n,s,r){t.save();const o=this.#i[e],l=$(o.ts),d=v=>Math.floor(s+(v-l)*r),c=$(o.ts+o.dur),h=d(l)+.5,u=d(c)-.5;t.strokeStyle=ie.instance().getComputedValue("--app-color-rendering");const m=Math.floor(i+n/2)+.5;return t.setLineDash([3,2]),t.moveTo(h,m-1),t.lineTo(u,m-1),t.moveTo(h,m+1),t.lineTo(u,m+1),t.stroke(),t.restore(),!0}forceDecoration(e){return!0}forceDrawableLevel(e){return this.#s?.webSocketIdToLevel.has(e)||!1}prepareHighlightedEntryInfo(e){const t=this.#i[e];if(Dt(t)){const i=document.createElement("div"),s=Dn(i,{cssFile:[Os],delegatesFocus:void 0}).createChild("div","timeline-flamechart-popover"),r=new Mi;return r.networkRequest=t,s.appendChild(r),i}return null}#c(e){const{traceBounds:t}=e.Meta,i=$(t.min),n=$(t.max);this.#e=i,this.#t=i===n?1e3:n-this.#e}#m(e,t){!this.#s||!this.#r||(this.#n=this.#s.relayoutEntriesWithinBounds(this.#i,e,t),this.#r=Ns.create({entryLevels:this.#r?.entryLevels,entryTotalTimes:this.#r?.entryTotalTimes,entryStartTimes:this.#r?.entryStartTimes,groups:this.#r?.groups,initiatorsData:this.#r.initiatorsData,entryDecorations:this.#r.entryDecorations}))}preferredHeight(){if(!this.#s||this.#n===0)return 0;const e=this.#s.group();return e?e.style.height*(this.isExpanded()?Mn(this.#n+1,7,8.5):1):0}isExpanded(){return!!this.#s?.group()?.expanded}formatValue(e,t){return Ye(e,t)}canJumpToEntry(e){return!1}search(e,t){const i=[];for(let n=0;n<this.#i.length;n++){const s=this.#i.at(n);if(s&&el(s,e)&&t.accept(s,this.#o??void 0)){const r=$(s.ts);i.push({startTimeMilli:r,index:n,provider:"network"})}}return i}mainFrameNavigationStartEvents(){return this.#o?this.#o.Meta.mainFrameNavigations:[]}buildFlowForInitiator(e){if(!this.#o||!this.#r)return!1;if(this.#p===e)return this.#h&&(this.#r.initiatorsData=this.#h),!0;if(!this.#s)return!1;const t=this.#r.initiatorsData.length;if(e===-1)return this.#p=e,t===0?!1:(this.#r.resetFlowData(),!0);const i=this.#i[e];this.#r.resetFlowData(),this.#p=e;const n=qc(this.#o,i);if(t===0&&n.length===0)return!1;for(const s of n){const r=this.indexForEvent(s.event),o=this.indexForEvent(s.initiator);r===null||o===null||this.#r.initiatorsData.push({initiatorIndex:o,eventIndex:r})}return this.#h=this.#r.initiatorsData,!0}}const sv=Object.freeze(Object.defineProperty({__proto__:null,TimelineFlameChartNetworkDataProvider:Jc},Symbol.toStringTag,{value:"Module"})),Zc=new CSSStyleSheet;Zc.replaceSync(`/*
 * Copyright 2024 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

.timeline-overlays-container {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  /* Ensure it appears on top of everything */
  z-index: 200;
  pointer-events: none;
}

.overlay-item {
  position: absolute;
  /* The FlameChartView will move these as the FlameChart is drawn */
  top: 0;
  left: 0;
}

.overlay-type-ENTRY_LABEL {
  /* keep these above the selected entry overline, else they can become hard to read */
  z-index: 2;
}

.overlay-type-ENTRY_SELECTED,
.overlay-type-ENTRY_OUTLINE {
  pointer-events: none;
  border: 2px solid var(--sys-color-primary);
  background-color: var(--sys-color-state-ripple-primary);

  &.cut-off-top {
    border-top: none;
  }

  &.cut-off-bottom {
    border-bottom: none;
  }

  &.cut-off-right {
    border-right: none;
  }

  &.cut-off-left {
    border-left: none;
  }
}

.overlay-type-ENTRY_OUTLINE {
  background-color: transparent;

  &.outline-reason-ERROR {
    border-color: var(--sys-color-error-bright);
  }

  &.outline-reason-INFO {
    border-color: var(--sys-color-primary);
  }
}

.overlay-type-CANDY_STRIPED_TIME_RANGE {
  --red-stripe-width: 2px;
  --white-stripe-width: 7px;

  background-image:
    repeating-linear-gradient(
      315deg,
      var(--sys-color-error-bright),
      var(--sys-color-error-bright) var(--red-stripe-width),
      transparent var(--red-stripe-width),
      transparent var(--white-stripe-width)
    );
  border: 2px solid var(--sys-color-error-bright);

  &.cut-off-bottom {
    border-bottom: none;
  }

  &.cut-off-top {
    border-top: none;
  }

  &.cut-off-right {
    border-right: none;
  }

  &.cut-off-left {
    border-left: none;
  }
}

.overlay-type-ENTRIES_LINK {
  height: 100%;
  width: 100%;
}

.overlay-type-TIME_RANGE {
  top: 0;
  bottom: 0;

  &.overlap-1 {
    bottom: 55px;
  }

  &.overlap-2 {
    bottom: 105px;
  }
}

.overlay-type-CURSOR_TIMESTAMP_MARKER {
  top: 0;
  bottom: 0;
  width: 2px;
  background-color: var(--sys-color-primary);
  pointer-events: none;
}

.timeline-entry-tooltip-element:not(:empty) {
  z-index: 2000;
  position: absolute;
  contain: content;
  background-color: var(--sys-color-cdt-base-container);
  pointer-events: none;
  padding: 4px 8px;
  white-space: nowrap;
  max-width: 80%;
  box-shadow: var(--drop-shadow);
}

.overlay-type-TIMESPAN_BREAKDOWN {
  /* This overlay by default is shown at the bottom of the UI, not the top */
  top: unset;
  bottom: 0;
  height: 100px;
}

/*# sourceURL=timelineFlameChartView.css */
`);const Qc={sAtS:"{PH1} at {PH2}"},Hg=A("panels/timeline/TimelineFlameChartView.ts",Qc),_g=N.bind(void 0,Hg),Wg=200;class ed extends xe{delegate;searchResults=void 0;eventListeners;networkSplitWidget;mainDataProvider;mainFlameChart;networkFlameChartGroupExpansionSetting;networkDataProvider;networkFlameChart;networkPane;splitResizer;chartSplitWidget;brickGame;countersView;detailsSplitWidget;detailsView;onMainAddEntryLabelAnnotation;onNetworkAddEntryLabelAnnotation;#e;#t;onMainEntrySelected;onNetworkEntrySelected;#i;#n;groupBySetting;searchableView;needsResizeToPreferredHeights;selectedSearchResult;searchRegex;#s;#r=null;#a=null;#o=null;#l=this.#S.bind(this);#p=0;#h=setTimeout(()=>({}),0);#d=document.createElement("div");#u;#c=null;#m=null;#g=[];#v=null;#f=document.createElement("div");#w=new Map;#b;#y;#E=null;constructor(e){super(),this.element.classList.add("timeline-flamechart"),this.delegate=e,this.eventListeners=[],this.#s=null;const t=new xe;t.element.classList.add("flame-charts-container"),this.networkSplitWidget=new Zt(!1,!1,"timeline-flamechart-main-view",150),this.networkSplitWidget.show(t.element),this.#d.classList.add("timeline-overlays-container"),t.element.appendChild(this.#d),this.#f.classList.add("timeline-entry-tooltip-element"),t.element.appendChild(this.#f),this.networkSplitWidget.sidebarElement().style.zIndex="120";const i=Te.instance().createSetting("timeline-flamechart-main-view-group-expansion",{});this.mainDataProvider=new Xi,this.mainDataProvider.addEventListener("DataChanged",()=>this.mainFlameChart.scheduleUpdate()),this.mainFlameChart=new Za(this.mainDataProvider,this,{groupExpansionSetting:i,selectedElementOutline:!1,tooltipElement:this.#f,useOverlaysForCursorRuler:!0}),this.mainFlameChart.alwaysShowVerticalScroll(),this.mainFlameChart.enableRuler(!1),this.mainFlameChart.addEventListener("LatestDrawDimensions",n=>{this.#u.updateChartDimensions("main",n.data.chart),this.#u.updateVisibleWindow(n.data.traceWindow),this.#u.update()}),this.networkFlameChartGroupExpansionSetting=Te.instance().createSetting("timeline-flamechart-network-view-group-expansion",{}),this.networkDataProvider=new Jc,this.networkFlameChart=new Za(this.networkDataProvider,this,{groupExpansionSetting:this.networkFlameChartGroupExpansionSetting,selectedElementOutline:!1,tooltipElement:this.#f,useOverlaysForCursorRuler:!0}),this.networkFlameChart.alwaysShowVerticalScroll(),this.networkFlameChart.addEventListener("LatestDrawDimensions",n=>{this.#u.updateChartDimensions("network",n.data.chart),this.#u.updateVisibleWindow(n.data.traceWindow),this.#u.update(),this.mainFlameChart.setTooltipYPixelAdjustment(this.#u.networkChartOffsetHeight())}),this.mainFlameChart.addEventListener("MouseMove",n=>{this.#x(n.data)}),this.networkFlameChart.addEventListener("MouseMove",n=>{this.#x(n.data)}),this.#u=new mg({container:this.#d,flameChartsContainers:{main:this.mainFlameChart.element,network:this.networkFlameChart.element},charts:{mainChart:this.mainFlameChart,mainProvider:this.mainDataProvider,networkChart:this.networkFlameChart,networkProvider:this.networkDataProvider},entryQueries:{isEntryCollapsedByUser:n=>H.activeManager()?.getEntriesFilter().entryIsInvisible(n)??!1,firstVisibleParentForEntry(n){return H.activeManager()?.getEntriesFilter().firstVisibleParentEntryForEntry(n)??null}}}),this.#u.addEventListener(jt.eventName,n=>{const{overlay:s,action:r}=n;r==="Remove"?(H.activeManager()?.getAnnotationByOverlay(s)===this.#c&&(this.#c=null),H.activeManager()?.removeAnnotationOverlay(s)):r==="Update"&&H.activeManager()?.updateAnnotationOverlay(s)}),this.element.addEventListener(Jn.eventName,()=>{this.focus()}),this.element.setAttribute("jslog",`${Zi("timeline.flame-chart-view")}`),this.networkPane=new xe,this.networkPane.setMinimumSize(23,23),this.networkFlameChart.show(this.networkPane.element),this.splitResizer=this.networkPane.element.createChild("div","timeline-flamechart-resizer"),this.networkSplitWidget.hideDefaultResizer(!0),this.networkSplitWidget.installResizer(this.splitResizer),this.networkSplitWidget.setMainWidget(this.mainFlameChart),this.networkSplitWidget.setSidebarWidget(this.networkPane),this.chartSplitWidget=new Zt(!1,!0,"timeline-counters-split-view-state"),this.countersView=new xc(this.delegate),this.chartSplitWidget.setMainWidget(t),this.chartSplitWidget.setSidebarWidget(this.countersView),this.chartSplitWidget.hideDefaultResizer(),this.chartSplitWidget.installResizer(this.countersView.resizerElement()),this.detailsSplitWidget=new Zt(!1,!0,"timeline-panel-details-split-view-state"),this.detailsSplitWidget.element.classList.add("timeline-details-split"),this.detailsView=new Gc(e),this.detailsSplitWidget.installResizer(this.detailsView.headerElement()),this.detailsSplitWidget.setMainWidget(this.chartSplitWidget),this.detailsSplitWidget.setSidebarWidget(this.detailsView),this.detailsSplitWidget.show(this.element),this.onMainAddEntryLabelAnnotation=this.onAddEntryLabelAnnotation.bind(this,this.mainDataProvider),this.onNetworkAddEntryLabelAnnotation=this.onAddEntryLabelAnnotation.bind(this,this.networkDataProvider),this.#e=n=>this.onEntriesLinkAnnotationCreate(this.mainDataProvider,n.data.entryFromIndex),this.#t=n=>this.onEntriesLinkAnnotationCreate(this.networkDataProvider,n.data.entryFromIndex),ne.isEnabled("perf-panel-annotations")&&(this.mainFlameChart.addEventListener("EntryLabelAnnotationAdded",this.onMainAddEntryLabelAnnotation,this),this.networkFlameChart.addEventListener("EntryLabelAnnotationAdded",this.onNetworkAddEntryLabelAnnotation,this),this.mainFlameChart.addEventListener("EntriesLinkAnnotationCreated",this.#e,this),this.networkFlameChart.addEventListener("EntriesLinkAnnotationCreated",this.#t,this)),this.onMainEntrySelected=this.onEntrySelected.bind(this,this.mainDataProvider),this.onNetworkEntrySelected=this.onEntrySelected.bind(this,this.networkDataProvider),this.mainFlameChart.addEventListener("EntrySelected",this.onMainEntrySelected,this),this.networkFlameChart.addEventListener("EntrySelected",this.onNetworkEntrySelected,this),this.#b=this.#M.bind(this,this.mainDataProvider),this.#y=this.#M.bind(this,this.networkDataProvider),this.mainFlameChart.addEventListener("EntryInvoked",this.#b,this),this.networkFlameChart.addEventListener("EntryInvoked",this.#y,this),this.mainFlameChart.addEventListener("EntryHovered",n=>{this.onEntryHovered(n),this.updateLinkSelectionAnnotationWithToEntry(this.mainDataProvider,n.data)},this),this.networkFlameChart.addEventListener("EntryHovered",n=>{this.updateLinkSelectionAnnotationWithToEntry(this.networkDataProvider,n.data)},this),this.element.addEventListener("keydown",this.#N.bind(this)),this.element.addEventListener("pointerdown",this.#P.bind(this)),this.#i=this.#$.bind(this),this.#n=null,this.groupBySetting=Te.instance().createSetting("timeline-tree-group-by",re.GroupBy.None),this.groupBySetting.addChangeListener(this.refreshMainFlameChart,this),this.refreshMainFlameChart(),Ys(this.#l)}containingElement(){return this.element}setOverlays(e,t){if(this.bulkRemoveOverlays(this.#g),this.#g=e,this.#g.length===0)return;const i=ae.instance().state()?.micro.entireTraceBounds;if(!i)return;this.bulkAddOverlays(this.#g);const n=[];for(const s of this.#g)n.push(...ug(s));for(const s of n)this.#T(s);if(t.updateTraceWindow){const s=Sc(this.#g),r=za(s,i,100);ae.instance().setTimelineVisibleWindow(r,{ignoreMiniMapBounds:!0,shouldAnimate:!0})}if(n.length!==0){const s=n.reduce((r,o)=>r.ts<o.ts?r:o,n[0]);this.revealEventVertically(s)}}revealAnnotation(e){const t=ae.instance().state()?.micro.entireTraceBounds;if(!t)return;const i=cc(e);if(!i)return;const n=lc(e);for(const o of n)this.#T(o);const s=n.at(0);s&&this.revealEventVertically(s);const r=za(i,t,100);ae.instance().setTimelineVisibleWindow(r,{ignoreMiniMapBounds:!0,shouldAnimate:!0})}setActiveInsight(e){this.#v=e,this.bulkRemoveOverlays(this.#g),this.#v&&this.setOverlays(this.#v.overlays,{updateTraceWindow:!0})}#T(e){const t=It(e),i=t==="main"?this.mainDataProvider:this.networkDataProvider,n=t==="main"?this.mainFlameChart:this.networkFlameChart,s=i.indexForEvent?.(e)??null;if(s===null)return;const r=i.groupForEvent?.(s)??null;if(!r)return;const o=i.timelineData().groups.indexOf(r);!r.expanded&&o>-1&&n.toggleGroupExpand(o)}async#x(e){const{mouseEvent:t,timeInMicroSeconds:i}=e;t.shiftKey||this.#u.removeOverlaysOfType("CURSOR_TIMESTAMP_MARKER")>0&&await this.#u.update(),!t.metaKey&&t.shiftKey&&this.addOverlay({type:"CURSOR_TIMESTAMP_MARKER",timestamp:i})}#P(e){e.buttons===2&&this.#m&&(this.#I(!0),e.stopPropagation())}#I(e){this.#m!==null&&((e||this.#m.state!=="connected")&&H.activeManager()?.removeAnnotation(this.#m),this.mainFlameChart.setLinkSelectionAnnotationIsInProgress(!1),this.networkFlameChart.setLinkSelectionAnnotationIsInProgress(!1),this.#m=null)}#L(e){this.mainFlameChart.setLinkSelectionAnnotationIsInProgress(!0),this.networkFlameChart.setLinkSelectionAnnotationIsInProgress(!0),this.#m=e}#C(e,t){this.#c||(this.#c={bounds:Pe(e,t),type:"TIME_RANGE",label:""},H.activeManager()?.createAnnotation(this.#c))}#k(e){const t=ae.instance().state()?.micro.timelineTraceWindow;if(!t)return!1;const i=t.range*.02;switch(e.key){case"ArrowRight":{if(!this.#c){if(e.shiftKey){let n=t.min;return this.#E&&(n=ee(this.#E.startTime)),this.#C(n,_(n+i)),!0}return!1}return this.#c.bounds.max=_(Math.min(this.#c.bounds.max+i,t.max)),this.#c.bounds.range=_(this.#c.bounds.max-this.#c.bounds.min),H.activeManager()?.updateAnnotation(this.#c),!0}case"ArrowLeft":return this.#c?(this.#c.bounds.max=_(Math.max(this.#c.bounds.max-i,this.#c.bounds.min+1)),this.#c.bounds.range=_(this.#c.bounds.max-this.#c.bounds.min),H.activeManager()?.updateAnnotation(this.#c),!0):!1;case"ArrowUp":return this.#c?(this.#c.bounds.min=_(Math.min(this.#c.bounds.min+i,this.#c.bounds.max-1)),this.#c.bounds.range=_(this.#c.bounds.max-this.#c.bounds.min),H.activeManager()?.updateAnnotation(this.#c),!0):!1;case"ArrowDown":return this.#c?(this.#c.bounds.min=_(Math.max(this.#c.bounds.min-i,t.min)),this.#c.bounds.range=_(this.#c.bounds.max-this.#c.bounds.min),H.activeManager()?.updateAnnotation(this.#c),!0):!1;default:return this.#c=null,!1}}#N(e){const t="fixme";if(this.#m&&this.#m.state==="creation_not_started"&&(this.#I(!0),e.stopPropagation()),e.key==="Escape"&&this.#m&&(this.#I(!0),e.stopPropagation(),e.preventDefault()),this.#k(e)){e.preventDefault(),e.stopPropagation();return}e.key===t[this.#p]?(this.#p++,clearTimeout(this.#h),this.#h=setTimeout(()=>{this.#p=0},2e3)):(this.#p=0,clearTimeout(this.#h)),this.#p===t.length&&this.runBrickBreakerGame()}runBrickBreakerGame(){}#S(e){if(e.updateType==="MINIMAP_BOUNDS")return;const t=e.state.milli.timelineTraceWindow,i=!!e.options.shouldAnimate;this.mainFlameChart.setWindowTimes(t.min,t.max,i),this.networkDataProvider.setWindowTimes(t.min,t.max),this.networkFlameChart.setWindowTimes(t.min,t.max,i),cl(()=>{this.updateSearchResults(!1,!1)},100)()}isNetworkTrackShownForTests(){return this.networkSplitWidget.showMode()!=="OnlyMain"}getLinkSelectionAnnotation(){return this.#m}getMainDataProvider(){return this.mainDataProvider}getNetworkDataProvider(){return this.networkDataProvider}refreshMainFlameChart(){this.mainFlameChart.update()}extensionDataVisibilityChanged(){this.reset(),this.setupWindowTimes(),this.mainDataProvider.reset(!0),this.mainDataProvider.timelineData(!0),this.refreshMainFlameChart()}windowChanged(e,t,i){ae.instance().setTimelineVisibleWindow($n(se(e),se(t)),{shouldAnimate:i})}updateRangeSelection(e,t){if(this.delegate.select(B.fromRange(e,t)),ne.isEnabled("perf-panel-annotations")){const i=$n(se(e),se(t));this.#c?(this.#c.bounds=i,H.activeManager()?.updateAnnotation(this.#c)):(this.#c={type:"TIME_RANGE",label:"",bounds:i},H.activeManager()?.deleteEmptyRangeAnnotations(),H.activeManager()?.createAnnotation(this.#c))}}getMainFlameChart(){return this.mainFlameChart}getNetworkFlameChart(){return this.networkFlameChart}updateSelectedGroup(e,t){e!==this.mainFlameChart||this.#o===t?.name||(this.#o=t?.name||null,this.#n=t?this.mainDataProvider.groupTreeEvents(t):null,this.#F())}setModel(e,t=!1){e!==this.#s&&(this.#o=null,this.#s=e,Jh(this.eventListeners),this.#n=null,this.mainDataProvider.setModel(e,t),this.networkDataProvider.setModel(e),this.reset(),this.setupWindowTimes(),this.updateSearchResults(!1,!1),this.refreshMainFlameChart(),this.#B())}setInsights(e,t){this.#r!==e&&(this.#r=e,this.#a=t,this.#F())}reset(){this.networkDataProvider.isEmpty()?(this.mainFlameChart.enableRuler(!0),this.networkSplitWidget.hideSidebar()):(this.mainFlameChart.enableRuler(!1),this.networkSplitWidget.showBoth(),this.resizeToPreferredHeights()),this.#u.reset(),this.mainFlameChart.reset(),this.networkFlameChart.reset(),this.updateSearchResults(!1,!1)}setupWindowTimes(){const e=ae.instance().state();if(!e)throw new Error("TimelineFlameChartView could not set the window bounds.");const t=e.milli.timelineTraceWindow;this.mainFlameChart.setWindowTimes(t.min,t.max),this.networkDataProvider.setWindowTimes(t.min,t.max),this.networkFlameChart.setWindowTimes(t.min,t.max)}#$(){this.mainDataProvider.timelineData(!0),this.mainFlameChart.scheduleUpdate()}#F(){this.countersView.setModel(this.#s,this.#n),this.detailsView.setModel({parsedTrace:this.#s,selectedEvents:this.#n,traceInsightsSets:this.#r,eventToRelatedInsightsMap:this.#a})}#B(){this.mainFlameChart.scheduleUpdate(),this.networkFlameChart.scheduleUpdate(),this.#_()}#_(){const e=[...this.mainFlameChart.timelineData()?.groups??[],...this.networkFlameChart.timelineData()?.groups??[]];for(const t of e){if(!t.jslogContext)continue;const i=this.#w.get(t.jslogContext)??Symbol(t.jslogContext);this.#w.has(t.jslogContext)||(this.#w.set(t.jslogContext,i),Zh(i,`${Zi().context(`timeline.${t.jslogContext}`)}`,this.delegate.element))}}updateLinkSelectionAnnotationWithToEntry(e,t){if(!this.#m||this.#m.state==="creation_not_started")return;const i=this.#R(t,e);if(i){if(i===this.#m.entryFrom||H.activeManager()?.linkAnnotationBetweenEntriesExists(this.#m.entryFrom,i))return;this.#m.state="connected",this.#m.entryTo=i}else this.#m.state="pending_to_event",delete this.#m.entryTo;H.activeManager()?.updateAnnotation(this.#m)}onEntryHovered(e){Or.hideDOMNodeHighlight();const t=e.data,i=this.mainDataProvider.eventByIndex(t);if(!i||!this.#s||i instanceof Bn)return;const n=Yt(this.#s,i);if(!n)return;const s=pl(this.#s,i);for(const r of s)new Qh(n,r).highlight()}highlightEvent(e){const t=e?this.mainDataProvider.entryIndexForSelection(B.fromTraceEvent(e)):-1;t>=0?this.mainFlameChart.highlightEntry(t):this.mainFlameChart.hideHighlight()}willHide(){this.networkFlameChartGroupExpansionSetting.removeChangeListener(this.resizeToPreferredHeights,this),An.instance().removeChangeListener(this.#i)}wasShown(){this.registerCSSFiles([Zc]),this.networkFlameChartGroupExpansionSetting.addChangeListener(this.resizeToPreferredHeights,this),An.instance().addChangeListener(this.#i),this.needsResizeToPreferredHeights&&this.resizeToPreferredHeights(),this.#B()}updateCountersGraphToggle(e){e?this.chartSplitWidget.showBoth():this.chartSplitWidget.hideSidebar()}revealEvent(e){const t=this.mainDataProvider.indexForEvent(e),i=this.networkDataProvider.indexForEvent(e);t!==null?this.mainFlameChart.revealEntry(t):i!==null&&this.networkFlameChart.revealEntry(i)}revealEventVertically(e){const t=this.mainDataProvider.indexForEvent(e),i=this.networkDataProvider.indexForEvent(e);t!==null?this.mainFlameChart.revealEntryVertically(t):i!==null&&this.networkFlameChart.revealEntryVertically(i)}setSelectionAndReveal(e){this.#E=e;const t=this.mainDataProvider.entryIndexForSelection(e),i=this.networkDataProvider.entryIndexForSelection(e);this.mainFlameChart.setSelectedEntry(t),this.networkFlameChart.setSelectedEntry(i),this.#u.removeOverlaysOfType("ENTRY_SELECTED"),(e===null||!B.isRangeSelection(e.object))&&this.#c&&!this.#c.label&&(H.activeManager()?.removeAnnotation(this.#c),this.#c=null);let n=this.mainDataProvider.entryIndexForSelection(e);this.mainFlameChart.setSelectedEntry(n),n=this.networkDataProvider.entryIndexForSelection(e),this.networkFlameChart.setSelectedEntry(n),this.detailsView&&this.detailsView.setSelection(e),e&&(B.isTraceEventSelection(e.object)||B.isSyntheticNetworkRequestDetailsEventSelection(e.object)||B.isLegacyTimelineFrame(e.object))&&this.addOverlay({type:"ENTRY_SELECTED",entry:e.object}),this.#m&&this.#m.state==="creation_not_started"&&this.#I(!0)}bulkAddOverlays(e){for(const t of e)this.#u.add(t);this.#u.update()}addOverlay(e){const t=this.#u.add(e);return this.#u.update(),t}bulkRemoveOverlays(e){if(e.length){for(const t of e)this.#u.remove(t);this.#u.update()}}removeOverlay(e){this.#u.remove(e),this.#u.update()}updateExistingOverlay(e,t){this.#u.updateExisting(e,t),this.#u.update()}enterLabelEditMode(e){this.#u.enterLabelEditMode(e)}onAddEntryLabelAnnotation(e,t){const i=e.createSelection(t.data.entryIndex);i&&(B.isTraceEventSelection(i.object)||B.isSyntheticNetworkRequestDetailsEventSelection(i.object)||B.isLegacyTimelineFrame(i.object))&&(this.setSelectionAndReveal(i),H.activeManager()?.createAnnotation({type:"ENTRY_LABEL",entry:i.object,label:""}),t.data.withLinkCreationButton&&this.onEntriesLinkAnnotationCreate(e,t.data.entryIndex,!0))}onEntriesLinkAnnotationCreate(e,t,i){const n=t?this.#R(t,e):null;n&&(this.#L({type:"ENTRIES_LINK",entryFrom:n,state:i?"creation_not_started":"pending_to_event"}),this.#m&&H.activeManager()?.createAnnotation(this.#m))}#R(e,t){const i=t.createSelection(e);return i&&(B.isTraceEventSelection(i.object)||B.isSyntheticNetworkRequestDetailsEventSelection(i.object)||B.isLegacyTimelineFrame(i.object))?i.object:null}#M(e,t){this.#O(e,t);const i=t.data;this.#m&&this.handleToEntryOfLinkBetweenEntriesSelection(i)}#O(e,t){const i=e.timelineData();if(!i)return;const n=t.data,s=i.entryLevels[n],r=id(i.groups,s);if(r&&r.jslogContext){const o=this.#w.get(r.jslogContext)??null;o&&eu(o,new MouseEvent("click"))}e.buildFlowForInitiator(n),this.delegate.select(e.createSelection(n))}onEntrySelected(e,t){this.#O(e,t);const i=t.data,n=this.#R(i,e);n&&n!==this.#m?.entryTo&&this.updateLinkSelectionAnnotationWithToEntry(e,i)}handleToEntryOfLinkBetweenEntriesSelection(e){if(this.#m&&e===-1)H.activeManager()?.removeAnnotation(this.#m);else if(this.#m&&this.#m?.entryTo&&this.#m?.entryFrom.ts>this.#m?.entryTo.ts){const t=this.#m.entryFrom,i=this.#m.entryTo;this.#m.entryTo=t,this.#m.entryFrom=i,H.activeManager()?.updateAnnotation(this.#m)}this.#I(!1)}resizeToPreferredHeights(){if(!this.isShowing()){this.needsResizeToPreferredHeights=!0;return}this.needsResizeToPreferredHeights=!1,this.networkPane.element.classList.toggle("timeline-network-resizer-disabled",!this.networkDataProvider.isExpanded()),this.networkSplitWidget.setSidebarSize(this.networkDataProvider.preferredHeight()+this.splitResizer.clientHeight+Yu+2)}setSearchableView(e){this.searchableView=e}searchResultIndexForEntryIndex(e){return this.searchResults?this.searchResults.findIndex(t=>t.index===e):-1}jumpToNextSearchResult(){if(!this.searchResults||!this.searchResults.length)return;const e=typeof this.selectedSearchResult<"u"?this.searchResults.indexOf(this.selectedSearchResult):-1;this.#A(Ls(e+1,this.searchResults.length))}jumpToPreviousSearchResult(){if(!this.searchResults||!this.searchResults.length)return;const e=typeof this.selectedSearchResult<"u"?this.searchResults.indexOf(this.selectedSearchResult):0;this.#A(Ls(e-1,this.searchResults.length))}supportsCaseSensitiveSearch(){return!0}supportsRegexSearch(){return!0}#A(e){this.searchableView.updateCurrentMatchIndex(e);const t=this.searchResults?.at(e)??null;if(t){switch(t.provider){case"main":{this.delegate.select(this.mainDataProvider.createSelection(t.index)),this.mainFlameChart.showPopoverForSearchResult(t.index);break}case"network":{this.delegate.select(this.networkDataProvider.createSelection(t.index)),this.networkFlameChart.showPopoverForSearchResult(t.index);break}case"other":break;default:ke(t.provider,`Unknown SearchResult[provider]: ${t.provider}`)}this.selectedSearchResult=t}}updateSearchResults(e,t){const i=ae.instance().state();if(!i)return;const n=this.selectedSearchResult;if(delete this.selectedSearchResult,this.searchResults=[],this.mainFlameChart.removeSearchResultHighlights(),this.networkFlameChart.removeSearchResultHighlights(),!this.searchRegex)return;const s=new Ra(this.searchRegex),r=i.micro.timelineTraceWindow,o=this.mainDataProvider.search(r,s),l=this.networkDataProvider.search(r,s);if(this.searchResults=o.concat(l).sort((c,h)=>c.startTimeMilli-h.startTimeMilli),this.searchableView.updateSearchMatchesCount(this.searchResults.length),this.searchResults.length<=Wg&&(this.mainFlameChart.highlightAllEntries(o.map(c=>c.index)),this.networkFlameChart.highlightAllEntries(l.map(c=>c.index))),!e||!this.searchResults.length)return;let d=this.#H(n);d===-1&&(d=t?this.searchResults.length-1:0),this.#A(d)}#H(e){return e?this.searchResults?.findIndex(t=>t.provider===e.provider&&t.index===e.index)??-1:-1}getSearchResults(){return this.searchResults}onSearchCanceled(){typeof this.selectedSearchResult<"u"&&this.delegate.select(null),delete this.searchResults,delete this.selectedSearchResult,delete this.searchRegex,this.mainFlameChart.showPopoverForSearchResult(-1),this.mainFlameChart.removeSearchResultHighlights(),this.networkFlameChart.showPopoverForSearchResult(-1),this.networkFlameChart.removeSearchResultHighlights()}performSearch(e,t,i){this.searchRegex=e.toSearchRegex().regex,this.updateSearchResults(t,i)}togglePopover({event:e,show:t}){const i=this.mainDataProvider.indexForEvent(e);t&&i?(this.mainFlameChart.setSelectedEntry(i),this.mainFlameChart.showPopoverForSearchResult(i)):this.mainFlameChart.hideHighlight()}}class Wn{timelineSelection;entryIndex;constructor(e,t){this.timelineSelection=e,this.entryIndex=t}}const _s={textColor:"#333"};class td{startTimeInternal;startOffset;style;constructor(e,t,i){this.startTimeInternal=e,this.startOffset=t,this.style=i}startTime(){return this.startTimeInternal}color(){return this.style.color}title(){if(this.style.lowPriority)return null;const e=ve(this.startOffset);return _g(Qc.sAtS,{PH1:this.style.title,PH2:e})}draw(e,t,i,n){this.style.lowPriority&&n<4||this.style.tall&&(e.save(),e.strokeStyle=this.style.color,e.lineWidth=this.style.lineWidth,e.translate(this.style.lineWidth<1||this.style.lineWidth&1?.5:0,.5),e.beginPath(),e.moveTo(t,0),e.setLineDash(this.style.dashStyle),e.lineTo(t,e.canvas.height),e.stroke(),e.restore())}}function id(a,e){return a.find((i,n)=>{const s=a.at(n+1),r=s?s.startLevel-1:1/0;return i.startLevel<=e&&r>=e})??null}const rv=Object.freeze(Object.defineProperty({__proto__:null,FlameChartStyle:_s,Selection:Wn,TimelineFlameChartMarker:td,TimelineFlameChartView:ed,groupForLevel:id},Symbol.toStringTag,{value:"Module"})),Vn={net:"NET",cpu:"CPU",heap:"HEAP",sSDash:"{PH1} â€“ {PH2}"},Vg=A("panels/timeline/TimelineEventOverview.ts",Vn),Ws=N.bind(void 0,Vg);class an extends dp{constructor(e,t){super(),this.element.id="timeline-overview-"+e,this.element.classList.add("overview-strip"),t&&(this.element.createChild("div","timeline-overview-strip-title").textContent=t)}renderBar(e,t,i,n,s){const r=e,o=t-e,l=this.context();l.fillStyle=s,l.fillRect(r,i,o,n)}}const Ug=new Set(["VeryHigh","High","Medium"]);class Vs extends an{#e;constructor(e){super("network",Ws(Vn.net)),this.#e=e}update(e,t){this.resetCanvas(),this.#t(e,t)}#t(e,t){if(!this.#e)return;const i=e&&t?{min:e,max:t,range:t-e}:wt(this.#e.Meta.traceBounds),n=this.height()/2,s=this.width(),r=s/i.range,o=new Path2D,l=new Path2D;for(const c of this.#e.NetworkRequests.byTime){const h=Ug.has(c.args.data.priority)?o:l,{startTime:u,endTime:m}=fe(c),v=Math.max(Math.floor((u-i.min)*r),0),T=Math.min(Math.ceil((m-i.min)*r+1),s);h.rect(v,0,T-v,n-1)}const d=this.context();d.save(),d.fillStyle="hsl(214, 60%, 60%)",d.fill(o),d.translate(0,n),d.fillStyle="hsl(214, 80%, 80%)",d.fill(l),d.restore()}}const zg=new WeakMap;class Us extends an{backgroundCanvas;#e;#t=!1;#i;#n;constructor(e){super("cpu-activity",Ws(Vn.cpu)),this.#e=e,this.backgroundCanvas=this.element.createChild("canvas","fill background"),this.#i=wt(e.Meta.traceBounds).min,this.#n=wt(e.Meta.traceBounds).max}#s(e){return We(e)&&e.callFrame.functionName==="(idle)"?G.IDLE:(tn(e.name)?.category||$e().other).name}resetCanvas(){super.resetCanvas(),this.#t=!1,this.backgroundCanvas.width=this.element.clientWidth*window.devicePixelRatio,this.backgroundCanvas.height=this.element.clientHeight*window.devicePixelRatio}#r(e){const t=4*window.devicePixelRatio,i=this.width(),n=this.height(),s=n,r=this.#n-this.#i,o=i/r,l=t/o,d=$e(),c=$p(),h=c.indexOf(G.OTHER),u=0;console.assert(u===c.indexOf(G.IDLE));for(let w=0;w<c.length;++w)zg.set(d[c[w]],w);const m=(w,x)=>{const C=new sd(this.#i,l,k);let W=0;const O=[],j=[],S=[];for(let Se=0;Se<c.length;++Se)j[Se]=new Path2D,j[Se].moveTo(0,n),S[Se]=n;function k(Se){let Ve=s;for(let mt=u+1;mt<c.length;++mt){const mr=(Se[mt]||0)/l*n;Ve-=mr,j[mt].bezierCurveTo(W,S[mt],W,Ve,W+t/2,Ve),S[mt]=Ve}W+=t}const Z=Se=>{const Ve=this.#s(Se);if(!Ve||Ve==="idle")return;const mt=$(Se.ts),mr=O.length?O[O.length-1]:u;C.appendInterval(mt,mr);const Ed=c.indexOf(Ve);O.push(Ed||h)};function Re(Se){const Ve=$(Se.ts)+$(_(Se.dur||0)),mt=O.pop();Ve!==void 0&&mt&&C.appendInterval(Ve,mt)}const st=ee(this.#i),rt=ee(this.#n),at={min:st,max:rt,range:_(rt-st)},ce=_(at.range>2e5?16e3:0);tu(x.entryToNode,x.tree,Z,Re,at,ce),C.appendInterval(this.#i+r+l,u);for(let Se=c.length-1;Se>0;--Se){j[Se].lineTo(i,n);const Ve=d[c[Se]].getComputedColorValue();w.fillStyle=Ve,w.fill(j[Se]),w.strokeStyle="white",w.lineWidth=1,w.stroke(j[Se])}},v=this.backgroundCanvas.getContext("2d");if(!v)throw new Error("Could not find 2d canvas");const T=al(e),E=this.context();for(const w of T){const x=w.type==="MAIN_THREAD"||w.type==="CPU_PROFILE";m(x?E:v,w)}function U(w){const x=4*window.devicePixelRatio;w.save(),w.lineWidth=x/Math.sqrt(8);for(let C=.5;C<i+n;C+=x)w.moveTo(C,0),w.lineTo(C-n,n);w.globalCompositeOperation="destination-out",w.stroke(),w.restore()}U(v)}update(){const t=ae.instance().state()?.milli.minimapTraceBounds;t&&(t.min===this.#i&&t.max===this.#n&&this.#t||(this.#i=t.min,this.#n=t.max,this.resetCanvas(),this.#t=!0,this.#r(this.#e)))}}class zs extends an{#e;constructor(e){super("responsiveness",null),this.#e=e}#t(){const{topLevelRendererIds:e}=this.#e.Meta,t=new Set(["LONG_TASK","FORCED_REFLOW","IDLE_CALLBACK_OVER_TIME"]),i=new Set;for(const n of t){const s=this.#e.Warnings.perWarning.get(n);if(s)for(const r of s)e.has(r.pid)&&i.add(r)}return i}update(e,t){this.resetCanvas();const i=this.height(),n=e&&t?{min:ee(e),max:ee(t),range:ee(se(t-e))}:this.#e.Meta.traceBounds,s=n.range,r=this.width()/s,o=this.context(),l=new Path2D,d=new Path2D,c=this.#t();for(const u of c)h(u);o.fillStyle="hsl(0, 80%, 90%)",o.strokeStyle="red",o.lineWidth=2*window.devicePixelRatio,o.fill(l),o.stroke(d);function h(u){const{startTime:m,duration:v}=Gi(u),T=Math.round(r*(m-n.min)),E=Math.round(r*v);l.rect(T,0,E,i),d.moveTo(T+E,0),d.lineTo(T+E,i)}}}class Un extends an{frameToImagePromise;lastFrame=null;lastElement;drawGeneration;emptyImage;#e=null;constructor(e){super("filmstrip",null),this.element.setAttribute("jslog",`${Zi("film-strip")}`),this.frameToImagePromise=new Map,this.#e=e,this.lastFrame=null,this.lastElement=null,this.reset()}update(e,t){this.resetCanvas();const i=this.#e?this.#e.frames:[];if(!i.length)return;if(this.height()===0){console.warn("TimelineFilmStrip could not be drawn as its canvas height is 0");return}const n=Symbol("drawGeneration");this.drawGeneration=n,this.imageByFrame(i[0]).then(s=>{if(this.drawGeneration!==n||!s||!s.naturalWidth||!s.naturalHeight)return;const r=this.height()-2*Un.Padding,o=Math.ceil(r*s.naturalWidth/s.naturalHeight),l=Math.min(200/s.naturalWidth,1);this.emptyImage=new Image(s.naturalWidth*l,s.naturalHeight*l),this.drawFrames(o,r,e,t)})}async imageByFrame(e){let t=this.frameToImagePromise.get(e);return t||(t=ha(e.screenshotEvent.args.dataUri),this.frameToImagePromise.set(e,t)),t}drawFrames(e,t,i,n){if(!e||!this.#e||this.#e.frames.length<1)return;const s=Un.Padding,r=this.width(),o=i??$(this.#e.zeroTime),d=(n?n-o:$(this.#e.spanTime))/r,c=this.context(),h=this.drawGeneration;c.beginPath();for(let m=s;m<r;m+=e+2*s){const v=se(o+(m+e/2)*d),T=ee(v),E=Vr(this.#e,T);E&&(c.rect(m-.5,.5,e+1,t+1),this.imageByFrame(E).then(u.bind(this,m)))}c.strokeStyle="#ddd",c.stroke();function u(m,v){this.drawGeneration!==h||!v||c.drawImage(v,m,1,e,t)}}async overviewInfoPromise(e){if(!this.#e||this.#e.frames.length===0)return null;const t=this.calculator();if(!t)return null;const i=se(t.positionToTime(e)),n=ee(i),s=Vr(this.#e,n);if(s===this.lastFrame)return this.lastElement;const o=await(s?this.imageByFrame(s):Promise.resolve(this.emptyImage)),l=document.createElement("div");return l.classList.add("frame"),o&&l.createChild("div","thumbnail").appendChild(o),this.lastFrame=s,this.lastElement=l,l}reset(){this.lastFrame=null,this.lastElement=null,this.frameToImagePromise=new Map}static Padding=2}class nd extends an{heapSizeLabel;#e;constructor(e){super("memory",Ws(Vn.heap)),this.heapSizeLabel=this.element.createChild("div","memory-graph-label"),this.#e=e}resetHeapSizeLabels(){this.heapSizeLabel.textContent=""}update(e,t){this.resetCanvas();const i=window.devicePixelRatio;if(this.#e.Memory.updateCountersByProcess.size===0){this.resetHeapSizeLabels();return}const s=Array.from(this.#e.Meta.topLevelRendererIds).map(k=>this.#e.Memory.updateCountersByProcess.get(k)||[]).filter(k=>k.length>0),r=3*i;let o=0,l=1e11;const d=e&&t?{min:e,max:t,range:t-e}:wt(this.#e.Meta.traceBounds),c=d.min,h=d.max;function u(k){const Z=k.args.data;!Z||!Z.jsHeapSizeUsed||(o=Math.max(o,Z.jsHeapSizeUsed),l=Math.min(l,Z.jsHeapSizeUsed))}for(let k=0;k<s.length;k++)s[k].forEach(u);l=Math.min(l,o);const m=1,v=this.width(),T=this.height()-r,E=v/(h-c),U=(T-m)/Math.max(o-l,1),w=new Array(v);function x(k){const Z=k.args.data;if(!Z||!Z.jsHeapSizeUsed)return;const{startTime:Re}=fe(k),st=Math.round((Re-c)*E),rt=Math.round((Z.jsHeapSizeUsed-l)*U);w[st]=Math.max(w[st]||0,rt)}for(let k=0;k<s.length;k++)s[k].forEach(x);const C=this.context(),W=T+r+m;C.translate(.5,.5),C.beginPath(),C.moveTo(-m,W);let O=0,j=!0,S=0;for(let k=0;k<w.length;k++){if(typeof w[k]>"u")continue;j&&(j=!1,O=w[k],C.lineTo(-m,T-O));const Z=w[k];Math.abs(Z-O)>2&&Math.abs(k-S)>1&&C.lineTo(k,T-O),O=Z,C.lineTo(k,T-O),S=k}C.lineTo(v+m,T-O),C.lineTo(v+m,W),C.closePath(),C.fillStyle="hsla(220, 90%, 70%, 0.2)",C.fill(),C.lineWidth=m,C.strokeStyle="hsl(220, 90%, 70%)",C.stroke(),this.heapSizeLabel.textContent=Ws(Vn.sSDash,{PH1:Ke(l),PH2:Ke(o)})}}class sd{lastTime;quantDuration;callback;counters;remainder;constructor(e,t,i){this.lastTime=e,this.quantDuration=t,this.callback=i,this.counters=[],this.remainder=t}appendInterval(e,t){let i=e-this.lastTime;if(i<=this.remainder){this.counters[t]=(this.counters[t]||0)+i,this.remainder-=i,this.lastTime=e;return}for(this.counters[t]=(this.counters[t]||0)+this.remainder,this.callback(this.counters),i-=this.remainder;i>=this.quantDuration;){const n=[];n[t]=this.quantDuration,this.callback(n),i-=this.quantDuration}this.counters=[],this.counters[t]=i,this.lastTime=e,this.remainder=this.quantDuration-i}}const av=Object.freeze(Object.defineProperty({__proto__:null,Quantizer:sd,TimelineEventOverview:an,TimelineEventOverviewCPUActivity:Us,TimelineEventOverviewMemory:nd,TimelineEventOverviewNetwork:Vs,TimelineEventOverviewResponsiveness:zs,TimelineFilmStripOverview:Un},Symbol.toStringTag,{value:"Module"})),rd=new CSSStyleSheet;rd.replaceSync(`/*
 * Copyright 2017 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

.drop-down {
  box-shadow: var(--drop-shadow);
  background: var(--sys-color-cdt-base-container);
}

.preview-item {
  border-bottom: 1px solid var(--sys-color-divider);

  &:first-child {
    border-top: 1px solid var(--sys-color-divider);
  }

  padding: 6px 10px;
  position: relative;

  .time {
    margin-left: 3px;
  }

  /* done this way because if we have a border it
   * awkwardly merges in a diagonal with the top and
   * bottom border */
  &.selected::before {
    content: " ";
    position: absolute;
    top: 0;
    bottom: 0;
    left: 0;
    width: 2px;
    background-color: var(--sys-color-primary);
  }
}

.preview-item canvas {
  width: 100%;
  height: 100%;
}

.text-details > span {
  flex: 1 0;
  padding-left: var(--sys-size-5);
  padding-right: var(--sys-size-5);
}

.text-details .name {
  font: var(--sys-typescale-body4-medium);
}

.text-details span.time {
  color: var(--sys-color-token-subtle);
  font: var(--sys-typescale-body4-regular);
  text-align: right;
}

.screenshot-thumb {
  display: flex;
  border: 1px solid var(--sys-color-surface3);
  margin: 2px 4px;
}

.screenshot-thumb img {
  margin: auto;
  max-width: 100%;
  max-height: 100%;
}

.landing-page-item {
  font: var(--sys-typescale-body4-regular);
  display: flex;
  align-items: center;
  gap: var(--sys-size-5);
}

/*# sourceURL=timelineHistoryManager.css */
`);const zn=1/0,ht={currentSessionSS:"Current session: {PH1}. {PH2}",landingPageTitle:"Live metrics",noRecordings:"(no recordings)",sAgo:"({PH1} ago)",moments:"moments",sM:"{PH1} m",sH:"{PH1} h",sD:"{PH1} #{PH2}",selectTimelineSession:"Select timeline session"},Gg=A("panels/timeline/TimelineHistoryManager.ts",ht),vt=N.bind(void 0,Gg);class Xt{recordings;action;nextNumberByDomain;buttonInternal;allOverviews;totalHeight;enabled;lastActiveTrace=null;#e;constructor(e){this.recordings=[],this.#e=e,this.action=Fi.instance().getAction("timeline.show-history"),this.nextNumberByDomain=new Map,this.buttonInternal=new od(this.action),iu(this.buttonInternal.element),this.clear(),this.allOverviews=[{constructor:t=>this.#e?.getControls().find(n=>n instanceof zs)||new zs(t),height:3},{constructor:t=>{const i=this.#e?.getControls().find(n=>n instanceof Us);return i||new Us(t)},height:20},{constructor:t=>this.#e?.getControls().find(n=>n instanceof Vs)||new Vs(t),height:8}],this.totalHeight=this.allOverviews.reduce((t,i)=>t+i.height,0),this.enabled=!0,ze.instance().addEventListener("field-data-changed",()=>{this.#t()})}#t(){if(this.lastActiveTrace?.type==="LANDING_PAGE"){const e=this.title(this.lastActiveTrace);this.buttonInternal.setTitle(e),this.buttonInternal.setText(e)}}addRecording(e){const t=e.filmStripForPreview;this.lastActiveTrace=e.data,this.recordings.unshift(e.data),this.#r(e.data.parsedTraceIndex,e.parsedTrace,t,e.startTime);const i=this.title(e.data);this.buttonInternal.setText(i);const n=this.action.title();if(Pn(this.buttonInternal.element,vt(ht.currentSessionSS,{PH1:i,PH2:n})),this.updateState(),this.recordings.length<=ad)return;const s=this.recordings.reduce((o,l)=>r(o.parsedTraceIndex)<r(l.parsedTraceIndex)?o:l);this.recordings.splice(this.recordings.indexOf(s),1);function r(o){const l=Xt.dataForTraceIndex(o);if(!l)throw new Error("Unable to find data for model");return l.lastUsed}}setEnabled(e){this.enabled=e,this.updateState()}button(){return this.buttonInternal}clear(){this.recordings=[],this.lastActiveTrace=null,this.updateState(),this.buttonInternal.setText(vt(ht.noRecordings)),this.nextNumberByDomain.clear()}#i(){return ne.isEnabled("timeline-observations")?1:2}#n(){return this.lastActiveTrace?this.lastActiveTrace.type==="LANDING_PAGE"?zn:this.lastActiveTrace.parsedTraceIndex:-1}async showHistoryDropDown(){if(this.recordings.length<this.#i()||!this.enabled)return null;const e=await At.show(this.recordings.map(i=>i.parsedTraceIndex),this.#n(),this.buttonInternal.element);if(e===null)return null;if(e===zn)return this.#s({type:"LANDING_PAGE"}),{type:"LANDING_PAGE"};const t=this.recordings.findIndex(i=>i.parsedTraceIndex===e);return t<0?(console.assert(!1,"selected recording not found"),null):(this.#s(this.recordings[t]),this.recordings[t])}cancelIfShowing(){At.cancelIfShowing()}navigate(e){if(!this.enabled||this.lastActiveTrace===null||!this.lastActiveTrace||this.lastActiveTrace.type==="LANDING_PAGE")return null;const t=this.recordings.findIndex(n=>this.lastActiveTrace?.type==="TRACE_INDEX"&&n.type==="TRACE_INDEX"&&n.parsedTraceIndex===this.lastActiveTrace.parsedTraceIndex);if(t<0)return null;const i=Mn(t+e,0,this.recordings.length-1);return this.#s(this.recordings[i]),this.recordings[i]}#s(e){if(e.type==="TRACE_INDEX"){const n=Xt.dataForTraceIndex(e.parsedTraceIndex);if(!n)throw new Error("Unable to find data for model");n.lastUsed=Date.now()}this.lastActiveTrace=e;const t=this.title(e),i=this.action.title();this.buttonInternal.setText(t),Pn(this.buttonInternal.element,vt(ht.currentSessionSS,{PH1:t,PH2:i}))}updateState(){this.action.setEnabled(this.recordings.length>=this.#i()&&this.enabled)}static previewElement(e){const t=Xt.dataForTraceIndex(e);if(!t)throw new Error("Unable to find data for model");const i=t.startTime;return t.time.textContent=i?vt(ht.sAgo,{PH1:Xt.coarseAge(i)}):"",t.preview}static coarseAge(e){const t=Math.round((Date.now()-e)/1e3);if(t<50)return vt(ht.moments);const i=Math.round(t/60);if(i<50)return vt(ht.sM,{PH1:i});const n=Math.round(i/60);return vt(ht.sH,{PH1:n})}title(e){if(e.type==="LANDING_PAGE")return vt(ht.landingPageTitle);const t=Xt.dataForTraceIndex(e.parsedTraceIndex);if(!t)throw new Error("Unable to find data for model");return t.title}#r(e,t,i,n){const s=qn.fromString(t.Meta.mainFrameURL),r=s?s.host:"",o=this.nextNumberByDomain.get(r)||1,l=vt(ht.sD,{PH1:r,PH2:o});this.nextNumberByDomain.set(r,o+1);const d=document.createElement("span");d.classList.add("time");const c=document.createElement("div");c.classList.add("preview-item"),c.classList.add("vbox"),c.setAttribute("jslog",`${il("timeline.history-item").track({click:!0})}`);const h={preview:c,title:l,time:d,lastUsed:Date.now(),startTime:n};Co.set(e,h),c.appendChild(this.#a(t,r,d));const u=c.createChild("div","hbox");return u.appendChild(this.#o(i)),u.appendChild(this.#l(t)),h.preview}#a(e,t,i){const n=document.createElement("div");n.classList.add("text-details"),n.classList.add("hbox");const s=n.createChild("span","name");s.textContent=t,Pn(s,t);const r=wt(e.Meta.traceBounds),o=ve(r.range,!1),l=n.createChild("span","time");return l.appendChild(document.createTextNode(o)),l.appendChild(i),n}#o(e){const t=document.createElement("div");t.classList.add("screenshot-thumb");const i=3/2;if(t.style.width=this.totalHeight*i+"px",t.style.height=this.totalHeight+"px",!e)return t;const n=e.frames.at(-1);return n&&ha(n.screenshotEvent.args.dataUri).then(s=>{s&&t.appendChild(s)}),t}#l(e){const t=document.createElement("div"),i=window.devicePixelRatio;t.style.width=ws+"px",t.style.height=this.totalHeight+"px";const n=t.createChild("canvas");n.width=i*ws,n.height=i*this.totalHeight;const s=n.getContext("2d");let r=0;for(const o of this.allOverviews){const l=o.constructor(e);l.update(),s&&s.drawImage(l.context().canvas,0,r,i*ws,o.height*i),r+=o.height*i}return t}static dataForTraceIndex(e){return Co.get(e)||null}}const ad=5,ws=450,Co=new Map;class At{glassPane;listControl;focusRestorer;selectionDone;constructor(e){this.glassPane=new nu,this.glassPane.setSizeBehavior("MeasureContent"),this.glassPane.setOutsideClickCallback(()=>this.close(null)),this.glassPane.setPointerEventsBehavior("BlockedByGlassPane"),this.glassPane.setAnchorBehavior("PreferBottom"),this.glassPane.element.addEventListener("blur",()=>this.close(null));const i=Dn(this.glassPane.contentElement,{cssFile:[rd],delegatesFocus:void 0}).createChild("div","drop-down"),n=new su;this.listControl=new ru(n,this,au.NonViewport),this.listControl.element.addEventListener("mousemove",this.onMouseMove.bind(this),!1),n.replaceAll(e),ou(this.listControl.element),Pn(this.listControl.element,vt(ht.selectTimelineSession)),i.appendChild(this.listControl.element),i.addEventListener("keydown",this.onKeyDown.bind(this),!1),i.addEventListener("click",this.onClick.bind(this),!1),this.focusRestorer=new lu(this.listControl.element),this.selectionDone=null}static show(e,t,i){if(At.instance)return Promise.resolve(null);const n=[...e];return ne.isEnabled("timeline-observations")&&n.unshift(zn),new At(n).show(i,t)}static cancelIfShowing(){At.instance&&At.instance.close(null)}show(e,t){return At.instance=this,this.glassPane.setContentAnchorBox(e.boxInWindow()),this.glassPane.show(this.glassPane.contentElement.ownerDocument),this.listControl.element.focus(),this.listControl.selectItem(t),new Promise(i=>{this.selectionDone=i})}onMouseMove(e){const t=e.target.enclosingNodeOrSelfWithClass("preview-item"),i=t&&this.listControl.itemForNode(t);i!==null&&this.listControl.selectItem(i)}onClick(e){e.target.enclosingNodeOrSelfWithClass("preview-item")&&this.close(this.listControl.selectedItem())}onKeyDown(e){switch(e.key){case"Tab":case"Escape":this.close(null);break;case"Enter":this.close(this.listControl.selectedItem());break;default:return}e.consume(!0)}close(e){this.selectionDone&&this.selectionDone(e),this.focusRestorer.restore(),this.glassPane.hide(),At.instance=null}createElementForItem(e){if(e===zn)return this.#e();const t=Xt.previewElement(e);return Ga(t),t.classList.remove("selected"),t}#e(){const e=document.createElement("div");Ga(e),e.classList.remove("selected"),e.classList.add("preview-item"),e.classList.add("landing-page-item");const t=cu("arrow-back");e.appendChild(t);const i=document.createElement("span");return i.innerText=vt(ht.landingPageTitle),e.appendChild(i),e}heightForItem(e){return console.assert(!1,"Should not be called"),0}isItemSelectable(e){return!0}selectedItemChanged(e,t,i,n){i&&i.classList.remove("selected"),n&&n.classList.add("selected")}updateSelectedItemARIA(e,t){return!1}static instance=null}class od extends $o{contentElement;constructor(e){const t=document.createElement("button");t.classList.add("history-dropdown-button"),t.setAttribute("jslog",`${il("history")}`),super(t),this.contentElement=this.element.createChild("span","content"),this.element.addEventListener("click",()=>void e.execute(),!1),this.setEnabled(e.enabled()),e.addEventListener("Enabled",i=>this.setEnabled(i.data)),this.setTitle(e.title())}setText(e){this.contentElement.textContent=e}}const ov=Object.freeze(Object.defineProperty({__proto__:null,DropDown:At,LANDING_PAGE_INDEX_DROPDOWN_CHOICE:zn,TimelineHistoryManager:Xt,ToolbarButton:od,maxRecordings:ad,previewWidth:ws},Symbol.toStringTag,{value:"Module"})),zi={learnmore:"LearnÂ more",wasd:"WASD",clickTheRecordButtonSOrHitSTo:"Click the record button {PH1} or hit {PH2} to start a new recording.",clickTheReloadButtonSOrHitSTo:"Click the reload button {PH1} or hit {PH2} to record the page load.",afterRecordingSelectAnAreaOf:"After recording, select an area of interest in the overview by dragging. Then, zoom and pan the timeline with the mousewheel or {PH1} keys. {PH2}"},Ts=A("panels/timeline/TimelineLandingPage.ts",zi),ko=N.bind(void 0,Ts);class jg extends xe{toggleRecordAction;constructor(e,t){super(),this.toggleRecordAction=e;const i=t?.isNode===!0;this.contentElement.classList.add("timeline-landing-page","fill"),ne.isEnabled("timeline-observations")&&!i?this.renderLandingPage():this.renderLegacyLandingPage()}renderLandingPage(){du(xn,new Xl).show(this.contentElement)}renderLegacyLandingPage(){function e(d,c){const h=document.createElement(d);return h.textContent=c,h}const t=tt.create("https://developer.chrome.com/docs/devtools/evaluate-performance/",ko(zi.learnmore),void 0,void 0,"learn-more"),i=e("b",Br.instance().shortcutsForAction("timeline.toggle-recording")[0].title()),n=e("b",Br.instance().shortcutsForAction("timeline.record-reload")[0].title()),s=e("b",ko(zi.wasd));this.contentElement.classList.add("legacy");const r=this.contentElement.createChild("div"),o=ja(et.createActionButton(this.toggleRecordAction,{showLabel:!1,ignoreToggleable:!0})),l=ja(et.createActionButtonForId("timeline.record-reload"));r.createChild("p").appendChild(z(Ts,zi.clickTheRecordButtonSOrHitSTo,{PH1:o,PH2:i})),r.createChild("p").appendChild(z(Ts,zi.clickTheReloadButtonSOrHitSTo,{PH1:l,PH2:n})),r.createChild("p").appendChild(z(Ts,zi.afterRecordingSelectAnAreaOf,{PH1:s,PH2:t}))}}const Ss={malformedTimelineDataS:"Malformed timeline data: {PH1}"},qg=A("panels/timeline/TimelineLoader.ts",Ss),Ar=N.bind(void 0,qg);class $t{client;canceledCallback;buffer;firstRawChunk;totalSize;filter;#e;#t=[];#i;#n;#s;constructor(e){this.client=e,this.canceledCallback=null,this.buffer="",this.firstRawChunk=!0,this.filter=null,this.#e=!1,this.#i=null,this.#s=new Promise(t=>{this.#n=t})}static async loadFromFile(e,t){const i=new $t(t),n=new hu(e);return i.canceledCallback=n.cancel.bind(n),i.totalSize=e.size,setTimeout(async()=>{!await n.read(i)&&n.error()&&i.reportErrorAndCancelLoading(n.error().message)}),i}static loadFromEvents(e,t){const i=new $t(t);return window.setTimeout(async()=>{i.addEvents(e)}),i}static loadFromCpuProfile(e,t){const i=new $t(t);i.#e=!0;try{const n=sn.createFakeTraceFromCpuProfile(e,qa(1));window.setTimeout(async()=>{i.addEvents(n)})}catch(n){console.error(n.stack)}return i}static async loadFromURL(e,t){const i=new $t(t),n=new pu;await t.loadingStarted();const s=Te.instance().moduleSetting("network.enable-remote-file-loading").get();uu(e,null,n,r,s);async function r(o,l,d){if(!o)return i.reportErrorAndCancelLoading(d.message);try{const c=n.data(),h=JSON.parse(c);i.#r(h),await i.close()}catch(c){await i.close();const h=c instanceof Error?c.message:"";return i.reportErrorAndCancelLoading(Ar(Ss.malformedTimelineDataS,{PH1:h}))}}return i}#r(e){if("traceEvents"in e||Array.isArray(e)){const t=Array.isArray(e)?e:e.traceEvents;this.#o(t)}else if(e.nodes)this.#a(e),this.#e=!0;else{this.reportErrorAndCancelLoading(Ar(Ss.malformedTimelineDataS));return}"metadata"in e&&(this.#i=e.metadata)}async addEvents(e){await this.client?.loadingStarted();const t=15e4;for(let i=0;i<e.length;i+=t){const n=e.slice(i,i+t);this.#o(n),await this.client?.loadingProgress((i+n.length)/e.length),await new Promise(s=>window.setTimeout(s,0))}this.close()}async cancel(){this.client&&(await this.client.loadingComplete([],null,!1,null,null),this.client=null),this.canceledCallback&&this.canceledCallback()}async write(e,t){if(!this.client)return Promise.resolve();if(this.buffer+=e,this.firstRawChunk)await this.client.loadingStarted(),await new Promise(i=>requestAnimationFrame(()=>requestAnimationFrame(i))),this.firstRawChunk=!1;else{let i;i=this.buffer.length/this.totalSize,i=i>1?i-Math.floor(i):i,await this.client.loadingProgress(i)}if(t){let i;try{return i=JSON.parse(this.buffer),this.#r(i),Promise.resolve()}catch(n){this.reportErrorAndCancelLoading(Ar(Ss.malformedTimelineDataS,{PH1:n.toString()}));return}}}reportErrorAndCancelLoading(e){e&&Is.instance().error(e),this.cancel()}async close(){this.client&&(await this.client.processingStarted(),await this.finalizeTrace())}isCpuProfile(){return this.#e}async finalizeTrace(){await this.client.loadingComplete(this.#t,this.filter,this.isCpuProfile(),null,this.#i),this.#n?.()}traceFinalizedForTest(){return this.#s}#a(e){const t=sn.createFakeTraceFromCpuProfile(e,qa(1));this.#o(t)}#o(e){this.#t=this.#t.concat(e)}}const lv=Object.freeze(Object.defineProperty({__proto__:null,TimelineLoader:$t},Symbol.toStringTag,{value:"Module"})),ld=new CSSStyleSheet;ld.replaceSync(`/*
 * Copyright 2023 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

.timeline-minimap {
  position: relative;
}

.timeline-sidebar-floating-icon {
  position: absolute;
  top: 5px;
  left: 10px;
  z-index: 999;
  border: none;
  width: 36px;
  height: 36px;
  border-radius: 50%;
  box-shadow: var(--drop-shadow-depth-1);
  background: var(--sys-color-cdt-base-container);

  &:hover {
    background: var(--sys-color-base-container-elevated);
  }
}

.timeline-minimap .overview-strip {
  margin-top: 2px;
  justify-content: center;
}

.timeline-minimap .overview-strip .timeline-overview-strip-title {
  color: var(--sys-color-token-subtle);
  font-size: 10px;
  font-weight: bold;
  z-index: 100;
  background-color: var(--sys-color-cdt-base-container);
  padding: 0 4px;
  position: absolute;
  top: -2px;
  right: 0;
}

.timeline-minimap #timeline-overview-cpu-activity {
  flex-basis: 20px;
}

.timeline-minimap #timeline-overview-network {
  flex-basis: 8px;
}

.timeline-minimap #timeline-overview-filmstrip {
  flex-basis: 30px;
}

.timeline-minimap #timeline-overview-memory {
  flex-basis: 20px;
}

.timeline-minimap #timeline-overview-network::before,
.timeline-minimap #timeline-overview-cpu-activity::before {
  content: "";
  position: absolute;
  left: 0;
  right: 0;
  bottom: 0;
  border-bottom: 1px solid var(--divider-line);
  z-index: -200;
}

.timeline-minimap .overview-strip .background {
  z-index: -10;
}

.timeline-minimap #timeline-overview-responsiveness {
  flex-basis: 5px;
  margin-top: 0 !important; /* stylelint-disable-line declaration-no-important */
}

.timeline-minimap #timeline-overview-input {
  flex-basis: 6px;
}

.timeline-minimap #timeline-overview-pane {
  flex: auto;
  position: relative;
  overflow: hidden;
}

.timeline-minimap #timeline-overview-container {
  display: flex;
  flex-direction: column;
  flex: none;
  position: relative;
  overflow: hidden;
}

.timeline-minimap #timeline-overview-container canvas {
  width: 100%;
  height: 100%;
}

.timeline-minimap-dim-highlight-svg {
  width: 100%;
  position: absolute;
  height: 100%;
}

.timeline-minimap .memory-graph-label {
  position: absolute;
  right: 0;
  bottom: 0;
  font-size: 9px;
  color: var(--sys-color-token-subtle);
  white-space: nowrap;
  padding: 0 4px;
  background-color: var(--sys-color-cdt-base-container);
}

/*# sourceURL=timelineMiniMap.css */
`);class cd extends Jo(xe){#e=new hp("timeline");#t=[];breadcrumbs=null;#i;#n=null;#s=this.#a.bind(this);constructor(){super(),this.element.classList.add("timeline-minimap"),this.#i=new bl,this.element.prepend(this.#i);const e=new mu;e.setAttribute("name","left-panel-open"),e.setAttribute("jslog",`${bt("timeline.sidebar-open").track({click:!0})}`),e.addEventListener("click",()=>{this.dispatchEventToListeners("OpenSidebarButtonClicked",{})}),this.#e.show(this.element),this.#e.addEventListener("OverviewPaneWindowChanged",t=>{this.#r(t)}),this.#e.addEventListener("OverviewPaneBreadcrumbAdded",t=>{this.addBreadcrumb(t.data)}),this.#i.addEventListener(Yi.eventName,t=>{const{breadcrumb:i,childBreadcrumbsRemoved:n}=t;this.#l(i,{removeChildBreadcrumbs:!!n,updateVisibleWindow:!0})}),this.#e.enableCreateBreadcrumbsButton(),Ys(this.#s)}#r(e){if(!this.#n?.parsedTrace)return;const i=ae.instance().state();if(!i)return;const n=e.data.startTime>0?e.data.startTime:i.milli.entireTraceBounds.min,s=Number.isFinite(e.data.endTime)?e.data.endTime:i.milli.entireTraceBounds.max;ae.instance().setTimelineVisibleWindow($n(se(n),se(s)),{shouldAnimate:!0})}#a(e){(e.updateType==="RESET"||e.updateType==="VISIBLE_WINDOW")&&(this.#e.setWindowTimes(e.state.milli.timelineTraceWindow.min,e.state.milli.timelineTraceWindow.max),Ka({window:e.state.micro.timelineTraceWindow,bounds:e.state.micro.minimapTraceBounds})||this.#o(e.state.micro.timelineTraceWindow)),(e.updateType==="RESET"||e.updateType==="MINIMAP_BOUNDS")&&this.#e.setBounds(e.state.milli.minimapTraceBounds.min,e.state.milli.minimapTraceBounds.max)}#o(e){if(!this.breadcrumbs)return;let t=this.breadcrumbs.initialBreadcrumb,i=this.breadcrumbs.initialBreadcrumb;for(;t&&Ka({window:e,bounds:t.window});){i=t;t=t.child}this.#l(i,{removeChildBreadcrumbs:!1,updateVisibleWindow:!1})}addBreadcrumb({startTime:e,endTime:t}){if(!this.breadcrumbs){console.warn("ModificationsManager has not been created, therefore Breadcrumbs can not be added");return}const i=ae.instance().state();if(!i)return;const n=i.milli.minimapTraceBounds,s={startTime:se(Math.max(e,n.min)),endTime:se(Math.min(t,n.max))},r=$n(s.startTime,s.endTime),o=this.breadcrumbs.add(r);this.#i.data={initialBreadcrumb:this.breadcrumbs.initialBreadcrumb,activeBreadcrumb:o}}highlightBounds(e){this.#e.highlightBounds(e)}clearBoundsHighlight(){this.#e.clearBoundsHighlight()}#l(e,t){this.breadcrumbs&&(this.breadcrumbs.setActiveBreadcrumb(e,t),this.#i.data={initialBreadcrumb:this.breadcrumbs.initialBreadcrumb,activeBreadcrumb:e})}wasShown(){super.wasShown(),this.registerCSSFiles([ld])}reset(){this.#n=null,this.#e.reset()}#p(e){const t=new Map,{Meta:i,PageLoadMetrics:n}=e,s=i.mainFrameNavigations,r=$(i.traceBounds.min);for(const o of s){const{startTime:l}=fe(o);t.set(l,R.createEventDivider(o,r))}for(const o of n.allMarkerEvents){const{startTime:l}=fe(o);t.set(l,R.createEventDivider(o,r))}this.#e.setMarkers(t)}#h(e){this.#e.setNavStartTimes(e.Meta.mainFrameNavigations)}getControls(){return this.#t}setData(e){if(this.#n?.parsedTrace!==e.parsedTrace){if(this.#n=e,this.#t=[],this.#p(e.parsedTrace),this.#h(e.parsedTrace),this.#t.push(new zs(e.parsedTrace)),this.#t.push(new Us(e.parsedTrace)),this.#t.push(new Vs(e.parsedTrace)),e.settings.showScreenshots){const t=Ks(e.parsedTrace);t.frames.length&&this.#t.push(new Un(t))}e.settings.showMemory&&this.#t.push(new nd(e.parsedTrace)),this.#e.setOverviewControls(this.#t),this.#e.showingScreenshots=e.settings.showScreenshots,this.#d()}}#d(){if(this.breadcrumbs=H.activeManager()?.getTimelineBreadcrumbs()??null,!this.breadcrumbs)return;let e=this.breadcrumbs.initialBreadcrumb;for(;e.child!==null;)e=e.child;this.#i.data={initialBreadcrumb:this.breadcrumbs.initialBreadcrumb,activeBreadcrumb:e}}}const cv=Object.freeze(Object.defineProperty({__proto__:null,TimelineMiniMap:cd},Symbol.toStringTag,{value:"Module"})),dd=new CSSStyleSheet;dd.replaceSync(`/*
 * Copyright (C) 2006, 2007, 2008 Apple Inc.  All rights reserved.
 * Copyright (C) 2009 Anthony Ricaud <rik@webkit.org>
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *
 * 1.  Redistributions of source code must retain the above copyright
 *     notice, this list of conditions and the following disclaimer.
 * 2.  Redistributions in binary form must reproduce the above copyright
 *     notice, this list of conditions and the following disclaimer in the
 *     documentation and/or other materials provided with the distribution.
 * 3.  Neither the name of Apple Computer, Inc. ("Apple") nor the names of
 *     its contributors may be used to endorse or promote products derived
 *     from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

.timeline-toolbar-container {
  display: flex;
  flex: none;
}

.timeline-toolbar-container > .toolbar {
  background-color: var(--sys-color-cdt-base-container);
  border-bottom: 1px solid var(--sys-color-divider);
}

.timeline-main-toolbar {
  flex: 1 1 auto;
}

.timeline-settings-pane {
  flex: none;
  background-color: var(--sys-color-cdt-base-container);
  border-bottom: 1px solid var(--sys-color-divider);
}

#timeline-overview-panel {
  flex: none;
  position: relative;
  border-bottom: 1px solid var(--sys-color-divider);
}

#timeline-overview-grid {
  background-color: var(--sys-color-cdt-base-container);
}

#timeline-overview-grid .timeline-grid-header {
  height: 12px;
}

#timeline-overview-grid .resources-dividers-label-bar {
  pointer-events: auto;
  height: 12px;
}

#timeline-overview-grid .resources-divider-label {
  top: 1px;
}

.timeline-details-split {
  flex: auto;
}

.timeline.panel .status-pane-container {
  z-index: 1000;
  display: flex;
  align-items: center;
  pointer-events: none;
}

.timeline.panel .status-pane-container.tinted {
  background-color: var(--sys-color-cdt-base-container);
  pointer-events: auto;
}

.timeline-landing-page.legacy > div > p {
  flex: none;
  white-space: pre-line;
  line-height: 18px;
}

.popover ul {
  margin: 0;
  padding: 0;
  list-style-type: none;
}

#memory-graphs-canvas-container {
  overflow: hidden;
  flex: auto;
  position: relative;

  .no-events-found {
    position: absolute;
    font: var(--sys-typescale-body4-regular);
    left: var(--sys-size-5);
    bottom: var(--sys-size-5);

    p {
      margin: 0;
    }
  }
}

#memory-counters-graph {
  flex: auto;
}

#memory-graphs-canvas-container .memory-counter-marker {
  position: absolute;
  border-radius: 3px;
  width: 5px;
  height: 5px;
  margin-left: -3px;
  margin-top: -2px;
}

#memory-graphs-container .timeline-memory-header {
  flex: 0 0 26px;
  background-color: var(--sys-color-surface2);
  border-bottom: 1px solid var(--sys-color-divider);
  justify-content: space-between;
}

#memory-graphs-container .timeline-memory-header::after {
  content: "";
  background-image: var(--image-file-toolbarResizerVertical);
  background-repeat: no-repeat;
  background-position: right center, center;
  flex: 20px 0 0;
  margin: 0 4px;
}

.timeline-memory-toolbar {
  flex-shrink: 1;
}

.memory-counter-value {
  margin: 8px;
}

#counter-values-bar {
  flex: 0 0 20px;
  border-top: solid 1px var(--sys-color-divider);
  width: 100%;
  overflow: hidden;
  line-height: 18px;
}

.timeline-details {
  vertical-align: top;
}

.timeline-details-view {
  color: var(--sys-color-on-surface);
  overflow: hidden;
}

.timeline-details-view-body {
  flex: auto;
  overflow: auto;
  position: relative;
  background-color: var(--sys-color-cdt-base-container);
  user-select: text;
  display: block;
}

.timeline-details-view-block {
  flex: none;
  display: flex;
  background-color: var(--sys-color-cdt-base-container);
  flex-direction: column;
  padding-bottom: 5px;
  border-bottom: 1px solid var(--sys-color-divider);
}

.timeline-details-view-row {
  padding-left: 10px;
  min-height: 20px;
}

.timeline-details-view-block .timeline-details-stack-values {
  flex-direction: column !important; /* stylelint-disable-line declaration-no-important */
}

.timeline-details-chip-title {
  font-size: 12px;
  padding: 8px;
  display: flex;
  align-items: center;
}

.timeline-details-view-block:first-child > .timeline-details-chip-title {
  font-size: 13px;
}

.timeline-details-view-row-title:not(:empty) {
  color: var(--sys-color-token-subtle);
  overflow: hidden;
  padding-right: 10px;
  display: inline-block;
  vertical-align: top;
}

.timeline-details-warning {
  --override-details-warning-background-color: rgb(250 209 209 / 48%);

  background-color: var(--override-details-warning-background-color);
}

.theme-with-dark-background .timeline-details-warning,
:host-context(.theme-with-dark-background) .timeline-details-warning {
  --override-details-warning-background-color: rgb(87 10 10 / 48%);
}

.timeline-details-warning .timeline-details-view-row-title {
  color: var(--sys-color-error);
}

.timeline-details-view-row-value {
  display: inline-block;
  user-select: text;
  text-overflow: ellipsis;
  overflow: hidden;
  padding: 0 3px;
}

.timeline-details-warning .timeline-details-view-row-value {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.timeline-details-view-pie-chart-wrapper {
  margin: 4px 0;
}

.timeline-details-view-pie-chart {
  margin-top: 5px;
}

.timeline-flamechart {
  overflow: hidden;
}

.brick-game {
  background-color: var(--sys-color-neutral-container);
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 9999; /* A high value to ensure it's on top */
}

.game-close-button {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 25px;
  height: 25px;
  position: absolute;
  right: 15px;
  top: 15px;
  border-radius: 50%;
  cursor: pointer;
}

.scorePanel {
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  white-space: pre-line;
  padding: 15px;
  position: absolute;
  left: 15px;
  bottom: 15px;
  border: double 7px transparent;
  border-radius: 20px;
  background-origin: border-box;
  background-clip: content-box, border-box;
  font-weight: 200;
}

.confetti-100 {
  display: block;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}

.confetti-100 > .confetti-100-particle {
  opacity: 0%;
  position: fixed;
  animation: confetti-100-animation 1s none ease-out;
  font-size: 30px;
}

@keyframes confetti-100-animation {
  0% {
    opacity: 100%;
    transform: translateY(0%) translateY(0%) rotate(0deg);
  }

  100% {
    opacity: 0%;
    transform: translateY(var(--to-Y)) translateX(var(--to-X)) rotate(var(--rotation));
  }
}

@media (prefers-reduced-motion) {
  .confetti-100 > .confetti-100-particle {
    animation-name: dissolve;
  }
}

.timeline-flamechart-resizer {
  flex: 8px 0 0;
  background-color: var(--sys-color-surface2);
  border: 1px var(--sys-color-divider);
  border-style: solid none;
  display: flex;
  flex-direction: row;
  align-items: flex-end;
  justify-content: center;
}

.timeline-network-resizer-disabled > .timeline-flamechart-resizer {
  display: none;
}

.timeline-flamechart-resizer::after {
  content: "...";
  font-size: 14px;
  margin-bottom: -1px;
}

.timeline-layers-view-properties table {
  width: 100%;
  border-collapse: collapse;
}

.timeline-layers-view-properties td {
  border: 1px solid var(--sys-color-divider);
  line-height: 22px;
}

.timeline-filmstrip-preview > img {
  max-width: 500px;
  max-height: 300px;
  cursor: pointer;
  border: 1px solid var(--sys-color-divider);
}

.timeline-tree-view {
  display: flex;
  overflow: hidden;
}

.timeline-tree-view .toolbar {
  background-color: var(--sys-color-cdt-base-container);
  border-bottom: 1px solid var(--sys-color-divider);
}

.timeline-tree-view .data-grid {
  border: none;
  flex: auto;
}

.timeline-tree-view .data-grid .data-container {
  overflow-y: scroll;
}

.timeline-tree-view .data-grid.data-grid-fits-viewport .corner {
  display: table-cell;
}

.timeline-tree-view .data-grid table.data {
  background: var(--sys-color-cdt-base-container);
}

.timeline-tree-view .data-grid .odd {
  background-color: var(--sys-color-surface1);
}

.timeline-tree-view .data-grid tr:hover td:not(.bottom-filler-td) {
  background-color: var(--sys-color-state-hover-on-subtle);
}

.timeline-tree-view .data-grid td.numeric-column {
  text-align: right;
  position: relative;
}

.timeline-tree-view .data-grid div.background-percent-bar {
  float: right;
  position: relative;
  z-index: 1;
}

.timeline-tree-view .data-grid span.percent-column {
  color: var(--sys-color-token-subtle);
  width: 45px;
  display: inline-block;
}

.timeline-tree-view .data-grid tr.selected span {
  color: inherit;
}

.timeline-tree-view .data-grid tr.selected {
  background-color: var(--sys-color-tonal-container);
}

.timeline-tree-view .data-grid .name-container {
  display: flex;
  align-items: center;
  padding-left: 2px;
}

.timeline-tree-view .data-grid .name-container .activity-icon {
  width: 12px;
  height: 12px;
  border: 1px solid var(--divider-line);
  margin: 3px 0;
}

.timeline-tree-view .data-grid .name-container .activity-icon-container {
  margin-right: 3px;
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  justify-content: center;
  width: 18px;
  height: 18px;
  overflow: hidden;
}

.timeline-tree-view .data-grid .name-container .activity-warning::after {
  content: "[deopt]";
  margin: 0 4px;
  line-height: 12px;
  font-size: 10px;
  color: var(--sys-color-state-disabled);
}

.timeline-tree-view .data-grid tr.selected .name-container .activity-warning::after {
  color: var(--sys-color-on-tonal-container);
}

.timeline-tree-view .data-grid .name-container .activity-link {
  flex: auto;
  text-align: right;
  overflow: hidden;
  text-overflow: ellipsis;
  margin-left: 5px;
}

.timeline-tree-view .data-grid .background-bar-container {
  position: absolute;
  left: 3px;
  right: 0;
}

.timeline-tree-view .data-grid .background-bar {
  float: right;
  height: 18px;
  background-color: var(--sys-color-surface-yellow);
  border-bottom: 1px solid var(--sys-color-yellow-outline);
}

.timeline-tree-view .data-grid .selected .background-bar {
  background-color: var(--app-color-selected-progress-bar);
  border-bottom: 1px solid var(--app-border-selected-progress-bar);
}

.timeline-tree-view .timeline-details-view-body .full-widget-dimmed-banner {
  background-color: inherit;
}

.timeline-details .filter-input-field {
  width: 120px;
}

.timeline-tree-view .data-grid thead {
  height: 21px;
  /* so the header is always above any body rows that the user has scrolled past */
  z-index: 2;
}

.timeline-stack-view-header {
  height: 27px;
  background-color: var(--sys-color-cdt-base-container);
  padding: 6px 10px;
  color: var(--sys-color-on-surface);
  white-space: nowrap;
  border-bottom: 1px solid var(--sys-color-divider);
}

.timeline-landing-page {
  position: absolute;
  background-color: var(--sys-color-cdt-base-container);
}

.timeline-landing-page.legacy {
  justify-content: center;
  align-items: center;
  overflow: auto;
  font-size: 13px;
  color: var(--sys-color-on-surface-subtle);
}

@media (forced-colors: active) {
  .timeline-tree-view .data-grid .name-container .activity-icon {
    forced-color-adjust: none;
  }

  .timeline-tree-view .data-grid tr.selected span.percent-column,
  .timeline-tree-view .data-grid tr.selected div.background-percent-bar span,
  .timeline-tree-view .data-grid tr.selected .name-container .activity-link .devtools-link .timeline-link {
    color: HighlightText;
  }

  .timeline-tree-view .data-grid .background-bar,
  .timeline-tree-view .data-grid tr:hover td:not(.bottom-filler-td) {
    background-color: transparent;
  }

  .timeline-tree-view .data-grid tr.selected .background-bar {
    background-color: transparent;
    border-bottom-color: HighlightText;
  }
}

.timeline-details-view-body > div {
  overflow-y: hidden;
  overflow-x: hidden;
}

.timeline-details-chip-title > div {
  width: 12px;
  height: 12px;
  border: 1px solid var(--sys-color-divider);
  display: inline-block;
  margin-right: 4px;
  content: " ";
}

.timeline-landing-page.legacy > div {
  max-width: 450px;
  margin: 10px;
}

.timeline-paint-profiler-log-split > div:last-child {
  background-color: var(--color-background-elevation-1);
  z-index: 0;
}

.timeline-layers-view > div:last-child,
.timeline-layers-view-properties > div:last-child {
  background-color: var(--color-background-elevation-1);
}

.timeline.panel .status-pane-container > div {
  pointer-events: auto;
}

.timeline-tree-view .data-grid .name-container div {
  flex: none;
}

.status-pane-container > .small-dialog {
  width: 100%;
  height: 100%;
}

devtools-feedback-button {
  float: right;
}

/*# sourceURL=timelinePanel.css */
`);const hd=new CSSStyleSheet;hd.replaceSync(`/*
 * Copyright (c) 2015 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

.timeline-status-dialog {
  display: flex;
  flex-direction: column;
  padding: 16px 16px 12px;
  align-self: center;
  background-color: var(--sys-color-cdt-base-container);
  box-shadow: var(--drop-shadow);
  border-radius: 10px;
}

.status-dialog-line {
  margin: 2px;
  height: 14px;
  min-height: auto;
  display: flex;
  align-items: baseline;
}

.status-dialog-line .label {
  display: inline-block;
  width: 80px;
  text-align: right;
  color: var(--sys-color-on-surface);
  margin-right: 10px;
}

.timeline-status-dialog .progress .indicator-container {
  display: inline-block;
  width: 200px;
  height: 8px;
  background-color: var(--sys-color-surface5);
}

.timeline-status-dialog .progress .indicator {
  background-color: var(--sys-color-primary);
  height: 100%;
  width: 0;
  margin: 0;
}

.timeline-status-dialog .stop-button {
  margin-top: 8px;
  height: 100%;
  align-self: flex-end;
}

.timeline-status-dialog .stop-button button {
  border-radius: 12px;
}

.timeline-status-dialog.small-dialog {
  width: inherit;
  justify-content: center;
}

.small-dialog > .stop-button {
  align-self: center;
  margin-top: 20px;
  height: initial;
}

@media (forced-colors: active) {
  .timeline-status-dialog {
    border: 1px solid canvastext;
  }

  .timeline-status-dialog .progress .indicator-container {
    border: 1px solid ButtonText;
    background-color: ButtonFace;
  }

  .timeline-status-dialog .progress .indicator {
    forced-color-adjust: none;
    background-color: ButtonText;
  }
}

/*# sourceURL=timelineStatusDialog.css */
`);const _e={frameStart:"Frame start",drawFrame:"Draw frame",layout:"Layout",rasterizing:"Rasterizing",drawing:"Drawing",painting:"Painting",system:"System",idle:"Idle",loading:"Loading",experience:"Experience",scripting:"Scripting",rendering:"Rendering",gpu:"GPU",async:"Async",messaging:"Messaging"},Kg=A("panels/timeline/UIDevtoolsUtils.ts",_e),Ue=N.bind(void 0,Kg);let Nr=null,us=null;class Ri{static isUiDevTools(){return ga.queryParam("uiDevTools")==="true"}static categorizeEvents(){if(Nr)return Nr;const e=Gs,t=Ri.categories(),i=t.drawing,n=t.rasterizing,s=t.layout,r=t.painting,o=t.other,l={};return l[e.ViewPaint]=new f("View::Paint",r),l[e.ViewOnPaint]=new f("View::OnPaint",r),l[e.ViewPaintChildren]=new f("View::PaintChildren",r),l[e.ViewOnPaintBackground]=new f("View::OnPaintBackground",r),l[e.ViewOnPaintBorder]=new f("View::OnPaintBorder",r),l[e.LayerPaintContentsToDisplayList]=new f("Layer::PaintContentsToDisplayList",r),l[e.ViewLayout]=new f("View::Layout",s),l[e.ViewLayoutBoundsChanged]=new f("View::Layout(bounds_changed)",s),l[e.RasterTask]=new f("RasterTask",n),l[e.RasterizerTaskImplRunOnWorkerThread]=new f("RasterizerTaskImpl::RunOnWorkerThread",n),l[e.DirectRendererDrawFrame]=new f("DirectRenderer::DrawFrame",i),l[e.BeginFrame]=new f(Ue(_e.frameStart),i,!0),l[e.DrawFrame]=new f(Ue(_e.drawFrame),i,!0),l[e.NeedsBeginFrameChanged]=new f("NeedsBeginFrameChanged",i,!0),l[e.ThreadControllerImplRunTask]=new f("ThreadControllerImpl::RunTask",o),Nr=l,l}static categories(){return us||(us={layout:new le(G.LAYOUT,Ue(_e.layout),!0,"--app-color-loading-children","--app-color-loading"),rasterizing:new le(G.RASTERIZING,Ue(_e.rasterizing),!0,"--app-color-children","--app-color-scripting"),drawing:new le(G.DRAWING,Ue(_e.drawing),!0,"--app-color-rendering-children","--app-color-rendering"),painting:new le(G.PAINTING,Ue(_e.painting),!0,"--app-color-painting-children","--app-color-painting"),other:new le(G.OTHER,Ue(_e.system),!1,"--app-color-system-children","--app-color-system"),idle:new le(G.IDLE,Ue(_e.idle),!1,"--app-color-idle-children","--app-color-idle"),loading:new le(G.LOADING,Ue(_e.loading),!1,"--app-color-loading-children","--app-color-loading"),experience:new le(G.EXPERIENCE,Ue(_e.experience),!1,"--app-color-rendering-children","--pp-color-rendering"),messaging:new le(G.MESSAGING,Ue(_e.messaging),!1,"--app-color-messaging-children","--pp-color-messaging"),scripting:new le(G.SCRIPTING,Ue(_e.scripting),!1,"--app-color-scripting-children","--pp-color-scripting"),rendering:new le(G.RENDERING,Ue(_e.rendering),!1,"--app-color-rendering-children","--pp-color-rendering"),gpu:new le(G.GPU,Ue(_e.gpu),!1,"--app-color-painting-children","--app-color-painting"),async:new le(G.ASYNC,Ue(_e.async),!1,"--app-color-async-children","--app-color-async")},us)}static getMainCategoriesList(){return["idle","drawing","painting","rasterizing","layout","other"]}}var Gs;(function(a){a.ViewPaint="View::Paint",a.ViewOnPaint="View::OnPaint",a.ViewPaintChildren="View::PaintChildren",a.ViewOnPaintBackground="View::OnPaintBackground",a.ViewOnPaintBorder="View::OnPaintBorder",a.ViewLayout="View::Layout",a.ViewLayoutBoundsChanged="View::Layout(bounds_changed)",a.LayerPaintContentsToDisplayList="Layer::PaintContentsToDisplayList",a.DirectRendererDrawFrame="DirectRenderer::DrawFrame",a.RasterTask="RasterTask",a.RasterizerTaskImplRunOnWorkerThread="RasterizerTaskImpl::RunOnWorkerThread",a.BeginFrame="BeginFrame",a.DrawFrame="DrawFrame",a.NeedsBeginFrameChanged="NeedsBeginFrameChanged",a.ThreadControllerImplRunTask="ThreadControllerImpl::RunTask"})(Gs||(Gs={}));const dv=Object.freeze(Object.defineProperty({__proto__:null,get RecordType(){return Gs},UIDevtoolsUtils:Ri},Symbol.toStringTag,{value:"Module"}));class ud extends xa{constructor(e,t,i){super(e,t,i),Fp(Ri.categorizeEvents()),Mp(Ri.categories()),Bp(Ri.getMainCategoriesList().filter(Sl))}}const hv=Object.freeze(Object.defineProperty({__proto__:null,UIDevtoolsController:ud},Symbol.toStringTag,{value:"Module"})),I={dropTimelineFileOrUrlHere:"Drop timeline file or URL here",disableJavascriptSamples:"Disable JavaScript samples",enableAdvancedPaint:"Enable advanced paint instrumentation (slow)",enableSelectorStats:"Enable CSS selector stats (slow)",screenshots:"Screenshots",memory:"Memory",clear:"Clear",fixMe:"Fix me",loadProfile:"Load profileâ€¦",saveProfile:"Save profileâ€¦",saveTraceWithAnnotationsMenuOption:"Save trace",saveTraceWithoutAnnotationsMenuOption:"Save trace without annotations",captureScreenshots:"Capture screenshots",showMemoryTimeline:"Show memory timeline",captureSettings:"Capture settings",disablesJavascriptSampling:"Disables JavaScript sampling, reduces overhead when running against mobile devices",capturesAdvancedPaint:"Captures advanced paint instrumentation, introduces significant performance overhead",capturesSelectorStats:"Captures CSS selector statistics",network:"Network:",cpu:"CPU:",networkConditions:"Network conditions",failedToSaveTimelineSS:"Failed to save timeline: {PH1} ({PH2})",CpuThrottlingIsEnabled:"- CPU throttling is enabled",NetworkThrottlingIsEnabled:"- Network throttling is enabled",SignificantOverheadDueToPaint:"- Significant overhead due to paint instrumentation",SelectorStatsEnabled:"- Selector stats is enabled",JavascriptSamplingIsDisabled:"- JavaScript sampling is disabled",stoppingTimeline:"Stopping timelineâ€¦",received:"Received",processed:"Processed",close:"Close",downloadAfterError:"Download raw trace events",recordingFailed:"Recording failed",profiling:"Profilingâ€¦",bufferUsage:"Buffer usage",loadingProfile:"Loading profileâ€¦",processingProfile:"Processing profileâ€¦",initializingProfiler:"Initializing profilerâ€¦",status:"Status",time:"Time",description:"Description",stop:"Stop",ssec:"{PH1}Â sec",exportNormalTraces:"Basic performance traces",exportEnhancedTraces:"Enhanced performance traces",showDataAddedByExtensions:"Show data added by extensions of the Performance panel",performanceExtension:"Extension data",showSidebar:"Show sidebar",hideSidebar:"Hide sidebar",sidebarShown:"Performance sidebar shown",sidebarHidden:"Performance sidebar hidden",selectionCleared:"Selection cleared",frameSelected:"Frame selected",eventSelected:"Event {PH1} selected",learnMore:"Learn more"},Yg=A("panels/timeline/TimelinePanel.ts",I),L=N.bind(void 0,Yg);let Fr,kt;class Xe extends gu{dropTarget;recordingOptionUIControls;state;recordingPageReload;millisecondsToRecordAfterLoadEvent;toggleRecordAction;recordReloadAction;#e;disableCaptureJSProfileSetting;captureLayersAndPicturesSetting;captureSelectorStatsSetting;#t;showScreenshotsSetting;showMemorySetting;panelToolbar;panelRightToolbar;timelinePane;#i=new cd;#n={mode:"LANDING_PAGE"};#s=new Map;#r=new Zt(!0,!1,"timeline-panel-sidebar-state",Gm);statusPaneContainer;flameChart;searchableViewInternal;showSettingsPaneButton;showSettingsPaneSetting;settingsPane;controller;cpuProfiler;clearButton;brickBreakerToolbarButton;brickBreakerToolbarButtonAdded=!1;loadButton;saveButton;statusPane;landingPage;loader;showScreenshotsToolbarCheckbox;showMemoryToolbarCheckbox;networkThrottlingSelect;cpuThrottlingSelect;fileSelectorElement;selection=null;traceLoadStart;primaryPageTargetPromiseCallback=e=>{};primaryPageTargetPromise=new Promise(e=>{this.primaryPageTargetPromiseCallback=e});#a;#o=null;#l=this.#z.bind(this);#p;#h=this.#r.createShowHideSidebarButton(L(I.showSidebar),L(I.hideSidebar),L(I.sidebarShown),L(I.sidebarHidden),"timeline.sidebar");#d=new qm;#u=!1;#c=null;#m=new Map;constructor(){super("timeline");const e=document.createElement("span");e.innerHTML=`<div style="
      font-size: 12px;
      transform: scale(1.25);
      color: transparent;
      background: linear-gradient(90deg,CLICK255 0 0 / 100%) 0%, rgb(255 154 0 / 100%) 10%, rgb(208 222 33 / 100%) 20%, rgb(79 220 74 / 100%) 30%, rgb(63 218 216 / 100%) 40%, rgb(47 201 226 / 100%) 50%, rgb(28 127 238 / 100%) 60%, rgb(95 21 242 / 100%) 70%, rgb(186 12 248 / 100%) 80%, rgb(251 7 217 / 100%) 90%, rgb(255 0 0 / 100%) 100%);
      -webkit-background-clip: text;
      ">ðŸ’«</div>`;const t=new Do;t.classList.add("fix-perf-icon"),t.data={name:L(I.fixMe),content:e},this.brickBreakerToolbarButton=new mn(L(I.fixMe),t),this.brickBreakerToolbarButton.addEventListener("Click",()=>this.#B()),this.#a=this.#v(),this.#U(),this.element.addEventListener("contextmenu",this.contextMenu.bind(this),!1),this.dropTarget=new tp(this.element,[Qa.File,Qa.URI],L(I.dropTimelineFileOrUrlHere),this.handleDrop.bind(this)),this.recordingOptionUIControls=[],this.state="Idle",this.recordingPageReload=!1,this.millisecondsToRecordAfterLoadEvent=5e3,this.toggleRecordAction=Fi.instance().getAction("timeline.toggle-recording"),this.recordReloadAction=Fi.instance().getAction("timeline.record-reload"),this.#e=new Xt(this.#i),this.traceLoadStart=null,this.disableCaptureJSProfileSetting=Te.instance().createSetting("timeline-disable-js-sampling",!1),this.disableCaptureJSProfileSetting.setTitle(L(I.disableJavascriptSamples)),this.captureLayersAndPicturesSetting=Te.instance().createSetting("timeline-capture-layers-and-pictures",!1,"Session"),this.captureLayersAndPicturesSetting.setTitle(L(I.enableAdvancedPaint)),this.captureSelectorStatsSetting=Te.instance().createSetting("timeline-capture-selector-stats",!1,"Session"),this.captureSelectorStatsSetting.setTitle(L(I.enableSelectorStats)),this.showScreenshotsSetting=Te.instance().createSetting("timeline-show-screenshots",!kt),this.showScreenshotsSetting.setTitle(L(I.screenshots)),this.showScreenshotsSetting.addChangeListener(this.updateMiniMap,this),this.showMemorySetting=Te.instance().createSetting("timeline-show-memory",!1),this.showMemorySetting.setTitle(L(I.memory)),this.showMemorySetting.addChangeListener(this.onModeChanged,this),this.#t=Xe.extensionDataVisibilitySetting(),this.#t.addChangeListener(this.#C,this),this.#t.setTitle(L(I.performanceExtension));const i=this.element.createChild("div","timeline-toolbar-container");i.setAttribute("jslog",`${pa()}`),this.panelToolbar=new et("timeline-main-toolbar",i),this.panelToolbar.makeWrappable(!0),this.panelRightToolbar=new et("",i),kt||(this.createSettingsPane(),this.updateShowSettingsToolbarButton()),this.timelinePane=new xe;const n=this.timelinePane.element.createChild("div","hbox");n.id="timeline-overview-panel",this.#i.show(n),this.statusPaneContainer=this.timelinePane.element.createChild("div","status-pane-container fill"),this.createFileSelector(),Y.instance().addModelListener(es,fr.Load,this.loadEventFired,this),this.flameChart=new ed(this),this.#p=this.#T.bind(this),this.element.addEventListener("toggle-popover",r=>this.flameChart.togglePopover(r.detail)),this.flameChart.getMainFlameChart().addEventListener("ChartPlayableStateChange",this.#p,this),this.searchableViewInternal=new fu(this.flameChart,null),this.searchableViewInternal.setMinimumSize(0,100),this.searchableViewInternal.element.classList.add("searchable-view"),this.searchableViewInternal.show(this.timelinePane.element),this.flameChart.show(this.searchableViewInternal.element),this.flameChart.setSearchableView(this.searchableViewInternal),this.searchableViewInternal.hideWidget(),this.#r.setMainWidget(this.timelinePane),this.#r.setSidebarWidget(this.#d),this.#r.enableShowModeSaving(),this.#r.show(this.element),this.#d.element.addEventListener(Kn.eventName,()=>{this.#g(null)}),this.#d.element.addEventListener(Js.eventName,r=>{const{name:o,insightSetKey:l,overlays:d}=r;this.#g({name:o,insightSetKey:l,overlays:d})}),this.#d.element.addEventListener(Qs.eventName,r=>{const{overlays:o,options:l}=r;this.flameChart.setOverlays(o,l);const d=o&&Sc(o);d?this.#i.highlightBounds(d):this.#i.clearBoundsHighlight()}),this.#d.element.addEventListener(er.eventName,r=>{const o={insightLabel:r.label,activateInsight:r.activateInsight};for(const l of r.events){const d=this.#m.get(l)??[];d.push(o),this.#m.set(l,d)}}),this.flameChart.element.addEventListener(ui.eventName,r=>{const o=B.fromTraceEvent(r.event);this.flameChart.setSelectionAndReveal(o)}),this.#d.contentElement.addEventListener(ui.eventName,r=>{this.select(B.fromTraceEvent(r.event))}),this.#d.element.addEventListener(tr.eventName,r=>{const{removedAnnotation:o}=r;H.activeManager()?.removeAnnotation(o)}),this.#d.element.addEventListener(ir.eventName,r=>{this.flameChart.revealAnnotation(r.annotation)}),this.#d.element.addEventListener(Hn.eventName,r=>{r.bounds?this.#i.highlightBounds(r.bounds):this.#i.clearBoundsHighlight()}),this.#d.element.addEventListener(Zs.eventName,r=>{ae.instance().setTimelineVisibleWindow(r.bounds,{ignoreMiniMapBounds:!0,shouldAnimate:!0})}),this.onModeChanged(),this.populateToolbar(),this.#W(),this.updateTimelineControls(),Y.instance().addEventListener("SuspendStateChanged",this.onSuspendStateChanged,this);const s=Y.instance().models(xi);for(const r of s)for(const o of r.registeredConsoleProfileMessages)this.consoleProfileFinished(o);Y.instance().observeModels(xi,{modelAdded:r=>{r.addEventListener("ConsoleProfileFinished",o=>this.consoleProfileFinished(o.data))},modelRemoved:r=>{}}),Y.instance().observeTargets({targetAdded:r=>{r===Y.instance().primaryPageTarget()&&this.primaryPageTargetPromiseCallback(r)},targetRemoved:r=>{}})}#g(e){e&&this.#x()&&this.#r.showBoth(),this.#d.setActiveInsight(e),this.flameChart.setActiveInsight(e)}static instance(e={forceNew:null,isNode:!1}){const{forceNew:t,isNode:i}=e;return kt=i,(!Fr||t)&&(Fr=new Xe),Fr}#v(){const e=Iu();return e.showAllEvents=ne.isEnabled("timeline-show-all-events"),e.includeRuntimeCallStats=ne.isEnabled("timeline-v8-runtime-call-stats"),e.debugMode=ne.isEnabled("timeline-debug-mode"),Vu.createWithAllHandlers(e)}static extensionDataVisibilitySetting(){return Te.instance().createSetting("timeline-show-extension-data",!0)}searchableView(){return this.searchableViewInternal}wasShown(){super.wasShown(),Li.instance().setFlavor(Xe,this),this.registerCSSFiles([dd]),Wt.panelLoaded("timeline","DevTools.Launch.Timeline")}willHide(){Li.instance().setFlavor(Xe,null),this.#e.cancelIfShowing()}loadFromEvents(e){this.state==="Idle"&&(this.prepareToLoadTimeline(),this.loader=$t.loadFromEvents(e,this))}getFlameChart(){return this.flameChart}getMinimap(){return this.#i}#f(e,t){return e.mode==="LANDING_PAGE"&&t.mode==="LANDING_PAGE"||e.mode==="STATUS_PANE_OVERLAY"&&t.mode==="STATUS_PANE_OVERLAY"||e.mode==="VIEWING_TRACE"&&t.mode==="VIEWING_TRACE"&&e.traceIndex===t.traceIndex}#w(){this.#o&&(Ot.clearResolvedNodeNames(),this.#o.removeEventListener(en.eventName,this.#l),this.#o.uninstall(),this.#o=null)}#b(){this.statusPane&&this.statusPane.remove(),this.statusPane=null}#y(e){if(!this.#f(this.#n,e))switch(this.#n.mode==="VIEWING_TRACE"&&(this.#w(),this.#L()),this.#n=e,this.updateTimelineControls(),e.mode){case"LANDING_PAGE":{this.#b(),this.#W(),this.searchableViewInternal.hideWidget(),this.brickBreakerToolbarButtonAdded=!1,this.panelToolbar.removeToolbarItem(this.brickBreakerToolbarButton);return}case"VIEWING_TRACE":{this.#V(),this.#O(),this.#b(),this.#A();return}case"STATUS_PANE_OVERLAY":{this.#V(),this.#H();return}default:ke(e,"Unsupported TimelinePanel viewMode")}}#E(){return this.#n.mode==="VIEWING_TRACE"?this.#n.traceIndex:null}getParsedTraceForLayoutTests(){const e=this.#E();if(e===null)throw new Error("No trace index active.");const t=this.#a.parsedTrace(e);if(t===null)throw new Error("No trace engine data found.");return t}getTraceEngineRawTraceEventsForLayoutTests(){const e=this.#E();if(e===null)throw new Error("No trace index active.");const t=this.#a.rawTraceEvents(e);if(t===null)throw new Error("No trace engine data found.");return t}#T(e){if(e.data){const t=new Date,i=t.getUTCMonth()+1,n=t.getUTCDate();i===4&&(n===1||n===2)&&!this.brickBreakerToolbarButtonAdded&&Zm&&(this.brickBreakerToolbarButtonAdded=!0,this.panelToolbar.appendToolbarItem(this.brickBreakerToolbarButton))}else this.brickBreakerToolbarButtonAdded=!1,this.panelToolbar.removeToolbarItem(this.brickBreakerToolbarButton)}loadFromCpuProfile(e){this.state!=="Idle"||e===null||(this.prepareToLoadTimeline(),this.loader=$t.loadFromCpuProfile(e,this))}setState(e){this.state=e,this.updateTimelineControls()}createSettingCheckbox(e,t){const i=new _o(e,t);return this.recordingOptionUIControls.push(i),i}#x(){return ne.isEnabled("timeline-rpp-sidebar")||ne.isEnabled("perf-panel-annotations")}#P(){this.#x()&&(this.panelToolbar.hasItem(this.#h)||this.panelToolbar.prependToolbarItem(this.#h))}#I(){this.panelToolbar.removeToolbarItem(this.#h)}populateDownloadMenu(e){e.viewSection().appendItem(L(I.saveTraceWithAnnotationsMenuOption),()=>{Wt.actionTaken(gi.PerfPanelTraceExported),this.saveToFile(!1,!0)}),e.viewSection().appendItem(L(I.saveTraceWithoutAnnotationsMenuOption),()=>{Wt.actionTaken(gi.PerfPanelTraceExported),this.saveToFile()})}populateToolbar(){this.panelToolbar.appendToolbarItem(et.createActionButton(this.toggleRecordAction)),this.panelToolbar.appendToolbarItem(et.createActionButton(this.recordReloadAction)),this.clearButton=new mn(L(I.clear),"clear",void 0,"timeline.clear"),this.clearButton.addEventListener("Click",()=>this.onClearButton()),this.panelToolbar.appendToolbarItem(this.clearButton),this.loadButton=new mn(L(I.loadProfile),"import",void 0,"timeline.load-from-file"),this.loadButton.addEventListener("Click",()=>{Wt.actionTaken(gi.PerfPanelTraceImported),this.selectFileToLoad()}),ne.isEnabled("perf-panel-annotations")?(this.saveButton=new vu(this.populateDownloadMenu.bind(this),!0,!0,"timeline.save-to-file-more-options","download"),this.saveButton.setTitle(L(I.saveProfile))):(this.saveButton=new mn(L(I.saveProfile),"download",void 0,"timeline.save-to-file"),this.saveButton.addEventListener("Click",t=>{Wt.actionTaken(gi.PerfPanelTraceExported),this.saveToFile()})),ne.isEnabled("timeline-enhanced-traces")&&this.saveButton.element.addEventListener("contextmenu",t=>{if(t.preventDefault(),t.stopPropagation(),t.ctrlKey||t.button===2){const i=new Ji(t);i.saveSection().appendItem(L(I.exportNormalTraces),()=>{this.saveToFile()}),i.saveSection().appendItem(L(I.exportEnhancedTraces),()=>{this.saveToFile(!0)}),i.show()}else this.saveToFile()}),this.panelToolbar.appendSeparator(),this.panelToolbar.appendToolbarItem(this.loadButton),this.panelToolbar.appendToolbarItem(this.saveButton),this.panelToolbar.appendSeparator(),this.panelToolbar.appendToolbarItem(this.#e.button()),this.panelToolbar.registerCSSFiles([hc]),this.panelToolbar.appendSeparator(),this.panelToolbar.appendSeparator(),kt||(this.showScreenshotsToolbarCheckbox=this.createSettingCheckbox(this.showScreenshotsSetting,L(I.captureScreenshots)),this.panelToolbar.appendToolbarItem(this.showScreenshotsToolbarCheckbox)),this.showMemoryToolbarCheckbox=this.createSettingCheckbox(this.showMemorySetting,L(I.showMemoryTimeline)),this.panelToolbar.appendToolbarItem(this.showMemoryToolbarCheckbox),this.panelToolbar.appendToolbarItem(et.createActionButtonForId("components.collect-garbage"));const e=new eg;kt&&(this.panelToolbar.appendSeparator(),this.panelToolbar.appendToolbarItem(e)),kt||(this.panelRightToolbar.appendSeparator(),this.panelRightToolbar.appendToolbarItem(this.showSettingsPaneButton))}createSettingsPane(){this.showSettingsPaneSetting=Te.instance().createSetting("timeline-show-settings-toolbar",!1),this.showSettingsPaneButton=new yu(this.showSettingsPaneSetting,"gear",L(I.captureSettings),"gear-filled","timeline-settings-toggle"),oi.instance().addEventListener("ConditionsChanged",this.updateShowSettingsToolbarButton,this),Jt.instance().addEventListener("RateChanged",this.updateShowSettingsToolbarButton,this),this.disableCaptureJSProfileSetting.addChangeListener(this.updateShowSettingsToolbarButton,this),this.captureLayersAndPicturesSetting.addChangeListener(this.updateShowSettingsToolbarButton,this),this.captureSelectorStatsSetting.addChangeListener(this.updateShowSettingsToolbarButton,this),this.settingsPane=new Oo,this.settingsPane.element.classList.add("timeline-settings-pane"),this.settingsPane.element.setAttribute("jslog",`${rn("timeline-settings-pane").track({resize:!0})}`),this.settingsPane.show(this.element);const e=new et("",this.settingsPane.element);e.element.classList.add("flex-auto"),e.makeVertical(),e.appendToolbarItem(this.createSettingCheckbox(this.disableCaptureJSProfileSetting,L(I.disablesJavascriptSampling))),e.appendToolbarItem(this.createSettingCheckbox(this.captureLayersAndPicturesSetting,L(I.capturesAdvancedPaint))),e.appendToolbarItem(this.createSettingCheckbox(this.captureSelectorStatsSetting,L(I.capturesSelectorStats)));const t=new xe;t.element.classList.add("flex-auto"),t.show(this.settingsPane.element);const i=new et("",t.element);i.appendText(L(I.cpu)),this.cpuThrottlingSelect=Ur().createCPUThrottlingSelector(),i.appendToolbarItem(this.cpuThrottlingSelect);const n=new et("",t.element);n.appendText(L(I.network)),this.networkThrottlingSelect=this.createNetworkConditionsSelect(),n.appendToolbarItem(this.networkThrottlingSelect);const s=new et("",t.element);s.makeVertical();const r=this.createSettingCheckbox(this.#t,L(I.showDataAddedByExtensions)),o=tt.create("https://developer.chrome.com/docs/devtools/performance/extension",L(I.learnMore));o.style.paddingLeft="5px",r.element.shadowRoot?.appendChild(o),s.appendToolbarItem(r),this.showSettingsPaneSetting.addChangeListener(this.updateSettingsPaneVisibility.bind(this)),this.updateSettingsPaneVisibility()}createNetworkConditionsSelect(){const e=new Qo(null,L(I.networkConditions));return e.setMaxWidth(140),Ur().decorateSelectWithNetworkThrottling(e.selectElement()),e}prepareToLoadTimeline(){console.assert(this.state==="Idle"),this.setState("Loading")}createFileSelector(){this.fileSelectorElement&&this.fileSelectorElement.remove(),this.fileSelectorElement=bu(this.loadFromFile.bind(this),".json,.gz,.gzip,.cpuprofile"),this.timelinePane.element.appendChild(this.fileSelectorElement)}contextMenu(e){const t=e;if(this.flameChart.getMainFlameChart().coordinatesToEntryIndex(t.offsetX,t.offsetY)!==-1)return;const i=new Ji(e,{useSoftMenu:!0});i.appendItemsAtLocation("timelineMenu"),i.show()}async saveToFile(e=!1,t=!1){if(this.state!=="Idle"||this.#n.mode!=="VIEWING_TRACE")return;const i=this.#a.rawTraceEvents(this.#n.traceIndex),n=this.#a.metadata(this.#n.traceIndex);if(ne.isEnabled("perf-panel-annotations")&&n&&t?n.modifications=H.activeManager()?.toJSON():n&&delete n.modifications,n&&e&&(n.enhancedTraceVersion=up.enhancedTraceVersion),!i)return;const s=nl(new Date);let r;n?.dataOrigin==="CPUProfile"?r=`CPU-${s}.cpuprofile`:n&&n.enhancedTraceVersion?r=`EnhancedTraces-${s}.json`:r=`Trace-${s}.json`;try{let o;if(n?.dataOrigin==="CPUProfile"){const l=i.find(c=>c.name==="CpuProfile");if(!l||!l.args?.data)return;const d=l.args?.data;if(d.hasOwnProperty("cpuProfile")){const c=d.cpuProfile;o=Cc(c)}}else{const l=ka(i,n);o=Array.from(l).join("")}if(!o)throw new Error("Trace content empty");await As.instance().save(r,o,!0,!1),As.instance().close(r)}catch(o){if(console.error(o.stack),o.name==="AbortError")return;Is.instance().error(L(I.failedToSaveTimelineSS,{PH1:o.message,PH2:o.name}))}}async showHistoryDropdown(){const e=await this.#e.showHistoryDropDown();e&&(e.type==="LANDING_PAGE"?this.#y({mode:"LANDING_PAGE"}):this.#y({mode:"VIEWING_TRACE",traceIndex:e.parsedTraceIndex}))}navigateHistory(e){const t=this.#e.navigate(e);return t&&t.type==="TRACE_INDEX"&&this.#y({mode:"VIEWING_TRACE",traceIndex:t.parsedTraceIndex}),!0}#L(){if(this.#n.mode!=="VIEWING_TRACE")return;const e=H.activeManager()?.toJSON();e&&this.#a.overrideModifications(this.#n.traceIndex,e)}selectFileToLoad(){this.fileSelectorElement&&this.fileSelectorElement.click()}async loadFromFile(e){this.state==="Idle"&&(this.prepareToLoadTimeline(),this.loader=await $t.loadFromFile(e,this),this.createFileSelector())}async loadFromURL(e){this.state==="Idle"&&(this.prepareToLoadTimeline(),this.loader=await $t.loadFromURL(e,this))}updateMiniMap(){if(this.#n.mode!=="VIEWING_TRACE")return;const e=this.#a.parsedTrace(this.#n.traceIndex),t=this.#a.metadata(this.#n.traceIndex)?.dataOrigin==="CPUProfile";e&&this.#i.setData({parsedTrace:e,isCpuProfile:t,settings:{showScreenshots:this.showScreenshotsSetting.get(),showMemory:this.showMemorySetting.get()}})}onModeChanged(){this.flameChart.updateCountersGraphToggle(this.showMemorySetting.get()),this.updateMiniMap(),this.doResize(),this.select(null)}#C(){this.flameChart.extensionDataVisibilityChanged()}updateSettingsPaneVisibility(){kt||(this.showSettingsPaneSetting.get()?(this.showSettingsPaneButton.setToggled(!0),this.settingsPane.showWidget()):(this.showSettingsPaneButton.setToggled(!1),this.settingsPane.hideWidget()))}updateShowSettingsToolbarButton(){const e=[];if(Jt.instance().cpuThrottlingRate()!==1&&e.push(L(I.CpuThrottlingIsEnabled)),oi.instance().isThrottling()&&e.push(L(I.NetworkThrottlingIsEnabled)),this.captureLayersAndPicturesSetting.get()&&e.push(L(I.SignificantOverheadDueToPaint)),this.captureSelectorStatsSetting.get()&&e.push(L(I.SelectorStatsEnabled)),this.disableCaptureJSProfileSetting.get()&&e.push(L(I.JavascriptSamplingIsDisabled)),this.showSettingsPaneButton.setChecked(e.length>0),this.showSettingsPaneButton.element.style.setProperty("--dot-toggle-top","16px"),this.showSettingsPaneButton.element.style.setProperty("--dot-toggle-left","15px"),e.length){const t=document.createElement("div");e.forEach(i=>{t.createChild("div").textContent=i}),this.showSettingsPaneButton.setTitle(t.textContent||"")}else this.showSettingsPaneButton.setTitle(L(I.captureSettings))}setUIControlsEnabled(e){this.recordingOptionUIControls.forEach(t=>t.setEnabled(e))}async#k(){if(!this.controller)return No;const e=this.controller.primaryPageTarget.inspectedURL(),t=this.controller.primaryPageTarget.model(es),i=t&&await t.navigationHistory();if(!t||!i)return e;const{currentIndex:n,entries:s}=i;return s[n].url}async#N(){await new Promise(async(t,i)=>{if(!this.controller){i("Could not find TimelineController");return}const s=this.controller.primaryPageTarget.model(es);if(!s){i("Could not load resourceModel");return}function r(o){o.data.url==="about:blank"?t():i(`Unexpected navigation to ${o.data.url}`),s?.removeEventListener(fr.FrameNavigated,r)}s.addEventListener(fr.FrameNavigated,r),await s.navigate("about:blank")})}async#S(){try{if(this.cpuProfiler=Li.instance().flavor(xi),!this.cpuProfiler){const e=Y.instance().targets().find(t=>t.type()===wu.NODE);if(!e)throw new Error("Could not load any Node target.");e&&(this.cpuProfiler=e.model(xi))}if(this.setUIControlsEnabled(!1),this.#y({mode:"STATUS_PANE_OVERLAY"}),!this.cpuProfiler)throw new Error("No Node target is found.");await Y.instance().suspendAllTargets("performance-timeline"),await this.cpuProfiler.startRecording(),this.recordingStarted()}catch(e){await this.recordingFailed(e.message)}}async#$(){try{const e=Y.instance().rootTarget(),t=Y.instance().primaryPageTarget();if(!t)throw new Error("Could not load primary page target.");if(!e)throw new Error("Could not load root target.");if(Ri.isUiDevTools()?this.controller=new ud(e,t,this):this.controller=new xa(e,t,this),this.setUIControlsEnabled(!1),this.#y({mode:"STATUS_PANE_OVERLAY"}),!this.controller)throw new Error("Could not create Timeline controller");const i=await this.#k();this.recordingPageReload&&await this.#N();const n={enableJSSampling:!this.disableCaptureJSProfileSetting.get(),capturePictures:this.captureLayersAndPicturesSetting.get(),captureFilmStrip:this.showScreenshotsSetting.get(),captureSelectorStats:this.captureSelectorStatsSetting.get()},s=await this.controller.startRecording(n);if(s.getError())throw new Error(s.getError());const r=this.recordingPageReload?{navigateToUrl:i}:void 0;this.recordingStarted(r)}catch(e){await this.recordingFailed(e.message)}}async startRecording(){console.assert(!this.statusPane,"Status pane is already opened."),this.setState("StartPending"),this.showRecordingStarted(),kt?await this.#S():await this.#$()}async stopRecording(){if(this.statusPane&&(this.statusPane.finish(),this.statusPane.updateStatus(L(I.stoppingTimeline)),this.statusPane.updateProgressBar(L(I.received),0)),this.setState("StopPending"),this.controller){await this.controller.stopRecording(),this.setUIControlsEnabled(!0),await this.controller.dispose(),this.controller=null;return}if(this.cpuProfiler){const e=await this.cpuProfiler.stopRecording();this.setState("Idle"),this.loadFromCpuProfile(e),this.setUIControlsEnabled(!0),this.cpuProfiler=null,await Y.instance().resumeAllTargets()}}async recordingFailed(e,t){this.statusPane&&this.statusPane.remove(),this.statusPane=new Es({description:e,buttonText:L(I.close),buttonDisabled:!1,showProgress:void 0,showTimer:void 0},async()=>{this.statusPane?.remove(),await this.loadingComplete([],null,!1,null,null)}),this.statusPane.showPane(this.statusPaneContainer),this.statusPane.updateStatus(L(I.recordingFailed)),t&&this.statusPane.enableDownloadOfEvents(t),this.setState("RecordingFailed"),this.traceLoadStart=null,this.setUIControlsEnabled(!0),this.controller&&(await this.controller.dispose(),this.controller=null),Y.instance().resumeAllTargets()}onSuspendStateChanged(){this.updateTimelineControls()}consoleProfileFinished(e){this.loadFromCpuProfile(e.cpuProfile),Tu.instance().showPanel("timeline")}updateTimelineControls(){this.toggleRecordAction.setToggled(this.state==="Recording"),this.toggleRecordAction.setEnabled(this.state==="Recording"||this.state==="Idle"),this.recordReloadAction.setEnabled(kt?!1:this.state==="Idle"),this.#e.setEnabled(this.state==="Idle"),this.clearButton.setEnabled(this.state==="Idle"),this.panelToolbar.setEnabled(this.state!=="Loading"),this.panelRightToolbar.setEnabled(this.state!=="Loading"),this.dropTarget.setEnabled(this.state==="Idle"),this.loadButton.setEnabled(this.state==="Idle"),this.saveButton.setEnabled(this.state==="Idle"&&this.#F()),this.#n.mode==="VIEWING_TRACE"&&this.#P()}async toggleRecording(){this.state==="Idle"?(this.recordingPageReload=!1,await this.startRecording(),Wt.actionTaken(gi.TimelineStarted)):this.state==="Recording"&&await this.stopRecording()}recordReload(){this.state==="Idle"&&(this.recordingPageReload=!0,this.startRecording(),Wt.actionTaken(gi.TimelinePageReloadStarted))}onClearButton(){this.#e.clear(),this.#a=this.#v(),H.reset(),this.#w(),this.flameChart.getMainDataProvider().reset(!0),this.flameChart.reset(),this.#y({mode:"LANDING_PAGE"})}#F(){return this.#n.mode==="VIEWING_TRACE"}#B(){this.#F()&&this.flameChart.runBrickBreakerGame()}#_(e,t=null){if(e||ne.isEnabled("timeline-show-all-events"))return;const i=t?[t]:[R.visibleEventsFilter()];nn.instance().setFilters(i)}#R=cl(()=>{this.#c&&(Vi(this.#c),this.#c=null)},1e3);#M(e){e!==this.#c&&(this.#c&&Vi(this.#c),this.#c=e,this.#R())}#O(){if(this.#n.mode!=="VIEWING_TRACE")return;const{traceIndex:e}=this.#n,t=this.#a.parsedTrace(e),i=this.#a.syntheticTraceEventsManager(e);if(!t||!i){console.error(`setModelForActiveTrace was called with an invalid trace index: ${e}`),this.#y({mode:"LANDING_PAGE"});return}ms.activate(i),yr.instance().reset(),this.#i.reset(),ae.instance().resetWithNewBounds(t.Meta.traceBounds);const n=H.initAndActivateModificationsManager(this.#a,e);n||console.error("ModificationsManager could not be created or activated."),this.statusPane?.updateProgressBar(L(I.processed),70);const s=this.#a.metadata(e)?.dataOrigin==="CPUProfile";this.flameChart.setModel(t,s),this.flameChart.resizeToPreferredHeights(),this.flameChart.setSelectionAndReveal(null),this.#d.setParsedTrace(t),this.searchableViewInternal.showWidget();const r=this.#s.get(e)??null;this.#_(t.Meta.traceIsGeneric,r),n?.addEventListener(Rt.eventName,c=>{const h=dc(c);h&&this.#M(h);const{overlay:u,action:m}=c;m==="Add"?this.flameChart.addOverlay(u):m==="Remove"?this.flameChart.removeOverlay(u):m==="UpdateTimeRange"&&Yn(u)?this.flameChart.updateExistingOverlay(u,{bounds:u.bounds}):m==="UpdateLinkToEntry"&&Xn(u)?this.flameChart.updateExistingOverlay(u,{entryTo:u.entryTo}):m==="EnterLabelEditState"&&nr(u)&&this.flameChart.enterLabelEditMode(u);const v=n.getAnnotations(),T=this.buildColorsAnnotationsMap(v);this.#d.setAnnotations(v,T)});const o=this.flameChart.getMainDataProvider().compatibilityTracksAppenderInstance().threadAppenders().at(0);if(o){const c=yp(t.Meta.traceBounds,o.getEntries());ae.instance().setTimelineVisibleWindow(c)}const l=H.activeManager();if(l){const c=l.getAnnotations(),h=this.buildColorsAnnotationsMap(c);this.#d.setAnnotations(c,h),this.flameChart.bulkAddOverlays(l.getOverlays())}if(yr.instance().reset(),t&&t.Samples.profilesInProcess.size){const c=Y.instance().primaryPageTarget(),h=Array.from(t.Samples.profilesInProcess).flatMap(([u,m])=>Array.from(m.values()).map(T=>T.parsedProfile));for(const u of h)yr.instance().appendCPUProfile(u,c)}this.#o=new Ot(t),this.#o.addEventListener(en.eventName,this.#l),this.#o.install(),this.statusPane?.updateProgressBar(L(I.processed),80),this.updateMiniMap(),this.statusPane?.updateProgressBar(L(I.processed),90),this.updateTimelineControls(),this.#g(null),this.#m.clear();const d=this.#a.traceInsights(e);this.flameChart.setInsights(d,this.#m),this.#d.setInsights(d),this.#A()}#A(){if(ga.queryParam("disable-auto-performance-sidebar-reveal")!==null)return;const e=this.#u,t=this.#d.userHasOpenedSidebarOnce();this.#x()&&(!t||e)&&this.#r.showBoth(),this.#u=!1}buildColorsAnnotationsMap(e){const t=new Map;for(const i of e)ul(i)?t.set(i.entry,this.getEntryColorByEntry(i.entry)):zr(i)&&(t.set(i.entryFrom,this.getEntryColorByEntry(i.entryFrom)),i.entryTo&&t.set(i.entryTo,this.getEntryColorByEntry(i.entryTo)));return t}getEntryColorByEntry(e){const t=this.flameChart.getMainDataProvider().indexForEvent(e),i=this.flameChart.getNetworkDataProvider().indexForEvent(e);if(t!==null){const n=this.flameChart.getMainDataProvider().entryColor(t);return n==="white"?ie.instance().getComputedValue("--app-color-system"):n}return i!==null?this.flameChart.getNetworkDataProvider().entryColor(i):(console.warn("Could not get entry color for ",e),ie.instance().getComputedValue("--app-color-system"))}recordingStarted(e){if(e&&this.recordingPageReload&&this.controller){const t=this.controller?.primaryPageTarget.model(es);if(!t){this.recordingFailed("Could not navigate to original URL");return}t.navigate(e.navigateToUrl)}this.#y({mode:"STATUS_PANE_OVERLAY"}),this.setState("Recording"),this.showRecordingStarted(),this.statusPane&&(this.statusPane.enableAndFocusButton(),this.statusPane.updateStatus(L(I.profiling)),this.statusPane.updateProgressBar(L(I.bufferUsage),0),this.statusPane.startTimer())}recordingProgress(e){this.statusPane&&this.statusPane.updateProgressBar(L(I.bufferUsage),e*100)}#H(){this.#r.sidebarIsShowing()&&(this.#u=!0,this.#r.hideSidebar())}#W(){if(this.updateSettingsPaneVisibility(),this.#I(),this.#H(),this.landingPage){this.landingPage.show(this.statusPaneContainer);return}this.landingPage=new jg(this.toggleRecordAction,{isNode:kt}),this.landingPage.show(this.statusPaneContainer)}#V(){this.landingPage.detach(),this.showSettingsPaneButton?.setToggled(!1),this.settingsPane?.hideWidget()}async loadingStarted(){this.#y({mode:"STATUS_PANE_OVERLAY"}),this.statusPane&&this.statusPane.remove(),this.statusPane=new Es({showProgress:!0,showTimer:void 0,buttonDisabled:void 0,buttonText:void 0,description:void 0},()=>this.cancelLoading()),this.statusPane.showPane(this.statusPaneContainer),this.statusPane.updateStatus(L(I.loadingProfile)),this.loader||this.statusPane.finish(),this.traceLoadStart=se(performance.now()),await this.loadingProgress(0)}async loadingProgress(e){typeof e=="number"&&this.statusPane&&this.statusPane.updateProgressBar(L(I.received),e*100)}async processingStarted(){this.statusPane?.updateStatus(L(I.processingProfile))}#U(){this.#a.addEventListener(Uu.eventName,e=>{const t=e,i=L(I.processed),n=.7;if(t.data.type==="COMPLETE")this.statusPane?.updateProgressBar(i,100*n);else if(t.data.type==="PROGRESS_UPDATE"){const s=t.data.data;this.statusPane?.updateProgressBar(i,s.percent*100*n)}})}#z(){this.flameChart.getMainDataProvider().timelineData(!0),this.flameChart.getMainFlameChart().update()}async loadingComplete(e,t=null,i,n,s){this.#a.resetProcessor(),delete this.loader;const r=this.state==="StopPending";if(this.setState("Idle"),e.length===0){this.#a.size()?this.#y({mode:"VIEWING_TRACE",traceIndex:this.#a.lastTraceIndex()}):this.#y({mode:"LANDING_PAGE"});return}s=s||await bp(i,n??void 0);try{await this.#G(e,r,s);const o=this.#a.lastTraceIndex();t&&this.#s.set(o,t),this.#y({mode:"VIEWING_TRACE",traceIndex:o});const l=this.#a.parsedTrace(o);if(!l)throw new Error(`Could not get trace data at index ${o}`);r&&Di.instance().registerFreshRecording(l),this.#e.addRecording({data:{parsedTraceIndex:o,type:"TRACE_INDEX"},filmStripForPreview:Ks(l),parsedTrace:l,startTime:n??null})}catch(o){this.recordingFailed(o.message,e),console.error(o)}finally{this.recordTraceLoadMetric()}}recordTraceLoadMetric(){if(!this.traceLoadStart)return;const e=this.traceLoadStart;requestAnimationFrame(()=>{setTimeout(()=>{const t=se(performance.now()),i=performance.measure("TraceLoad",{start:e,end:t}),n=se(i.duration);this.element.dispatchEvent(new sr(n)),Wt.performanceTraceLoad(i)},0)})}async#G(e,t,i){return this.#a.parse(e,{metadata:i,isFreshRecording:t})}loadingCompleteForTest(){}showRecordingStarted(){this.#y({mode:"STATUS_PANE_OVERLAY"}),this.statusPane&&this.statusPane.remove(),this.statusPane=new Es({showTimer:!0,showProgress:!0,buttonDisabled:!0,description:void 0,buttonText:void 0},()=>this.stopRecording()),this.statusPane.showPane(this.statusPaneContainer),this.statusPane.updateStatus(L(I.initializingProfiler))}cancelLoading(){this.loader&&this.loader.cancel()}async loadEventFired(e){if(this.state!=="Recording"||!this.recordingPageReload||!this.controller||this.controller.primaryPageTarget!==e.data.resourceTreeModel.target())return;const t=this.controller;await new Promise(i=>window.setTimeout(i,this.millisecondsToRecordAfterLoadEvent)),!(t!==this.controller||this.state!=="Recording")&&this.stopRecording()}frameForSelection(e){if(this.#n.mode!=="VIEWING_TRACE")return null;if(B.isLegacyTimelineFrame(e.object)&&e.object instanceof Bn)return e.object;if(B.isRangeSelection(e.object)||B.isSyntheticNetworkRequestDetailsEventSelection(e.object))return null;if(B.isTraceEventSelection(e.object)){const t=this.#a.parsedTrace(this.#n.traceIndex);if(!t)return null;const i=ee(e.endTime);return zu(t.Frames.frames,i,i).at(0)||null}return console.assert(!1,"Should never be reached"),null}jumpToFrame(e){if(this.#n.mode!=="VIEWING_TRACE")return;const t=this.selection&&this.frameForSelection(this.selection);if(!t)return;const i=this.#a.parsedTrace(this.#n.traceIndex);if(!i)return;let n=i.Frames.frames.indexOf(t);console.assert(n>=0,"Can't find current frame in the frame list"),n=Mn(n+e,0,i.Frames.frames.length-1);const s=i.Frames.frames[n];return this.#q($(s.startTime),$(s.endTime)),this.select(B.fromFrame(s)),!0}#j(e,t){if(e!==null&&t===null&&Vi(L(I.selectionCleared)),t===null||B.isRangeSelection(t.object))return;if(B.isLegacyTimelineFrame(t.object)){Vi(L(I.frameSelected));return}const i=Ge(t.object);Vi(L(I.eventSelected,{PH1:i}))}select(e){this.#j(this.selection,e),this.selection=e,this.flameChart.setSelectionAndReveal(e)}selectEntryAtTime(e,t){if(e){if(e.length===0){this.select(null);return}for(let i=js(e,t,(n,s)=>n-s.ts)-1;i>=0;--i){const n=e[i],{endTime:s}=fe(n);if(Su(n)&&s<t)break;if(nn.instance().isVisible(n)&&s>=t){this.select(B.fromTraceEvent(n));return}}this.select(null)}}highlightEvent(e){this.flameChart.highlightEvent(e)}#q(e,t){const i=ae.instance().state();if(!i)return;const n=i.milli.timelineTraceWindow;let s=0;n.max<t?s=t-n.max:n.min>e&&(s=e-n.min),ae.instance().setTimelineVisibleWindow($n(se(n.min+s),se(n.max+s)),{shouldAnimate:!0})}handleDrop(e){const t=e.items;if(!t.length)return;const i=t[0];if(Wt.actionTaken(gi.PerfPanelTraceImported),i.kind==="string"){const n=e.getData("text/uri-list");new qn(n).isValid&&this.loadFromURL(n)}else if(i.kind==="file"){const n=t[0].getAsFile();if(!n)return;this.loadFromFile(n)}}}const Xg=18,Jg=20;class Es extends xe{status;time;progressLabel;progressBar;description;button;downloadTraceButton;startTime;timeUpdateTimer;#e;constructor(e,t){super(!0),this.contentElement.classList.add("timeline-status-dialog"),this.contentElement.setAttribute("jslog",`${Eu("timeline-status").track({resize:!0})}`);const i=this.contentElement.createChild("div","status-dialog-line status");if(i.createChild("div","label").textContent=L(I.status),this.status=i.createChild("div","content"),Cu(this.status),e.showTimer){const r=this.contentElement.createChild("div","status-dialog-line time");r.createChild("div","label").textContent=L(I.time),this.time=r.createChild("div","content")}if(e.showProgress){const r=this.contentElement.createChild("div","status-dialog-line progress");this.progressLabel=r.createChild("div","label"),this.progressBar=r.createChild("div","indicator-container").createChild("div","indicator"),ku(this.progressBar)}if(typeof e.description=="string"){const r=this.contentElement.createChild("div","status-dialog-line description");r.createChild("div","label").textContent=L(I.description),this.description=r.createChild("div","content"),this.description.innerText=e.description}const n=this.contentElement.createChild("div","stop-button");this.downloadTraceButton=Ya(L(I.downloadAfterError),()=>{this.#t()},{jslogContext:"timeline.download-after-error"}),this.downloadTraceButton.disabled=!0,this.downloadTraceButton.style.visibility="hidden";const s=e.buttonText||L(I.stop);this.button=Ya(s,t,{jslogContext:"timeline.stop-recording"}),this.button.disabled=!!e.buttonDisabled,n.append(this.downloadTraceButton),n.append(this.button)}finish(){this.stopTimer(),this.button.disabled=!0}async#t(){if(!this.#e||this.#e.length===0)return;const t=`Trace-Load-Error-${nl(new Date)}.json`,i=ka(this.#e,{}),n=Array.from(i).join("");await As.instance().save(t,n,!0,!1),As.instance().close(t)}enableDownloadOfEvents(e){this.#e=e,this.downloadTraceButton.disabled=!1,this.downloadTraceButton.style.visibility="visible"}remove(){this.element.parentNode&&(this.element.parentNode.classList.remove("tinted"),this.arrangeDialog(this.element.parentNode)),this.stopTimer(),this.element.remove()}showPane(e){this.arrangeDialog(e),this.show(e),e.classList.add("tinted")}enableAndFocusButton(){this.button.disabled=!1,this.button.focus()}updateStatus(e){this.status.textContent=e}updateProgressBar(e,t){this.progressLabel.textContent=e,this.progressBar.style.width=t.toFixed(1)+"%",xu(this.progressBar,t),this.updateTimer()}startTimer(){this.startTime=Date.now(),this.timeUpdateTimer=window.setInterval(this.updateTimer.bind(this),1e3),this.updateTimer()}stopTimer(){this.timeUpdateTimer&&(clearInterval(this.timeUpdateTimer),this.updateTimer(),delete this.timeUpdateTimer)}updateTimer(){if(this.arrangeDialog(this.element.parentNode),!this.timeUpdateTimer||!this.time)return;const e=(Date.now()-this.startTime)/1e3;this.time.textContent=L(I.ssec,{PH1:Math.round(e)})}arrangeDialog(e){const t=e.clientWidth<325;this.element.classList.toggle("small-dialog",t),this.contentElement.classList.toggle("small-dialog",t)}wasShown(){super.wasShown(),this.registerCSSFiles([hd])}}let Mr;class Fa{static instance(e={forceNew:null}){const{forceNew:t}=e;return(!Mr||t)&&(Mr=new Fa),Mr}handleQueryParam(e){sl.instance().showView("timeline").then(async()=>{await Xe.instance().loadFromURL(window.decodeURIComponent(e))})}}class Zg{async reveal(e){await sl.instance().showView("timeline"),Xe.instance().loadFromEvents(e.traceEvents)}}class Qg{handleAction(e,t){const i=e.flavor(Xe);if(i===null)return!1;switch(t){case"timeline.toggle-recording":return i.toggleRecording(),!0;case"timeline.record-reload":return i.recordReload(),!0;case"timeline.save-to-file":return i.saveToFile(),!0;case"timeline.load-from-file":return i.selectFileToLoad(),!0;case"timeline.jump-to-previous-frame":return i.jumpToFrame(-1),!0;case"timeline.jump-to-next-frame":return i.jumpToFrame(1),!0;case"timeline.show-history":return i.showHistoryDropdown(),!0;case"timeline.previous-recording":return i.navigateHistory(1),!0;case"timeline.next-recording":return i.navigateHistory(-1),!0}return!1}}const uv=Object.freeze(Object.defineProperty({__proto__:null,ActionDelegate:Qg,LoadTimelineHandler:Fa,StatusPane:Es,TimelinePanel:Xe,TraceRevealer:Zg,headerHeight:Jg,rowHeight:Xg},Symbol.toStringTag,{value:"Module"}));let pn;class pi{#e=null;#t=new Map;static instance(){return pn||(pn=new pi,pn)}static removeInstance(){pn=void 0}getExtensionData(){if(!Xe.extensionDataVisibilitySetting().get()||!this.#e||!this.#e.ExtensionTraceData)return{extensionMarkers:[],extensionTrackData:[],entryToNode:new Map};const t=this.#t.get(this.#e);return t||this.#e.ExtensionTraceData}saveCurrentModelData(){this.#e&&!this.#t.has(this.#e)&&this.#t.set(this.#e,this.getExtensionData())}modelChanged(e){e!==this.#e&&(this.#e!==null&&this.saveCurrentModelData(),this.#e=e)}}const pv=Object.freeze(Object.defineProperty({__proto__:null,ExtensionDataGatherer:pi},Symbol.toStringTag,{value:"Module"})),Qr={customTrackDescription:"This is a custom track added by a third party.",customTrackName:"{PH1} â€” Custom track"},ef=A("panels/timeline/ExtensionTrackAppender.ts",Qr),xo=N.bind(void 0,ef);class pd{appenderName="Extension";#e;#t;constructor(e,t){this.#e=t,this.#t=e}appendTrackAtLevel(e,t){return Object.values(this.#e.entriesByTrack).reduce((n,s)=>s.length+n,0)===0?e:(this.#i(e,t),this.#s(e))}#i(e,t){const i=it({shareHeaderLine:!1,collapsible:!0}),n=xo(Qr.customTrackName,{PH1:this.#e.name}),s=nt("extension",e,n,i,!0,t);s.description=xo(Qr.customTrackDescription),this.#t.registerTrackForGroup(s,this)}#n(e,t){const i=it({shareHeaderLine:!1,padding:2,nestingLevel:1,collapsible:!0}),n=nt("extension",e,t,i,!0);this.#t.registerTrackForGroup(n,this)}#s(e){let t=e;for(const[i,n]of Object.entries(this.#e.entriesByTrack))this.#e.isTrackGroup&&this.#n(t,i),t=this.#t.appendEventsAtLevel(n,t,this);return t}colorForEvent(e){const t=ie.instance().getComputedValue("--app-color-rendering");return pt(e)?_n(e):t}titleForEvent(e){return e.name}highlightedEntryInfo(e){return{title:pt(e)&&e.args.tooltipText?e.args.tooltipText:this.titleForEvent(e),formattedTime:hi(e.dur)}}}const mv=Object.freeze(Object.defineProperty({__proto__:null,ExtensionTrackAppender:pd},Symbol.toStringTag,{value:"Module"})),md={gpu:"GPU"},tf=A("panels/timeline/GPUTrackAppender.ts",md),nf=N.bind(void 0,tf);class gd{appenderName="GPU";#e;#t;constructor(e,t){this.#e=e,this.#t=t}appendTrackAtLevel(e,t){const i=this.#t.GPU.mainGPUThreadTasks;return i.length===0?e:(this.#i(e,t),this.#e.appendEventsAtLevel(i,e,this))}#i(e,t){const i=it({collapsible:!1}),n=nt("gpu",e,nf(md.gpu),i,!0,t);this.#e.registerTrackForGroup(n,this)}colorForEvent(e){if(!Pu(e))throw new Error(`Unexpected GPU Task: The event's type is '${e.name}'`);return ie.instance().getComputedValue("--app-color-painting")}}const gv=Object.freeze(Object.defineProperty({__proto__:null,GPUTrackAppender:gd},Symbol.toStringTag,{value:"Module"})),fd={interactions:"Interactions"},sf=A("panels/timeline/InteractionsTrackAppender.ts",fd),rf=N.bind(void 0,sf);class vd{appenderName="Interactions";#e;#t;#i;constructor(e,t,i){this.#t=e,this.#e=i,this.#i=t}appendTrackAtLevel(e,t){return this.#i.UserInteractions.interactionEvents.length===0?e:(this.#n(e,t),this.#s(e))}#n(e,t){const i=this.#i.UserInteractions.interactionEvents.length>0,n=it({collapsible:i,useDecoratorsForOverview:!0}),s=nt("interactions",e,rf(fd.interactions),n,!0,t);this.#t.registerTrackForGroup(s,this)}#s(e){const{interactionEventsWithNoNesting:t,interactionsOverThreshold:i}=this.#i.UserInteractions,n=(r,o)=>{i.has(r)&&o!==void 0&&this.#r(r,o)};return this.#t.appendEventsAtLevel(t,e,this,n)}#r(e,t){const i=this.#t.getFlameChartTimelineData().entryDecorations[t]||[];i.push({type:"CANDY",startAtTime:Gu,endAtTime:e.processingEnd},{type:"WARNING_TRIANGLE",customEndTime:e.processingEnd}),this.#t.getFlameChartTimelineData().entryDecorations[t]=i}colorForEvent(e){let t=Ge(e,this.#i);return Ni(e)&&(t+=e.interactionId),this.#e.colorForID(t)}highlightedEntryInfo(e){if(Ni(e)){const t=new Il;return t.entry=e,{title:"",formattedTime:"",additionalElement:t}}return{title:"",formattedTime:""}}}const fv=Object.freeze(Object.defineProperty({__proto__:null,InteractionsTrackAppender:vd},Symbol.toStringTag,{value:"Module"})),kn={layoutShifts:"Layout shifts",layoutShiftCluster:"Layout shift cluster",layoutShift:"Layout shift"},af=A("panels/timeline/LayoutShiftsTrackAppender.ts",kn),ps=N.bind(void 0,af),yd=_(5e3);class ur{appenderName="LayoutShifts";#e;#t;constructor(e,t){this.#e=e,this.#t=t}appendTrackAtLevel(e,t){return this.#t.LayoutShifts.clusters.length===0?e:(this.#i(e,t),this.#n(e))}#i(e,t){const i=it({collapsible:!1}),n=nt("layout-shifts",e,ps(kn.layoutShifts),i,!0,t);this.#e.registerTrackForGroup(n,this)}#n(e){const t=this.#t.LayoutShifts.clusters.flatMap(i=>i.events);if(ne.isEnabled("timeline-rpp-sidebar")){const i=this.#t.LayoutShifts.clusters;this.#e.appendEventsAtLevel(i,e,this)}return this.preloadScreenshots(t),this.#e.appendEventsAtLevel(t,e,this)}colorForEvent(e){const t=ie.instance().getComputedValue("--app-color-rendering");if(gn(e)){const i=Cs(t);if(i)return i.setAlpha(.5).asString("rgba")}return t}titleForEvent(e){return on(e)?ps(kn.layoutShift):""}highlightedEntryInfo(e){const t=on(e)?e.args.data?.weighted_score_delta??0:gn(e)?e.clusterCumulativeScore:-1,i=on(e)?ps(kn.layoutShift):gn(e)?ps(kn.layoutShiftCluster):e.name;let n;if(Ai(e)){const s=new Ru(510,400),r=ur.createShiftViz(e,this.#t,s);r&&(n=r)}return{title:i,formattedTime:t.toFixed(4),additionalElement:n}}getDrawOverride(e){if(!ne.isEnabled("timeline-rpp-sidebar")&&on(e))return(t,i,n,s,r,o)=>{const l=$(_(e.ts+yd)),c=o(l)-i;return t.fillStyle=this.colorForEvent(e),t.fillRect(i,n,c-.5,r-1),{x:i,width:c}};if(on(e)){const t=e.args.data?.weighted_score_delta||0,i=1-Math.min(t/.1,1);return(n,s,r,o,l)=>{const d=l/3,c=i*d,h=l,u=h/2;return n.save(),n.beginPath(),n.moveTo(s,r+c),n.lineTo(s+u-c,r+u),n.lineTo(s,r+l-c),n.lineTo(s-u+c,r+u),n.closePath(),n.fillStyle=this.colorForEvent(e),n.fill(),n.restore(),{x:s-u,width:h}}}if(gn(e))return(t,i,n,s,r)=>{const o=r*.2,l=n+(r-o)/2+.5;return t.fillStyle=this.colorForEvent(e),t.fillRect(i,l,s-.5,o-1),{x:i,width:s,z:-1}}}preloadScreenshots(e){const t=new Set;for(const n of e){const s=n.parsedData.screenshots;s.before&&t.add(s.before),s.after&&t.add(s.after)}const i=Array.from(t);return Lu(i)}static createShiftViz(e,t,i){const n=e.parsedData.screenshots,{viewportRect:s,devicePixelRatio:r}=t.Meta,o=document.createElement("div");o.classList.add("layout-shift-viz");const l=n.before&&Wr(n.before),d=n.after&&Wr(n.after);if(!l||!d||!s||r===void 0)return;const c=E=>new DOMRect(E[0]/r,E[1]/r,E[2]/r,E[3]/r),h=Math.min(l.naturalWidth/s.width,l.naturalHeight/s.height,1),u=Math.min(i.width/l.naturalWidth,i.height/l.naturalHeight,1);for(const E of[o,d,l])E.style.width=`${l.naturalWidth*u}px`,E.style.height=`${l.naturalHeight*u}px`;const m=e.args.data?.impacted_nodes?.map(E=>c(E.old_rect))??[],v=e.args.data?.impacted_nodes?.map(E=>c(E.new_rect))??[];function T(){if(!l||!d)return;[l,d].flatMap(x=>x.getAnimations()).forEach(x=>x.cancel());const E="ease-out",U={duration:3e3,iterations:1/0,fill:"forwards",easing:E};d.animate({opacity:[0,0,1,1,1],easing:E},U);const w=x=>({left:`${x.x*u*h}px`,top:`${x.y*u*h}px`,width:`${x.width*u*h}px`,height:`${x.height*u*h}px`,opacity:.7,outlineWidth:"1px",easing:E});m.forEach((x,C)=>{const W=v[C],O=document.createElement("div");O.classList.add("layout-shift-viz-rect"),o.appendChild(O);let j=w(x),S=w(W);S.opacity=.4,[x.width,x.height,x.x,x.y].every(k=>k===0)&&(j={...S},j.opacity="0"),[W.width,W.height,W.x,W.y].every(k=>k===0)&&(S={...j},S.opacity="0"),O.animate([j,j,{...S,outlineWidth:"4px"},S,S],U)})}return D(o,()=>T()),o.append(l,d),o}}const vv=Object.freeze(Object.defineProperty({__proto__:null,LAYOUT_SHIFT_SYNTHETIC_DURATION:yd,LayoutShiftsTrackAppender:ur},Symbol.toStringTag,{value:"Module"})),ea={serverTimingTrack:"This track contains timings taken from Server-Timing network response headers. Their respective start times are only estimated and may not be accurate.",serverSideTrack:"Server Timings â€” {PH1}"},of=A("panels/timeline/ServerTimingsTrackAppender.ts",ea),Io=N.bind(void 0,of);class bd{appenderName="ServerTimings";#e;#t;constructor(e,t){this.#e=t,this.#t=e}appendTrackAtLevel(e,t){if(!ne.isEnabled("timeline-server-timings")||this.#e.ServerTimings.serverTimings.length===0)return e;let i=e;const n=Object.groupBy(this.#e.ServerTimings.serverTimings,s=>s.args.data.origin);for(const[s,r]of Object.entries(n))!r||r.length===0||(this.#i(i,s,t),i=this.#n(i,r));return i}#i(e,t,i){const n=it({shareHeaderLine:!1,collapsible:!0}),s=Io(ea.serverSideTrack,{PH1:t}),r=nt("server.timings",e,s,n,!0,i);r.description=Io(ea.serverTimingTrack),this.#t.registerTrackForGroup(r,this)}#n(e,t){let i=e;return i=this.#t.appendEventsAtLevel(t,i,this),i}colorForEvent(){return ie.instance().getComputedValue("--ref-palette-primary70")}titleForEvent(e){return e.name}highlightedEntryInfo(e){return{title:e.name,formattedTime:hi(e.dur)}}}const yv=Object.freeze(Object.defineProperty({__proto__:null,ServerTimingsTrackAppender:bd},Symbol.toStringTag,{value:"Module"})),wd={timings:"Timings"},lf=A("panels/timeline/TimingsTrackAppender.ts",wd),cf=N.bind(void 0,lf),ta={navigationStart:0,MarkLoad:1,firstContentfulPaint:2,firstPaint:2,MarkDOMContent:3,"largestContentfulPaint::Candidate":4};class Td{appenderName="Timings";#e;#t;#i;#n=null;constructor(e,t,i){this.#t=e,this.#e=i,this.#i=t}appendTrackAtLevel(e,t){const i=pi.instance().getExtensionData().extensionMarkers,n=this.#i.PageLoadMetrics.allMarkerEvents,s=i.length===0,r=this.#i.UserTimings.performanceMarks.filter(h=>!Ja(h)),o=this.#i.UserTimings.performanceMeasures.filter(h=>!Ja(h)),l=this.#i.UserTimings.timestampEvents,d=this.#i.UserTimings.consoleTimings;if(s&&n.length===0&&r.length===0&&o.length===0&&l.length===0&&d.length===0)return e;this.#s(e,t);let c=this.#o(e);return c=this.#t.appendEventsAtLevel(r,c,this),c=this.#t.appendEventsAtLevel(o,c,this),c=this.#t.appendEventsAtLevel(l,c,this),this.#t.appendEventsAtLevel(d,c,this)}#s(e,t){const i=this.#i.UserTimings.performanceMeasures.length>0,n=it({useFirstLineForOverview:!0,collapsible:i}),s=nt("timings",e,cf(wd.timings),n,!0,t);this.#t.registerTrackForGroup(s,this)}#r(e){e.sort((t,i)=>{const n=ta[t.name]??1/0,s=ta[i.name]??1/0;return n-s})}#a(e){if(this.#n)return this.#n;const t=new Map;e.forEach(i=>{const n=t.get(i.ts)||[];n.push(i),t.set(i.ts,n)});for(const i of t.values())i.length>1&&this.#r(i);return this.#n=t,this.#n}#o(e){let t=this.#i.PageLoadMetrics.allMarkerEvents;if(t=t.concat(pi.instance().getExtensionData().extensionMarkers).sort((r,o)=>r.ts-o.ts),t.length===0)return e;const i=this.#a(t);for(const r of i.values())for(const o of r){const l=this.#t.appendEventAtLevel(o,e,this);this.#t.getFlameChartTimelineData().entryTotalTimes[l]=Number.NaN}const n=$(this.#i.Meta.traceBounds.min),s=t.map(r=>{const o=$(r.ts),l=pt(r)?this.markerStyleForExtensionMarker(r):this.markerStyleForPageLoadEvent(r);return new td(o,o-n,l)});return this.#t.getFlameChartTimelineData().markers.push(...s),++e}markerStyleForPageLoadEvent(e){const t=[6,4];let i="",n="grey";return Yo(e)&&(n="#0867CB",i="DCL"),Xo(e)&&(n="#B31412",i="L"),Ko(e)&&(n="#228847",i="FP"),qo(e)&&(n="#1A6937",i="FCP"),sa(e)&&(n="#1A3422",i="LCP"),Au(e)&&(n="#FF9800",i=""),{title:i,dashStyle:t,lineWidth:.5,color:n,tall:!0,lowPriority:!1}}markerStyleForExtensionMarker(e){const t=[6,4],i=e.name,n=_n(e);return{title:i,dashStyle:t,lineWidth:.5,color:n,tall:!0,lowPriority:!1}}colorForEvent(e){return Xa(e)?this.markerStyleForPageLoadEvent(e).color:pt(e)?_n(e):this.#e.colorForID(e.name)}titleForEvent(e){if(Xa(e))switch(e.name){case"MarkDOMContent":return"DCL";case"MarkLoad":return"L";case"firstContentfulPaint":return"FCP";case"firstPaint":return"FP";case"largestContentfulPaint::Candidate":return"LCP";case"navigationStart":return"";default:return e.name}return xs(e)?`${e.name}: ${e.args.data.message}`:Ps(e)?`[mark]: ${e.name}`:e.name}highlightedEntryInfo(e){const t=pt(e)&&e.args.tooltipText?e.args.tooltipText:this.titleForEvent(e);if(Uo(e)||Ps(e)||xs(e)){const i=jo(e,this.#i.Meta.traceBounds,this.#i.Meta.navigationsByNavigationId,this.#i.Meta.navigationsByFrameId);return{title:t,formattedTime:hi(i)}}return{title:t,formattedTime:hi(e.dur)}}}const bv=Object.freeze(Object.defineProperty({__proto__:null,SORT_ORDER_PAGE_LOAD_MARKERS:ta,TimingsTrackAppender:Td},Symbol.toStringTag,{value:"Module"}));function pr(a,e){if(e&&e.Meta.traceIsGeneric||Ho(a))return!0;if(Nu(a)||Fu(a))return ne.isEnabled("timeline-show-postmessage-events");if(pt(a)||Vo(a))return!0;const t=tn(a.name),i=Mu(a)||Du(a)||Ps(a);return t&&!t.hidden||i}const ia=["Animations","Timings","Interactions","GPU","LayoutShifts","Thread","Thread_AuctionWorklet","Extension","ServerTimings"];class Sd{#e=new Map;#t=new Map;#i=new Map;#n=new Map;#s;#r;#a;#o;#l=[];#p=new Set([...ia]);#h;#d;#u;#c;#m;#g;#v=[];#f;constructor(e,t,i,n){this.#s=e,this.#r=t,this.#a=i,this.#o=new ua({min:30,max:55,count:void 0},{min:70,max:100,count:6},50,.7),this.#h=n,this.#d=new Td(this,this.#r,this.#o),this.#l.push(this.#d),this.#c=new vd(this,this.#r,this.#o),this.#l.push(this.#c),this.#u=new vl(this,this.#r),this.#l.push(this.#u),this.#m=new gd(this,this.#r),this.#l.push(this.#m),this.#g=new ur(this,this.#r),this.#l.push(this.#g),this.#f=new bd(this,this.#r),this.#l.push(this.#f),this.#b(),this.#w(),this.onThemeChange=this.onThemeChange.bind(this),ie.instance().addEventListener(Rs.eventName,this.onThemeChange)}reset(){ie.instance().removeEventListener(Rs.eventName,this.onThemeChange)}setFlameChartDataAndEntryData(e,t,i){this.#t.clear(),this.#s=e,this.#a=t,this.#h=i}getFlameChartTimelineData(){return this.#s}onThemeChange(){for(const e of this.#s.groups)e.style.color=ie.instance().getComputedValue("--sys-color-on-surface"),e.style.backgroundColor=ie.instance().getComputedValue("--sys-color-cdt-base-container")}#w(){const e=pi.instance().getExtensionData().extensionTrackData;for(const t of e)this.#l.push(new pd(this,t))}#b(){const e=s=>{switch(s.threadType){case"MAIN_THREAD":{if(s.isOnMainFrame){const r=s.getUrl();return r.startsWith("about:")||r.startsWith("chrome:")?2:0}return 1}case"WORKER":return 3;case"RASTERIZER":return 4;case"THREAD_POOL":return 5;case"AUCTION_WORKLET":return 6;case"OTHER":return 7;default:return 8}},t=al(this.#r),i=new Set,n=ne.isEnabled("timeline-show-all-events");for(const{pid:s,tid:r,name:o,type:l}of t){if(this.#r.Meta.traceIsGeneric){this.#v.push(new li(this,this.#r,s,r,o,"OTHER"));continue}if((o==="Chrome_ChildIOThread"||o==="Compositor"||o==="GpuMemoryThread")&&!n)continue;const d=this.#r.AuctionWorklets.worklets.get(s);if(!i.has(s)){if(d){i.add(s),this.#v.push(new li(this,this.#r,s,d.args.data.utilityThread.tid,"auction-worket-utility","AUCTION_WORKLET")),this.#v.push(new li(this,this.#r,s,d.args.data.v8HelperThread.tid,"auction-worklet-v8helper","AUCTION_WORKLET"));continue}this.#v.push(new li(this,this.#r,s,r,o,l))}}this.#v.sort((s,r)=>e(s)-e(r)||r.getEntries().length-s.getEntries().length),this.#l.push(...this.#v)}timingsTrackAppender(){return this.#d}animationsTrackAppender(){return this.#u}interactionsTrackAppender(){return this.#c}gpuTrackAppender(){return this.#m}layoutShiftsTrackAppender(){return this.#g}threadAppenders(){return this.#v}serverTimingsTrackAppender(){return this.#f}eventsInTrack(e){const t=this.#i.get(e);if(t)return t;let i=null,n=null;for(const[o,l]of this.#e)l===e&&(i===null&&(i=o),n=o);if(i===null||n===null)throw new Error(`Could not find events for track: ${e}`);const s=this.#s.entryLevels,r=[];for(let o=0;o<s.length;o++)i<=s[o]&&s[o]<=n&&r.push(this.#a[o]);return r.sort((o,l)=>o.ts-l.ts),this.#i.set(e,r),r}eventsForTreeView(e){const t=this.#n.get(e);if(t)return t;let i=this.eventsInTrack(e);return $u(i)||(i=i.filter(n=>!Go(n.ph))),this.#n.set(e,i),i}registerTrackForGroup(e,t){this.#s.groups.push(e),this.#t.set(e,t)}getCurrentTrackCountForThreadType(e){return this.#v.filter(t=>t.threadType===e&&t.headerAppended()).length}groupForAppender(e){let t=null;for(const[i,n]of this.#t)if(n===e){t=i;break}return t}groupEventsForTreeView(e){const t=this.#t.get(e);return t?this.eventsForTreeView(t):null}registerTrackForLevel(e,t){this.#e.set(e,t)}groupForLevel(e){const t=this.#e.get(e);return t?this.groupForAppender(t):null}appendEventAtLevel(e,t,i){this.#e.set(t,i);const n=this.#a.length;this.#a.push(e),this.#h[t]="TrackAppender",this.#s.entryLevels[n]=t,this.#s.entryStartTimes[n]=$(e.ts);const s=e.dur||ee(Hs);return this.#s.entryTotalTimes[n]=$(s),n}appendEventsAtLevel(e,t,i,n){const s=[];for(let r=0;r<e.length;++r){const o=e[r];if(!pr(o,this.#r))continue;const l=Fs(o,s),d=this.appendEventAtLevel(o,t+l,i);n?.(o,d)}return this.#h.length=t+s.length,this.#h.fill("TrackAppender",t),t+s.length}allVisibleTrackAppenders(){return this.#l.filter(e=>this.#p.has(e.appenderName))}allThreadAppendersByProcess(){const e=this.allVisibleTrackAppenders(),t=new Map;for(const i of e){if(!(i instanceof li))continue;const n=t.get(i.processId())??[];n.push(i),t.set(i.processId(),n)}return t}setVisibleTracks(e){if(!e){this.#p=new Set([...ia]);return}this.#p=e}getDrawOverride(e,t){const i=this.#e.get(t);if(!i)throw new Error("Track not found for level");return i.getDrawOverride?.(e)}colorForEvent(e,t){const i=this.#e.get(t);if(!i)throw new Error("Track not found for level");return i.colorForEvent(e)}titleForEvent(e,t){const i=this.#e.get(t);if(!i)throw new Error("Track not found for level");return i.titleForEvent?i.titleForEvent(e):Ge(e,this.#r)}highlightedEntryInfo(e,t){const i=this.#e.get(t);if(!i)throw new Error("Track not found for level");const n=Tl(e,this.#r);let s=this.titleForEvent(e,t),r=hi(e.dur),o;if(i.highlightedEntryInfo){const{title:l,formattedTime:d,warningElements:c,additionalElement:h}=i.highlightedEntryInfo(e);l&&(s=l),d&&(r=d),c&&n.push(...c),o=h}return{title:s,formattedTime:r,warningElements:n,additionalElement:o}}}const wv=Object.freeze(Object.defineProperty({__proto__:null,CompatibilityTracksAppender:Sd,TrackNames:ia,entryIsVisibleInTimeline:pr},Symbol.toStringTag,{value:"Module"}));export{Nf as A,Df as B,$f as C,jf as D,Of as E,Bf as F,gv as G,Pf as H,Rf as I,Yf as J,qf as K,vv as L,_f as M,nv as N,bv as O,dv as P,Xe as Q,Lf as S,zf as T,hv as U,Mf as a,Af as b,wv as c,Uf as d,Hf as e,Xf as f,pv as g,mv as h,ev as i,fv as j,Wf as k,yv as l,tv as m,Vf as n,Qf as o,av as p,Kf as q,iv as r,sv as s,rv as t,ov as u,Jf as v,lv as w,cv as x,Zf as y,uv as z};
//# sourceMappingURL=CompatibilityTracksAppender-Bm26C5B2.js.map
