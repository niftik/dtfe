import{i2 as ko,aq as Xi,h as qt,dp as Ce,i3 as Gt,i4 as Lo,b as M,g as N,bo as Po,cq as Fo,bJ as Xs,eD as Mo,cC as Ao,ei as Ss,eh as No,fD as Do,fE as Ro,ag as se,i5 as Oo,i6 as Bo,i7 as Qs,i8 as Uo,df as Qi,bA as Z,dG as Vo,eg as Et,bO as Zs,fA as jo,X as Wo,U as Ho,I as oe,db as $o,i9 as _o,aj as v,ia as zo,bE as xt,b2 as qo,ib as vs,l as Q,ic as Cs,id as Go,eX as en,bG as Zt,du as tn,e4 as sn,e5 as nn,aD as Zi,i as T,aE as W,cH as g,e9 as ft,ie as ee,ig as Yo,gf as es,e1 as Ko,ih as Jo,ii as on,ex as z,cc as Re,u as ne,A as Pe,r as Oe,ij as P,ik as X,b0 as Je,hK as Mi,aF as _,il as Xo,d_ as rn,eW as fe,bN as me,V as O,d$ as Qo,gY as Tt,fu as Ie,fv as _e,fy as De,im as an,fU as kt,fT as ts,io as Zo,fx as er,en as vt,fk as tr,av as b,ip as ir,_ as Lt,iq as sr,ir as nr,is as or,it as is,bu as rr,dd as ar,fw as U,ek as cr,iu as nt,aZ as lr,bT as dr,b$ as hr,dX as ws,bQ as bt,ea as ur,e3 as pr,aU as Be,c3 as cn,c7 as Xe,bq as ue,iv as mr,c4 as tt,cZ as Ai,cY as Yt,bp as ln,cA as ss,iw as gr,cb as ns,bz as Ct,fM as Is,ix as fr,cR as br,cD as it,aK as Sr,cM as dn,aL as ys,iy as Kt,iz as ri,at as te,iA as vr,iB as ai,iC as Cr,iD as wr,iE as Ir,ay as yr,iF as Er,iG as Es,a as Me,bi as hn,f5 as xr,iH as Jt,ax as Ae,iI as xs,cw as Ts,iJ as we,au as Y,dj as Ne,iK as Qe,iL as os,iM as Tr,cz as Xt,as as Ni,dn as kr,ar as Lr,eZ as un,iN as ht,iO as Ft,iP as pn,iQ as Pr,iR as rs,b4 as Fr,aJ as Se,aw as y,cB as wt,eO as ci,ec as Mr,iS as mn,bv as gn,dy as Ar,iT as Nr,ds as ks,iU as Dr,ba as fn,fW as Ze,cs as ut,iV as as,cG as bn,fO as Sn,Q as Di,iW as Rr,hd as Or,cj as Br,ck as Ls,iX as Ri,iY as Ur,fX as Vr,e6 as jr,e8 as Wr,iZ as cs,i_ as Ps,g2 as Hr,dw as $,dP as $r,bd as _r,cd as Mt,i$ as zr,f2 as li,bM as Fs,f0 as qr,j0 as Gr,b1 as Yr,j1 as vn,j2 as Cn,fo as di,eb as He,eL as Kr,c5 as Jr,j as wn,j3 as Xr,c2 as Qr,j4 as Zr,j5 as ea,j6 as At,c_ as Nt,fB as ta,j7 as ia,j8 as rt,cm as at,j9 as In,am as yn,hW as sa,dB as na,ja as oa,jb as ra,jc as aa,jd as ca,je as la,jf as da,jg as ha,fz as ua,jh as En,bS as Oi,ca as Bi,ji as pa,jj as ma,jk as ga,jl as fa,jm as ls,jn as ba,jo as xn,jp as Tn,jq as kn,bD as ei,d2 as Sa,jr as Ui,g7 as Ms,c$ as va,dU as Ca,c9 as wa,c6 as Ia,js as ya,eR as Ea,gT as xa}from"./inspector-CyOA7R9n.js";import{f as Ta}from"./ScriptFormatter-CdcZyJ9a.js";import{F as ka,S as pt,I as As,a as Ns,b as La,i as hi,L as Pa}from"./PreviewFactory-7rWtg079.js";import{P as Ln}from"./PopoverHelper-fEnxzApM.js";import{C as Fa,E as Ds,U as Rs}from"./coverage-nL5Jv5gw.js";import{S as Ma}from"./cssOverview.css-C_I9lWrq.js";import{a as Aa,b as Na,c as Da,B as Ra}from"./swatchPopover.css-CdLS3b97.js";import{B as Oa,F as Ba}from"./FloatingButton-ChdjBnjy.js";import{H as Os,B as Vi}from"./components-nB6c8Px-.js";import{D as Ua,T as Va}from"./DropTarget-DDkHhLsd.js";import{P as ja}from"./utils-C4_HKhgT.js";class ke{#e;#t;#i;#s;#n;constructor(e,t,i){this.#e=e,this.#t=t,this.#i=i;const{queries:s,fileRegexQueries:n}=ke.#o(e,t,i);this.#s=s,this.#n=n}static fromPlainObject(e){return new ke(e.query,e.ignoreCase,e.isRegex)}filePathMatchesFileQuery(e){return this.#n.every(({regex:t,shouldMatch:i})=>!!e.match(t)===i)}queries(){return this.#s}query(){return this.#e}ignoreCase(){return this.#t}isRegex(){return this.#i}toPlainObject(){return{query:this.query(),ignoreCase:this.ignoreCase(),isRegex:this.isRegex()}}static#o(e,t,i){const s=/"([^\\"]|\\.)+"/,n=/(\s*(?!-?f(ile)?:)[^\\ ]|\\.)+/,o=n.source+"(\\s+"+n.source+")*",r=["(\\s*"+Bs.source+"\\s*)","("+s.source+")","("+o+")"].join("|"),c=new RegExp(r,"g"),l=e.match(c)||[],d=[],h=[];for(const u of l){if(!u)continue;const p=ke.#c(u);if(p){const m=new RegExp(p.text,t?"i":"");h.push({regex:m,shouldMatch:p.shouldMatch})}else i?d.push(u):u.startsWith('"')&&u.endsWith('"')?d.push(ke.#a(u)):d.push(ke.#r(u))}return{queries:d,fileRegexQueries:h}}static#r(e){return e.replace(/\\(.)/g,"$1")}static#a(e){return e.substring(1,e.length-1).replace(/\\(.)/g,"$1")}static#c(e){const t=e.match(Bs);if(!t)return null;e=t[3];let i="";for(let n=0;n<e.length;++n){const o=e[n];o==="*"?i+=".*":o==="\\"?(++n,e[n]===" "&&(i+=" ")):(ko().indexOf(e.charAt(n))!==-1&&(i+="\\"),i+=e.charAt(n))}const s=!t[1];return{text:i,shouldMatch:s}}}const Bs=/(-)?f(ile)?:((?:[^\\ ]|\\.)+)/;class Wa extends Xi{#e;#t=new qt(5);#i=this.#s.bind(this);constructor(e){super(),this.#e=e,this.#e.debuggerModel.addEventListener(Ce.DebugInfoAttached,this.#n,this),this.#e.debuggerModel.sourceMapManager().addEventListener(Gt.SourceMapAttached,this.#o,this),this.#t.schedule(this.#i)}dispose(){this.#e.debuggerModel.removeEventListener(Ce.DebugInfoAttached,this.#n,this),this.#e.debuggerModel.sourceMapManager().removeEventListener(Gt.SourceMapAttached,this.#o,this),this.listeners?.clear()}async#s(){const e=await Lo(this.#e);this.dispatchEventToListeners("ScopeChainUpdated",new Ha(e))}#n(e){e.data===this.#e.script&&this.#t.schedule(this.#i)}#o(e){e.data.client===this.#e.script&&this.#t.schedule(this.#i)}}class Ha{scopeChain;constructor(e){this.scopeChain=e}}const Pn=new CSSStyleSheet;Pn.replaceSync(`/*
 * Copyright (c) 2015 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

:host {
  padding: 10px;
}

.widget {
  align-items: center;
}

label {
  white-space: nowrap;
}

input[type="text"].add-source-map {
  box-shadow: 0 0 0 1px var(--box-shadow-outline-color);
  font-size: inherit;
  margin: 0 8px 0 5px;
}

/*# sourceURL=dialog.css */
`);const Bt={sourceMapUrl:"Source map URL: ",debugInfoUrl:"DWARF symbols URL: ",add:"Add"},$a=M("panels/sources/AddSourceMapURLDialog.ts",Bt),ui=N.bind(void 0,$a);class $e extends Po{input;dialog;callback;constructor(e,t,i){super(!0),this.contentElement.createChild("label").textContent=e,this.input=Fo("add-source-map","text","url"),this.input.addEventListener("keydown",this.onKeyDown.bind(this),!1),this.contentElement.appendChild(this.input);const s=Xs(ui(Bt.add),this.apply.bind(this),{jslogContext:"add"});this.contentElement.appendChild(s),this.dialog=new Mo(t),this.dialog.setSizeBehavior("MeasureContent"),this.dialog.setDefaultFocusedElement(this.input),this.callback=i}static createAddSourceMapURLDialog(e){return new $e(ui(Bt.sourceMapUrl),"add-source-map-url",e)}static createAddDWARFSymbolsURLDialog(e){return new $e(ui(Bt.debugInfoUrl),"add-debug-info-url",e)}show(){super.show(this.dialog.contentElement),this.dialog.show()}done(e){this.dialog.hide(),this.callback(e)}apply(){this.done(this.input.value)}onKeyDown(e){e.key==="Enter"&&(e.consume(!0),this.apply())}wasShown(){super.wasShown(),this.registerCSSFiles([Pn])}}const nd=Object.freeze(Object.defineProperty({__proto__:null,AddDebugInfoURLDialog:$e},Symbol.toStringTag,{value:"Module"})),Fn=new CSSStyleSheet;Fn.replaceSync(`/*
 * Copyright 2018 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

:host {
  z-index: 30;
  padding: 4px;
  background-color: var(--sys-color-surface3);
  border-radius: 7px;
  border: 2px solid var(--sys-color-divider);
  width: 90%;
  pointer-events: auto;
}

:host(.sources-edit-breakpoint-dialog) {
  border-radius: 0;
  z-index: 30;
  background-color: var(--sys-color-surface3);
  width: 555px;
  pointer-events: auto;
  margin-left: -1px;
  padding: 0 10px 10px 5px;
  border: 1px solid var(--sys-color-divider);
}

:host-context(.sources-edit-breakpoint-dialog) .condition-editor {
  background-color: var(--sys-color-cdt-base-container);
  margin: 0 6px 20px 3px;
}

:host-context(.sources-edit-breakpoint-dialog) .source-frame-breakpoint-toolbar {
  font-family: sans-serif;
  font-size: 12px;
}

:host-context(.sources-edit-breakpoint-dialog) .link,
.devtools-link {
  font-family: sans-serif;
  font-size: 12px;
  margin: 0 3px;
}

:host-context(.sources-edit-breakpoint-dialog) devtools-icon.link-icon {
  vertical-align: sub;
  margin-right: 0.5ch;
  color: var(--icon-link);
  width: 16px;
  height: 16px;
}

:host-context(.sources-edit-breakpoint-dialog) .link-wrapper {
  display: inline-flex;
}

:host-context(.sources-edit-breakpoint-dialog) .dialog-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

:host-context(.sources-edit-breakpoint-dialog) .dialog-header > devtools-icon:hover {
  color: var(--icon-default-hover);
}

/*# sourceURL=breakpointEditDialog.css */
`);const le={breakpointType:"Breakpoint type",breakpoint:"Breakpoint",closeDialog:"Close edit dialog and save changes",conditionalBreakpoint:"Conditional breakpoint",logpoint:"Logpoint",expressionToCheckBeforePausingEg:"Expression to check before pausing, e.g. x > 5",pauseOnlyWhenTheConditionIsTrue:"Pause only when the condition is true",learnMoreOnBreakpointTypes:"Learn more: Breakpoint Types",logMessageEgXIsX:"Log message, e.g. `'x is', x`",logAMessageToConsoleDoNotBreak:"Log a message to Console, do not break"},_a=M("panels/sources/BreakpointEditDialog.ts",le),ge=N.bind(void 0,_a);class Mn extends Ao{onFinish;finished;editor;typeSelector;placeholderCompartment;#e;#t;constructor(e,t,i,s){super(!0);const n=[Ss.javascriptLanguage,No(t||""),Do.instance(),Ro.instance(),se.lineWrapping,Oo,Bo,Ss.javascriptLanguage.data.of({autocomplete:E=>this.#t.historyCompletions(E)}),Qs(),Uo()];this.onFinish=s,this.finished=!1,this.element.tabIndex=-1,this.element.classList.add("sources-edit-breakpoint-dialog"),this.element.setAttribute("jslog",`${Qi("edit-breakpoint")}`);const o=this.contentElement.createChild("div","dialog-header"),r=new Z("source-frame-breakpoint-toolbar",o);r.appendText(`Line ${e+1}:`),this.typeSelector=new Vo(this.onTypeChanged.bind(this),ge(le.breakpointType),void 0,"type"),this.typeSelector.createOption(ge(le.breakpoint),"REGULAR_BREAKPOINT");const c=this.typeSelector.createOption(ge(le.conditionalBreakpoint),"CONDITIONAL_BREAKPOINT"),l=this.typeSelector.createOption(ge(le.logpoint),"LOGPOINT");this.typeSelector.select(i?l:c),r.appendToolbarItem(this.typeSelector);const d=t||"",h=E=>(Go(E.state.doc.toString()).then(re=>{re?this.finishEditing(!0,this.editor.state.doc.toString()):Cs(E)}),!0),u=[{key:"ArrowUp",run:()=>this.#t.moveHistory(-1)},{key:"ArrowDown",run:()=>this.#t.moveHistory(1)},{mac:"Ctrl-p",run:()=>this.#t.moveHistory(-1,!0)},{mac:"Ctrl-n",run:()=>this.#t.moveHistory(1,!0)},{key:"Mod-Enter",run:h},{key:"Enter",run:h},{key:"Shift-Enter",run:Cs},{key:"Escape",run:()=>(this.finishEditing(!1,""),!0)}];this.placeholderCompartment=new Et;const p=this.contentElement.appendChild(document.createElement("div"));p.classList.add("condition-editor"),p.setAttribute("jslog",`${Zs().track({change:!0})}`),this.editor=new jo(Wo.create({doc:d,selection:{anchor:0,head:d.length},extensions:[this.placeholderCompartment.of(this.getPlaceholder()),Ho.of(u),n]})),p.appendChild(this.editor);const m=new oe;m.name="cross",m.title=ge(le.closeDialog),m.setAttribute("jslog",`${$o().track({click:!0})}`),m.onclick=()=>this.finishEditing(!0,this.editor.state.doc.toString()),o.appendChild(m),this.#e=new _o(v.instance().createLocalSetting("breakpoint-condition-history",[])),this.#t=new zo(this.editor,this.#e);const f=this.contentElement.appendChild(document.createElement("div"));f.classList.add("link-wrapper");const w=xt`<x-link class="link devtools-link" tabindex="0" href="https://goo.gle/devtools-loc"
                                          jslog="${qo("learn-more")}">${ge(le.learnMoreOnBreakpointTypes)}</x-link>`,V=new oe;V.name="open-externally",V.classList.add("link-icon"),w.prepend(V),f.appendChild(w),this.updateTooltip()}saveAndFinish(){this.finishEditing(!0,this.editor.state.doc.toString())}focusEditor(){this.editor.editor.focus()}onTypeChanged(){if(this.breakpointType==="REGULAR_BREAKPOINT"){this.finishEditing(!0,"");return}this.focusEditor(),this.editor.dispatch({effects:this.placeholderCompartment.reconfigure(this.getPlaceholder())}),this.updateTooltip()}get breakpointType(){const e=this.typeSelector.selectedOption();return e?e.value:null}getPlaceholder(){const e=this.breakpointType;return e==="CONDITIONAL_BREAKPOINT"?vs(ge(le.expressionToCheckBeforePausingEg)):e==="LOGPOINT"?vs(ge(le.logMessageEgXIsX)):[]}updateTooltip(){const e=this.breakpointType;e==="CONDITIONAL_BREAKPOINT"?Q.install(this.typeSelector.element,ge(le.pauseOnlyWhenTheConditionIsTrue)):e==="LOGPOINT"&&Q.install(this.typeSelector.element,ge(le.logAMessageToConsoleDoNotBreak))}finishEditing(e,t){if(this.finished)return;this.finished=!0,this.editor.remove(),this.#e.pushHistoryItem(t);const i=this.breakpointType==="LOGPOINT";this.onFinish({committed:e,condition:t,isLogpoint:i})}wasShown(){super.wasShown(),this.registerCSSFiles([Fn])}get editorForTest(){return this.editor}}const od=Object.freeze(Object.defineProperty({__proto__:null,BreakpointEditDialog:Mn},Symbol.toStringTag,{value:"Module"})),An=new CSSStyleSheet;An.replaceSync(`/*
 * Copyright 2016 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

.call-frame-warnings-message {
  text-align: center;
  font-style: italic;
  padding: 4px;
  color: var(--sys-color-on-surface-yellow);
  background-color: var(--sys-color-surface-yellow);
}

.ignore-listed-message {
  padding: 1px;
}

.ignore-listed-message-label {
  color: var(--sys-color-token-subtle);
  align-items: center;
  display: flex;
}

.show-more-message > .link {
  margin-left: 5px;
}

.show-more-message {
  text-align: center;
  font-style: italic;
  padding: 4px;
  border-top: 1px solid var(--sys-color-divider);
}

.call-frame-item {
  padding: 3px 8px 3px 20px;
  position: relative;
  min-height: 18px;
  line-height: 15px;
  display: flex;
  flex-wrap: wrap;
}

.call-frame-title-text {
  text-overflow: ellipsis;
  overflow: hidden;
}

.async-header + .call-frame-item {
  border-top: 0;
}

.call-frame-item:not(.async-header) {
  border-top: 1px solid var(--sys-color-divider);
}

.call-frame-item-title,
.call-frame-location {
  display: flex;
  white-space: nowrap;
}

.async-header .call-frame-item-title {
  font-weight: bold;
  color: var(--sys-color-on-surface);
  background-color: var(--sys-color-cdt-base-container);
  margin-left: -5px;
  padding: 0 5px;
  z-index: 1;
}

.call-frame-item:focus-visible,
.call-frame-item.async-header:focus-visible .call-frame-item-title {
  background-color: var(--sys-color-tonal-container);
}

.ignore-listed-checkbox:focus-visible {
  outline-width: unset;
}

.call-frame-item:not(.async-header):hover {
  background-color: var(--sys-color-state-hover-on-subtle);
}

.call-frame-location {
  color: var(--sys-color-token-subtle);
  margin-left: auto;
  padding: 0 10px;
}

.async-header::before {
  content: " ";
  width: 100%;
  border-top: 1px solid var(--sys-color-divider);
  margin-top: 8px;
  position: absolute;
  left: 0;
}

.ignore-listed-call-frame {
  opacity: 60%;
  font-style: italic;
}

.selected-call-frame-icon {
  display: none;
  position: absolute;
  top: 3px;
  left: 4px;
}

.call-frame-item.selected .selected-call-frame-icon {
  display: block;
}

.call-frame-warning-icon {
  display: block;
  position: absolute;
  top: 3px;
  right: 4px;
}

@media (forced-colors: active) {
  .call-frame-item:focus-visible,
  .call-frame-item:not(.async-header):hover {
    forced-color-adjust: none;
    background-color: Highlight;
  }

  .call-frame-item:focus-visible *,
  .call-frame-item:not(.async-header):hover * {
    color: HighlightText;
  }
}

/*# sourceURL=callStackSidebarPane.css */
`);const be={callStack:"Call Stack",notPaused:"Not paused",onIgnoreList:"on ignore list",showIgnorelistedFrames:"Show ignore-listed frames",showMore:"Show more",copyStackTrace:"Copy stack trace",callFrameWarnings:"Some call frames have warnings",debugFileNotFound:'Failed to load debug file "{PH1}".',restartFrame:"Restart frame"},za=M("panels/sources/CallStackSidebarPane.ts",be),ye=N.bind(void 0,za);let pi;class st extends en{ignoreListMessageElement;ignoreListCheckboxElement;notPausedMessageElement;callFrameWarningsElement;items;list;showMoreMessageElement;showIgnoreListed;locationPool;updateThrottler;maxAsyncStackChainDepth;updateItemThrottler;scheduledForUpdateItems;muteActivateItem;lastDebuggerModel=null;constructor(){super(ye(be.callStack),!0,"sources.callstack"),this.contentElement.setAttribute("jslog",`${Zt("sources.callstack")}`),{element:this.ignoreListMessageElement,checkbox:this.ignoreListCheckboxElement}=this.createIgnoreListMessageElementAndCheckbox(),this.contentElement.appendChild(this.ignoreListMessageElement),this.notPausedMessageElement=this.contentElement.createChild("div","gray-info-message"),this.notPausedMessageElement.textContent=ye(be.notPaused),this.notPausedMessageElement.tabIndex=-1,this.callFrameWarningsElement=this.contentElement.createChild("div","call-frame-warnings-message");const e=new oe;e.data={iconName:"warning-filled",color:"var(--icon-warning)",width:"14px",height:"14px"},e.classList.add("call-frame-warning-icon"),this.callFrameWarningsElement.appendChild(e),this.callFrameWarningsElement.appendChild(document.createTextNode(ye(be.callFrameWarnings))),this.callFrameWarningsElement.tabIndex=-1,this.items=new tn,this.list=new sn(this.items,this,nn.NonViewport),this.contentElement.appendChild(this.list.element),this.list.element.addEventListener("contextmenu",this.onContextMenu.bind(this),!1),self.onInvokeElement(this.list.element,t=>{const i=this.list.itemForNode(t.target);i&&(this.activateItem(i),t.consume(!0))}),this.showMoreMessageElement=this.createShowMoreMessageElement(),this.showMoreMessageElement.classList.add("hidden"),this.contentElement.appendChild(this.showMoreMessageElement),this.showIgnoreListed=!1,this.locationPool=new Zi,this.updateThrottler=new qt(100),this.maxAsyncStackChainDepth=mt,this.update(),this.updateItemThrottler=new qt(100),this.scheduledForUpdateItems=new Set,T.instance().addModelListener(W,Ce.DebugInfoAttached,this.debugInfoAttached,this)}static instance(e={forceNew:null}){const{forceNew:t}=e;return(!pi||t)&&(pi=new st),pi}flavorChanged(e){this.showIgnoreListed=!1,this.ignoreListCheckboxElement.checked=!1,this.maxAsyncStackChainDepth=mt,this.update()}debugInfoAttached(){this.update()}setSourceMapSubscription(e){this.lastDebuggerModel!==e&&(this.lastDebuggerModel&&this.lastDebuggerModel.sourceMapManager().removeEventListener(Gt.SourceMapAttached,this.debugInfoAttached,this),this.lastDebuggerModel=e,this.lastDebuggerModel&&this.lastDebuggerModel.sourceMapManager().addEventListener(Gt.SourceMapAttached,this.debugInfoAttached,this))}update(){this.updateThrottler.schedule(()=>this.doUpdate())}async doUpdate(){this.locationPool.disposeAll(),this.callFrameWarningsElement.classList.add("hidden");const e=g.instance().flavor(ft);if(this.setSourceMapSubscription(e?.debuggerModel??null),!e){this.notPausedMessageElement.classList.remove("hidden"),this.ignoreListMessageElement.classList.add("hidden"),this.showMoreMessageElement.classList.add("hidden"),this.items.replaceAll([]),g.instance().setFlavor(ee,null);return}this.notPausedMessageElement.classList.add("hidden");const t=[],i=new Set;for(const l of e.callFrames){const d=je.createForDebuggerCallFrame(l,this.locationPool,this.refreshItem.bind(this));t.push(d),l.missingDebugInfoDetails&&i.add(l.missingDebugInfoDetails.details)}const s=await Promise.all(t);i.size&&(this.callFrameWarningsElement.classList.remove("hidden"),Q.install(this.callFrameWarningsElement,Array.from(i).join(`
`)));let n=e.debuggerModel,o=e.asyncStackTraceId,r=e.asyncStackTrace,c=e.callFrames;for(let{maxAsyncStackChainDepth:l}=this;l>0;--l){if(!r){if(!o)break;if(o.debuggerId){const h=await W.modelForDebuggerId(o.debuggerId);if(!h)break;n=h}if(r=await n.fetchAsyncStackTrace(o),!r)break}const d=Yo(r.description,c);s.push(...await je.createItemsForAsyncStack(d,n,r.callFrames,this.locationPool,this.refreshItem.bind(this))),c=r.callFrames,o=r.parentId,r=r.parent}this.showMoreMessageElement.classList.toggle("hidden",!r),this.items.replaceAll(s);for(const l of this.items)this.refreshItem(l);if(this.maxAsyncStackChainDepth===mt){this.list.selectNextItem(!0,!1);const l=this.list.selectedItem();l&&this.activateItem(l)}this.updatedForTest()}updatedForTest(){}refreshItem(e){this.scheduledForUpdateItems.add(e),this.updateItemThrottler.schedule(async()=>{const t=Array.from(this.scheduledForUpdateItems);if(this.scheduledForUpdateItems.clear(),this.muteActivateItem=!0,!this.showIgnoreListed&&this.items.every(i=>i.isIgnoreListed)){this.showIgnoreListed=!0;for(let i=0;i<this.items.length;++i)this.list.refreshItemByIndex(i);this.ignoreListMessageElement.classList.toggle("hidden",!0)}else{this.showIgnoreListed=this.ignoreListCheckboxElement.checked;const i=new Set(t);let s=!1;for(let n=0;n<this.items.length;++n){const o=this.items.at(n);i.has(o)&&this.list.refreshItemByIndex(n),s=s||o.isIgnoreListed}this.ignoreListMessageElement.classList.toggle("hidden",!s)}delete this.muteActivateItem})}createElementForItem(e){const t=document.createElement("div");t.classList.add("call-frame-item");const s=t.createChild("div","call-frame-item-title").createChild("div","call-frame-title-text");if(s.textContent=e.title,e.isAsyncHeader)t.classList.add("async-header");else{Q.install(s,e.title);const c=t.createChild("div","call-frame-location");c.textContent=es(e.linkText,30),Q.install(c,e.linkText),t.classList.toggle("ignore-listed-call-frame",e.isIgnoreListed),e.isIgnoreListed&&Ko(t,ye(be.onIgnoreList)),e.frame||Jo(t,!0)}const n=e.frame,o=n===g.instance().flavor(ee);t.classList.toggle("selected",o),on(t,o),t.classList.toggle("hidden",!this.showIgnoreListed&&e.isIgnoreListed);const r=new oe;if(r.data={iconName:"large-arrow-right-filled",color:"var(--icon-arrow-main-thread)",width:"14px",height:"14px"},r.classList.add("selected-call-frame-icon"),t.appendChild(r),t.tabIndex=e===this.list.selectedItem()?0:-1,n&&n.missingDebugInfoDetails){const c=new oe;c.data={iconName:"warning-filled",color:"var(--icon-warning)",width:"14px",height:"14px"},c.classList.add("call-frame-warning-icon");const l=n.missingDebugInfoDetails.resources.map(d=>ye(be.debugFileNotFound,{PH1:z.extractName(d.resourceUrl)}));Q.install(c,[n.missingDebugInfoDetails.details,...l].join(`
`)),t.appendChild(c)}return t}heightForItem(e){return console.assert(!1),0}isItemSelectable(e){return!0}selectedItemChanged(e,t,i,s){i&&(i.tabIndex=-1),s&&(this.setDefaultFocusedElement(s),s.tabIndex=0,this.hasFocus()&&s.focus())}updateSelectedItemARIA(e,t){return!0}createIgnoreListMessageElementAndCheckbox(){const e=document.createElement("div");e.classList.add("ignore-listed-message");const t=e.createChild("label");t.classList.add("ignore-listed-message-label");const i=t.createChild("input");i.tabIndex=0,i.type="checkbox",i.classList.add("ignore-listed-checkbox"),t.append(ye(be.showIgnorelistedFrames));const s=()=>{this.showIgnoreListed=i.checked;for(const n of this.items)this.refreshItem(n)};return i.addEventListener("click",s),{element:e,checkbox:i}}createShowMoreMessageElement(){const e=document.createElement("div");e.classList.add("show-more-message"),e.createChild("span");const t=e.createChild("span","link");return t.textContent=ye(be.showMore),t.addEventListener("click",()=>{this.maxAsyncStackChainDepth+=mt,this.update()},!1),e}onContextMenu(e){const t=this.list.itemForNode(e.target);if(!t)return;const i=new Re(e),s=t.frame;s&&i.defaultSection().appendItem(ye(be.restartFrame),()=>{ne.actionTaken(Pe.StackFrameRestarted),s.restart()},{disabled:!s.canBeRestarted,jslogContext:"restart-frame"}),i.defaultSection().appendItem(ye(be.copyStackTrace),this.copyStackTrace.bind(this),{jslogContext:"copy-stack-trace"}),t.uiLocation&&this.appendIgnoreListURLContextMenuItems(i,t.uiLocation.uiSourceCode),i.show()}onClick(e){const t=this.list.itemForNode(e.target);t&&this.activateItem(t)}activateItem(e){const t=e.uiLocation;if(this.muteActivateItem||!t)return;this.list.selectItem(e);const i=e.frame,s=this.activeCallFrameItem();i&&s!==e?(i.debuggerModel.setSelectedCallFrame(i),g.instance().setFlavor(ee,i),s&&this.refreshItem(s),this.refreshItem(e)):Oe(t)}activeCallFrameItem(){const e=g.instance().flavor(ee);return e&&this.items.find(t=>t.frame===e)||null}appendIgnoreListURLContextMenuItems(e,t){const i=P.instance().binding(t);i&&(t=i.network);const s=e.section("ignoreList");if(!(s.items.length>0))for(const{text:n,callback:o,jslogContext:r}of X.instance().getIgnoreListURLContextMenuItems(t))s.appendItem(n,o,{jslogContext:r})}selectNextCallFrameOnStack(){const e=this.activeCallFrameItem(),t=e?this.items.indexOf(e)+1:0;for(let i=t;i<this.items.length;i++){const s=this.items.at(i);if(s.frame){this.activateItem(s);break}}}selectPreviousCallFrameOnStack(){const e=this.activeCallFrameItem(),t=e?this.items.indexOf(e)-1:this.items.length-1;for(let i=t;i>=0;i--){const s=this.items.at(i);if(s.frame){this.activateItem(s);break}}}copyStackTrace(){const e=[];for(const t of this.items){let i=t.title;t.uiLocation&&(i+=" ("+t.uiLocation.linkText(!0)+")"),e.push(i)}Je.copyText(e.join(`
`))}wasShown(){super.wasShown(),this.registerCSSFiles([An])}}const qa=Symbol("element"),mt=32;let Ga=class{handleAction(e,t){switch(t){case"debugger.next-call-frame":return st.instance().selectNextCallFrameOnStack(),!0;case"debugger.previous-call-frame":return st.instance().selectPreviousCallFrameOnStack(),!0}return!1}};class je{isIgnoreListed;title;linkText;uiLocation;isAsyncHeader;updateDelegate;frame;static async createForDebuggerCallFrame(e,t,i){const s=e.functionName,n=new je(Mi(s),i,e);return await _.instance().createCallFrameLiveLocation(e.location(),n.update.bind(n),t),Xo(e).then(o=>{o&&o!==s&&(n.title=o,n.updateDelegate(n))}),n}static async createItemsForAsyncStack(e,t,i,s,n){const o=new WeakMap,r=new je(e,n);o.set(r,new Set),r.isAsyncHeader=!0;const c=[],l=[];for(const h of i){const u=new je(Mi(h.functionName),d),p=t.createRawLocationByScriptId(h.scriptId,h.lineNumber,h.columnNumber);l.push(_.instance().createCallFrameLiveLocation(p,u.update.bind(u),s)),c.push(u)}return await Promise.all(l),n(r),[r,...c];function d(h){n(h);let u=!1;const p=o.get(r);p&&(h.isIgnoreListed?(p.delete(h),u=p.size===0):(u=p.size===0,p.add(h)),r.isIgnoreListed=p.size===0),u&&n(r)}}constructor(e,t,i){this.isIgnoreListed=!1,this.title=e,this.linkText="",this.uiLocation=null,this.isAsyncHeader=!1,this.updateDelegate=t,this.frame=i}async update(e){const t=await e.uiLocation();this.isIgnoreListed=await e.isIgnoreListed(),this.linkText=t?t.linkText():"",this.uiLocation=t,this.updateDelegate(this)}}const ad=Object.freeze(Object.defineProperty({__proto__:null,ActionDelegate:Ga,CallStackSidebarPane:st,Item:je,defaultMaxAsyncStackChainDepth:mt,elementSymbol:qa},Symbol.toStringTag,{value:"Module"})),D={beforeBidderWorkletBiddingStart:"Bidder Bidding Phase Start",beforeBidderWorkletReportingStart:"Bidder Reporting Phase Start",beforeSellerWorkletScoringStart:"Seller Scoring Phase Start",beforeSellerWorkletReportingStart:"Seller Reporting Phase Start",setTimeoutOrIntervalFired:"{PH1} fired",scriptFirstStatement:"Script First Statement",scriptBlockedByContentSecurity:"Script Blocked by Content Security Policy",requestAnimationFrame:"Request Animation Frame",cancelAnimationFrame:"Cancel Animation Frame",animationFrameFired:"Animation Frame Fired",webglErrorFired:"WebGL Error Fired",webglWarningFired:"WebGL Warning Fired",setInnerhtml:"Set `innerHTML`",createCanvasContext:"Create canvas context",createAudiocontext:"Create `AudioContext`",closeAudiocontext:"Close `AudioContext`",resumeAudiocontext:"Resume `AudioContext`",suspendAudiocontext:"Suspend `AudioContext`",sinkViolations:"Sink Violations",policyViolations:"Policy Violations"},Ya=M("panels/sources/CategorizedBreakpointL10n.ts",D),B=rn.bind(void 0,Ya);function Nn(a){return(Xa.get(a)??fe(a))()}const Ka={beforeBidderWorkletBiddingStart:B(D.beforeBidderWorkletBiddingStart),beforeBidderWorkletReportingStart:B(D.beforeBidderWorkletReportingStart),beforeSellerWorkletScoringStart:B(D.beforeSellerWorkletScoringStart),beforeSellerWorkletReportingStart:B(D.beforeSellerWorkletReportingStart),setTimeout:fe("setTimeout"),clearTimeout:fe("clearTimeout"),"setTimeout.callback":B(D.setTimeoutOrIntervalFired,{PH1:"setTimeout"}),setInterval:fe("setInterval"),clearInterval:fe("clearInterval"),"setInterval.callback":B(D.setTimeoutOrIntervalFired,{PH1:"setInterval"}),scriptFirstStatement:B(D.scriptFirstStatement),scriptBlockedByCSP:B(D.scriptBlockedByContentSecurity),sharedStorageWorkletScriptFirstStatement:B(D.scriptFirstStatement),requestAnimationFrame:B(D.requestAnimationFrame),cancelAnimationFrame:B(D.cancelAnimationFrame),"requestAnimationFrame.callback":B(D.animationFrameFired),webglErrorFired:B(D.webglErrorFired),webglWarningFired:B(D.webglWarningFired),"Element.setInnerHTML":B(D.setInnerhtml),canvasContextCreated:B(D.createCanvasContext),"Geolocation.getCurrentPosition":fe("getCurrentPosition"),"Geolocation.watchPosition":fe("watchPosition"),"Notification.requestPermission":fe("requestPermission"),"DOMWindow.close":fe("window.close"),"Document.write":fe("document.write"),audioContextCreated:B(D.createAudiocontext),audioContextClosed:B(D.closeAudiocontext),audioContextResumed:B(D.resumeAudiocontext),audioContextSuspended:B(D.suspendAudiocontext)},Ja={"trustedtype-policy-violation":B(D.policyViolations),"trustedtype-sink-violation":B(D.sinkViolations)},Xa=new Map([...Object.entries(Ka),...Object.entries(Ja)]),cd=Object.freeze(Object.defineProperty({__proto__:null,getLocalizedBreakpointName:Nn},Symbol.toStringTag,{value:"Module"}));class ze{uiSourceCode;constructor(e,t){this.uiSourceCode=e}static accepts(e){return!1}willHide(){}rightToolbarItems(){return[]}leftToolbarItems(){return[]}populateLineGutterContextMenu(e,t){}populateTextAreaContextMenu(e,t,i){}decorationChanged(e,t){}editorExtension(){return[]}editorInitialized(e){}dispose(){}}const ld=Object.freeze(Object.defineProperty({__proto__:null,Plugin:ze},Symbol.toStringTag,{value:"Module"})),qe={clickToShowCoveragePanel:"Click to show Coverage Panel",showDetails:"Show Details",coverageS:"Coverage: {PH1}",coverageNa:"Coverage: n/a"},Qa=M("panels/sources/CoveragePlugin.ts",qe),ct=N.bind(void 0,Qa);class Dn extends ze{originalSourceCode;infoInToolbar;model;coverage;#e;constructor(e,t){super(e),this.originalSourceCode=this.uiSourceCode,this.#e=t,this.infoInToolbar=new me(ct(qe.clickToShowCoveragePanel),void 0,void 0,"debugger.show-coverage"),this.infoInToolbar.setSecondary(),this.infoInToolbar.addEventListener("Click",()=>{O.instance().showView("coverage")});const i=T.instance().primaryPageTarget();i&&(this.model=i.model(Fa),this.model&&(this.model.addEventListener(Ds.CoverageReset,this.handleReset,this),this.coverage=this.model.getCoverageForUrl(this.originalSourceCode.url()),this.coverage&&this.coverage.addEventListener(Rs.Events.SizesChanged,this.handleCoverageSizesChanged,this))),this.updateStats()}dispose(){this.coverage&&this.coverage.removeEventListener(Rs.Events.SizesChanged,this.handleCoverageSizesChanged,this),this.model&&this.model.removeEventListener(Ds.CoverageReset,this.handleReset,this)}static accepts(e){return e.contentType().isDocumentOrScriptOrStyleSheet()}handleReset(){this.coverage=null,this.updateStats()}handleCoverageSizesChanged(){this.updateStats()}updateStats(){if(this.coverage){this.infoInToolbar.setTitle(ct(qe.showDetails));const e=new Intl.NumberFormat(Qo.instance().locale,{style:"percent",maximumFractionDigits:1});this.infoInToolbar.setText(ct(qe.coverageS,{PH1:e.format(this.coverage.usedPercentage())}))}else this.infoInToolbar.setTitle(ct(qe.clickToShowCoveragePanel)),this.infoInToolbar.setText(ct(qe.coverageNa))}rightToolbarItems(){return[this.infoInToolbar]}editorExtension(){return mi.of([])}getCoverageManager(){return this.uiSourceCode.getDecorationData("coverage")}editorInitialized(e){this.getCoverageManager()&&this.startDecoUpdate(e)}decorationChanged(e,t){e==="coverage"&&this.startDecoUpdate(t)}startDecoUpdate(e){const t=this.getCoverageManager();(t?t.usageByLine(this.uiSourceCode,this.#t(e)):Promise.resolve([])).then(i=>{const s=!!e.state.field(ji,!1);i.length?s?e.dispatch({effects:On.of(i)}):e.dispatch({effects:mi.reconfigure([ji.init(n=>Rn(i,n)),tc(this.uiSourceCode.url()),ic])}):s&&e.dispatch({effects:mi.reconfigure([])})})}#t(e){const t=[];for(let i=1;i<=e.state.doc.lines;++i){const s=e.state.doc.line(i),{lineNumber:n,columnNumber:o}=this.#e.editorLocationToUILocation(i-1,0),{lineNumber:r,columnNumber:c}=this.#e.editorLocationToUILocation(i-1,s.length);t.push(new Tt(n,o,r,c))}return t}}const Za=new class extends kt{elementClass="cm-coverageUsed"},ec=new class extends kt{elementClass="cm-coverageUnused"};function Rn(a,e){const t=new ts;for(let i=0;i<a.length;i++){const s=a[i];if(s!==void 0&&i<e.doc.lines){const n=e.doc.line(i+1).from;t.add(n,n,s?Za:ec)}}return t.finish()}const On=Ie.define(),ji=_e.define({create(){return De.empty},update(a,e){return e.effects.reduce((t,i)=>i.is(On)?Rn(i.value,e.state):t,a.map(e.changes))}});function tc(a){return an({markers:e=>e.state.field(ji),domEventHandlers:{click(){return O.instance().showView("coverage").then(()=>{const e=O.instance().view("coverage");return e&&e.widget()}).then(e=>{const t=a.match(/(.*):formatted$/),i=t&&t[1]||a;e.selectCoverageItemByUrl(i)}),!0}},class:"cm-coverageGutter"})}const mi=new Et,ic=se.baseTheme({".cm-coverageGutter":{width:"5px",marginLeft:"3px"},".cm-coverageUnused":{backgroundColor:"var(--app-color-coverage-unused)"},".cm-coverageUsed":{backgroundColor:"var(--app-color-coverage-used)"}}),dd=Object.freeze(Object.defineProperty({__proto__:null,CoveragePlugin:Dn},Symbol.toStringTag,{value:"Module"})),ti={openColorPicker:"Open color picker.",openCubicBezierEditor:"Open cubic bezier editor.",addSourceMap:"Add source map…"},sc=M("panels/sources/CSSPlugin.ts",ti),ds=N.bind(void 0,sc),nc=new Set(["ColorLiteral","NumberLiteral","StringLiteral","Comment","Important"]);function oc(a,e){if(nc.has(a.name))return null;for(let t=a;t&&!(t.name==="StyleSheet"||t.name==="Styles"||t.name==="CallExpression");t=t.parent)if(t.name==="Declaration"){const i=t.getChild("PropertyName"),s=t.getChild(":");return i&&s&&s.to<=e?i:null}return null}function rc(a,e){const t=e.getStyleSheetIdsForURL(a);if(t.length===0)throw new Error("Can't find style sheet ID for current URL");return t[0]}async function ac(a,e,t){const i=Lt(a.state).resolveInner(a.pos,-1);if(i.name==="ClassName"){nr(t);const n=rc(e.url(),t),o=await t.getClassNames(n);return{from:i.from,options:o.map(r=>({type:"constant",label:r}))}}const s=oc(i,a.pos);if(s){const n=or().getPropertyValues(a.state.sliceDoc(s.from,s.to));return{from:i.name==="ValueName"?i.from:a.pos,options:n.map(o=>({type:"constant",label:o})),validFor:/^[\w\P{ASCII}\-]+$/u}}return null}function cc(a,e,t,i,s){let n=a.doc.lineAt(e);function o(c,l){return c>=n.to&&(n=a.doc.lineAt(c)),n.text.slice(c-n.from,l-n.from)}const r=is(a,t,100);r&&r.iterate({from:e,to:t,enter:c=>{let l;if(c.name==="ValueName"||c.name==="ColorLiteral"?l=o(c.from,c.to):c.name==="Callee"&&/^(?:(?:rgba?|hsla?|hwba?|lch|oklch|lab|oklab|color)|cubic-bezier)$/.test(o(c.from,c.to))&&(l=a.sliceDoc(c.from,c.node.parent.to)),l){const d=rr(l);if(d)i(c.from,d,l);else{const h=ar.parse(l);h&&s(c.from,h,l)}}}})}class lc extends nt{#e;#t;#i;constructor(e,t,i){super(),this.#t=e,this.#e=t,this.#i=i}eq(e){return this.#t.equal(e.#t)&&this.#e===e.#e&&this.#i===e.#i}toDOM(e){const t=new Aa(ds(ti.openColorPicker));t.renderColor(this.#t);const i=t.createChild("span");return i.textContent=this.#e,i.setAttribute("hidden","true"),t.addEventListener(Na.eventName,s=>{const n=s.data.color.getAuthoredText()??s.data.color.asString();e.dispatch({changes:{from:this.#i,to:this.#i+this.#e.length,insert:n}}),this.#e=n,this.#t=t.getColor()}),t.addEventListener(Da.eventName,s=>{s.consume(!0),e.dispatch({effects:It.of({type:0,pos:e.posAtDOM(t),text:this.#e,swatch:t,color:this.#t})})}),t}ignoreEvent(){return!0}}class dc extends nt{curve;text;constructor(e,t){super(),this.curve=e,this.text=t}eq(e){return this.curve.asCSSText()===e.curve.asCSSText()&&this.text===e.text}toDOM(e){const t=Ra.create();return t.setBezierText(this.text),Q.install(t.iconElement(),ds(ti.openCubicBezierEditor)),t.iconElement().addEventListener("click",i=>{i.consume(!0),e.dispatch({effects:It.of({type:1,pos:e.posAtDOM(t),text:this.text,swatch:t,curve:this.curve})})},!1),t.hideText(!0),t}ignoreEvent(){return!0}}function hc(a){return{pos:a.pos,arrow:!0,create(e){let t=a.text,i,s;if(a.type===0){const o=new Ma;s=r=>{o.addEventListener("ColorChanged",r)},o.addEventListener("SizeChanged",()=>e.requestMeasure()),o.setColor(a.color),i=o,ne.colorPickerOpenedFrom(0)}else{const o=new Oa(a.curve);i=o,s=r=>{o.addEventListener("BezierChanged",r)}}const n=document.createElement("div");return n.className="cm-tooltip-swatchEdit",i.markAsRoot(),i.show(n),i.showWidget(),i.element.addEventListener("keydown",o=>{o.key==="Escape"&&(o.consume(),e.dispatch({effects:It.of(null),changes:t===a.text?void 0:{from:a.pos,to:a.pos+t.length,insert:a.text}}),i.hideWidget(),e.focus())}),i.element.addEventListener("focusout",o=>{o.relatedTarget&&!i.element.contains(o.relatedTarget)&&(e.dispatch({effects:It.of(null)}),i.hideWidget())},!1),i.element.addEventListener("mousedown",o=>o.consume()),{dom:n,resize:!1,offset:{x:-8,y:0},mount:()=>{i.focus(),i.wasShown(),s(o=>{e.dispatch({changes:{from:a.pos,to:a.pos+t.length,insert:o.data},annotations:Bn.of(!0)}),t=o.data})}}}}}const It=Ie.define(),Bn=ir.define(),uc=_e.define({create(){return null},update(a,e){(e.docChanged||e.selection)&&!e.annotation(Bn)&&(a=null);for(const t of e.effects)t.is(It)&&(a=t.value);return a},provide:a=>Zo.from(a,e=>e&&hc(e))});function Us(a,e,t){const i=new ts;return cc(a,e,t,(s,n,o)=>{i.add(s,s,U.widget({widget:new lc(n,o,s)}))},(s,n,o)=>{i.add(s,s,U.widget({widget:new dc(n,o)}))}),i.finish()}const pc=er.fromClass(class{decorations;constructor(a){this.decorations=Us(a.state,a.viewport.from,a.viewport.to)}update(a){(a.viewportChanged||a.docChanged)&&(this.decorations=Us(a.state,a.view.viewport.from,a.view.viewport.to))}},{decorations:a=>a.decorations});function mc(){return[pc,uc]}function Vs(a){if(a.name==="Unit"&&(a=a.parent),a.name==="NumberLiteral"){const e=a.lastChild;return{from:a.from,to:e&&e.name==="Unit"?e.from:a.to}}return null}function Dt(a,e){const{head:t}=a.state.selection.main,i=Lt(a.state).resolveInner(t,-1),s=Vs(i)||Vs(i.resolve(t,1));if(!s)return!1;const n=Number(a.state.sliceDoc(s.from,s.to));return isNaN(n)?!1:(a.dispatch({changes:{from:s.from,to:s.to,insert:String(n+e)},scrollIntoView:!0,userEvent:"insert.modifyUnit"}),!0)}function Un(){let a=null;const e=vt.instance().getShortcutListener({"sources.increment-css":()=>Promise.resolve(Dt(a,1)),"sources.increment-css-by-ten":()=>Promise.resolve(Dt(a,10)),"sources.decrement-css":()=>Promise.resolve(Dt(a,-1)),"sources.decrement-css-by-ten":()=>Promise.resolve(Dt(a,-10))});return se.domEventHandlers({keydown:(t,i)=>{const s=a;return a=i,e(t),a=s,t.defaultPrevented}})}class Vn extends ze{#e;constructor(e,t){super(e,t),T.instance().observeModels(tr,this)}static accepts(e){return e.contentType().hasStyleSheets()}modelAdded(e){e.target()===T.instance().primaryPageTarget()&&(this.#e=e)}modelRemoved(e){this.#e===e&&(this.#e=void 0)}editorExtension(){return[Un(),this.#t(),mc()]}#t(){const{cssCompletionSource:e}=cr,t=this.uiSourceCode,i=this.#e;return Qs({override:[async s=>await ac(s,t,i)||e(s)]})}populateTextAreaContextMenu(e){function t(n,o){$e.createAddSourceMapURLDialog(c=>{sr.instance().modelToInfo.get(n)?.addSourceMap(o,c)}).show()}const i=this.#e,s=this.uiSourceCode.url();if(this.uiSourceCode.project().type()===b.Network&&i&&!X.instance().isUserIgnoreListedURL(s)){const n=ds(ti.addSourceMap);e.debugSection().appendItem(n,()=>t(i,s),{jslogContext:"add-source-map"})}}}const hd=Object.freeze(Object.defineProperty({__proto__:null,CSSPlugin:Vn,cssBindings:Un},Symbol.toStringTag,{value:"Module"})),jn=new CSSStyleSheet;jn.replaceSync(`/*
 * Copyright 2016 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

.paused-status {
  margin: 6px;
  padding: 4px 10px;
  border-radius: 10px;
  background-color: var(--sys-color-yellow-container);
  color: var(--sys-color-on-yellow-container);
}

.paused-status.error-reason {
  background-color: var(--sys-color-surface-error);
  color: var(--sys-color-on-surface-error);
}

.status-main {
  padding-left: 18px;
  position: relative;
}

.status-sub:not(:empty) {
  padding-left: 15px;
  padding-top: 5px;
  overflow: hidden;
  text-overflow: ellipsis;
}

.paused-status.error-reason .status-sub {
  color: var(--sys-color-error);
  line-height: 11px;
  max-height: 27px;
  user-select: text;
}

devtools-icon {
  position: absolute;
  left: -1px;
  top: -1px;
}

/*# sourceURL=debuggerPausedMessage.css */
`);const R={pausedOnS:"Paused on {PH1}",childSAdded:"Child {PH1} added",descendantSAdded:"Descendant {PH1} added",descendantSRemoved:"Descendant {PH1} removed",pausedOnEventListener:"Paused on event listener",pausedOnXhrOrFetch:"Paused on XHR or fetch",pausedOnException:"Paused on exception",pausedOnPromiseRejection:"Paused on `promise` rejection",pausedOnAssertion:"Paused on assertion",pausedOnDebuggedFunction:"Paused on debugged function",pausedBeforePotentialOutofmemory:"Paused before potential out-of-memory crash",pausedOnCspViolation:"Paused on CSP violation",trustedTypeSinkViolation:"`Trusted Type` Sink Violation",trustedTypePolicyViolation:"`Trusted Type` Policy Violation",pausedOnBreakpoint:"Paused on breakpoint",debuggerPaused:"Debugger paused",subtreeModifications:"subtree modifications",attributeModifications:"attribute modifications",nodeRemoval:"node removal",webglErrorFiredS:"WebGL Error Fired ({PH1})",scriptBlockedDueToContent:"Script blocked due to Content Security Policy directive: {PH1}"},St=M("panels/sources/DebuggerPausedMessage.ts",R),K=N.bind(void 0,St),gi=rn.bind(void 0,St);class Ve{elementInternal;contentElement;constructor(){this.elementInternal=document.createElement("div"),this.elementInternal.classList.add("paused-message"),this.elementInternal.classList.add("flex-none"),this.elementInternal.setAttribute("jslog",`${Qi("debugger-paused")}`);const e=lr(this.elementInternal,{cssFile:[jn],delegatesFocus:void 0});this.contentElement=e.createChild("div"),dr(this.elementInternal,!1)}element(){return this.elementInternal}static descriptionWithoutStack(e){const t=/^\s+at\s/m.exec(e);return t?e.substring(0,t.index-1):e.substring(0,e.lastIndexOf(`
`))}static async createDOMBreakpointHitMessage(e){const t=document.createElement("span"),i=e.debuggerModel.target().model(hr);if(!e.auxData||!i)return t;const s=i.resolveDOMBreakpointData(e.auxData);if(!s)return t;const n=t.createChild("div","status-main"),o=new oe;o.data={iconName:"info",color:"var(--sys-color-on-yellow-container)",width:"16px",height:"16px"},n.appendChild(o);const r=Wn.get(s.type);n.appendChild(document.createTextNode(K(R.pausedOnS,{PH1:r?r():String(null)})));const c=t.createChild("div","status-sub monospace"),l=await ws.linkify(s.node);if(c.appendChild(l),s.targetNode){const d=await ws.linkify(s.targetNode);let h;s.insertion?s.targetNode===s.node?h=bt(St,R.childSAdded,{PH1:d}):h=bt(St,R.descendantSAdded,{PH1:d}):h=bt(St,R.descendantSRemoved,{PH1:d}),c.appendChild(document.createElement("br")),c.appendChild(h)}return t}static#e(e){if(!e)return"";const{eventName:t,webglErrorName:i,directiveText:s,targetName:n}=e;if(t==="instrumentation:webglErrorFired"&&i){const r=i.replace(/^.*(0x[0-9a-f]+).*$/i,"$1");return K(R.webglErrorFiredS,{PH1:r})}if(t==="instrumentation:scriptBlockedByCSP"&&s)return K(R.scriptBlockedDueToContent,{PH1:s});let o=ur.instance().resolveEventListenerBreakpoint(e);return o?Nn(o.name):(o=pr.instance().resolveEventListenerBreakpoint(e),o&&n?n+"."+o.name:o?.name??"")}async render(e,t,i){if(this.contentElement.removeChildren(),this.contentElement.hidden=!e,!e)return;const s=this.contentElement.createChild("div","paused-status"),n=e.reason==="exception"||e.reason==="promiseRejection"||e.reason==="assert"||e.reason==="OOM";let o;if(e.reason==="DOM")o=await Ve.createDOMBreakpointHitMessage(e);else if(e.reason==="EventListener"){const c=Ve.#e(e.auxData);o=r(K(R.pausedOnEventListener),c)}else if(e.reason==="XHR"){const c=e.auxData;o=r(K(R.pausedOnXhrOrFetch),c.url||"")}else if(e.reason==="exception"){const c=e.auxData,l=c.description||c.value||"",d=Ve.descriptionWithoutStack(l);o=r(K(R.pausedOnException),d,l)}else if(e.reason==="promiseRejection"){const c=e.auxData,l=c.description||c.value||"",d=Ve.descriptionWithoutStack(l);o=r(K(R.pausedOnPromiseRejection),d,l)}else if(e.reason==="assert")o=r(K(R.pausedOnAssertion));else if(e.reason==="debugCommand")o=r(K(R.pausedOnDebuggedFunction));else if(e.reason==="OOM")o=r(K(R.pausedBeforePotentialOutofmemory));else if(e.reason==="CSPViolation"&&e.auxData&&e.auxData.violationType){const c=e.auxData.violationType;c==="trustedtype-sink-violation"?o=r(K(R.pausedOnCspViolation),K(R.trustedTypeSinkViolation)):c==="trustedtype-policy-violation"&&(o=r(K(R.pausedOnCspViolation),K(R.trustedTypePolicyViolation)))}else if(e.callFrames.length){const c=await t.rawLocationToUILocation(e.callFrames[0].location()),l=c?i.findBreakpoint(c):null,d=K(l?R.pausedOnBreakpoint:R.debuggerPaused);o=r(d)}else console.warn("ScriptsPanel paused, but callFrames.length is zero.");s.classList.toggle("error-reason",n),o&&s.appendChild(o);function r(c,l,d){const h=document.createElement("span"),u=h.createChild("div","status-main"),p=new oe;if(p.data={iconName:n?"cross-circle-filled":"info",color:n?"var(--icon-error)":"var(--sys-color-on-yellow-container)",width:"16px",height:"16px"},u.appendChild(p),u.appendChild(document.createTextNode(c)),l){const m=h.createChild("div","status-sub monospace");m.textContent=l,Q.install(m,d||l)}return h}}}const Wn=new Map([["subtree-modified",gi(R.subtreeModifications)],["attribute-modified",gi(R.attributeModifications)],["node-removed",gi(R.nodeRemoval)]]),ud=Object.freeze(Object.defineProperty({__proto__:null,BreakpointTypeNouns:Wn,DebuggerPausedMessage:Ve},Symbol.toStringTag,{value:"Module"})),Hn=new CSSStyleSheet;Hn.replaceSync(`/*
 * Copyright (C) 2006, 2007, 2008 Apple Inc.  All rights reserved.
 * Copyright (C) 2009 Anthony Ricaud <rik@webkit.org>
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *
 * 1.  Redistributions of source code must retain the above copyright
 *     notice, this list of conditions and the following disclaimer.
 * 2.  Redistributions in binary form must reproduce the above copyright
 *     notice, this list of conditions and the following disclaimer in the
 *     documentation and/or other materials provided with the distribution.
 * 3.  Neither the name of Apple Computer, Inc. ("Apple") nor the names of
 *     its contributors may be used to endorse or promote products derived
 *     from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

.is-ignore-listed {
  .tree-element-title,
  .leading-icons {
    opacity: 40%;
  }
}

.tree-outline li {
  min-height: 20px;
}

.tree-outline li:hover:not(.selected) .selection {
  display: block;
  background-color: var(--sys-color-state-hover-on-subtle);
}

.navigator-fs-folder-tree-item devtools-icon {
  color: var(--icon-folder-workspace);
}

.navigator-fs-tree-item devtools-icon {
  color: var(--icon-file-authored);
}

.navigator-nw-folder-tree-item devtools-icon {
  color: var(--icon-folder-deployed);
}

.navigator-sm-script-tree-item devtools-icon,
.navigator-script-tree-item devtools-icon,
.navigator-snippet-tree-item devtools-icon {
  color: var(--icon-file-script);
}

.navigator-file-tree-item .ai-button-container {
  display: none;
  position: absolute;
  z-index: 999;
  right: var(--sys-size-3);
}

.navigator-file-tree-item:hover .ai-button-container {
  display: inline-flex;
}

.navigator-file-tree-item devtools-icon.dot::before {
  width: 7px;
  height: 7px;
  top: 12px;
  left: 11px;
}

.navigator-file-tree-item:hover:not(.force-white-icons) devtools-icon.dot::before {
  outline-color: var(--icon-gap-hover);
}

.navigator-file-tree-item.selected:not(.force-white-icons) devtools-icon.dot::before {
  outline-color: var(--icon-gap-inactive);
}

.navigator-file-tree-item.selected.force-white-icons devtools-icon.dot::before {
  outline-color: var(--icon-gap-focus-selected);
}

.navigator-sm-stylesheet-tree-item devtools-icon,
.navigator-stylesheet-tree-item devtools-icon {
  color: var(--icon-file-styles);
}

.navigator-image-tree-item devtools-icon,
.navigator-font-tree-item devtools-icon {
  color: var(--icon-file-image);
}

.navigator-nw-folder-tree-item.is-from-source-map devtools-icon {
  color: var(--icon-folder-authored);
}

.navigator-fs-tree-item:not(.has-mapped-files):not(.selected) > :not(.selection),
.navigator-fs-folder-tree-item:not(.has-mapped-files):not(.selected) > :not(.selection) {
  color: var(--sys-color-on-surface-subtle);
  opacity: 40%;

  & devtools-icon {
    color: var(--sys-color-on-surface-subtle);
  }
}

.tree-outline:not(:has(.navigator-deployed-tree-item)) .navigator-sm-folder-tree-item .tree-element-title,
.tree-outline:not(:has(.navigator-deployed-tree-item)) .navigator-sm-script-tree-item .tree-element-title,
.tree-outline:not(:has(.navigator-deployed-tree-item)) .navigator-sm-stylesheet-tree-item .tree-element-title {
  font-style: italic;
}

@media (forced-colors: active) {
  .tree-outline li .leading-icons devtools-icon {
    color: ButtonText;
  }

  .tree-outline li:hover:not(.selected) .selection,
  .tree-outline li:hover:not(:has(span[is="dt-checkbox"])) .selection {
    forced-color-adjust: none;
    background-color: Highlight;
  }

  .tree-outline:not(.hide-selection-when-blurred) li.parent:hover:not(.selected)::before {
    background-color: HighlightText;
  }

  .tree-outline:not(.hide-selection-when-blurred) li:hover:not(.selected) devtools-icon,
  .tree-outline li:not(.selected):hover .tree-element-title {
    forced-color-adjust: none;
    color: HighlightText;
  }

  .navigator-fs-tree-item:not(.has-mapped-files):not(.selected) > :not(.selection),
  .navigator-fs-folder-tree-item:not(.has-mapped-files):not(.selected) > :not(.selection),
  .is-ignore-listed {
    filter: none;
    opacity: 100%;
  }
}

/*# sourceURL=navigatorTree.css */
`);const $n=new CSSStyleSheet;$n.replaceSync(`/*
 * Copyright 2016 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

.navigator-toolbar {
  border-bottom: 1px solid var(--sys-color-divider);
  padding-left: 8px;
}

/*# sourceURL=navigatorView.css */
`);const _n=new CSSStyleSheet;_n.replaceSync(`/*
 * Copyright 2016 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

:host {
  padding: 0;
  margin: 0;
  overflow-y: auto;
}

.tree-outline {
  padding: 0;
}

.tree-outline ol {
  padding: 0;
}

.tree-outline li {
  height: 16px;
}

li.search-result {
  cursor: pointer;
  font-size: 12px;
  margin-top: 8px;
  padding: 2px 0 2px 4px;
  word-wrap: normal;
  white-space: pre;
}

li.search-result:hover {
  background-color: var(--sys-color-state-hover-on-subtle);
}

li.search-result .search-result-file-name {
  color: var(--sys-color-on-surface);
  flex: 1 1;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

li.search-result .search-result-matches-count {
  color: var(--sys-color-token-subtle);
  margin: 0 8px;
}

li.search-result.expanded .search-result-matches-count {
  display: none;
}

li.show-more-matches {
  color: var(--sys-color-on-surface);
  cursor: pointer;
  margin: 8px 0 0 -4px;
}

li.show-more-matches:hover {
  text-decoration: underline;
}

li.search-match {
  margin: 2px 0;
  word-wrap: normal;
  white-space: pre;
}

li.search-match.selected:focus-visible {
  background: var(--sys-color-tonal-container);
}

li.search-match::before {
  display: none;
}

li.search-match .search-match-line-number {
  color: var(--sys-color-token-subtle);
  text-align: right;
  vertical-align: top;
  word-break: normal;
  padding: 2px 4px 2px 6px;
  margin-right: 5px;
}

.tree-outline .devtools-link {
  text-decoration: none;
  display: block;
  flex: auto;
}

li.search-match .search-match-content {
  color: var(--sys-color-on-surface);
}

ol.children.expanded {
  padding-bottom: 4px;
}

li.search-match .link-style.search-match-link {
  overflow: hidden;
  text-overflow: ellipsis;
  margin-left: 9px;
  text-align: left;
}

.search-result-qualifier {
  color: var(--sys-color-token-subtle);
}

.search-result-dash {
  color: var(--sys-color-surface-variant);
  margin: 0 4px;
}

/*# sourceURL=searchResultsPane.css */
`);const Ut={matchesCountS:"Matches Count {PH1}",lineS:"Line {PH1}",showDMore:"Show {PH1} more"},gc=M("panels/search/SearchResultsPane.ts",Ut),fi=N.bind(void 0,gc);class fc extends Be{searchConfig;searchResults;treeElements;treeOutline;matchesExpandedCount;constructor(e){super(!0),this.searchConfig=e,this.searchResults=[],this.treeElements=[],this.treeOutline=new cn,this.treeOutline.hideOverflow(),this.contentElement.appendChild(this.treeOutline.element),this.matchesExpandedCount=0}addSearchResult(e){this.searchResults.push(e),this.addTreeElement(e)}showAllMatches(){this.treeElements.forEach(e=>{e.expand(),e.showAllMatches()})}collapseAllResults(){this.treeElements.forEach(e=>{e.collapse()})}addTreeElement(e){const t=new vc(this.searchConfig,e);this.treeOutline.appendChild(t),this.treeOutline.selectedTreeElement||t.select(!0,!0),this.matchesExpandedCount<bc&&t.expand(),this.matchesExpandedCount+=e.matchesCount(),this.treeElements.push(t)}wasShown(){super.wasShown(),this.treeOutline.registerCSSFiles([_n])}}const bc=200,Sc=20;class vc extends Xe{searchConfig;searchResult;initialized;toggleOnClick;constructor(e,t){super("",!0),this.searchConfig=e,this.searchResult=t,this.initialized=!1,this.toggleOnClick=!0}onexpand(){this.initialized||(this.updateMatchesUI(),this.initialized=!0)}showAllMatches(){this.removeChildren(),this.appendSearchMatches(0,this.searchResult.matchesCount())}updateMatchesUI(){this.removeChildren();const e=Math.min(this.searchResult.matchesCount(),Sc);e<this.searchResult.matchesCount()?(this.appendSearchMatches(0,e-1),this.appendShowMoreMatchesElement(e-1)):this.appendSearchMatches(0,e)}onattach(){this.updateSearchMatches()}updateSearchMatches(){this.listItemElement.classList.add("search-result");const e=i(this.searchResult.label(),"search-result-file-name");e.appendChild(i("—","search-result-dash")),e.appendChild(i(this.searchResult.description(),"search-result-qualifier")),this.tooltip=this.searchResult.description(),this.listItemElement.appendChild(e);const t=document.createElement("span");t.className="search-result-matches-count",t.textContent=`${this.searchResult.matchesCount()}`,ue(t,fi(Ut.matchesCountS,{PH1:this.searchResult.matchesCount()})),this.listItemElement.appendChild(t),this.expanded&&this.updateMatchesUI();function i(s,n){const o=document.createElement("span");return o.className=n,o.textContent=s,o}}appendSearchMatches(e,t){const i=this.searchResult,s=this.searchConfig.queries(),n=[];for(let o=0;o<s.length;++o)n.push(mr(s[o],!this.searchConfig.ignoreCase(),this.searchConfig.isRegex()));for(let o=e;o<t;++o){let r=i.matchLineContent(o),c=[];const l=i.matchColumn(o),d=i.matchLength(o);if(l!==void 0&&d!==void 0){const{matchRange:w,lineSegment:V}=Cc(r,new Yt(l,d));r=V,c=[w]}else{r=r.trim();for(let w=0;w<n.length;++w)c=c.concat(this.regexMatchRanges(r,n[w]));({lineSegment:r,matchRanges:c}=wc(r,c))}const h=tt.linkifyRevealable(i.matchRevealable(o),"",void 0,void 0,void 0,"search-match");h.classList.add("search-match-link"),h.tabIndex=0;const u=document.createElement("span");u.classList.add("search-match-line-number");const p=i.matchLabel(o);u.textContent=p,typeof p=="number"&&!isNaN(p)?ue(u,fi(Ut.lineS,{PH1:p})):ue(u,p),h.appendChild(u);const m=this.createContentSpan(r,c);h.appendChild(m);const f=new Xe;this.appendChild(f),f.listItemElement.className="search-match",f.listItemElement.appendChild(h),f.listItemElement.addEventListener("keydown",w=>{w.key==="Enter"&&(w.consume(!0),Oe(i.matchRevealable(o)))}),f.tooltip=r}}appendShowMoreMatchesElement(e){const t=this.searchResult.matchesCount()-e,i=fi(Ut.showDMore,{PH1:t}),s=new Xe(i);this.appendChild(s),s.listItemElement.classList.add("show-more-matches"),s.onselect=this.showMoreMatchesElementSelected.bind(this,s,e)}createContentSpan(e,t){const i=document.createElement("span");return i.className="search-match-content",i.textContent=e,ue(i,`${e} line`),Ai(i,t,"highlighted-search-result"),i}regexMatchRanges(e,t){t.lastIndex=0;let i;const s=[];for(;t.lastIndex<e.length&&(i=t.exec(e));)s.push(new Yt(i.index,i[0].length));return s}showMoreMatchesElementSelected(e,t){return this.removeChild(e),this.appendSearchMatches(t,this.searchResult.matchesCount()),!1}}const js={prefixLength:25,maxLength:1e3};function Cc(a,e,t=js){const i={...js,...t},s=a.trimStart(),n=a.length-s.length,o=Math.min(e.offset,n),r=Math.max(o,e.offset-i.prefixLength),c=Math.min(a.length,r+i.maxLength),l=r>o?"…":"",d=l+a.substring(r,c),h=e.offset-r+l.length,u=Math.min(e.length,d.length-h),p=new Yt(h,u);return{lineSegment:d,matchRange:p}}function wc(a,e){let t=0,i=e;i.length>0&&i[0].offset>20&&(t=15);let s=a.substring(t,1e3+t);return t&&(i=i.map(n=>new Yt(n.offset-t+1,n.length)),s="…"+s),{lineSegment:s,matchRanges:i}}const zn=new CSSStyleSheet;zn.replaceSync(`/*
 * Copyright 2014 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

.search-drawer-header {
  align-items: center;
  flex-shrink: 0;
  overflow: hidden;
  display: inline-flex;
  min-width: 150px;

  .search-container {
    border-bottom: 1px solid var(--sys-color-divider);
    display: flex;
    height: 100%;
    align-items: center;
    flex-grow: 1;
  }

  .toolbar-item-search {
    flex-grow: 1;
    box-shadow: inset 0 0 0 2px transparent;
    box-sizing: border-box;
    height: var(--sys-size-9);
    margin-left: var(--sys-size-3);
    padding: 0 var(--sys-size-2) 0 var(--sys-size-5);
    border-radius: 100px;
    position: relative;
    display: flex;
    align-items: center;
    background-color: var(--sys-color-cdt-base);

    &:has(input:focus) {
      box-shadow: inset 0 0 0 2px var(--sys-color-state-focus-ring);
    }

    &:has(input:hover)::before {
      content: "";
      box-sizing: inherit;
      height: 100%;
      width: 100%;
      position: absolute;
      border-radius: 100px;
      left: 0;
      background-color: var(--sys-color-state-hover-on-subtle);
    }

    & > devtools-icon {
      color: var(--sys-color-on-surface-subtle);
      width: var(--sys-size-8);
      height: var(--sys-size-8);
      margin-right: var(--sys-size-3);
    }
  }

  .search-toolbar-input {
    appearance: none;
    color: var(--sys-color-on-surface);
    background-color: transparent;
    border: 0;
    z-index: 1;
    flex: 1;

    &::placeholder {
      color: var(--sys-color-on-surface-subtle);
    }

    &:placeholder-shown + .clear-button {
      display: none;
    }

    &::-webkit-search-cancel-button {
      display: none;
    }
  }
}

.search-toolbar {
  background-color: var(--sys-color-cdt-base-container);
  border-bottom: 1px solid var(--sys-color-divider);
}

.search-toolbar-summary {
  background-color: var(--sys-color-cdt-base-container);
  border-top: 1px solid var(--sys-color-divider);
  padding-left: 5px;
  flex: 0 0 19px;
  display: flex;
  padding-right: 5px;
}

.search-toolbar-summary .search-message {
  padding-top: 2px;
  padding-left: 1ex;
  text-overflow: ellipsis;
  white-space: nowrap;
  overflow: hidden;
}

.search-view .search-results {
  overflow-y: auto;
  display: flex;
  flex: auto;
}

.search-view .search-results > div {
  flex: auto;
}

/*# sourceURL=searchView.css */
`);const j={find:"Find",enableCaseSensitive:"Enable case sensitive search",disableCaseSensitive:"Disable case sensitive search",enableRegularExpression:"Enable regular expressions",disableRegularExpression:"Disable regular expressions",refresh:"Refresh",clearInput:"Clear",clear:"Clear search",indexing:"Indexing…",searching:"Searching…",indexingInterrupted:"Indexing interrupted.",foundMatchingLineInFile:"Found 1 matching line in 1 file.",foundDMatchingLinesInFile:"Found {PH1} matching lines in 1 file.",foundDMatchingLinesInDFiles:"Found {PH1} matching lines in {PH2} files.",noMatchesFound:"No matches found.",searchFinished:"Search finished.",searchInterrupted:"Search interrupted."},Ic=M("panels/search/SearchView.ts",j),H=N.bind(void 0,Ic);function Ws(a,e){const t=new ns;return t.data={variant:"icon_toggle",size:"SMALL",iconName:a,toggledIconName:a,toggleType:"primary-toggle",toggled:!1,jslogContext:e},t}class yc extends Be{focusOnShow;isIndexing;searchId;searchMatchesCount;searchResultsCount;nonEmptySearchResultsCount;searchingView;notFoundView;searchConfig;pendingSearchConfig;searchResultsPane;progressIndicator;visiblePane;searchPanelElement;searchResultsElement;search;matchCaseButton;regexButton;searchMessageElement;searchProgressPlaceholderElement;searchResultsMessageElement;advancedSearchConfig;searchScope;#e;#t=[];constructor(e,t){super(!0),this.setMinimumSize(0,40),this.focusOnShow=!1,this.isIndexing=!1,this.searchId=1,this.searchMatchesCount=0,this.searchResultsCount=0,this.nonEmptySearchResultsCount=0,this.searchingView=null,this.notFoundView=null,this.searchConfig=null,this.pendingSearchConfig=null,this.searchResultsPane=null,this.progressIndicator=null,this.visiblePane=null,this.#e=t,this.contentElement.setAttribute("jslog",`${ln("search").track({resize:!0})}`),this.contentElement.classList.add("search-view"),this.contentElement.addEventListener("keydown",p=>{this.onKeyDownOnPanel(p)}),this.searchPanelElement=this.contentElement.createChild("div","search-drawer-header"),this.searchResultsElement=this.contentElement.createChild("div"),this.searchResultsElement.className="search-results";const i=document.createElement("div");i.classList.add("search-container");const s=i.createChild("div","toolbar-item-search"),n=ss("search");s.appendChild(n),this.search=gr.create(),this.search.addEventListener("keydown",p=>{this.onKeyDown(p)}),this.search.setAttribute("jslog",`${Zs().track({change:!0,keydown:"ArrowUp|ArrowDown|Enter"})}`),s.appendChild(this.search),this.search.placeholder=H(j.find),this.search.setAttribute("type","search"),this.search.setAttribute("results","0"),this.search.setAttribute("size","100"),this.search.classList.add("search-toolbar-input"),ue(this.search,this.search.placeholder);const o=new ns;o.data={variant:"icon",size:"SMALL",iconName:"cross-circle-filled",jslogContext:"clear-input",title:H(j.clearInput)},o.classList.add("clear-button"),o.addEventListener("click",()=>{this.onSearchInputClear()}),o.tabIndex=-1,s.appendChild(o);const r="regular-expression";this.regexButton=Ws(r,r),this.regexButton.addEventListener("click",()=>this.regexButtonToggled()),s.appendChild(this.regexButton);const c="match-case";this.matchCaseButton=Ws(c,c),this.matchCaseButton.addEventListener("click",()=>this.matchCaseButtonToggled()),s.appendChild(this.matchCaseButton),this.searchPanelElement.appendChild(i);const l=new Z("search-toolbar",this.searchPanelElement);l.element.setAttribute("jslog",`${Ct()}`);const d=new me(H(j.refresh),"refresh",void 0,"search.refresh"),h=new me(H(j.clear),"clear",void 0,"search.clear");l.appendToolbarItem(d),l.appendToolbarItem(h),d.addEventListener("Click",()=>this.onAction()),h.addEventListener("Click",()=>{this.resetSearch(),this.onSearchInputClear()});const u=this.contentElement.createChild("div","search-toolbar-summary");this.searchMessageElement=u.createChild("div","search-message"),this.searchProgressPlaceholderElement=u.createChild("div","flex-centered"),this.searchResultsMessageElement=u.createChild("div","search-message"),this.advancedSearchConfig=v.instance().createLocalSetting(e+"-search-config",new ke("",!0,!1).toPlainObject()),this.load(),this.searchScope=null}regexButtonToggled(){this.regexButton.title=this.regexButton.toggled?H(j.disableRegularExpression):H(j.enableRegularExpression)}matchCaseButtonToggled(){this.matchCaseButton.title=this.matchCaseButton.toggled?H(j.disableCaseSensitive):H(j.enableCaseSensitive)}buildSearchConfig(){return new ke(this.search.value,!this.matchCaseButton.toggled,this.regexButton.toggled)}toggle(e,t){this.search.value=e,this.isShowing()?this.focus():this.focusOnShow=!0,this.initScope(),t?this.onAction():this.startIndexing()}createScope(){throw new Error("Not implemented")}initScope(){this.searchScope=this.createScope()}wasShown(){this.focusOnShow&&(this.focus(),this.focusOnShow=!1),this.registerCSSFiles([zn])}onIndexingFinished(){if(!this.progressIndicator)return;const e=!this.progressIndicator.isCanceled();if(this.progressIndicator.done(),this.progressIndicator=null,this.isIndexing=!1,this.searchMessageElement.textContent=e?"":H(j.indexingInterrupted),e||(this.pendingSearchConfig=null),!this.pendingSearchConfig)return;const t=this.pendingSearchConfig;this.pendingSearchConfig=null,this.innerStartSearch(t)}startIndexing(){this.isIndexing=!0,this.progressIndicator&&this.progressIndicator.done(),this.progressIndicator=new Is,this.searchMessageElement.textContent=H(j.indexing),this.progressIndicator.show(this.searchProgressPlaceholderElement),this.searchScope&&this.searchScope.performIndexing(new fr(this.progressIndicator,this.onIndexingFinished.bind(this)))}onSearchInputClear(){this.search.value="",this.save(),this.focus()}onSearchResult(e,t){if(!(e!==this.searchId||!this.progressIndicator)){if(this.progressIndicator&&this.progressIndicator.isCanceled()){this.onIndexingFinished();return}this.searchResultsPane||(this.searchResultsPane=new fc(this.searchConfig),this.showPane(this.searchResultsPane)),this.#t.push(t),this.#e.schedule(async()=>this.#i())}}#i(){for(const e of this.#t)this.addSearchResult(e),e.matchesCount()&&this.searchResultsPane?.addSearchResult(e);this.#t=[]}onSearchFinished(e,t){e!==this.searchId||!this.progressIndicator||(this.searchResultsPane||this.nothingFound(),this.searchFinished(t),this.searchConfig=null,br(this.searchMessageElement.textContent+" "+this.searchResultsMessageElement.textContent))}innerStartSearch(e){this.searchConfig=e,this.progressIndicator&&this.progressIndicator.done(),this.progressIndicator=new Is,this.searchStarted(this.progressIndicator),this.searchScope&&this.searchScope.performSearch(e,this.progressIndicator,this.onSearchResult.bind(this,this.searchId),this.onSearchFinished.bind(this,this.searchId))}resetSearch(){this.stopSearch(),this.showPane(null),this.searchResultsPane=null,this.searchMessageElement.textContent="",this.searchResultsMessageElement.textContent=""}stopSearch(){this.progressIndicator&&!this.isIndexing&&this.progressIndicator.cancel(),this.searchScope&&this.searchScope.stopSearch(),this.searchConfig=null}searchStarted(e){this.searchMatchesCount=0,this.searchResultsCount=0,this.nonEmptySearchResultsCount=0,this.searchingView||(this.searchingView=new it(H(j.searching))),this.showPane(this.searchingView),this.searchMessageElement.textContent=H(j.searching),e.show(this.searchProgressPlaceholderElement),this.updateSearchResultsMessage()}updateSearchResultsMessage(){this.searchMatchesCount&&this.searchResultsCount?this.searchMatchesCount===1&&this.nonEmptySearchResultsCount===1?this.searchResultsMessageElement.textContent=H(j.foundMatchingLineInFile):this.searchMatchesCount>1&&this.nonEmptySearchResultsCount===1?this.searchResultsMessageElement.textContent=H(j.foundDMatchingLinesInFile,{PH1:this.searchMatchesCount}):this.searchResultsMessageElement.textContent=H(j.foundDMatchingLinesInDFiles,{PH1:this.searchMatchesCount,PH2:this.nonEmptySearchResultsCount}):this.searchResultsMessageElement.textContent=""}showPane(e){this.visiblePane&&this.visiblePane.detach(),e&&e.show(this.searchResultsElement),this.visiblePane=e}nothingFound(){this.notFoundView||(this.notFoundView=new it(H(j.noMatchesFound))),this.showPane(this.notFoundView),this.searchResultsMessageElement.textContent=H(j.noMatchesFound)}addSearchResult(e){const t=e.matchesCount();this.searchMatchesCount+=t,this.searchResultsCount++,t&&this.nonEmptySearchResultsCount++,this.updateSearchResultsMessage()}searchFinished(e){this.searchMessageElement.textContent=H(e?j.searchFinished:j.searchInterrupted)}focus(){this.search.focus(),this.search.select()}willHide(){this.stopSearch()}onKeyDown(e){switch(this.save(),e.keyCode){case Sr.Enter.code:this.onAction();break}}onKeyDownOnPanel(e){const t=dn(),i=t&&e.metaKey&&!e.ctrlKey&&e.altKey&&e.code==="BracketRight",s=!t&&e.ctrlKey&&!e.metaKey&&e.shiftKey&&e.code==="BracketRight",n=t&&e.metaKey&&!e.ctrlKey&&e.altKey&&e.code==="BracketLeft",o=!t&&e.ctrlKey&&!e.metaKey&&e.shiftKey&&e.code==="BracketLeft";i||s?(this.searchResultsPane?.showAllMatches(),ys(e.currentTarget,e,"show-all-matches")):(n||o)&&(this.searchResultsPane?.collapseAllResults(),ys(e.currentTarget,e,"collapse-all-results"))}save(){this.advancedSearchConfig.set(this.buildSearchConfig().toPlainObject())}load(){const e=ke.fromPlainObject(this.advancedSearchConfig.get());this.search.value=e.query(),this.matchCaseButton.toggled=!e.ignoreCase(),this.matchCaseButtonToggled(),this.regexButton.toggled=e.isRegex(),this.regexButtonToggled()}onAction(){const e=this.buildSearchConfig();!e.query()||!e.query().length||(this.resetSearch(),++this.searchId,this.initScope(),this.isIndexing||this.startIndexing(),this.pendingSearchConfig=e)}get throttlerForTest(){return this.#e}}class Te{searchId;searchResultCandidates;searchResultCallback;searchFinishedCallback;searchConfig;constructor(){this.searchId=0,this.searchResultCandidates=[],this.searchResultCallback=null,this.searchFinishedCallback=null,this.searchConfig=null}static filesComparator(e,t){if(e.isDirty()&&!t.isDirty())return-1;if(!e.isDirty()&&t.isDirty())return 1;const i=e.project().type()===b.FileSystem&&!P.instance().binding(e),s=t.project().type()===b.FileSystem&&!P.instance().binding(t);if(i!==s)return i?1:-1;const n=e.url(),o=t.url();return n&&!o?-1:!n&&o?1:Kt(e.fullDisplayName(),t.fullDisplayName())}static urlComparator(e,t){return Kt(e.url(),t.url())}performIndexing(e){this.stopSearch();const t=this.projects(),i=new ri(e);for(let s=0;s<t.length;++s){const n=t[s],o=i.createSubProgress([...n.uiSourceCodes()].length);n.indexContent(o)}}projects(){const e=v.instance().moduleSetting("search-in-anonymous-and-content-scripts").get();return te.instance().projects().filter(t=>!(t.type()===b.Service||!e&&t.isServiceProject()&&t.type()!==b.Formatter||!e&&t.type()===b.ContentScripts))}performSearch(e,t,i,s){this.stopSearch(),this.searchResultCandidates=[],this.searchResultCallback=i,this.searchFinishedCallback=s,this.searchConfig=e;const n=[],o=new ri(t),r=o.createSubProgress(),c=new ri(o.createSubProgress());for(const l of this.projects()){const d=[...l.uiSourceCodes()].length,h=c.createSubProgress(d),u=this.projectFilesMatchingFileQuery(l,e),p=l.findFilesMatchingSearchRequest(e,u,h).then(this.processMatchingFilesForProject.bind(this,this.searchId,l,e,u));n.push(p)}Promise.all(n).then(this.processMatchingFiles.bind(this,this.searchId,r,this.searchFinishedCallback.bind(this,!0)))}projectFilesMatchingFileQuery(e,t,i){const s=[];for(const n of e.uiSourceCodes()){if(!n.contentType().isTextType()||X.instance().isUserOrSourceMapIgnoreListedUISourceCode(n))continue;const o=P.instance().binding(n);o&&o.network===n||i&&!n.isDirty()||t.filePathMatchesFileQuery(n.fullDisplayName())&&s.push(n)}return s.sort(Te.urlComparator),s}processMatchingFilesForProject(e,t,i,s,n){if(e!==this.searchId&&this.searchFinishedCallback){this.searchFinishedCallback(!1);return}let o=[...n.keys()];o.sort(Te.urlComparator),o=vr(o,s,Te.urlComparator);const r=this.projectFilesMatchingFileQuery(t,i,!0);o=ai(o,r,Te.urlComparator);const c=[];for(const l of o){const d=Cr.scriptForUISourceCode(l);d&&!d.isAnonymousScript()||c.push(l)}c.sort(Te.filesComparator),this.searchResultCandidates=ai(this.searchResultCandidates,c,Te.filesComparator)}processMatchingFiles(e,t,i){if(e!==this.searchId&&this.searchFinishedCallback){this.searchFinishedCallback(!1);return}const s=this.searchResultCandidates;if(!s.length){t.done(),i();return}t.setTotalWork(s.length);let n=0;const o=20;let r=0;for(let h=0;h<o&&h<s.length;++h)l.call(this);function c(h){h.isDirty()?d.call(this,h,new Ir(h.workingCopy())):h.requestContentData().then(u=>{d.call(this,h,yr.contentDataOrEmpty(u).textObj)})}function l(){if(n>=s.length){if(!r){t.done(),i();return}return}++r;const h=s[n++];window.setTimeout(c.bind(this,h),0)}function d(h,u){t.incrementWorked(1);let p=[];const m=this.searchConfig,f=m.queries();if(u!==null){for(let w=0;w<f.length;++w){const V=Er(u,f[w],!m.ignoreCase(),m.isRegex());p=ai(p,V,Es.comparator)}m.queries().length||(p=[new Es(0,u.lineAt(0),0,0)])}if(p&&this.searchResultCallback){const w=new qn(h,p);this.searchResultCallback(w)}--r,l.call(this)}}stopSearch(){++this.searchId}}class qn{uiSourceCode;searchMatches;constructor(e,t){this.uiSourceCode=e,this.searchMatches=t}label(){return this.uiSourceCode.displayName()}description(){return this.uiSourceCode.fullDisplayName()}matchesCount(){return this.searchMatches.length}matchLineContent(e){return this.searchMatches[e].lineContent}matchRevealable(e){const{lineNumber:t,columnNumber:i,matchLength:s}=this.searchMatches[e],n=new Tt(t,i,t,i+s);return new wr(this.uiSourceCode,n)}matchLabel(e){return String(this.searchMatches[e].lineNumber+1)}matchColumn(e){return this.searchMatches[e].columnNumber}matchLength(e){return this.searchMatches[e].matchLength}}const pd=Object.freeze(Object.defineProperty({__proto__:null,FileBasedSearchResult:qn,SourcesSearchScope:Te},Symbol.toStringTag,{value:"Module"}));class hs{query;constructor(e){this.query=e}}class Gn extends yc{constructor(){super("sources",new qt(200))}createScope(){return new Te}}let Ec=class{handleAction(e,t){switch(t){case"sources.search":{const i=Me.instance().element.window().getSelection(),s=i?i.toString().replace(/\r?\n.*/,""):"";return Oe(new hs(s)),!0}}return!1}};class xc{async reveal({query:e},t){const i=O.instance();await i.showView("sources.search-sources-tab",!0,t);const s=i.materializedWidget("sources.search-sources-tab");s instanceof Gn&&s.toggle(e)}}const gd=Object.freeze(Object.defineProperty({__proto__:null,ActionDelegate:Ec,Revealer:xc,SearchSources:hs,SearchSourcesView:Gn},Symbol.toStringTag,{value:"Module"})),L={searchInFolder:"Search in folder",searchInAllFiles:"Search in all files",noDomain:"(no domain)",authored:"Authored",authoredTooltip:"Contains original sources",deployed:"Deployed",deployedTooltip:"Contains final sources the browser sees",areYouSureYouWantToExcludeThis:"Are you sure you want to exclude this folder?",areYouSureYouWantToDeleteThis:"Are you sure you want to delete this file?",rename:"Rename…",makeACopy:"Make a copy…",delete:"Delete",remove:"Remove",areYouSureYouWantToDeleteFolder:"Are you sure you want to delete this folder and its contents?",actionCannotBeUndone:"This action cannot be undone.",openFolder:"Open folder",newFile:"New file",excludeFolder:"Exclude from workspace",removeFolderFromWorkspace:"Remove from workspace",areYouSureYouWantToRemoveThis:"Remove ‘{PH1}’ from Workspace?",workspaceStopSyncing:"This will stop syncing changes from DevTools to your sources.",sFromSourceMap:"{PH1} (from source map)",sIgnoreListed:"{PH1} (ignore listed)"},Tc=M("panels/sources/NavigatorView.ts",L),F=N.bind(void 0,Tc),S={Authored:"authored",Deployed:"deployed",Domain:"domain",File:"file",FileSystem:"fs",FileSystemFolder:"fs-folder",Frame:"frame",NetworkFolder:"nw-folder",Root:"root",Worker:"worker"},kc=new Map([[S.Root,1],[S.Authored,1],[S.Deployed,5],[S.Domain,10],[S.FileSystemFolder,1],[S.NetworkFolder,1],[S.File,10],[S.Frame,70],[S.Worker,90],[S.FileSystem,100]]);class ce extends Be{placeholder;scriptsTree;uiSourceCodeNodes;subfolderNodes;rootNode;frameNodes;authoredNode;deployedNode;navigatorGroupByFolderSetting;navigatorGroupByAuthoredExperiment;workspaceInternal;groupByFrame;groupByAuthored;groupByDomain;groupByFolder;constructor(e,t){super(!0),this.placeholder=null,this.scriptsTree=new cn("NavigationTree"),this.scriptsTree.hideOverflow(),this.scriptsTree.setComparator(ce.treeElementsCompare),this.scriptsTree.setFocusable(!1),this.contentElement.setAttribute("jslog",`${hn(e).track({resize:!0})}`),this.contentElement.appendChild(this.scriptsTree.element),this.setDefaultFocusedElement(this.scriptsTree.element),this.uiSourceCodeNodes=new xr,this.subfolderNodes=new Map,this.rootNode=new Kn(this),this.rootNode.populate(),this.frameNodes=new Map,this.contentElement.addEventListener("contextmenu",this.handleContextMenu.bind(this),!1),vt.instance().addShortcutListener(this.contentElement,{"sources.rename":this.renameShortcut.bind(this)}),this.navigatorGroupByFolderSetting=v.instance().moduleSetting("navigator-group-by-folder"),this.navigatorGroupByFolderSetting.addChangeListener(this.groupingChanged.bind(this)),t&&(this.navigatorGroupByAuthoredExperiment="authored-deployed-grouping"),X.instance().addChangeListener(this.ignoreListChanged.bind(this)),this.initGrouping(),P.instance().addEventListener(Jt.BindingCreated,this.onBindingChanged,this),P.instance().addEventListener(Jt.BindingRemoved,this.onBindingChanged,this),Ae.instance().addEventListener("RequestsForHeaderOverridesFileChanged",this.#e,this),T.instance().addEventListener("NameChanged",this.targetNameChanged,this),T.instance().observeTargets(this),this.resetWorkspace(te.instance()),this.workspaceInternal.uiSourceCodes().forEach(this.addUISourceCode.bind(this)),xs.instance().addEventListener("FrameAttributionAdded",this.frameAttributionAdded,this),xs.instance().addEventListener("FrameAttributionRemoved",this.frameAttributionRemoved,this)}static treeElementOrder(e){if(bi.has(e))return 0;const t=e;let i=kc.get(t.nodeType)||0;if(t.uiSourceCode){const s=t.uiSourceCode.contentType();s.isDocument()?i+=3:s.isScript()?i+=5:s.isStyleSheet()?i+=10:i+=15}return i}static appendSearchItem(e,t){const i=F(t?L.searchInFolder:L.searchInAllFiles),s=new hs(t&&`file:${t}`);e.viewSection().appendItem(i,()=>Oe(s),{jslogContext:t?"search-in-folder":"search-in-all-files"})}static treeElementsCompare(e,t){const i=ce.treeElementOrder(e),s=ce.treeElementOrder(t);return i>s?1:i<s?-1:Kt(e.titleAsText(),t.titleAsText())}setPlaceholder(e){console.assert(!this.placeholder,"A placeholder widget was already set"),this.placeholder=e,e.show(this.contentElement,this.contentElement.firstChild),t.call(this),this.scriptsTree.addEventListener(Ts.ElementAttached,t.bind(this)),this.scriptsTree.addEventListener(Ts.ElementsDetached,t.bind(this));function t(){const i=this.scriptsTree.firstChild();i?e.hideWidget():e.showWidget(),this.scriptsTree.element.classList.toggle("hidden",!i)}}onBindingChanged(e){const t=e.data;let i=!1;const s=this.uiSourceCodeNodes.get(t.network);for(const l of s)l.updateTitle(),i||=l.uiSourceCode().contentType().isFromSourceMap();const n=this.uiSourceCodeNodes.get(t.fileSystem);for(const l of n)l.updateTitle(),i||=l.uiSourceCode().contentType().isFromSourceMap();const o=we.relativePath(t.fileSystem);let r=ht;for(let l=0;l<o.length-1;++l){r=z.concatenate(r,o[l]);const d=this.folderNodeId(t.fileSystem.project(),null,null,t.fileSystem.origin(),i,r),h=this.subfolderNodes.get(d);h&&h.updateTitle(),r=z.concatenate(r,"/")}const c=this.rootOrDeployedNode().child(t.fileSystem.project().id());c&&c.updateTitle()}#e(e){const t=e.data,i=this.uiSourceCodeNodes.get(t);for(const s of i)s.updateTitle()}focus(){this.scriptsTree.focus()}appendChild(e,t){this.scriptsTree.setFocusable(!0),e.appendChild(t)}removeChild(e,t){e.removeChild(t),this.scriptsTree.rootElement().childCount()===0&&this.scriptsTree.setFocusable(!1)}resetWorkspace(e){this.workspaceInternal&&(this.workspaceInternal.removeEventListener(Y.UISourceCodeAdded,this.uiSourceCodeAddedCallback,this),this.workspaceInternal.removeEventListener(Y.UISourceCodeRemoved,this.uiSourceCodeRemovedCallback,this),this.workspaceInternal.removeEventListener(Y.ProjectAdded,this.projectAddedCallback,this),this.workspaceInternal.removeEventListener(Y.ProjectRemoved,this.projectRemovedCallback,this)),this.workspaceInternal=e,this.workspaceInternal.addEventListener(Y.UISourceCodeAdded,this.uiSourceCodeAddedCallback,this),this.workspaceInternal.addEventListener(Y.UISourceCodeRemoved,this.uiSourceCodeRemovedCallback,this),this.workspaceInternal.addEventListener(Y.ProjectAdded,this.projectAddedCallback,this),this.workspaceInternal.addEventListener(Y.ProjectRemoved,this.projectRemovedCallback,this),this.workspaceInternal.projects().forEach(this.projectAdded.bind(this)),this.computeUniqueFileSystemProjectNames()}projectAddedCallback(e){const t=e.data;this.projectAdded(t),t.type()===b.FileSystem&&this.computeUniqueFileSystemProjectNames()}projectRemovedCallback(e){const t=e.data;this.removeProject(t),t.type()===b.FileSystem&&this.computeUniqueFileSystemProjectNames()}workspace(){return this.workspaceInternal}acceptProject(e){return!e.isServiceProject()}frameAttributionAdded(e){const{uiSourceCode:t}=e.data;if(!this.acceptsUISourceCode(t))return;const i=e.data.frame;this.addUISourceCodeNode(t,i)}frameAttributionRemoved(e){const{uiSourceCode:t}=e.data;if(!this.acceptsUISourceCode(t))return;const i=e.data.frame,s=Array.from(this.uiSourceCodeNodes.get(t)).find(n=>n.frame()===i);s&&this.removeUISourceCodeNode(s)}acceptsUISourceCode(e){return this.acceptProject(e.project())}addUISourceCode(e){if(Ne.isEnabled("just-my-code")&&X.instance().isUserOrSourceMapIgnoreListedUISourceCode(e)||!this.acceptsUISourceCode(e)||e.isFetchXHR())return;const t=Qe.framesForUISourceCode(e);if(t.length)for(const i of t)this.addUISourceCodeNode(e,i);else this.addUISourceCodeNode(e,null);this.uiSourceCodeAdded(e)}addUISourceCodeNode(e,t){const i=e.contentType().isFromSourceMap();let s;e.project().type()===b.FileSystem?s=we.relativePath(e).slice(0,-1):s=z.extractPath(e.url()).split("/").slice(1,-1);const n=e.project(),o=Qe.targetForUISourceCode(e),r=this.folderNode(e,n,o,t,e.origin(),s,i),c=new Vt(this,e,t),l=r.child(c.id);l&&l instanceof Vt?this.uiSourceCodeNodes.set(e,l):(r.appendChild(c),this.uiSourceCodeNodes.set(e,c),c.updateTitleBubbleUp()),this.selectDefaultTreeNode()}uiSourceCodeAdded(e){}uiSourceCodeAddedCallback(e){const t=e.data;this.addUISourceCode(t)}uiSourceCodeRemovedCallback(e){this.removeUISourceCodes([e.data])}tryAddProject(e){this.projectAdded(e);for(const t of e.uiSourceCodes())this.addUISourceCode(t)}projectAdded(e){const t=this.rootOrDeployedNode();!this.acceptProject(e)||e.type()!==b.FileSystem||os(e)||t.child(e.id())||(t.appendChild(new de(this,e,e.id(),S.FileSystem,e.displayName())),this.selectDefaultTreeNode())}selectDefaultTreeNode(){const e=this.rootNode.children();e.length&&!this.scriptsTree.selectedTreeElement&&e[0].treeNode().select(!0,!1)}computeUniqueFileSystemProjectNames(){const e=this.workspaceInternal.projectsForType(b.FileSystem);if(!e.length)return;const t=Tr.newArrayTrie(),i=[];for(const n of e){const r=n.fileSystemPath().split("/").reverse();i.push(r),t.add(r)}const s=this.rootOrDeployedNode();for(let n=0;n<e.length;++n){const o=i[n],r=e[n];t.remove(o);const c=t.longestPrefix(o,!1);t.add(o);const l=o.slice(0,c.length+1),d=z.encodedPathToRawPathString(l.reverse().join("/")),h=s.child(r.id());h&&h.setTitle(d)}}removeProject(e){if(this.removeUISourceCodes(e.uiSourceCodes()),e.type()!==b.FileSystem)return;const t=this.rootNode.child(e.id());t&&this.rootNode.removeChild(t)}folderNodeId(e,t,i,s,n,o){const r=e.type()===b.FileSystem?e.id():"";let c=t&&!(this.groupByAuthored&&n)?t.id():"",l=this.groupByFrame&&i?i.id:"";return this.groupByAuthored&&(n?(c="Authored",l=""):c="Deployed:"+c),c+":"+r+":"+l+":"+s+":"+o}folderNode(e,t,i,s,n,o,r){if(Xt(e))return this.rootNode;if(i&&!this.groupByFolder&&!r)return this.domainNode(e,t,i,s,n);const c=z.join(o,"/"),l=this.folderNodeId(t,i,s,n,r,c);let d=this.subfolderNodes.get(l);if(d)return d;if(!o.length)return i?this.domainNode(e,t,i,s,n):this.rootOrDeployedNode().child(t.id());const h=this.folderNode(e,t,i,s,n,o.slice(0,-1),r);let u=S.NetworkFolder;t.type()===b.FileSystem&&(u=S.FileSystemFolder);const p=z.encodedPathToRawPathString(o[o.length-1]);return d=new Le(this,t,l,u,c,p,n),this.subfolderNodes.set(l,d),h.appendChild(d),d}domainNode(e,t,i,s,n){const o=e.contentType().isFromSourceMap(),r=this.frameNode(t,i,s,o);if(!this.groupByDomain)return r;let c=r.child(n);return c||(c=new de(this,t,n,S.Domain,this.computeProjectDisplayName(i,n)),s&&n===z.extractOrigin(s.url)&&bi.add(c.treeNode()),r.appendChild(c),o&&this.groupByAuthored&&c.treeNode().expand(),c)}frameNode(e,t,i,s){if(!this.groupByFrame||!i||this.groupByAuthored&&s)return this.targetNode(e,t,s);let n=this.frameNodes.get(i);if(n)return n;n=new de(this,e,t.id()+":"+i.id,S.Frame,i.displayName()),n.setHoverCallback(r),this.frameNodes.set(i,n);const o=i.parentFrame();this.frameNode(e,o?o.resourceTreeModel().target():t,o,s).appendChild(n),o||(bi.add(n.treeNode()),n.treeNode().expand());function r(c){if(c){const l=t.model(Ni);l&&i&&l.highlightFrame(i.id)}else Ni.hideDOMNodeHighlight()}return n}targetNode(e,t,i){if(this.groupByAuthored&&i)return this.authoredNode||(this.authoredNode=new de(this,null,"group:Authored",S.Authored,F(L.authored),F(L.authoredTooltip)),this.rootNode.appendChild(this.authoredNode),this.authoredNode.treeNode().expand()),this.authoredNode;const s=this.rootOrDeployedNode();if(t===T.instance().scopeTarget())return s;let n=s.child("target:"+t.id());return n||(n=new de(this,e,"target:"+t.id(),t.type()===kr.FRAME?S.Frame:S.Worker,t.name()),s.appendChild(n)),n}rootOrDeployedNode(){return this.groupByAuthored?(this.deployedNode||(this.deployedNode=new de(this,null,"group:Deployed",S.Deployed,F(L.deployed),F(L.deployedTooltip)),this.rootNode.appendChild(this.deployedNode)),this.deployedNode):this.rootNode}computeProjectDisplayName(e,t){const i=e.model(Lr),s=i?i.executionContexts():[];let n=null;for(const c of s)if(!(!c.origin||!t.startsWith(c.origin))){if(c.isDefault){n=null;break}c.name&&(n=c.name)}if(n)return n;if(!t)return F(L.noDomain);const o=new z(t);return(o.isValid?o.host+(o.port?":"+o.port:""):"")||t}revealUISourceCode(e,t){const i=this.uiSourceCodeNodes.get(e);if(i.size===0)return null;const s=i.values().next().value;if(!s)return null;if(this.scriptsTree.selectedTreeElement){if(un(this.scriptsTree.selectedTreeElement.treeOutline?.element))return null;this.scriptsTree.selectedTreeElement.deselect()}return s.reveal(t),s}sourceSelected(e,t){Oe(e,!t)}#t(e){const t=this.scriptsTree.selectedTreeElement,i=t&&t.node;let s=e;for(;s;){if(s===i)return!0;if(s=s.parent,!(e instanceof de||e instanceof ot))break}return!1}removeUISourceCodes(e){const t=[];for(const i of e){const s=this.uiSourceCodeNodes.get(i);for(const n of s)this.#t(n)?t.push(n):this.removeUISourceCodeNode(n)}t.forEach(this.removeUISourceCodeNode.bind(this))}removeUISourceCodeNode(e){const t=e.uiSourceCode();this.uiSourceCodeNodes.delete(t,e);const i=t.project(),s=Qe.targetForUISourceCode(t);let n=e.frame(),o=e.parent;if(!o)return;o.removeChild(e);let r=o;for(;r&&(o=r.parent,!(!o||(o===this.rootNode||o===this.deployedNode)&&i.type()===b.FileSystem||!(r instanceof de||r instanceof Le)));){if(!r.isEmpty()){r.updateTitleBubbleUp();break}if(r.type===S.Frame)this.discardFrame(n,!!this.groupByAuthored&&t.contentType().isFromSourceMap()),n=n.parentFrame();else{const c=this.folderNodeId(i,s,n,t.origin(),t.contentType().isFromSourceMap(),r instanceof Le&&r.folderPath||ht);this.subfolderNodes.delete(c),o.removeChild(r)}r===this.authoredNode?this.authoredNode=void 0:r===this.deployedNode&&(this.deployedNode=void 0),r=o}}reset(e){for(const t of this.uiSourceCodeNodes.valuesArray())t.dispose();this.scriptsTree.removeChildren(),this.scriptsTree.setFocusable(!1),this.uiSourceCodeNodes.clear(),this.subfolderNodes.clear(),this.frameNodes.clear(),this.rootNode.reset(),this.authoredNode=void 0,this.deployedNode=void 0,e||this.resetWorkspace(te.instance())}handleContextMenu(e){}async renameShortcut(){const e=this.scriptsTree.selectedTreeElement,t=e&&e.node;return!t||!t.uiSourceCode()||!t.uiSourceCode().canRename()?!1:(this.rename(t,!1),!0)}handleContextMenuCreate(e,t,i){if(i){const s=we.relativePath(i);s.pop(),t=z.join(s,"/")}this.create(e,t,i)}handleContextMenuRename(e){this.rename(e,!1)}async handleContextMenuExclude(e,t){await Ft.show(F(L.areYouSureYouWantToExcludeThis),void 0,{jslogContext:"exclude-folder-confirmation"})&&(mn(),e.excludeFolder(we.completeURL(e,t)),pn())}async handleContextMenuDelete(e){await Ft.show(F(L.areYouSureYouWantToDeleteThis),void 0,{jslogContext:"delete-file-confirmation"})&&e.project().deleteFile(e)}handleFileContextMenu(e,t){const i=t.uiSourceCode(),s=new Re(e);s.appendApplicableItems(i);const n=i.project();n.type()===b.FileSystem&&(s.editSection().appendItem(F(L.rename),this.handleContextMenuRename.bind(this,t),{jslogContext:"rename"}),s.editSection().appendItem(F(L.makeACopy),this.handleContextMenuCreate.bind(this,n,ht,i),{jslogContext:"make-a-copy"}),s.editSection().appendItem(F(L.delete),this.handleContextMenuDelete.bind(this,i),{jslogContext:"delete"})),s.show()}async handleDeleteFolder(e){const t=`${F(L.areYouSureYouWantToDeleteFolder)}
${F(L.actionCannotBeUndone)}`;if(await Ft.show(t,void 0,{jslogContext:"delete-folder-confirmation"})){ne.actionTaken(Pe.OverrideTabDeleteFolderContextMenu);const s=this.findTopNonMergedNode(e);await this.removeUISourceCodeFromProject(s),await this.deleteDirectoryRecursively(s)}}async removeUISourceCodeFromProject(e){e.children().forEach(async t=>{await this.removeUISourceCodeFromProject(t)}),e instanceof Vt&&e.uiSourceCode().project().removeUISourceCode(e.uiSourceCode().url())}async deleteDirectoryRecursively(e){e instanceof Le&&await Ae.instance().project()?.deleteDirectoryRecursively(e.folderPath)}findTopNonMergedNode(e){return!e.isMerged||!(e.parent instanceof Le)?e:this.findTopNonMergedNode(e.parent)}handleFolderContextMenu(e,t){const i=t.folderPath||ht,s=t.project||null,n=new Re(e);if(ce.appendSearchItem(n,i),!!s){if(s.type()===b.FileSystem){const o=z.urlToRawPathString(we.completeURL(s,i),Pr());n.revealSection().appendItem(F(L.openFolder),()=>Je.showItemInFolder(o),{jslogContext:"open-folder"}),s.canCreateFile()&&n.defaultSection().appendItem(F(L.newFile),()=>{this.handleContextMenuCreate(s,i,void 0)},{jslogContext:"new-file"})}else if(t.origin&&t.folderPath){const o=z.concatenate(t.origin,"/",t.folderPath),r={isContentScript:t.recursiveProperties.exclusivelyContentScripts||!1,isKnownThirdParty:t.recursiveProperties.exclusivelyThirdParty||!1,isCurrentlyIgnoreListed:t.recursiveProperties.exclusivelyIgnored||!1};for(const{text:c,callback:l,jslogContext:d}of X.instance().getIgnoreListFolderContextMenuItems(o,r))n.defaultSection().appendItem(c,l,{jslogContext:d})}s.canExcludeFolder(i)&&n.defaultSection().appendItem(F(L.excludeFolder),this.handleContextMenuExclude.bind(this,s,i),{jslogContext:"exclude-folder"}),s.type()===b.FileSystem&&(s.fileSystem().type()==="overrides"?t instanceof de||n.defaultSection().appendItem(F(L.delete),this.handleDeleteFolder.bind(this,t),{jslogContext:"delete"}):t instanceof de&&n.defaultSection().appendItem(F(L.removeFolderFromWorkspace),async()=>{const r=`${F(L.areYouSureYouWantToRemoveThis,{PH1:t.title})}
${F(L.workspaceStopSyncing)}`;await Ft.show(r,void 0,{okButtonLabel:F(L.remove),jslogContext:"remove-folder-from-workspace-confirmation"})&&s.remove()},{jslogContext:"remove-folder-from-workspace"})),n.show()}}rename(e,t){const i=e.uiSourceCode();e.rename(s.bind(this));function s(n){t&&(n?e.treeElement&&e.treeElement.listItemElement.hasFocus()&&this.sourceSelected(i,!0):i.remove())}}async create(e,t,i){let s="";i&&(s=(await i.requestContent()).content||"");const n=await e.createFile(t,null,s);if(!n)return;this.sourceSelected(n,!1);const o=this.revealUISourceCode(n,!0);o&&this.rename(o,!0)}groupingChanged(){this.reset(!0),this.initGrouping(),this.resetWorkspace(te.instance()),this.workspaceInternal.uiSourceCodes().forEach(this.addUISourceCode.bind(this))}ignoreListChanged(){Ne.isEnabled("just-my-code")?this.groupingChanged():this.rootNode.updateTitleRecursive()}initGrouping(){this.groupByFrame=!0,this.groupByDomain=this.navigatorGroupByFolderSetting.get(),this.groupByFolder=this.groupByDomain,this.navigatorGroupByAuthoredExperiment?this.groupByAuthored=Ne.isEnabled(this.navigatorGroupByAuthoredExperiment):this.groupByAuthored=!1}resetForTest(){this.reset(),this.workspaceInternal.uiSourceCodes().forEach(this.addUISourceCode.bind(this))}discardFrame(e,t){if(t)return;const i=this.frameNodes.get(e);if(i){i.parent&&i.parent.removeChild(i),this.frameNodes.delete(e);for(const s of e.childFrames)this.discardFrame(s,t)}}targetAdded(e){}targetRemoved(e){const t=this.rootOrDeployedNode(),i=t.child("target:"+e.id());i&&t.removeChild(i)}targetNameChanged(e){const t=e.data,i=this.rootOrDeployedNode().child("target:"+t.id());i&&i.setTitle(t.name())}wasShown(){super.wasShown(),this.scriptsTree.registerCSSFiles([Hn]),this.registerCSSFiles([$n])}}const bi=new WeakSet;class ot extends Xe{nodeType;navigatorView;hoverCallback;node;hovered;isIgnoreListed;isFromSourceMap;constructor(e,t,i,s){super("",!0,ot.#e(t)),this.listItemElement.classList.add("navigator-"+t+"-tree-item","navigator-folder-tree-item"),ue(this.listItemElement,`${i}, ${t}`),this.nodeType=t,this.title=i,this.tooltip=i,this.navigatorView=e,this.hoverCallback=s,this.isFromSourceMap=!1;let n="folder";t===S.Domain?n="cloud":t===S.Frame?n="frame":t===S.Worker?n="gears":t===S.Authored?n="code":t===S.Deployed&&(n="deployed");const o=ss(n);this.setLeadingIcons([o])}async onpopulate(){this.node.populate()}onattach(){this.collapse(),this.node.onattach(),this.listItemElement.addEventListener("contextmenu",this.handleContextMenuEvent.bind(this),!1),this.listItemElement.addEventListener("mousemove",this.mouseMove.bind(this),!1),this.listItemElement.addEventListener("mouseleave",this.mouseLeave.bind(this),!1)}setIgnoreListed(e){this.isIgnoreListed!==e&&(this.isIgnoreListed=e,this.listItemElement.classList.toggle("is-ignore-listed",e),this.updateTooltip())}setFromSourceMap(e){this.isFromSourceMap=e,this.listItemElement.classList.toggle("is-from-source-map",e)}setNode(e){this.node=e,this.updateTooltip(),ue(this.listItemElement,`${this.title}, ${this.nodeType}`)}updateTooltip(){if(this.node.tooltip)this.tooltip=this.node.tooltip;else{const e=[];let t=this.node;for(;t&&!t.isRoot()&&t.type===this.node.type;)e.push(t.title),t=t.parent;e.reverse();let i=e.join("/");this.isIgnoreListed&&(i=F(L.sIgnoreListed,{PH1:i})),this.tooltip=i}}handleContextMenuEvent(e){this.node&&(this.select(),this.navigatorView.handleFolderContextMenu(e,this.node))}mouseMove(e){this.hovered||!this.hoverCallback||(this.hovered=!0,this.hoverCallback(!0))}mouseLeave(e){this.hoverCallback&&(this.hovered=!1,this.hoverCallback(!1))}static#e(e){switch(e){case S.Domain:return"domain";case S.Frame:return"frame";case S.Worker:return"worker";case S.Authored:return"authored";case S.Deployed:return"deployed"}return"folder"}}class Yn extends Xe{nodeType;node;navigatorView;uiSourceCodeInternal;aiButtonContainer;constructor(e,t,i,s){super("",!1,t.contentType().name()),this.nodeType=S.File,this.node=s,this.title=i,this.listItemElement.classList.add("navigator-"+t.contentType().name()+"-tree-item","navigator-file-tree-item"),this.tooltip=t.url(),ue(this.listItemElement,`${t.name()}, ${this.nodeType}`),rs("source-tree-file-added",t.fullDisplayName()),this.navigatorView=e,this.uiSourceCodeInternal=t,this.updateIcon(),this.titleElement.setAttribute("jslog",`${Fr("title").track({change:!0})}`)}updateIcon(){const e=ja.getIconForSourceFile(this.uiSourceCodeInternal);this.setLeadingIcons([e])}updateAccessibleName(){ue(this.listItemElement,`${this.uiSourceCodeInternal.name()}, ${this.nodeType}`)}createAiButton(){if(!Se.instance().hasAction("drjones.sources-floating-button"))return;const e=Se.instance().getAction("drjones.sources-floating-button");if(!this.aiButtonContainer){this.aiButtonContainer=this.listItemElement.createChild("span","ai-button-container");const t=new Ba({iconName:"smart-assistant"});t.addEventListener("click",i=>{i.stopPropagation(),this.navigatorView.sourceSelected(this.uiSourceCode,!1),e.execute()},{capture:!0}),t.addEventListener("mousedown",i=>{i.stopPropagation()},{capture:!0}),this.aiButtonContainer.appendChild(t)}}get uiSourceCode(){return this.uiSourceCodeInternal}onattach(){this.listItemElement.draggable=!0,this.listItemElement.addEventListener("click",this.onclick.bind(this),!1),this.listItemElement.addEventListener("contextmenu",this.handleContextMenuEvent.bind(this),!1),this.listItemElement.addEventListener("dragstart",this.ondragstart.bind(this),!1),this.createAiButton()}shouldRenameOnMouseDown(){return!this.uiSourceCodeInternal.canRename()||!this.treeOutline?!1:this===this.treeOutline.selectedTreeElement&&this.treeOutline.element.hasFocus()&&!un(this.treeOutline.element)}selectOnMouseDown(e){if(e.which!==1||!this.shouldRenameOnMouseDown()){super.selectOnMouseDown(e);return}window.setTimeout(t.bind(this),300);function t(){this.shouldRenameOnMouseDown()&&this.navigatorView.rename(this.node,!1)}}ondragstart(e){e.dataTransfer&&(e.dataTransfer.setData("text/plain",this.uiSourceCodeInternal.url()),e.dataTransfer.effectAllowed="copy")}onspace(){return this.navigatorView.sourceSelected(this.uiSourceCode,!0),!0}onclick(e){this.navigatorView.sourceSelected(this.uiSourceCode,!1)}ondblclick(e){const t=e.button===1;return this.navigatorView.sourceSelected(this.uiSourceCode,!t),!1}onenter(){return this.navigatorView.sourceSelected(this.uiSourceCode,!0),!0}ondelete(){return!0}handleContextMenuEvent(e){this.select(),this.navigatorView.handleFileContextMenu(e,this.node)}}class Pt{id;navigatorView;type;childrenInternal;populated;isMerged;parent;title;tooltip;recursiveProperties;constructor(e,t,i,s){this.id=t,this.navigatorView=e,this.type=i,this.childrenInternal=new Map,this.tooltip=s,this.populated=!1,this.isMerged=!1,this.recursiveProperties={exclusivelySourceMapped:null,exclusivelyIgnored:null,exclusivelyContentScripts:null,exclusivelyThirdParty:null}}treeNode(){throw"Not implemented"}dispose(){}updateTitle(){}updateTitleRecursive(){for(const e of this.children())e.updateTitleRecursive();this.updateTitle()}updateTitleBubbleUp(){this.updateTitle(),this.parent&&this.parent.updateTitleBubbleUp()}isRoot(){return!1}hasChildren(){return!0}onattach(){}setTitle(e){throw"Not implemented"}populate(){this.isPopulated()||(this.parent&&this.parent.populate(),this.populated=!0,this.wasPopulated())}wasPopulated(){const e=this.children();for(let t=0;t<e.length;++t)this.navigatorView.appendChild(this.treeNode(),e[t].treeNode())}didAddChild(e){this.isPopulated()&&this.navigatorView.appendChild(this.treeNode(),e.treeNode())}willRemoveChild(e){this.isPopulated()&&this.navigatorView.removeChild(this.treeNode(),e.treeNode())}isPopulated(){return this.populated}isEmpty(){return!this.childrenInternal.size}children(){return[...this.childrenInternal.values()]}child(e){return this.childrenInternal.get(e)||null}appendChild(e){this.childrenInternal.set(e.id,e),e.parent=this,this.didAddChild(e)}removeChild(e){this.willRemoveChild(e),this.childrenInternal.delete(e.id),e.parent=null,e.dispose()}reset(){this.childrenInternal.clear()}}class Kn extends Pt{constructor(e){super(e,"",S.Root)}isRoot(){return!0}treeNode(){return this.navigatorView.scriptsTree.rootElement()}}class Vt extends Pt{uiSourceCodeInternal;treeElement;eventListeners;frameInternal;constructor(e,t,i){super(e,"UISourceCode:"+t.canononicalScriptId(),S.File),this.uiSourceCodeInternal=t,this.treeElement=null,this.eventListeners=[],this.frameInternal=i,this.recursiveProperties.exclusivelySourceMapped=t.contentType().isFromSourceMap(),t.contentType().isScript()&&(this.recursiveProperties.exclusivelyThirdParty=t.isKnownThirdParty(),this.recursiveProperties.exclusivelyContentScripts=t.project().type()===b.ContentScripts)}frame(){return this.frameInternal}uiSourceCode(){return this.uiSourceCodeInternal}treeNode(){if(this.treeElement)return this.treeElement;this.treeElement=new Yn(this.navigatorView,this.uiSourceCodeInternal,"",this),this.updateTitle();const e=this.updateTitle.bind(this,void 0);return this.eventListeners=[this.uiSourceCodeInternal.addEventListener(y.TitleChanged,e),this.uiSourceCodeInternal.addEventListener(y.WorkingCopyChanged,e),this.uiSourceCodeInternal.addEventListener(y.WorkingCopyCommitted,e)],this.treeElement}updateTitle(e){const t=X.instance().isUserOrSourceMapIgnoreListedUISourceCode(this.uiSourceCodeInternal);if((this.uiSourceCodeInternal.contentType().isScript()||t)&&(this.recursiveProperties.exclusivelyIgnored=t),!this.treeElement)return;let i=this.uiSourceCodeInternal.displayName();!e&&this.uiSourceCodeInternal.isDirty()&&(i="*"+i),this.treeElement.title=i,this.treeElement.updateIcon(),this.treeElement.listItemElement.classList.toggle("is-ignore-listed",t);let s=this.uiSourceCodeInternal.url();this.uiSourceCodeInternal.contentType().isFromSourceMap()&&(s=F(L.sFromSourceMap,{PH1:this.uiSourceCodeInternal.displayName()})),t&&(s=F(L.sIgnoreListed,{PH1:s})),this.treeElement.tooltip=s,this.treeElement.updateAccessibleName(),this.parent?.childrenInternal.delete(this.id),this.id="UISourceCode:"+this.uiSourceCodeInternal.canononicalScriptId(),this.parent?.childrenInternal.set(this.id,this)}hasChildren(){return!1}dispose(){wt(this.eventListeners)}reveal(e){this.parent&&(this.parent.populate(),this.parent.treeNode().expand()),this.treeElement&&(this.treeElement.reveal(!0),e&&this.treeElement.select(!0))}rename(e){if(!this.treeElement||(this.treeElement.listItemElement.focus(),!this.treeElement.treeOutline))return;const t=this.treeElement.treeOutline.element;ci(t,!0);function i(o,r,c){if(r!==c){this.treeElement&&(this.treeElement.title=r),this.uiSourceCodeInternal.rename(r).then(s.bind(this));return}n.call(this,!0)}function s(o){if(!o){ci(t,!1),this.updateTitle(),this.rename(e);return}if(this.treeElement){const{parent:r}=this.treeElement;r&&(r.removeChild(this.treeElement),r.appendChild(this.treeElement),this.treeElement.select())}n.call(this,!0)}function n(o){ci(t,!1),this.updateTitle(),e&&e(o)}this.updateTitle(!0),this.treeElement.startEditingTitle(new Mr(i.bind(this),n.bind(this,!1)))}}class Le extends Pt{project;folderPath;origin;title;treeElement;constructor(e,t,i,s,n,o,r){super(e,i,s),this.project=t,this.folderPath=n,this.title=o,this.origin=r}treeNode(){return this.treeElement?this.treeElement:(this.treeElement=this.createTreeElement(this.title,this),this.updateTitle(),this.treeElement)}updateTitle(){let e;for(e in this.recursiveProperties){let s=null;for(const n of this.children())if(n.recursiveProperties[e]===!1){s=!1;break}else n.recursiveProperties[e]&&(s=!0);this.recursiveProperties[e]=s}if(!this.treeElement||(this.treeElement.setFromSourceMap(this.recursiveProperties.exclusivelySourceMapped||!1),this.treeElement.setIgnoreListed(this.recursiveProperties.exclusivelyIgnored||!1),!this.project||this.project.type()!==b.FileSystem))return;const t=z.concatenate(we.fileSystemPath(this.project.id()),"/",this.folderPath),i=P.instance().filePathHasBindings(t);this.treeElement.listItemElement.classList.toggle("has-mapped-files",i)}createTreeElement(e,t){const i=new ot(this.navigatorView,this.type,e);return i.setNode(t),i}wasPopulated(){!this.treeElement||this.treeElement.node!==this||this.addChildrenRecursive()}addChildrenRecursive(){const e=this.children();for(let t=0;t<e.length;++t){const i=e[t];this.didAddChild(i),i instanceof Le&&i.addChildrenRecursive()}}shouldMerge(e){return this.type!==S.Domain&&e instanceof Le}didAddChild(e){if(!this.treeElement)return;let t=this.children();if(t.length===1&&this.shouldMerge(e)){e.isMerged=!0,this.treeElement.title=this.treeElement.title+"/"+e.title,e.treeElement=this.treeElement,e.updateTitle(),this.treeElement.setNode(e);return}let i;if(t.length===2&&(i=t[0]!==e?t[0]:t[1]),i&&i.isMerged){i.isMerged=!1;const s=[];s.push(this);let n=this;for(;n&&n.isMerged;)n=n.parent,n&&s.push(n);s.reverse();const o=s.map(d=>d.title).join("/"),r=[];n=i;do r.push(n),t=n.children(),n=t.length===1?t[0]:null;while(n&&n.isMerged);if(!this.isPopulated()){this.treeElement.title=o,this.treeElement.setNode(this);for(let d=0;d<r.length;++d)r[d].treeElement=null,r[d].isMerged=!1;this.updateTitle();return}const c=this.treeElement,l=this.createTreeElement(o,this);for(let d=0;d<s.length;++d)s[d].treeElement=l,s[d].updateTitle();c.parent&&this.navigatorView.appendChild(c.parent,l),c.setNode(r[r.length-1]),c.title=r.map(d=>d.title).join("/"),c.parent&&this.navigatorView.removeChild(c.parent,c),this.navigatorView.appendChild(this.treeElement,c),c.expanded&&l.expand(),this.updateTitle()}this.isPopulated()&&this.navigatorView.appendChild(this.treeElement,e.treeNode())}willRemoveChild(e){const t=e;t.isMerged||!this.isPopulated()||!this.treeElement||!t.treeElement||this.navigatorView.removeChild(this.treeElement,t.treeElement)}}class de extends Pt{project;title;hoverCallback;treeElement;constructor(e,t,i,s,n,o){super(e,i,s,o),this.project=t,this.title=n,this.populate()}setHoverCallback(e){this.hoverCallback=e}treeNode(){return this.treeElement?this.treeElement:(this.treeElement=new ot(this.navigatorView,this.type,this.title,this.hoverCallback),this.treeElement.setNode(this),this.treeElement)}onattach(){this.updateTitle()}updateTitle(){if(!this.treeElement||!this.project||this.project.type()!==b.FileSystem)return;const e=we.fileSystemPath(this.project.id()),t=this.treeElement.listItemElement.classList.contains("has-mapped-files"),i=P.instance().filePathHasBindings(e);t!==i&&(this.treeElement.listItemElement.classList.toggle("has-mapped-files",i),!this.treeElement.childrenListElement.hasFocus()&&(i?this.treeElement.expand():this.treeElement.collapse()))}setTitle(e){this.title=e,this.treeElement&&(this.treeElement.title=this.title)}}const fd=Object.freeze(Object.defineProperty({__proto__:null,NavigatorFolderTreeElement:ot,NavigatorFolderTreeNode:Le,NavigatorGroupTreeNode:de,NavigatorRootTreeNode:Kn,NavigatorSourceTreeElement:Yn,NavigatorTreeNode:Pt,NavigatorUISourceCodeTreeNode:Vt,NavigatorView:ce,Types:S},Symbol.toStringTag,{value:"Module"})),Jn=new CSSStyleSheet;Jn.replaceSync(`/*
 * Copyright (C) 2006, 2007, 2008 Apple Inc.  All rights reserved.
 * Copyright (C) 2009 Anthony Ricaud <rik@webkit.org>
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *
 * 1.  Redistributions of source code must retain the above copyright
 *     notice, this list of conditions and the following disclaimer.
 * 2.  Redistributions in binary form must reproduce the above copyright
 *     notice, this list of conditions and the following disclaimer in the
 *     documentation and/or other materials provided with the distribution.
 * 3.  Neither the name of Apple Computer, Inc. ("Apple") nor the names of
 *     its contributors may be used to endorse or promote products derived
 *     from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY APPLE AND ITS CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL APPLE OR ITS CONTRIBUTORS BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

.paused-message {
  align-self: center;
  width: fit-content;
}

.scripts-debug-toolbar {
  position: absolute;
  top: 0;
  width: 100%;
  background-color: var(--app-color-toolbar-background);
  border-bottom: 1px solid var(--sys-color-divider);
  overflow: hidden;
  z-index: 1;
}

.scripts-debug-toolbar-drawer {
  flex: 0 0 52px;
  transition: margin-top 0.1s ease-in-out;
  margin-top: -26px;
  padding-top: 25px;
  background-color: var(--sys-color-cdt-base-container);
  overflow: hidden;
  white-space: nowrap;
}

.scripts-debug-toolbar-drawer.expanded {
  margin-top: 0;
}

.scripts-debug-toolbar-drawer > [is="dt-checkbox"] {
  display: none;
  padding-left: 3px;
  height: 28px;
}

.scripts-debug-toolbar-drawer.expanded > [is="dt-checkbox"] {
  display: flex;
}

.cursor-auto {
  cursor: auto;
}

.navigator-tabbed-pane {
  background-color: var(--sys-color-cdt-base-container);
}

/*# sourceURL=sourcesPanel.css */
`);const Xn=20;class Qn{sourcesView;entries=[];current=-1;revealing=!1;constructor(e){this.sourcesView=e}trackSourceFrameCursorJumps(e){e.addEventListener("EditorUpdate",t=>this.onEditorUpdate(t.data,e))}onEditorUpdate(e,t){e.docChanged&&this.mapEntriesFor(t.uiSourceCode(),e.changes);const i=e.startState.selection.main,s=e.state.selection.main;!this.revealing&&i.anchor!==s.anchor&&e.transactions.some(o=>!!(o.isUserEvent("select.pointer")||o.isUserEvent("select.reveal")||o.isUserEvent("select.search")))&&(this.updateCurrentState(t.uiSourceCode(),i.head),this.entries.length>this.current+1&&(this.entries.length=this.current+1),this.entries.push(new Lc(t.uiSourceCode(),s.head)),this.current++,this.entries.length>Xn&&(this.entries.shift(),this.current--))}updateCurrentState(e,t){if(!this.revealing){const i=this.current>=0?this.entries[this.current]:null;i?.matches(e)&&(i.position=t)}}mapEntriesFor(e,t){for(const i of this.entries)i.matches(e)&&(i.position=t.mapPos(i.position))}reveal(e){const t=te.instance().uiSourceCode(e.projectId,e.url);t&&(this.revealing=!0,this.sourcesView.showSourceLocation(t,e.position,!1,!0),this.revealing=!1)}rollback(){this.current>0&&(this.current--,this.reveal(this.entries[this.current]))}rollover(){this.current<this.entries.length-1&&(this.current++,this.reveal(this.entries[this.current]))}removeHistoryForSourceCode(e){for(let t=this.entries.length-1;t>=0;t--)this.entries[t].matches(e)&&(this.entries.splice(t,1),this.current>=t&&this.current--)}}class Lc{projectId;url;position;constructor(e,t){this.projectId=e.project().id(),this.url=e.url(),this.position=t}matches(e){return this.url===e.url()&&this.projectId===e.project().id()}}const bd=Object.freeze(Object.defineProperty({__proto__:null,EditingLocationHistoryManager:Qn,HistoryDepth:Xn},Symbol.toStringTag,{value:"Module"})),Zn=new CSSStyleSheet;Zn.replaceSync(`/*
 * Copyright (C) 2013 Google Inc. All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 * notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above
 * copyright notice, this list of conditions and the following disclaimer
 * in the documentation and/or other materials provided with the
 * distribution.
 *     * Neither the name of Google Inc. nor the names of its
 * contributors may be used to endorse or promote products derived from
 * this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#sources-panel-sources-view {
  --override-highlight-animation-10pc-background-color: rgb(158 54 153);
  --override-highlight-animation-10pc-foreground-color: rgb(255 255 255);

  flex: auto;
  position: relative;
}

#sources-panel-sources-view .sources-toolbar {
  display: flex;
  flex: 0 0 27px;
  background-color: var(--sys-color-cdt-base-container);
  border-top: 1px solid var(--sys-color-divider);
  overflow: hidden;
  z-index: 0;
}

.sources-toolbar .toolbar {
  cursor: default;
}

.source-frame-debugger-script {
  --override-debugger-background-tint: rgb(255 255 194 / 50%);

  background-color: var(--override-debugger-background-tint);
}

.theme-with-dark-background .source-frame-debugger-script {
  --override-debugger-background-tint: rgb(61 61 0 / 50%);
}

/*# sourceURL=sourcesView.css */
`);const Qt={ms:"ms",mb:"MB",kb:"kB"},Pc=M("panels/sources/ProfilePlugin.ts",Qt),Wi=N.bind(void 0,Pc);class Fc extends kt{value;constructor(e){super(),this.value=e}eq(e){return this.value===e.value}toDOM(){const e=document.createElement("div");e.className="cm-profileMarker";let t=this.value;const i=gn(Math.log10(1+.002*t)/5,.02,1);e.style.backgroundColor=`hsla(217, 100%, 70%, ${i.toFixed(3)})`,t/=1e3;let s,n;t>=1e3?(s=Wi(Qt.mb),t/=1e3,n=t>=20?0:1):(s=Wi(Qt.kb),n=0),e.textContent=t.toFixed(n);const o=e.appendChild(document.createElement("span"));return o.className="cm-units",o.textContent=s,e}}class Mc extends kt{value;constructor(e){super(),this.value=e}eq(e){return this.value===e.value}toDOM(){const e=document.createElement("div");e.className="cm-profileMarker";const t=gn(Math.log10(1+10*this.value)/5,.02,1);e.textContent=this.value.toFixed(1),e.style.backgroundColor=`hsla(44, 100%, 50%, ${t.toFixed(3)})`;const i=document.createElement("span");return i.className="cm-units",i.textContent=Wi(Qt.ms),e.appendChild(i),e}}function Si(a,e,t){const i=t==="performance"?Mc:Fc,s=[];for(const[n,o]of a)if(n<=e.doc.lines){const{from:r}=e.doc.line(n);s.push(new i(o).range(r))}return De.of(s,!0)}const eo=a=>class extends ze{updateEffect=Ie.define();field;gutter;compartment=new Et;constructor(e){super(e),this.field=_e.define({create(){return De.empty},update:(t,i)=>i.effects.reduce((s,n)=>n.is(this.updateEffect)?Si(n.value,i.state,a):s,t.map(i.changes))}),this.gutter=an({markers:t=>t.state.field(this.field),class:`cm-${a}Gutter`})}static accepts(e){return e.contentType().hasScripts()}getLineMap(){return this.uiSourceCode.getDecorationData(a)}editorExtension(){const e=this.getLineMap();return this.compartment.of(e?[this.field.init(t=>Si(e,t,a)),this.gutter,Hs]:[])}decorationChanged(e,t){const i=!!t.state.field(this.field,!1),s=this.getLineMap();s?i?t.dispatch({effects:this.updateEffect.of(s)}):t.dispatch({effects:this.compartment.reconfigure([this.field.init(n=>Si(s,n,e)),this.gutter,Hs])}):i&&t.dispatch({effects:this.compartment.reconfigure([])})}},Hs=se.baseTheme({".cm-performanceGutter":{width:"60px",backgroundColor:"var(--sys-color-cdt-base-container)",marginLeft:"3px"},".cm-memoryGutter":{width:"48px",backgroundColor:"var(--sys-color-cdt-base-container)",marginLeft:"3px"},".cm-profileMarker":{textAlign:"right",paddingRight:"3px"},".cm-profileMarker .cm-units":{color:"var(--sys-color-token-subtle)",fontSize:"75%",marginLeft:"3px"}}),Ac=eo("memory"),Nc=eo("performance"),jt={fromS:"(From {PH1})",sourceMappedFromS:"(Source mapped from {PH1})"},Hi=M("panels/sources/ResourceOriginPlugin.ts",jt),Dc=N.bind(void 0,Hi);class to extends ze{static accepts(e){const t=e.contentType();return t.hasScripts()||t.isFromSourceMap()}rightToolbarItems(){const e=_.instance();if(this.uiSourceCode.contentType().isFromSourceMap()){const t=[];for(const s of e.scriptsForUISourceCode(this.uiSourceCode)){const n=e.uiSourceCodeForScript(s);if(!n)continue;const o=n.url(),r=Ar(o),c=Dc(jt.sourceMappedFromS,{PH1:r});t.push(tt.linkifyRevealable(n,r,o,c,void 0,"original-script-location"))}for(const s of Nr.uiSourceOrigin(this.uiSourceCode))t.push(tt.linkifyURL(s));if(t.length===0)return[];const i=document.createElement("span");return t.forEach((s,n)=>{n>0&&i.append(", "),i.append(s)}),[new ks(bt(Hi,jt.fromS,{PH1:i}))]}for(const t of e.scriptsForUISourceCode(this.uiSourceCode))if(t.originStackTrace){const i=io.linkifyStackTraceTopFrame(t.debuggerModel.target(),t.originStackTrace);return[new ks(bt(Hi,jt.fromS,{PH1:i}))]}return[]}}const io=new tt,Sd=Object.freeze(Object.defineProperty({__proto__:null,ResourceOriginPlugin:to,linkifier:io},Symbol.toStringTag,{value:"Module"})),$i={enter:"⌘+Enter",ctrlenter:"Ctrl+Enter"},Rc=M("panels/sources/SnippetsPlugin.ts",$i),$s=N.bind(void 0,Rc);class so extends ze{static accepts(e){return Xt(e)}rightToolbarItems(){const e=Z.createActionButtonForId("debugger.run-snippet");return e.setText(dn()?$s($i.enter):$s($i.ctrlenter)),e.setReducedFocusRing(),[e]}editorExtension(){return Dr()}}const vd=Object.freeze(Object.defineProperty({__proto__:null,SnippetsPlugin:so},Symbol.toStringTag,{value:"Module"}));function Oc(){return[Vn,mo,so,to,Dn,Ac,Nc]}class J extends fn(pt){uiSourceCodeInternal;muteSourceCodeEvents;persistenceBinding;uiSourceCodeEventListeners;messageAndDecorationListeners;boundOnBindingChanged;plugins=[];errorPopoverHelper;#e=!1;constructor(e){super(()=>this.workingCopy()),this.uiSourceCodeInternal=e,this.muteSourceCodeEvents=!1,this.persistenceBinding=P.instance().binding(e),this.uiSourceCodeEventListeners=[],this.messageAndDecorationListeners=[],this.boundOnBindingChanged=this.onBindingChanged.bind(this),v.instance().moduleSetting("persistence-network-overrides-enabled").addChangeListener(this.onNetworkPersistenceChanged,this),this.errorPopoverHelper=new Ln(this.textEditor.editor.contentDOM,this.getErrorPopoverContent.bind(this),"sources.error"),this.errorPopoverHelper.setHasPadding(!0),this.errorPopoverHelper.setTimeout(100,100),this.initializeUISourceCode()}async workingCopy(){return this.uiSourceCodeInternal.isDirty()?this.uiSourceCodeInternal.workingCopyContentData():this.uiSourceCodeInternal.requestContentData()}editorConfiguration(e){return[super.editorConfiguration(e),Gc(this.allMessages()),_s.of(this.plugins.map(t=>t.editorExtension()))]}onFocus(){super.onFocus(),g.instance().setFlavor(J,this)}onBlur(){super.onBlur(),g.instance().setFlavor(J,null)}installMessageAndDecorationListeners(){if(this.persistenceBinding){const e=this.persistenceBinding.network,t=this.persistenceBinding.fileSystem;this.messageAndDecorationListeners=[e.addEventListener(y.MessageAdded,this.onMessageAdded,this),e.addEventListener(y.MessageRemoved,this.onMessageRemoved,this),e.addEventListener(y.DecorationChanged,this.onDecorationChanged,this),t.addEventListener(y.MessageAdded,this.onMessageAdded,this),t.addEventListener(y.MessageRemoved,this.onMessageRemoved,this)]}else this.messageAndDecorationListeners=[this.uiSourceCodeInternal.addEventListener(y.MessageAdded,this.onMessageAdded,this),this.uiSourceCodeInternal.addEventListener(y.MessageRemoved,this.onMessageRemoved,this),this.uiSourceCodeInternal.addEventListener(y.DecorationChanged,this.onDecorationChanged,this)]}uiSourceCode(){return this.uiSourceCodeInternal}setUISourceCode(e){const t=e.contentLoaded()?Promise.resolve():e.requestContent(),i=this.uiSourceCodeInternal;t.then(async()=>{this.uiSourceCodeInternal===i&&(this.unloadUISourceCode(),this.uiSourceCodeInternal=e,e.workingCopy()!==this.textEditor.state.doc.toString()?await this.setContentDataOrError(Promise.resolve(e.workingCopyContentData())):this.reloadPlugins(),this.initializeUISourceCode())},console.error)}unloadUISourceCode(){wt(this.messageAndDecorationListeners),wt(this.uiSourceCodeEventListeners),this.uiSourceCodeInternal.removeWorkingCopyGetter(),P.instance().unsubscribeFromBindingEvent(this.uiSourceCodeInternal,this.boundOnBindingChanged)}initializeUISourceCode(){this.uiSourceCodeEventListeners=[this.uiSourceCodeInternal.addEventListener(y.WorkingCopyChanged,this.onWorkingCopyChanged,this),this.uiSourceCodeInternal.addEventListener(y.WorkingCopyCommitted,this.onWorkingCopyCommitted,this),this.uiSourceCodeInternal.addEventListener(y.TitleChanged,this.onTitleChanged,this)],P.instance().subscribeForBindingEvent(this.uiSourceCodeInternal,this.boundOnBindingChanged),this.installMessageAndDecorationListeners(),this.updateStyle();const e=ka.includes(this.contentType)&&!this.uiSourceCodeInternal.project().canSetFileContent()&&P.instance().binding(this.uiSourceCodeInternal)===null,t=!this.uiSourceCodeInternal.contentType().isFromSourceMap();this.setCanPrettyPrint(e,t)}wasShown(){super.wasShown(),this.setEditable(this.canEditSourceInternal())}willHide(){for(const e of this.plugins)e.willHide();super.willHide(),g.instance().setFlavor(J,null),this.uiSourceCodeInternal.removeWorkingCopyGetter()}getContentType(){const e=P.instance().binding(this.uiSourceCodeInternal),t=e?e.network.mimeType():this.uiSourceCodeInternal.mimeType();return Ze.simplifyContentType(t)}canEditSourceInternal(){return this.hasLoadError()||this.uiSourceCodeInternal.editDisabled()||this.uiSourceCodeInternal.mimeType()==="application/wasm"?!1:P.instance().binding(this.uiSourceCodeInternal)||this.uiSourceCodeInternal.project().canSetFileContent()?!0:this.uiSourceCodeInternal.project().isServiceProject()?!1:this.uiSourceCodeInternal.project().type()===b.Network&&Ae.instance().active()?!0:this.pretty&&this.uiSourceCodeInternal.contentType().hasScripts()?!1:this.uiSourceCodeInternal.contentType()!==ut.Document}onNetworkPersistenceChanged(){this.setEditable(this.canEditSourceInternal())}commitEditing(){this.uiSourceCodeInternal.isDirty()&&(this.muteSourceCodeEvents=!0,this.uiSourceCodeInternal.commitWorkingCopy(),this.muteSourceCodeEvents=!1)}async setContent(e){this.disposePlugins(),this.loadPlugins(),await super.setContent(e);for(const t of this.plugins)t.editorInitialized(this.textEditor);this.#t(),rs("source-file-loaded",this.uiSourceCodeInternal.displayName(!0))}createMessage(e){const{lineNumber:t,columnNumber:i}=this.uiLocationToEditorLocation(e.lineNumber(),e.columnNumber());return new jc(e,t,i)}allMessages(){return(this.persistenceBinding!==null?[...this.persistenceBinding.network.messages(),...this.persistenceBinding.fileSystem.messages()]:[...this.uiSourceCodeInternal.messages()]).map(t=>this.createMessage(t))}onTextChanged(){const e=this.pretty;super.onTextChanged(),this.errorPopoverHelper.hidePopover(),A.instance().updateLastModificationTime(),this.muteSourceCodeEvents=!0,this.isClean()?this.uiSourceCodeInternal.resetWorkingCopy():this.uiSourceCodeInternal.setWorkingCopyGetter(()=>this.textEditor.state.sliceDoc()),this.muteSourceCodeEvents=!1,e!==this.pretty&&(this.updateStyle(),this.reloadPlugins())}onWorkingCopyChanged(){this.muteSourceCodeEvents||this.maybeSetContent(this.uiSourceCodeInternal.workingCopyContentData())}onWorkingCopyCommitted(){this.muteSourceCodeEvents||this.maybeSetContent(this.uiSourceCode().workingCopyContentData()),this.contentCommitted(),this.updateStyle()}reloadPlugins(){this.disposePlugins(),this.loadPlugins();const e=this.textEditor;e.dispatch({effects:_s.reconfigure(this.plugins.map(t=>t.editorExtension()))});for(const t of this.plugins)t.editorInitialized(e)}onTitleChanged(){this.updateLanguageMode("").then(()=>this.reloadPlugins(),console.error)}loadPlugins(){const e=P.instance().binding(this.uiSourceCodeInternal),t=e?e.network:this.uiSourceCodeInternal;for(const i of Oc())i.accepts(t)&&this.plugins.push(new i(t,this));this.dispatchEventToListeners("ToolbarItemsChanged")}disposePlugins(){for(const e of this.plugins)e.dispose();this.plugins=[]}onBindingChanged(){const e=P.instance().binding(this.uiSourceCodeInternal);e!==this.persistenceBinding&&(this.unloadUISourceCode(),this.persistenceBinding=e,this.initializeUISourceCode(),this.reloadMessages(),this.reloadPlugins())}reloadMessages(){const e=this.allMessages(),{editor:t}=this.textEditor;t.dispatch({effects:Wt.of(We.create(e))})}updateStyle(){this.setEditable(this.canEditSourceInternal())}maybeSetContent(e){this.textEditor.state.doc.toString()!==e.text&&this.setContentDataOrError(Promise.resolve(e))}populateTextAreaContextMenu(e,t,i){super.populateTextAreaContextMenu(e,t,i),e.appendApplicableItems(this.uiSourceCodeInternal);const s=this.editorLocationToUILocation(t,i);e.appendApplicableItems(new as(this.uiSourceCodeInternal,s.lineNumber,s.columnNumber));for(const n of this.plugins)n.populateTextAreaContextMenu(e,t,i)}populateLineGutterContextMenu(e,t){super.populateLineGutterContextMenu(e,t);for(const i of this.plugins)i.populateLineGutterContextMenu(e,t)}dispose(){this.errorPopoverHelper.dispose(),this.disposePlugins(),this.unloadUISourceCode(),this.textEditor.editor.destroy(),this.detach(),v.instance().moduleSetting("persistence-network-overrides-enabled").removeChangeListener(this.onNetworkPersistenceChanged,this)}onMessageAdded(e){const{editor:t}=this.textEditor,i=t.state.field(Ht,!1);if(i){const s=this.createMessage(e.data);t.dispatch({effects:Wt.of(i.messages.add(s))})}}onMessageRemoved(e){const{editor:t}=this.textEditor,i=t.state.field(Ht,!1);if(i){const s=this.createMessage(e.data);t.dispatch({effects:Wt.of(i.messages.remove(s))})}}onDecorationChanged(e){for(const t of this.plugins)t.decorationChanged(e.data,this.textEditor)}async toolbarItems(){const e=await super.toolbarItems(),t=[];for(const i of this.plugins)e.push(...i.leftToolbarItems()),t.push(...i.rightToolbarItems());return t.length?[...e,new bn(!0),...t]:e}getErrorPopoverContent(e){const t=e,i=e.target,s=i.enclosingNodeOrSelfWithClass("cm-messageIcon-error")||i.enclosingNodeOrSelfWithClass("cm-messageIcon-issue");if(!s)return null;const n=this.textEditor.state.field(Ht,!1);if(!n||n.messages.rows.length===0)return null;const{editor:o}=this.textEditor,r=o.posAtCoords(t);if(r===null)return null;const c=o.state.doc.lineAt(r);if(r!==c.to)return null;const l=n.messages.rows.find(f=>f[0].lineNumber()===c.number-1);if(!l)return null;const d=s.classList.contains("cm-messageIcon-issue"),h=l.filter(f=>f.level()==="Issue"===d);if(!h.length)return null;const u=s?s.boxInWindow():new AnchorBox(t.clientX,t.clientY,1,1),p=_c(h),m=document.createElement("div");m.classList.add("text-editor-messages-description-container");for(let f=0;f<h.length;f++)p[f]&&m.appendChild(zc(h[f],p[f]));return{box:u,hide(){},show:async f=>(f.contentElement.append(m),!0)}}#t(){if(this.#e)return;this.#e=!0;const e=Ze.mimeFromURL(this.uiSourceCodeInternal.url()),t=Ze.mediaTypeForMetrics(e??"",this.uiSourceCodeInternal.contentType().isFromSourceMap(),Sn(this.uiSourceCodeInternal.content()),this.uiSourceCodeInternal.url().startsWith("snippet://"),this.uiSourceCodeInternal.url().startsWith("debugger://"));ne.sourcesPanelFileOpened(t)}}function _i(a){return a==="Error"?{color:"var(--icon-error)",width:"16px",height:"14px",iconName:"cross-circle-filled"}:a==="Warning"?{color:"var(--icon-warning)",width:"18px",height:"14px",iconName:"warning-filled"}:a==="Issue"?{color:"var(--icon-warning)",width:"17px",height:"14px",iconName:"issue-exclamation-filled"}:{color:"var(--icon-error)",width:"16px",height:"14px",iconName:"cross-circle-filled"}}function Bc(a){switch(a){case"Error":return"error";case"Warning":return"warning";case"Issue":return"warning"}}function Uc(a,e){const t={Issue:2,Warning:3,Error:4};return t[a.level()]-t[e.level()]}function Vc(a){return a.origin instanceof Rr?{...Or(a.origin.getIssueKind()),width:"12px",height:"12px"}:_i(a.level())}const _s=new Et;class jc{origin;#e;#t;constructor(e,t,i){this.origin=e,this.#e=t,this.#t=i}level(){return this.origin.level()}text(){return this.origin.text()}clickHandler(){return this.origin.clickHandler()}lineNumber(){return this.#e}columnNumber(){return this.#t}isEqual(e){return this.origin.isEqual(e.origin)}}function zs(a,e){const t=e.lineNumber();let i=0;for(;i<a.length;i++){const s=a[i][0].lineNumber()-t;if(s===0)return a[i]=a[i].concat(e),a;if(s>0)break}return a.splice(i,0,[e]),a}function Wc(a,e){for(let t=0;t<a.length;t++)if(a[t][0].lineNumber()===e.lineNumber()){const i=a[t].filter(s=>!s.isEqual(e));i.length?a[t]=i:a.splice(t,1);break}}class We{rows;constructor(e){this.rows=e}static create(e){const t=[];for(const i of e)zs(t,i);return new We(t)}remove(e){const t=this.rows.slice();return Wc(t,e),new We(t)}add(e){return new We(zs(this.rows.slice(),e))}}const Wt=Ie.define(),Hc=U.mark({class:"cm-waveUnderline"});class $c extends nt{messages;constructor(e){super(),this.messages=e}eq(e){return e.messages===this.messages}toDOM(){const e=document.createElement("span");e.classList.add("cm-messageIcon");const t=this.messages.filter(s=>s.level()!=="Issue");if(t.length){const s=t.sort(Uc)[t.length-1],n=e.appendChild(new oe);n.data=_i(s.level()),n.classList.add("cm-messageIcon-error")}const i=this.messages.find(s=>s.level()==="Issue");if(i){const s=e.appendChild(new oe);s.data=_i("Issue"),s.classList.add("cm-messageIcon-issue"),s.addEventListener("click",()=>(i.clickHandler()||Math.min)())}return e}ignoreEvents(){return!0}}class et{messages;decorations;constructor(e,t){this.messages=e,this.decorations=t}static create(e,t){const i=new ts;for(const s of e.rows){const n=t.line(Math.min(t.lines,s[0].lineNumber()+1)),o=s.reduce((r,c)=>Math.min(r,c.columnNumber()||0),n.length);o<n.length&&i.add(n.from+o,n.to,Hc),i.add(n.to,n.to,U.widget({side:1,widget:new $c(s)}))}return new et(e,i.finish())}apply(e){let t=this;e.docChanged&&(t=new et(this.messages,this.decorations.map(e.changes)));for(const i of e.effects)i.is(Wt)&&(t=et.create(i.value,e.state.doc));return t}}const Ht=_e.define({create(a){return et.create(new We([]),a.doc)},update(a,e){return a.apply(e)},provide:a=>Di.lowest(se.decorations.from(a,e=>e.decorations))});function _c(a){const e=[];for(let t=0;t<a.length;t++){e[t]=0;for(let i=0;i<=t;i++)if(a[i].isEqual(a[t])){e[i]++;break}}return e}function zc(a,e){const t=document.createElement("div");if(t.classList.add("text-editor-row-message"),t.style.display="flex",t.style.alignItems="center",t.style.gap="4px",e===1){const s=t.appendChild(new oe);s.data=Vc(a),s.classList.add("text-editor-row-message-icon"),s.addEventListener("click",()=>(a.clickHandler()||Math.min)())}else{const s=document.createElement("span",{is:"dt-small-bubble"});s.textContent=String(e),s.classList.add("text-editor-row-message-repeat-count"),s.style.flexShrink="0",t.appendChild(s),s.type=Bc(a.level())}const i=t.createChild("div");for(const s of a.text().split(`
`))i.createChild("div").textContent=s;return t}const qc=se.baseTheme({".cm-tooltip-message":{padding:"4px"},".cm-waveUnderline":{backgroundImage:"var(--image-file-errorWave)",backgroundRepeat:"repeat-x",backgroundPosition:"bottom",paddingBottom:"1px"},".cm-messageIcon":{cursor:"pointer","& > *":{verticalAlign:"text-bottom",marginLeft:"2px"}},".cm-messageIcon-issue, .cm-messageIcon-error":{marginTop:"-1px",marginBottom:"-1px"}});function Gc(a){return[Ht.init(e=>et.create(We.create(a),e.doc)),qc]}const Cd=Object.freeze(Object.defineProperty({__proto__:null,UISourceCodeFrame:J},Symbol.toStringTag,{value:"Module"})),gt={areYouSureYouWantToCloseUnsaved:"Are you sure you want to close unsaved file: {PH1}?",unableToLoadThisContent:"Unable to load this content.",changesToThisFileWereNotSavedTo:"Changes to this file were not saved to file system."},Yc=M("panels/sources/TabbedEditorContainer.ts",gt),Rt=N.bind(void 0,Yc);let Kc=0;class no extends Xi{delegate;tabbedPane;tabIds;files;previouslyViewedFilesSetting;history;uriToUISourceCode;idToUISourceCode;currentFileInternal;currentView;scrollTimer;reentrantShow;constructor(e,t,i,s){super(),this.delegate=e,this.tabbedPane=new Br,this.tabbedPane.setPlaceholderElement(i,s),this.tabbedPane.setTabDelegate(new ro(this)),this.tabbedPane.setCloseableTabs(!0),this.tabbedPane.setAllowTabReorder(!0,!0),this.tabbedPane.addEventListener(Ls.TabClosed,this.tabClosed,this),this.tabbedPane.addEventListener(Ls.TabSelected,this.tabSelected,this),this.tabbedPane.headerElement().setAttribute("jslog",`${Ct("top").track({keydown:"ArrowUp|ArrowLeft|ArrowDown|ArrowRight|Enter|Space"})}`),P.instance().addEventListener(Jt.BindingCreated,this.onBindingCreated,this),P.instance().addEventListener(Jt.BindingRemoved,this.onBindingRemoved,this),Ae.instance().addEventListener("RequestsForHeaderOverridesFileChanged",this.#e,this),this.tabIds=new Map,this.files=new Map,this.previouslyViewedFilesSetting=t,this.history=ii.fromObject(this.previouslyViewedFilesSetting.get()),this.uriToUISourceCode=new Map,this.idToUISourceCode=new Map,this.reentrantShow=!1}onBindingCreated(e){const t=e.data;this.updateFileTitle(t.fileSystem);const i=this.tabIds.get(t.network);let s=this.tabIds.get(t.fileSystem);const n=this.currentFileInternal===t.network,o=Ee(t.network),r=this.history.selectionRange(o),c=this.history.scrollLineNumber(o);if(this.history.remove(o),!!i){if(!s){const l=this.tabbedPane.tabView(i),d=this.tabbedPane.tabIndex(i);if(l instanceof J)this.delegate.recycleUISourceCodeFrame(l,t.fileSystem),s=this.appendFileTab(t.fileSystem,!1,d,l);else{s=this.appendFileTab(t.fileSystem,!1,d);const h=this.tabbedPane.tabView(s);this.restoreEditorProperties(h,r,c)}}this.closeTabs([i],!0),n&&this.tabbedPane.selectTab(s,!1),this.updateHistory()}}#e(e){this.updateFileTitle(e.data)}onBindingRemoved(e){const t=e.data;this.updateFileTitle(t.fileSystem)}get view(){return this.tabbedPane}get visibleView(){return this.tabbedPane.visibleView}fileViews(){return this.tabbedPane.tabViews()}leftToolbar(){return this.tabbedPane.leftToolbar()}rightToolbar(){return this.tabbedPane.rightToolbar()}show(e){this.tabbedPane.show(e)}showFile(e){const t=P.instance().binding(e);e=t?t.fileSystem:e;const i=g.instance().flavor(pe);i?.currentSourceFrame()?.contentSet&&this.currentFileInternal===e&&i?.currentUISourceCode()===e?rs("source-file-loaded",e.displayName(!0)):this.innerShowFile(e,!0)}closeFile(e){const t=this.tabIds.get(e);t&&this.closeTabs([t])}closeAllFiles(){this.closeTabs(this.tabbedPane.tabIds())}historyUISourceCodes(){const e=[];for(const{url:t,resourceType:i}of this.history.keys()){const s=this.uriToUISourceCode.get(t);s!==void 0&&s.contentType()===i&&e.push(s)}return e}selectNextTab(){this.tabbedPane.selectNextTab()}selectPrevTab(){this.tabbedPane.selectPrevTab()}addViewListeners(){!this.currentView||!(this.currentView instanceof pt)||(this.currentView.addEventListener("EditorUpdate",this.onEditorUpdate,this),this.currentView.addEventListener("EditorScroll",this.onScrollChanged,this))}removeViewListeners(){!this.currentView||!(this.currentView instanceof pt)||(this.currentView.removeEventListener("EditorUpdate",this.onEditorUpdate,this),this.currentView.removeEventListener("EditorScroll",this.onScrollChanged,this))}onScrollChanged(){if(this.currentView instanceof pt&&(this.scrollTimer&&clearTimeout(this.scrollTimer),this.scrollTimer=window.setTimeout(()=>this.previouslyViewedFilesSetting.set(this.history.toObject()),100),this.currentFileInternal)){const{editor:e}=this.currentView.textEditor,t=e.lineBlockAtHeight(e.scrollDOM.getBoundingClientRect().top-e.documentTop),i=e.state.doc.lineAt(t.from).number-1;this.history.updateScrollLineNumber(Ee(this.currentFileInternal),i)}}onEditorUpdate({data:e}){if(e.docChanged||e.selectionSet){const{main:t}=e.state.selection,i=e.state.doc.lineAt(t.from),s=e.state.doc.lineAt(t.to),n=new Tt(i.number-1,t.from-i.from,s.number-1,t.to-s.from);this.currentFileInternal&&this.history.updateSelectionRange(Ee(this.currentFileInternal),n),this.previouslyViewedFilesSetting.set(this.history.toObject()),this.currentFileInternal&&Ri.instance().sourceSelectionChanged(this.currentFileInternal.url(),n)}}innerShowFile(e,t){if(this.reentrantShow)return;const i=this.canonicalUISourceCode(e),s=P.instance().binding(e);if(e=s?s.fileSystem:e,this.currentFileInternal===e)return;this.removeViewListeners(),this.currentFileInternal=e;try{this.reentrantShow=!0;const r=this.tabIds.get(i)||this.appendFileTab(i,t);this.tabbedPane.selectTab(r,t)}finally{this.reentrantShow=!1}t&&this.editorSelectedByUserAction();const n=this.currentView;this.currentView=this.visibleView,this.addViewListeners(),this.currentView instanceof J&&this.currentView.uiSourceCode()!==e&&(this.delegate.recycleUISourceCodeFrame(this.currentView,e),e.project().type()!==b.FileSystem&&e.disableEdit());const o={currentFile:this.currentFileInternal,currentView:this.currentView,previousView:n,userGesture:t};this.dispatchEventToListeners("EditorSelected",o)}titleForFile(e){let i=es(e.displayName(!0),30);return e.isDirty()&&(i+="*"),i}maybeCloseTab(e,t){const i=this.files.get(e);return i&&(!(i.isDirty()&&i.project().canSetFileContent())||confirm(Rt(gt.areYouSureYouWantToCloseUnsaved,{PH1:i.name()})))?(i.resetWorkingCopy(),t&&this.tabbedPane.selectTab(t,!0),this.tabbedPane.closeTab(e,!0),!0):!1}closeTabs(e,t){const i=[],s=[];for(let n=0;n<e.length;++n){const o=e[n],r=this.files.get(o);r&&(!t&&r.isDirty()?i.push(o):s.push(o))}i.length&&this.tabbedPane.selectTab(i[0],!0),this.tabbedPane.closeTabs(s,!0);for(let n=0;n<i.length;++n){const o=n+1<i.length?i[n+1]:null;if(!this.maybeCloseTab(i[n],o))break}}onContextMenu(e,t){const i=this.files.get(e);i&&t.appendApplicableItems(i)}canonicalUISourceCode(e){const t=this.idToUISourceCode.get(e.canononicalScriptId());return t||(this.idToUISourceCode.set(e.canononicalScriptId(),e),this.uriToUISourceCode.set(e.url(),e),e)}addUISourceCode(e){const t=this.canonicalUISourceCode(e),i=t!==e,s=P.instance().binding(t);if(e=s?s.fileSystem:t,i&&e.project().type()!==b.FileSystem&&e.disableEdit(),this.currentFileInternal?.canononicalScriptId()===e.canononicalScriptId())return;const n=this.history.index(Ee(e));if(n===-1)return;if(this.tabIds.has(e)||this.appendFileTab(e,!1),!n){this.innerShowFile(e,!1);return}if(!this.currentFileInternal)return;const o=Xt(this.currentFileInternal),r=Xt(e);this.history.index(Ee(this.currentFileInternal))&&o&&!r&&this.innerShowFile(e,!1)}removeUISourceCode(e){this.removeUISourceCodes([e])}removeUISourceCodes(e){const t=[];for(const i of e){const s=this.tabIds.get(i);s&&t.push(s),this.uriToUISourceCode.get(i.url())===i&&this.uriToUISourceCode.delete(i.url()),this.idToUISourceCode.get(i.canononicalScriptId())===i&&this.idToUISourceCode.delete(i.canononicalScriptId())}this.tabbedPane.closeTabs(t)}editorClosedByUserAction(e){this.history.remove(Ee(e)),this.updateHistory()}editorSelectedByUserAction(){this.updateHistory()}updateHistory(){const e=[];for(const t of this.tabbedPane.lastOpenedTabIds(oo)){const i=this.files.get(t);i!==void 0&&e.push(Ee(i))}this.history.update(e),this.previouslyViewedFilesSetting.set(this.history.toObject())}tooltipForFile(e){return e=P.instance().network(e)||e,e.url()}appendFileTab(e,t,i,s){const n=s||this.delegate.viewForFile(e),o=this.titleForFile(e),r=this.tooltipForFile(e),c=this.generateTabId();if(this.tabIds.set(e,c),this.files.set(c,e),!s){const l=this.history.selectionRange(Ee(e)),d=this.history.scrollLineNumber(Ee(e));this.restoreEditorProperties(n,l,d)}return this.tabbedPane.appendTab(c,o,n,r,t,void 0,void 0,i,"editor"),this.updateFileTitle(e),this.addUISourceCodeListeners(e),e.loadError()?this.addLoadErrorIcon(c):e.contentLoaded()||e.requestContent().then(l=>{e.loadError()&&this.addLoadErrorIcon(c)}),c}addLoadErrorIcon(e){const t=new oe;t.data={iconName:"cross-circle-filled",color:"var(--icon-error)",width:"14px",height:"14px"},Q.install(t,Rt(gt.unableToLoadThisContent)),this.tabbedPane.tabView(e)&&this.tabbedPane.setTabIcon(e,t)}restoreEditorProperties(e,t,i){const s=e instanceof pt?e:null;s&&(t&&s.setSelection(t),typeof i=="number"&&s.scrollToLine(i))}tabClosed(e){const{tabId:t,isUserGesture:i}=e.data,s=this.files.get(t);this.currentFileInternal&&this.currentFileInternal.canononicalScriptId()===s?.canononicalScriptId()&&(this.removeViewListeners(),this.currentView=null,this.currentFileInternal=null),s&&this.tabIds.delete(s),this.files.delete(t),s&&(this.removeUISourceCodeListeners(s),this.dispatchEventToListeners("EditorClosed",s),i&&this.editorClosedByUserAction(s))}tabSelected(e){const{tabId:t,isUserGesture:i}=e.data,s=this.files.get(t);s&&this.innerShowFile(s,i)}addUISourceCodeListeners(e){e.addEventListener(y.TitleChanged,this.uiSourceCodeTitleChanged,this),e.addEventListener(y.WorkingCopyChanged,this.uiSourceCodeWorkingCopyChanged,this),e.addEventListener(y.WorkingCopyCommitted,this.uiSourceCodeWorkingCopyCommitted,this)}removeUISourceCodeListeners(e){e.removeEventListener(y.TitleChanged,this.uiSourceCodeTitleChanged,this),e.removeEventListener(y.WorkingCopyChanged,this.uiSourceCodeWorkingCopyChanged,this),e.removeEventListener(y.WorkingCopyCommitted,this.uiSourceCodeWorkingCopyCommitted,this)}updateFileTitle(e){const t=this.tabIds.get(e);if(t){const i=this.titleForFile(e),s=this.tooltipForFile(e);this.tabbedPane.changeTabTitle(t,i,s);let n=null;e.loadError()?(n=new oe,n.data={iconName:"cross-circle-filled",color:"var(--icon-error)",width:"14px",height:"14px"},Q.install(n,Rt(gt.unableToLoadThisContent))):P.instance().hasUnsavedCommittedChanges(e)?(n=new oe,n.data={iconName:"warning-filled",color:"var(--icon-warning)",width:"14px",height:"14px"},Q.install(n,Rt(gt.changesToThisFileWereNotSavedTo))):n=Ur.iconForUISourceCode(e),this.tabbedPane.setTabIcon(t,n)}}uiSourceCodeTitleChanged(e){const t=e.data;this.updateFileTitle(t),this.updateHistory();for(const[i,s]of this.uriToUISourceCode)s===t&&i!==s.url()&&this.uriToUISourceCode.delete(i);for(const[i,s]of this.idToUISourceCode)s===t&&i!==s.canononicalScriptId()&&this.idToUISourceCode.delete(i);this.canonicalUISourceCode(t)}uiSourceCodeWorkingCopyChanged(e){const t=e.data;this.updateFileTitle(t)}uiSourceCodeWorkingCopyCommitted(e){const t=e.data.uiSourceCode;this.updateFileTitle(t)}generateTabId(){return"tab-"+Kc++}currentFile(){return this.currentFileInternal||null}}const oo=30,Jc=4096;function Ee(a){return{url:a.url(),resourceType:a.contentType()}}class yt{url;resourceType;selectionRange;scrollLineNumber;constructor(e,t,i,s){this.url=e,this.resourceType=t,this.selectionRange=i,this.scrollLineNumber=s}static fromObject(e){const t=Ze.fromName(e.resourceTypeName);if(t===null)throw new TypeError(`Invalid resource type name "${e.resourceTypeName}"`);const i=e.selectionRange?Tt.fromObject(e.selectionRange):void 0;return new yt(e.url,t,i,e.scrollLineNumber)}toObject(){return this.url.length>=Jc?null:{url:this.url,resourceTypeName:this.resourceType.name(),selectionRange:this.selectionRange,scrollLineNumber:this.scrollLineNumber}}}class ii{items;constructor(e){this.items=e}static fromObject(e){const t=[];for(const i of e)try{t.push(yt.fromObject(i))}catch{}return new ii(t)}index({url:e,resourceType:t}){return this.items.findIndex(i=>i.url===e&&i.resourceType===t)}selectionRange(e){const t=this.index(e);if(t!==-1)return this.items[t].selectionRange}updateSelectionRange(e,t){if(!t)return;const i=this.index(e);i!==-1&&(this.items[i].selectionRange=t)}scrollLineNumber(e){const t=this.index(e);if(t!==-1)return this.items[t].scrollLineNumber}updateScrollLineNumber(e,t){const i=this.index(e);i!==-1&&(this.items[i].scrollLineNumber=t)}update(e){for(let t=e.length-1;t>=0;--t){const i=this.index(e[t]);let s;i!==-1?(s=this.items[i],this.items.splice(i,1)):s=new yt(e[t].url,e[t].resourceType),this.items.unshift(s)}}remove(e){const t=this.index(e);t!==-1&&this.items.splice(t,1)}toObject(){const e=[];for(const t of this.items){const i=t.toObject();if(i&&e.push(i),e.length===oo)break}return e}keys(){return this.items}}class ro{editorContainer;constructor(e){this.editorContainer=e}closeTabs(e,t){this.editorContainer.closeTabs(t)}onContextMenu(e,t){this.editorContainer.onContextMenu(e,t)}}const wd=Object.freeze(Object.defineProperty({__proto__:null,EditorContainerTabDelegate:ro,History:ii,HistoryItem:yt,TabbedEditorContainer:no},Symbol.toStringTag,{value:"Module"})),Ge={openFile:"Open file",runCommand:"Run command",workspaceDropInAFolderToSyncSources:"To sync edits to the workspace, drop a folder with your sources here or",selectFolder:"Select folder",sourceViewActions:"Source View Actions"},Xc=M("panels/sources/SourcesView.ts",Ge),lt=N.bind(void 0,Xc);class pe extends fn(Be){selectedIndex;searchableViewInternal;sourceViewByUISourceCode;editorContainer;historyManager;toolbarContainerElementInternal;scriptViewToolbar;bottomToolbarInternal;toolbarChangedListener;focusedPlaceholderElement;searchView;searchConfig;constructor(){super(),this.element.id="sources-panel-sources-view",this.element.setAttribute("jslog",`${hn("editor").track({keydown:"Escape"})}`),this.setMinimumAndPreferredSizes(88,52,150,100),this.selectedIndex=0;const e=te.instance();this.searchableViewInternal=new Vr(this,this,"sources-view-search-config"),this.searchableViewInternal.setMinimalSearchQuerySize(0),this.searchableViewInternal.show(this.element),this.sourceViewByUISourceCode=new Map,this.editorContainer=new no(this,v.instance().createLocalSetting("previously-viewed-files",[]),this.placeholderElement(),this.focusedPlaceholderElement),this.editorContainer.show(this.searchableViewInternal.element),this.editorContainer.addEventListener("EditorSelected",this.editorSelected,this),this.editorContainer.addEventListener("EditorClosed",this.editorClosed,this),this.historyManager=new Qn(this),this.toolbarContainerElementInternal=this.element.createChild("div","sources-toolbar"),this.toolbarContainerElementInternal.setAttribute("jslog",`${Ct("bottom")}`),this.scriptViewToolbar=new Z("",this.toolbarContainerElementInternal),this.scriptViewToolbar.element.style.flex="auto",this.bottomToolbarInternal=new Z("",this.toolbarContainerElementInternal),this.toolbarChangedListener=null,mn(),e.uiSourceCodes().forEach(this.addUISourceCode.bind(this)),pn(),e.addEventListener(Y.UISourceCodeAdded,this.uiSourceCodeAdded,this),e.addEventListener(Y.UISourceCodeRemoved,this.uiSourceCodeRemoved,this),e.addEventListener(Y.ProjectRemoved,this.projectRemoved.bind(this),this),T.instance().addScopeChangeListener(this.#e.bind(this));function t(i){if(i.returnValue)return;const s=[],n=te.instance().projectsForType(b.FileSystem);for(const o of n)for(const r of o.uiSourceCodes())r.isDirty()&&s.push(r);if(s.length){i.returnValue=!0,O.instance().showView("sources");for(const o of s)Oe(o)}}window.opener||window.addEventListener("beforeunload",t,!0)}placeholderElement(){const e=[{actionId:"quick-open.show",description:lt(Ge.openFile)},{actionId:"quick-open.show-command-menu",description:lt(Ge.runCommand)},{actionId:"sources.add-folder-to-workspace",description:lt(Ge.workspaceDropInAFolderToSyncSources),isWorkspace:!0}],t=document.createElement("div");jr(t),ue(t,lt(Ge.sourceViewActions));for(const i of e){const s=vt.instance().shortcutTitleForAction(i.actionId),n=t.createChild("div","tabbed-pane-placeholder-row");if(Wr(n),s){const o=n.createChild("span");o.textContent=s;const r=n.createChild("button");r.textContent=i.description;const c=Se.instance().getAction(i.actionId);r.addEventListener("click",()=>c.execute())}if(i.isWorkspace){const o=n.createChild("span","workspace");o.textContent=i.description;const r=o.createChild("button");r.textContent=lt(Ge.selectFolder),r.addEventListener("click",this.addFileSystemClicked.bind(this))}}return t}async addFileSystemClicked(){await cs.instance().addFileSystem()&&(ne.actionTaken(Pe.WorkspaceSelectFolder),O.instance().showView("navigator-files"))}static defaultUISourceCodeScores(){const e=new Map,t=g.instance().flavor(pe);if(t){const i=t.editorContainer.historyUISourceCodes();for(let s=1;s<i.length;++s)e.set(i[s],i.length-s)}return e}leftToolbar(){return this.editorContainer.leftToolbar()}rightToolbar(){return this.editorContainer.rightToolbar()}bottomToolbar(){return this.bottomToolbarInternal}wasShown(){super.wasShown(),this.registerCSSFiles([Zn]),g.instance().setFlavor(pe,this)}willHide(){g.instance().setFlavor(pe,null),super.willHide()}toolbarContainerElement(){return this.toolbarContainerElementInternal}searchableView(){return this.searchableViewInternal}visibleView(){return this.editorContainer.visibleView}currentSourceFrame(){const e=this.visibleView();return e instanceof J?e:null}currentUISourceCode(){return this.editorContainer.currentFile()}onCloseEditorTab(){const e=this.editorContainer.currentFile();return e?(this.editorContainer.closeFile(e),!0):!1}onJumpToPreviousLocation(){this.historyManager.rollback()}onJumpToNextLocation(){this.historyManager.rollover()}#e(){const e=te.instance();for(const t of e.uiSourceCodes()){if(t.project().type()!==b.Network)continue;const i=Qe.targetForUISourceCode(t);T.instance().isInScope(i)?this.addUISourceCode(t):this.removeUISourceCodes([t])}}uiSourceCodeAdded(e){const t=e.data;this.addUISourceCode(t)}addUISourceCode(e){const t=e.project();if(!t.isServiceProject()){switch(t.type()){case b.FileSystem:{if(we.fileSystemType(t)==="overrides")return;break}case b.Network:{const i=Qe.targetForUISourceCode(e);if(!T.instance().isInScope(i))return}}this.editorContainer.addUISourceCode(e)}}uiSourceCodeRemoved(e){const t=e.data;this.removeUISourceCodes([t])}removeUISourceCodes(e){this.editorContainer.removeUISourceCodes(e);for(let t=0;t<e.length;++t)this.removeSourceFrame(e[t]),this.historyManager.removeHistoryForSourceCode(e[t])}projectRemoved(e){const i=e.data.uiSourceCodes();this.removeUISourceCodes([...i])}updateScriptViewToolbarItems(){const e=this.visibleView();e instanceof en&&e.toolbarItems().then(t=>{this.scriptViewToolbar.removeToolbarItems();for(const i of lo())this.scriptViewToolbar.appendToolbarItem(i.getOrCreateButton(this));t.map(i=>this.scriptViewToolbar.appendToolbarItem(i))})}showSourceLocation(e,t,i,s){const n=this.currentSourceFrame();n&&this.historyManager.updateCurrentState(n.uiSourceCode(),n.textEditor.state.selection.main.head),this.editorContainer.showFile(e);const o=this.currentSourceFrame();o&&t&&o.revealPosition(t,!s);const r=this.visibleView();!i&&r&&r.focus()}createSourceView(e){let t;const i=e.contentType();return i===ut.Image?t=new As(e.mimeType(),e):i===ut.Font?t=new Ns(e.mimeType(),e):e.name()===qs?t=new Os(e):(t=new J(e),this.historyManager.trackSourceFrameCursorJumps(t)),e.addEventListener(y.TitleChanged,this.#s,this),this.sourceViewByUISourceCode.set(e,t),t}#t(e){return e instanceof As?"ImageView":e instanceof Ns?"FontView":e instanceof Os?"HeadersView":"SourceView"}#i(e){if(e.name()===qs)return"HeadersView";switch(e.contentType()){case ut.Image:return"ImageView";case ut.Font:return"FontView";default:return"SourceView"}}#s(e){const t=e.data,i=this.sourceViewByUISourceCode.get(t);i&&this.#t(i)!==this.#i(t)&&(this.removeUISourceCodes([t]),this.showSourceLocation(t))}getSourceView(e){return this.sourceViewByUISourceCode.get(e)}getOrCreateSourceView(e){return this.sourceViewByUISourceCode.get(e)||this.createSourceView(e)}recycleUISourceCodeFrame(e,t){e.uiSourceCode().removeEventListener(y.TitleChanged,this.#s,this),this.sourceViewByUISourceCode.delete(e.uiSourceCode()),e.setUISourceCode(t),this.sourceViewByUISourceCode.set(t,e),t.addEventListener(y.TitleChanged,this.#s,this)}viewForFile(e){return this.getOrCreateSourceView(e)}removeSourceFrame(e){const t=this.sourceViewByUISourceCode.get(e);this.sourceViewByUISourceCode.delete(e),t&&t instanceof J&&t.dispose(),e.removeEventListener(y.TitleChanged,this.#s,this)}editorClosed(e){const t=e.data;this.historyManager.removeHistoryForSourceCode(t);let i=!1;this.editorContainer.currentFile()||(i=!0),this.removeToolbarChangedListener(),this.updateScriptViewToolbarItems(),this.searchableViewInternal.resetSearch();const s={uiSourceCode:t,wasSelected:i};this.dispatchEventToListeners("EditorClosed",s)}editorSelected(e){const t=e.data.previousView instanceof J?e.data.previousView:null;t&&t.setSearchableView(null);const i=e.data.currentView instanceof J?e.data.currentView:null;i&&i.setSearchableView(this.searchableViewInternal),this.searchableViewInternal.setReplaceable(!!i?.canEditSource()),this.searchableViewInternal.refreshSearch(),this.updateToolbarChangedListener(),this.updateScriptViewToolbarItems();const s=this.editorContainer.currentFile();s&&this.dispatchEventToListeners("EditorSelected",s)}removeToolbarChangedListener(){this.toolbarChangedListener&&wt([this.toolbarChangedListener]),this.toolbarChangedListener=null}updateToolbarChangedListener(){this.removeToolbarChangedListener();const e=this.currentSourceFrame();e&&(this.toolbarChangedListener=e.addEventListener("ToolbarItemsChanged",this.updateScriptViewToolbarItems,this))}onSearchCanceled(){this.searchView&&this.searchView.onSearchCanceled(),delete this.searchView,delete this.searchConfig}performSearch(e,t,i){const s=this.currentSourceFrame();s&&(this.searchView=s,this.searchConfig=e,this.searchView.performSearch(this.searchConfig,t,i))}jumpToNextSearchResult(){if(this.searchView){if(this.searchConfig&&this.searchView!==this.currentSourceFrame()){this.performSearch(this.searchConfig,!0);return}this.searchView.jumpToNextSearchResult()}}jumpToPreviousSearchResult(){if(this.searchView){if(this.searchConfig&&this.searchView!==this.currentSourceFrame()){this.performSearch(this.searchConfig,!0),this.searchView&&this.searchView.jumpToLastSearchResult();return}this.searchView.jumpToPreviousSearchResult()}}supportsCaseSensitiveSearch(){return!0}supportsRegexSearch(){return!0}replaceSelectionWith(e,t){const i=this.currentSourceFrame();if(!i){console.assert(!!i);return}i.replaceSelectionWith(e,t)}replaceAllWith(e,t){const i=this.currentSourceFrame();if(!i){console.assert(!!i);return}i.replaceAllWith(e,t)}showOutlineQuickOpen(){Ps.show("@")}showGoToLineQuickOpen(){this.editorContainer.currentFile()&&Ps.show(":")}save(){this.saveSourceFrame(this.currentSourceFrame())}saveAll(){this.editorContainer.fileViews().forEach(this.saveSourceFrame.bind(this))}saveSourceFrame(e){if(!(e instanceof J))return;e.commitEditing()}toggleBreakpointsActiveState(e){this.editorContainer.view.element.classList.toggle("breakpoints-deactivated",!e)}}const ao=[];function co(a){ao.push(a)}function lo(){return ao.map(a=>a())}class us{static nextFile(e){function t(d){const h=d.lastIndexOf(".");return d.substr(0,h!==-1?h:d.length).toLowerCase()}const i=[],s=e.parentURL(),n=e.name(),o=t(n);for(const d of e.project().uiSourceCodes())s===d.parentURL()&&t(d.name())===o&&i.push(d.name());i.sort(Kt);const r=Hr(i.indexOf(n)+1,i.length),c=z.concatenate(s?z.concatenate(s,"/"):"",i[r]),l=e.project().uiSourceCodeForURL(c);return l!==e?l:null}handleAction(e,t){const i=e.flavor(pe);if(!i)return!1;const s=i.currentUISourceCode();if(!s)return!1;const n=us.nextFile(s);return n?(i.showSourceLocation(n),!0):!1}}let Qc=class{handleAction(e,t){const i=e.flavor(pe);if(!i)return!1;switch(t){case"sources.close-all":return i.editorContainer.closeAllFiles(),!0;case"sources.jump-to-previous-location":return i.onJumpToPreviousLocation(),!0;case"sources.jump-to-next-location":return i.onJumpToNextLocation(),!0;case"sources.next-editor-tab":return i.editorContainer.selectNextTab(),!0;case"sources.previous-editor-tab":return i.editorContainer.selectPrevTab(),!0;case"sources.close-editor-tab":return i.onCloseEditorTab();case"sources.go-to-line":return i.showGoToLineQuickOpen(),!0;case"sources.go-to-member":return i.showOutlineQuickOpen(),!0;case"sources.save":return i.save(),!0;case"sources.save-all":return i.saveAll(),!0}return!1}};const qs=".headers",yd=Object.freeze(Object.defineProperty({__proto__:null,ActionDelegate:Qc,SourcesView:pe,SwitchFileActionDelegate:us,getRegisteredEditorActions:lo,registerEditorAction:co},Symbol.toStringTag,{value:"Module"})),ho=new CSSStyleSheet;ho.replaceSync(`/*
 * Copyright 2017 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

.thread-item {
  padding: 3px 8px 3px 20px;
  position: relative;
  min-height: 18px;
  line-height: 15px;
  display: flex;
  flex-wrap: wrap;
}

.thread-item + .thread-item {
  border-top: 1px solid var(--sys-color-divider);
}

.thread-item:hover {
  background-color: var(--sys-color-state-hover-on-subtle);
}

.thread-item:focus-visible {
  background-color: var(--sys-color-tonal-container);
}

.thread-item-title,
.thread-item-paused-state {
  text-overflow: ellipsis;
  overflow: hidden;
  white-space: nowrap;
}

.thread-item-paused-state {
  color: var(--sys-color-state-disabled);
  margin-left: auto;
  padding: 0 10px;
}

.selected-thread-icon {
  display: none;
  position: absolute;
  top: 3px;
  left: 4px;
}

.thread-item.selected .selected-thread-icon {
  display: block;
}

@media (forced-colors: active) {
  .thread-item:hover,
  .thread-item:focus-visible {
    forced-color-adjust: none;
    background-color: Highlight;
  }

  .thread-item:hover > div,
  .thread-item:focus-visible > div {
    color: HighlightText;
  }
}

/*# sourceURL=threadsSidebarPane.css */
`);const uo={paused:"paused"},Zc=M("panels/sources/ThreadsSidebarPane.ts",uo),el=N.bind(void 0,Zc);class po extends Be{items;list;selectedModel;constructor(){super(!0),this.contentElement.setAttribute("jslog",`${Zt("sources.threads")}`),this.items=new tn,this.list=new sn(this.items,this,nn.NonViewport);const e=g.instance().flavor($);this.selectedModel=e!==null?e.model(W):null,this.contentElement.appendChild(this.list.element),g.instance().addFlavorChangeListener($,this.targetFlavorChanged,this),T.instance().observeModels(W,this)}static shouldBeShown(){return T.instance().models(W).length>=2}createElementForItem(e){const t=document.createElement("div");t.classList.add("thread-item");const i=t.createChild("div","thread-item-title"),s=t.createChild("div","thread-item-paused-state"),n=new oe;n.data={iconName:"large-arrow-right-filled",color:"var(--icon-arrow-main-thread)",width:"14px",height:"14px"},n.classList.add("selected-thread-icon"),t.appendChild(n),t.tabIndex=-1,self.onInvokeElement(t,d=>{g.instance().setFlavor($,e.target()),d.consume(!0)});const o=g.instance().flavor($)===e.target();t.classList.toggle("selected",o),on(t,o);function r(){const d=e.runtimeModel().defaultExecutionContext();i.textContent=d&&d.label()?d.label():e.target().name()}function c(){s.textContent=e.isPaused()?el(uo.paused):""}function l(d){d.data===e.target()&&r()}return e.addEventListener(Ce.DebuggerPaused,c),e.addEventListener(Ce.DebuggerResumed,c),e.runtimeModel().addEventListener($r.ExecutionContextChanged,r),T.instance().addEventListener("NameChanged",l),c(),r(),t}heightForItem(e){return console.assert(!1),0}isItemSelectable(e){return!0}selectedItemChanged(e,t,i,s){const n=i;n&&(n.tabIndex=-1);const o=s;o&&(this.setDefaultFocusedElement(o),o.tabIndex=0,this.hasFocus()&&o.focus())}updateSelectedItemARIA(e,t){return!1}modelAdded(e){this.items.insert(this.items.length,e),g.instance().flavor($)===e.target()&&this.list.selectItem(e)}modelRemoved(e){this.items.remove(this.items.indexOf(e))}targetFlavorChanged({data:e}){const t=this.hasFocus(),i=e.model(W);this.list.selectItem(i),i&&this.list.refreshItem(i),this.selectedModel!==null&&this.list.refreshItem(this.selectedModel),this.selectedModel=i,t&&this.focus()}wasShown(){super.wasShown(),this.registerCSSFiles([ho])}}const Ed=Object.freeze(Object.defineProperty({__proto__:null,ThreadsSidebarPane:po},Symbol.toStringTag,{value:"Module"})),x={dropWorkspaceFolderHere:"Drop workspace folder here",moreOptions:"More options",showNavigator:"Show navigator",hideNavigator:"Hide navigator",navigatorShown:"Navigator sidebar shown",navigatorHidden:"Navigator sidebar hidden",debuggerShown:"Debugger sidebar shown",debuggerHidden:"Debugger sidebar hidden",showDebugger:"Show debugger",hideDebugger:"Hide debugger",groupByFolder:"Group by folder",groupByAuthored:"Group by Authored/Deployed",hideIgnoreListed:"Hide ignore-listed sources",resumeWithAllPausesBlockedForMs:"Resume with all pauses blocked for 500 ms",terminateCurrentJavascriptCall:"Terminate current JavaScript call",pauseOnCaughtExceptions:"Pause on caught exceptions",revealInSidebar:"Reveal in navigator sidebar",continueToHere:"Continue to here",storeAsGlobalVariable:"Store as global variable",copyS:"Copy {PH1}",copyStringContents:"Copy string contents",copyStringAsJSLiteral:"Copy string as JavaScript literal",copyStringAsJSONLiteral:"Copy string as JSON literal",showFunctionDefinition:"Show function definition",openInSourcesPanel:"Open in Sources panel"},tl=M("panels/sources/SourcesPanel.ts",x),k=N.bind(void 0,tl),il=new Set(["number","boolean","bigint","undefined"]);let vi;class A extends _r{workspace;togglePauseAction;stepOverAction;stepIntoAction;stepOutAction;stepAction;toggleBreakpointsActiveAction;debugToolbar;debugToolbarDrawer;debuggerPausedMessage;overlayLoggables;splitWidget;editorView;navigatorTabbedLocation;sourcesViewInternal;toggleNavigatorSidebarButton;toggleDebuggerSidebarButton;threadsSidebarPane;watchSidebarPane;callstackPane;liveLocationPool;lastModificationTime;pausedInternal;switchToPausedTargetTimeout;ignoreExecutionLineEvents;executionLineLocation;pauseOnExceptionButton;sidebarPaneStack;tabbedLocationHeader;extensionSidebarPanesContainer;sidebarPaneView;constructor(){super("sources"),new Ua(this.element,[Va.Folder],k(x.dropWorkspaceFolderHere),this.handleDrop.bind(this)),this.workspace=te.instance(),this.togglePauseAction=Se.instance().getAction("debugger.toggle-pause"),this.stepOverAction=Se.instance().getAction("debugger.step-over"),this.stepIntoAction=Se.instance().getAction("debugger.step-into"),this.stepOutAction=Se.instance().getAction("debugger.step-out"),this.stepAction=Se.instance().getAction("debugger.step"),this.toggleBreakpointsActiveAction=Se.instance().getAction("debugger.toggle-breakpoints-active"),this.debugToolbar=this.createDebugToolbar(),this.debugToolbarDrawer=this.createDebugToolbarDrawer(),this.debuggerPausedMessage=new Ve;const e=225;this.splitWidget=new Mt(!0,!0,"sources-panel-split-view-state",e),this.splitWidget.enableShowModeSaving(),this.splitWidget.show(this.element);const t=225;this.editorView=new Mt(!0,!1,"sources-panel-navigator-split-view-state",t),this.editorView.enableShowModeSaving(),this.splitWidget.setMainWidget(this.editorView),this.navigatorTabbedLocation=O.instance().createTabbedLocation(this.revealNavigatorSidebar.bind(this),"navigator-view",!0,!0);const i=this.navigatorTabbedLocation.tabbedPane();i.setMinimumSize(100,25),i.element.classList.add("navigator-tabbed-pane"),i.headerElement().setAttribute("jslog",`${Ct("navigator").track({keydown:"ArrowUp|ArrowLeft|ArrowDown|ArrowRight|Enter|Space"})}`);const s=new zr(this.populateNavigatorMenu.bind(this),!0,!0,"more-options","dots-vertical");if(s.setTitle(k(x.moreOptions)),i.rightToolbar().appendToolbarItem(s),O.instance().hasViewsForLocation("run-view-sidebar")){const n=new Mt(!1,!0,"source-panel-navigator-sidebar-split-view-state");n.setMainWidget(i);const o=O.instance().createTabbedLocation(this.revealNavigatorSidebar.bind(this),"run-view-sidebar").tabbedPane();n.setSidebarWidget(o),n.installResizer(o.headerElement()),this.editorView.setSidebarWidget(n)}else this.editorView.setSidebarWidget(i);this.sourcesViewInternal=new pe,this.sourcesViewInternal.addEventListener("EditorSelected",this.editorSelected.bind(this)),this.toggleNavigatorSidebarButton=this.editorView.createShowHideSidebarButton(k(x.showNavigator),k(x.hideNavigator),k(x.navigatorShown),k(x.navigatorHidden),"navigator"),this.toggleDebuggerSidebarButton=this.splitWidget.createShowHideSidebarButton(k(x.showDebugger),k(x.hideDebugger),k(x.debuggerShown),k(x.debuggerHidden),"debugger"),this.editorView.setMainWidget(this.sourcesViewInternal),this.threadsSidebarPane=null,this.watchSidebarPane=O.instance().view("sources.watch"),this.callstackPane=st.instance(),v.instance().moduleSetting("sidebar-position").addChangeListener(this.updateSidebarPosition.bind(this)),this.updateSidebarPosition(),this.updateDebuggerButtonsAndStatus(),this.liveLocationPool=new Zi,this.setTarget(g.instance().flavor($)),v.instance().moduleSetting("breakpoints-active").addChangeListener(this.breakpointsActiveStateChanged,this),g.instance().addFlavorChangeListener($,this.onCurrentTargetChanged,this),g.instance().addFlavorChangeListener(ee,this.callFrameChanged,this),T.instance().addModelListener(W,Ce.DebuggerWasEnabled,this.debuggerWasEnabled,this),T.instance().addModelListener(W,Ce.DebuggerPaused,this.debuggerPaused,this),T.instance().addModelListener(W,Ce.DebugInfoAttached,this.debugInfoAttached,this),T.instance().addModelListener(W,Ce.DebuggerResumed,n=>this.debuggerResumed(n.data)),T.instance().addModelListener(W,Ce.GlobalObjectCleared,n=>this.debuggerResumed(n.data)),Ri.instance().addEventListener("SidebarPaneAdded",this.extensionSidebarPaneAdded,this),T.instance().observeTargets(this),this.lastModificationTime=-1/0}static instance(e={forceNew:null}){const{forceNew:t}=e;return(!vi||t)&&(vi=new A),vi}static updateResizerAndSidebarButtons(e){e.sourcesViewInternal.leftToolbar().removeToolbarItems(),e.sourcesViewInternal.rightToolbar().removeToolbarItems(),e.sourcesViewInternal.bottomToolbar().removeToolbarItems();const t=g.instance().flavor(ve)&&!Me.instance().isDrawerMinimized();e.splitWidget.isVertical()||t?e.splitWidget.uninstallResizer(e.sourcesViewInternal.toolbarContainerElement()):e.splitWidget.installResizer(e.sourcesViewInternal.toolbarContainerElement()),t||(e.sourcesViewInternal.leftToolbar().appendToolbarItem(e.toggleNavigatorSidebarButton),e.splitWidget.isVertical()?e.sourcesViewInternal.rightToolbar().appendToolbarItem(e.toggleDebuggerSidebarButton):e.sourcesViewInternal.bottomToolbar().appendToolbarItem(e.toggleDebuggerSidebarButton))}targetAdded(e){this.showThreadsIfNeeded()}targetRemoved(e){}showThreadsIfNeeded(){po.shouldBeShown()&&!this.threadsSidebarPane&&(this.threadsSidebarPane=O.instance().view("sources.threads"),this.sidebarPaneStack&&this.threadsSidebarPane&&this.sidebarPaneStack.appendView(this.threadsSidebarPane,this.splitWidget.isVertical()?this.watchSidebarPane:this.callstackPane))}setTarget(e){if(!e)return;const t=e.model(W);t&&(t.isPaused()?this.showDebuggerPausedDetails(t.debuggerPausedDetails()):(this.pausedInternal=!1,this.clearInterface(),this.toggleDebuggerSidebarButton.setEnabled(!0)))}onCurrentTargetChanged({data:e}){this.setTarget(e)}paused(){return this.pausedInternal||!1}wasShown(){g.instance().setFlavor(A,this),this.registerCSSFiles([Jn]),super.wasShown(),g.instance().flavor(ve)&&(Me.instance().setDrawerMinimized(!0),A.updateResizerAndSidebarButtons(this)),this.editorView.setMainWidget(this.sourcesViewInternal)}willHide(){super.willHide(),g.instance().setFlavor(A,null);const e=g.instance().flavor(ve);e&&(e.showViewInWrapper(),Me.instance().setDrawerMinimized(!1),A.updateResizerAndSidebarButtons(this))}resolveLocation(e){return e==="sources.sidebar-top"||e==="sources.sidebar-bottom"||e==="sources.sidebar-tabs"?this.sidebarPaneStack||null:this.navigatorTabbedLocation}ensureSourcesViewVisible(){return g.instance().flavor(ve)?!0:Me.instance().canSelectPanel("sources")?(O.instance().showView("sources"),!0):!1}onResize(){v.instance().moduleSetting("sidebar-position").get()==="auto"&&this.element.window().requestAnimationFrame(this.updateSidebarPosition.bind(this))}searchableView(){return this.sourcesViewInternal.searchableView()}toggleNavigatorSidebar(){this.editorView.toggleSidebar()}toggleDebuggerSidebar(){this.splitWidget.toggleSidebar()}debuggerPaused(e){const t=e.data,i=t.debuggerPausedDetails();!this.pausedInternal&&v.instance().moduleSetting("auto-focus-on-debugger-paused-enabled").get()&&this.setAsCurrentPanel(),g.instance().flavor($)===t.target()?this.showDebuggerPausedDetails(i):this.pausedInternal||g.instance().setFlavor($,t.target())}debugInfoAttached(e){const{debuggerModel:t}=e.data;if(!t.isPaused())return;const i=t.debuggerPausedDetails();i&&g.instance().flavor($)===t.target()&&this.showDebuggerPausedDetails(i)}showDebuggerPausedDetails(e){this.pausedInternal=!0,this.updateDebuggerButtonsAndStatus(),g.instance().setFlavor(ft,e),this.toggleDebuggerSidebarButton.setEnabled(!1),this.revealDebuggerSidebar(),window.focus(),Je.bringToFront(),g.instance().flavor($)?.model(Ni)&&!v.instance().moduleSetting("disable-paused-state-overlay").get()&&!this.overlayLoggables&&(this.overlayLoggables={debuggerPausedMessage:{},resumeButton:{},stepOverButton:{}},li(this.overlayLoggables.debuggerPausedMessage,`${Qi("debugger-paused")}`,null),li(this.overlayLoggables.resumeButton,`${Fs("debugger.toggle-pause")}`,this.overlayLoggables.debuggerPausedMessage),li(this.overlayLoggables.stepOverButton,`${Fs("debugger.step-over")}`,this.overlayLoggables.debuggerPausedMessage))}maybeLogOverlayAction(){if(!this.overlayLoggables)return;const e=!document.hasFocus();window.setTimeout(()=>{if(this.overlayLoggables){if(e){const t=g.instance().flavor(ft);qr(this.pausedInternal&&t?.reason==="step"?this.overlayLoggables.stepOverButton:this.overlayLoggables.resumeButton,new MouseEvent("click"))}this.pausedInternal||(Gr(this.overlayLoggables.debuggerPausedMessage,new DOMRect(0,0,0,0)),this.overlayLoggables=void 0)}},500)}debuggerResumed(e){this.maybeLogOverlayAction();const t=e.target();g.instance().flavor($)===t&&(this.pausedInternal=!1,this.clearInterface(),this.toggleDebuggerSidebarButton.setEnabled(!0),this.switchToPausedTargetTimeout=window.setTimeout(this.switchToPausedTarget.bind(this,e),500))}debuggerWasEnabled(e){const t=e.data;g.instance().flavor($)===t.target()&&this.updateDebuggerButtonsAndStatus()}get visibleView(){return this.sourcesViewInternal.visibleView()}showUISourceCode(e,t,i){if(i){if(!this.isShowing()&&!g.instance().flavor(ve))return}else this.showEditor();this.sourcesViewInternal.showSourceLocation(e,t,i)}showEditor(){g.instance().flavor(ve)||this.setAsCurrentPanel()}showUILocation(e,t){const{uiSourceCode:i,lineNumber:s,columnNumber:n}=e;this.showUISourceCode(i,{lineNumber:s,columnNumber:n},t)}async revealInNavigator(e,t){const i=O.instance();for(const s of i.viewsForLocation("navigator-view")){const n=await s.widget();if(n instanceof ce&&n.acceptProject(e.project())){n.revealUISourceCode(e,!0),this.navigatorTabbedLocation.tabbedPane().selectTab(s.viewId(),!0),t||(this.editorView.showBoth(!0),n.focus());break}}}addExperimentMenuItem(e,t,i){function s(){const n=Ne.isEnabled(t);Ne.setEnabled(t,!n),ne.experimentChanged(t,n);const o=v.instance().moduleSetting("navigator-group-by-folder");o.set(o.get())}e.appendCheckboxItem(i,s,{checked:Ne.isEnabled(t),additionalElement:ss("experiment"),jslogContext:Yr(t)})}populateNavigatorMenu(e){const t=v.instance().moduleSetting("navigator-group-by-folder");e.appendItemsAtLocation("navigatorMenu"),e.viewSection().appendCheckboxItem(k(x.groupByFolder),()=>t.set(!t.get()),{checked:t.get(),jslogContext:t.name}),this.addExperimentMenuItem(e.viewSection(),"authored-deployed-grouping",k(x.groupByAuthored)),this.addExperimentMenuItem(e.viewSection(),"just-my-code",k(x.hideIgnoreListed))}setIgnoreExecutionLineEvents(e){this.ignoreExecutionLineEvents=e}updateLastModificationTime(){this.lastModificationTime=window.performance.now()}async executionLineChanged(e){const t=await e.uiLocation();e.isDisposed()||t&&(window.performance.now()-this.lastModificationTime<$t||this.sourcesViewInternal.showSourceLocation(t.uiSourceCode,t,void 0,!0))}lastModificationTimeoutPassedForTest(){$t=Number.MIN_VALUE}updateLastModificationTimeForTest(){$t=Number.MAX_VALUE}async callFrameChanged(){const e=g.instance().flavor(ee);e&&(this.executionLineLocation&&this.executionLineLocation.dispose(),this.executionLineLocation=await _.instance().createCallFrameLiveLocation(e.location(),this.executionLineChanged.bind(this),this.liveLocationPool))}async updateDebuggerButtonsAndStatus(){const e=g.instance().flavor($),t=e?e.model(W):null;t?this.pausedInternal?(this.togglePauseAction.setToggled(!0),this.togglePauseAction.setEnabled(!0),this.stepOverAction.setEnabled(!0),this.stepIntoAction.setEnabled(!0),this.stepOutAction.setEnabled(!0),this.stepAction.setEnabled(!0)):(this.togglePauseAction.setToggled(!1),this.togglePauseAction.setEnabled(!t.isPausing()),this.stepOverAction.setEnabled(!1),this.stepIntoAction.setEnabled(!1),this.stepOutAction.setEnabled(!1),this.stepAction.setEnabled(!1)):(this.togglePauseAction.setEnabled(!1),this.stepOverAction.setEnabled(!1),this.stepIntoAction.setEnabled(!1),this.stepOutAction.setEnabled(!1),this.stepAction.setEnabled(!1));const i=t?t.debuggerPausedDetails():null;await this.debuggerPausedMessage.render(i,_.instance(),vn.instance()),i&&this.updateDebuggerButtonsAndStatusForTest()}updateDebuggerButtonsAndStatusForTest(){}clearInterface(){this.updateDebuggerButtonsAndStatus(),g.instance().setFlavor(ft,null),this.switchToPausedTargetTimeout&&clearTimeout(this.switchToPausedTargetTimeout),this.liveLocationPool.disposeAll()}switchToPausedTarget(e){if(delete this.switchToPausedTargetTimeout,!(this.pausedInternal||e.isPaused())){for(const t of T.instance().models(W))if(t.isPaused()){g.instance().setFlavor($,t.target());break}}}runSnippet(){const e=this.sourcesViewInternal.currentUISourceCode();e&&Cn(e)}editorSelected(e){const t=e.data;g.instance().setFlavor(di,t),this.editorView.mainWidget()&&v.instance().moduleSetting("auto-reveal-in-navigator").get()&&this.revealInNavigator(t,!0)}togglePause(){const e=g.instance().flavor($);if(!e)return!0;const t=e.model(W);return t&&(this.pausedInternal?(this.pausedInternal=!1,t.resume()):t.pause(),this.clearInterface()),!0}prepareToResume(){if(!this.pausedInternal)return null;this.pausedInternal=!1,this.clearInterface();const e=g.instance().flavor($);return e?e.model(W):null}longResume(){const e=this.prepareToResume();e&&(e.skipAllPausesUntilReloadOrTimeout(500),e.resume())}terminateExecution(){const e=this.prepareToResume();e&&(e.runtimeModel().terminateExecution(),e.resume())}stepOver(){const e=this.prepareToResume();return e&&e.stepOver(),!0}stepInto(){const e=this.prepareToResume();return e&&e.stepInto(),!0}stepIntoAsync(){const e=this.prepareToResume();return e&&e.scheduleStepIntoAsync(),!0}stepOut(){const e=this.prepareToResume();return e&&e.stepOut(),!0}async continueToLocation(e){const t=g.instance().flavor(He);if(!t)return;const s=(await _.instance().uiLocationToRawLocations(e.uiSourceCode,e.lineNumber,0)).find(n=>n.debuggerModel===t.debuggerModel);s&&this.prepareToResume()&&s.continueToLocation()}toggleBreakpointsActive(){v.instance().moduleSetting("breakpoints-active").set(!v.instance().moduleSetting("breakpoints-active").get())}breakpointsActiveStateChanged(){const e=v.instance().moduleSetting("breakpoints-active").get();this.toggleBreakpointsActiveAction.setToggled(!e),this.sourcesViewInternal.toggleBreakpointsActiveState(e)}createDebugToolbar(){const e=new Z("scripts-debug-toolbar");e.element.setAttribute("jslog",`${Ct("debug").track({keydown:"ArrowUp|ArrowLeft|ArrowDown|ArrowRight|Enter|Space"})}`);const t=new me(k(x.resumeWithAllPausesBlockedForMs),"play");t.addEventListener("Click",this.longResume,this);const i=new me(k(x.terminateCurrentJavascriptCall),"stop");i.addEventListener("Click",this.terminateExecution,this);const s=Z.createLongPressActionButton(this.togglePauseAction,[i,t],[]);return s.toggleOnClick(!1),e.appendToolbarItem(s),e.appendToolbarItem(Z.createActionButton(this.stepOverAction)),e.appendToolbarItem(Z.createActionButton(this.stepIntoAction)),e.appendToolbarItem(Z.createActionButton(this.stepOutAction)),e.appendToolbarItem(Z.createActionButton(this.stepAction)),e.appendSeparator(),e.appendToolbarItem(Z.createActionButton(this.toggleBreakpointsActiveAction)),e}createDebugToolbarDrawer(){const e=document.createElement("div");e.classList.add("scripts-debug-toolbar-drawer");const t=k(x.pauseOnCaughtExceptions),i=v.instance().moduleSetting("pause-on-caught-exception");return e.appendChild(Kr(t,i)),e}appendApplicableItems(e,t,i){if(i instanceof di){this.appendUISourceCodeItems(e,t,i);return}if(i instanceof J){this.appendUISourceCodeFrameItems(t,i);return}if(i instanceof as){this.appendUILocationItems(t,i);return}if(i instanceof Jr){this.appendRemoteObjectItems(t,i);return}this.appendNetworkRequestItems(t,i)}appendUISourceCodeItems(e,t,i){if(!e.target)return;const s=e.target;if(!i.project().isServiceProject()&&!s.isSelfOrDescendant(this.navigatorTabbedLocation.widget().element)&&!(Ne.isEnabled("just-my-code")&&X.instance().isUserOrSourceMapIgnoreListedUISourceCode(i))&&t.revealSection().appendItem(k(x.revealInSidebar),this.revealInNavigator.bind(this,i),{jslogContext:"sources.reveal-in-navigator-sidebar"}),Se.instance().hasAction("drjones.sources-panel-context")){const n=this.element.querySelector("devtools-text-editor");s.isSelfOrDescendant(n)||(g.instance().setFlavor(di,i),t.headerSection().appendAction("drjones.sources-panel-context"))}i.contentType().hasScripts()&&_.instance().scriptsForUISourceCode(i).every(n=>n.isJavaScript())&&this.callstackPane.appendIgnoreListURLContextMenuItems(t,i)}appendUISourceCodeFrameItems(e,t){t.uiSourceCode().contentType().isFromSourceMap()||t.textEditor.state.selection.main.empty||e.debugSection().appendAction("debugger.evaluate-selection")}appendUILocationItems(e,t){const i=t.uiSourceCode;if(!_.instance().scriptsForUISourceCode(i).every(n=>n.isJavaScript()))return;if(i.contentType().hasScripts()){const n=g.instance().flavor($),o=n?n.model(W):null;o&&o.isPaused()&&e.debugSection().appendItem(k(x.continueToHere),this.continueToLocation.bind(this,t),{jslogContext:"continue-to-here"}),this.callstackPane.appendIgnoreListURLContextMenuItems(e,i)}}appendRemoteObjectItems(e,t){const i=v.instance().moduleSetting("text-editor-indent").get(),s=g.instance().flavor(He);function n(){return t.type==="wasm"?t.subtype:t.subtype==="node"?"outerHTML":t.type}const o=n();e.debugSection().appendItem(k(x.storeAsGlobalVariable),()=>s?.target().model(wn)?.saveToTempVariable(s,t),{jslogContext:"store-as-global-variable"});const r=e.clipboardSection(),c=Je;if(t.type==="string")r.appendItem(k(x.copyStringContents),()=>{c.copyText(t.value)},{jslogContext:"copy-string-contents"}),r.appendItem(k(x.copyStringAsJSLiteral),()=>{c.copyText(Xr(t.value))},{jslogContext:"copy-string-as-js-literal"}),r.appendItem(k(x.copyStringAsJSONLiteral),()=>{c.copyText(JSON.stringify(t.value))},{jslogContext:"copy-string-as-json-literal"});else if(il.has(t.type))r.appendItem(k(x.copyS,{PH1:String(o)}),()=>{c.copyText(t.description)},{jslogContext:"copy-primitive"});else if(t.type==="object"){const d=async()=>{const h=await t.callFunctionJSON(l,[{value:{subtype:t.subtype,indent:i}}]);c.copyText(h)};r.appendItem(k(x.copyS,{PH1:String(o)}),d,{jslogContext:"copy-object"})}else t.type==="function"&&e.debugSection().appendItem(k(x.showFunctionDefinition),this.showFunctionDefinition.bind(this,t),{jslogContext:"show-function-definition"});function l(d){const h=d.subtype,u=d.indent;if(h==="map"){if(this instanceof Map){const p=Array.from(this.entries());return`new Map(${p.length===0?"":JSON.stringify(p,null,u)})`}return}if(h==="set"){if(this instanceof Set){const p=Array.from(this.values());return`new Set(${p.length===0?"":JSON.stringify(p,null,u)})`}return}if(h==="node")return this instanceof Element?this.outerHTML:void 0;if(h&&typeof this>"u")return String(h);try{return JSON.stringify(this,null,u)}catch{return String(this)}}}appendNetworkRequestItems(e,t){const i=this.workspace.uiSourceCodeForURL(t.url());if(!i)return;const s=k(x.openInSourcesPanel),n=this.showUILocation.bind(this,i.uiLocation(0,0));e.revealSection().appendItem(s,n,{jslogContext:"reveal-in-sources"})}showFunctionDefinition(e){Qr.objectAsFunction(e).targetFunction().then(t=>t.debuggerModel().functionDetailsPromise(t).then(this.didGetFunctionDetails.bind(this)))}async didGetFunctionDetails(e){if(!e||!e.location)return;const t=await _.instance().rawLocationToUILocation(e.location);t&&this.showUILocation(t)}revealNavigatorSidebar(){this.setAsCurrentPanel(),this.editorView.showBoth(!0)}revealDebuggerSidebar(){v.instance().moduleSetting("auto-focus-on-debugger-paused-enabled").get()&&(this.setAsCurrentPanel(),this.splitWidget.showBoth(!0))}updateSidebarPosition(){let e;const t=v.instance().moduleSetting("sidebar-position").get();if(t==="right"?e=!1:t==="bottom"?e=!0:e=Me.instance().element.offsetWidth<680,this.sidebarPaneView&&e===!this.splitWidget.isVertical()||this.sidebarPaneView&&this.sidebarPaneView.shouldHideOnDetach())return;this.sidebarPaneView&&this.sidebarPaneView.detach(),this.splitWidget.setVertical(!e),this.splitWidget.element.classList.toggle("sources-split-view-vertical",e),A.updateResizerAndSidebarButtons(this);const i=new Be;i.element.appendChild(this.debugToolbar.element),i.element.appendChild(this.debugToolbarDrawer),i.setMinimumAndPreferredSizes(zi,25,zi,100),this.sidebarPaneStack=O.instance().createStackLocation(this.revealDebuggerSidebar.bind(this),void 0,"debug"),this.sidebarPaneStack.widget().element.classList.add("overflow-auto"),this.sidebarPaneStack.widget().show(i.element),this.sidebarPaneStack.widget().element.appendChild(this.debuggerPausedMessage.element()),this.sidebarPaneStack.appendApplicableItems("sources.sidebar-top"),this.threadsSidebarPane&&this.sidebarPaneStack.appendView(this.threadsSidebarPane);const s=O.instance().view("sources.js-breakpoints"),n=O.instance().view("sources.scope-chain");if(this.tabbedLocationHeader&&(this.splitWidget.uninstallResizer(this.tabbedLocationHeader),this.tabbedLocationHeader=null),!e)this.sidebarPaneStack.appendView(this.watchSidebarPane),this.sidebarPaneStack.showView(s),this.sidebarPaneStack.showView(n),this.sidebarPaneStack.showView(this.callstackPane),this.extensionSidebarPanesContainer=this.sidebarPaneStack,this.sidebarPaneView=i,this.splitWidget.uninstallResizer(this.debugToolbar.gripElementForResize());else{const r=new Mt(!0,!0,"sources-panel-debugger-sidebar-split-view-state",.5);r.setMainWidget(i),this.sidebarPaneStack.showView(s),this.sidebarPaneStack.showView(this.callstackPane);const c=O.instance().createTabbedLocation(this.revealDebuggerSidebar.bind(this));r.setSidebarWidget(c.tabbedPane()),this.tabbedLocationHeader=c.tabbedPane().headerElement(),this.splitWidget.installResizer(this.tabbedLocationHeader),this.splitWidget.installResizer(this.debugToolbar.gripElementForResize()),c.appendView(n),c.appendView(this.watchSidebarPane),c.appendApplicableItems("sources.sidebar-tabs"),this.extensionSidebarPanesContainer=c,this.sidebarPaneView=r}this.sidebarPaneStack.appendApplicableItems("sources.sidebar-bottom");const o=Ri.instance().sidebarPanes();for(let r=0;r<o.length;++r)this.addExtensionSidebarPane(o[r]);this.splitWidget.setSidebarWidget(this.sidebarPaneView)}setAsCurrentPanel(){return O.instance().showView("sources")}extensionSidebarPaneAdded(e){this.addExtensionSidebarPane(e.data)}addExtensionSidebarPane(e){e.panelName()===this.name&&this.extensionSidebarPanesContainer.appendView(e)}sourcesView(){return this.sourcesViewInternal}handleDrop(e){const t=e.items;if(!t.length)return;const i=t[0].webkitGetAsEntry();i&&i.isDirectory&&(Je.upgradeDraggedFileSystemPermissions(i.filesystem),ne.actionTaken(Pe.WorkspaceDropFolder),O.instance().showView("navigator-files"))}}let $t=200;const zi=215;class sl{async reveal(e,t){A.instance().showUILocation(e,t)}}class Ke{static#e;static instance(e={forceNew:!1}){return(!Ke.#e||e.forceNew)&&(Ke.#e=new Ke),Ke.#e}async reveal(e,t){const{uiSourceCode:i,range:{start:s,end:n}}=e;A.instance().showUISourceCode(i,{from:s,to:n},t)}}class nl{async reveal(e,t){const i=await _.instance().rawLocationToUILocation(e);i&&A.instance().showUILocation(i,t)}}class ol{async reveal(e,t){A.instance().showUISourceCode(e,void 0,t)}}class rl{async reveal(e){if(v.instance().moduleSetting("auto-focus-on-debugger-paused-enabled").get())return A.instance().setAsCurrentPanel()}}class al{handleAction(e,t){const i=A.instance();if(!i.ensureSourcesViewVisible())return!1;switch(t){case"debugger.toggle-pause":return e.flavor(Zr)&&!v.instance().moduleSetting("disable-paused-state-overlay").get()||i.togglePause(),!0}return!1}}let cl=class{handleAction(e,t){const i=A.instance();switch(t){case"debugger.step-over":return i.stepOver(),!0;case"debugger.step-into":return i.stepIntoAsync(),!0;case"debugger.step":return i.stepInto(),!0;case"debugger.step-out":return i.stepOut(),!0;case"debugger.run-snippet":return i.runSnippet(),!0;case"debugger.toggle-breakpoints-active":return i.toggleBreakpointsActive(),!0;case"debugger.evaluate-selection":{const s=e.flavor(J);if(s){const{state:n}=s.textEditor;let o=n.sliceDoc(n.selection.main.from,n.selection.main.to);const r=e.flavor(He),c=r?.target().model(wn);if(r&&c){const l=c.addCommandMessage(r,o);o=ea.wrapObjectLiteral(o),c.evaluateCommandInConsole(r,l,o,!0)}}return!0}case"sources.reveal-in-navigator-sidebar":{const s=i.sourcesView().currentUISourceCode();return s===null?!1:(i.revealInNavigator(s),!0)}case"sources.toggle-navigator-sidebar":return i.toggleNavigatorSidebar(),!0;case"sources.toggle-debugger-sidebar":return i.toggleDebuggerSidebar(),!0}return!1}};class ve extends Be{view;constructor(){super(),this.element.classList.add("sources-view-wrapper"),this.element.setAttribute("jslog",`${ln("sources.quick").track({resize:!0})}`),this.view=A.instance().sourcesView()}wasShown(){g.instance().setFlavor(ve,this),super.wasShown(),A.instance().isShowing()?Me.instance().setDrawerMinimized(!0):this.showViewInWrapper(),A.updateResizerAndSidebarButtons(A.instance())}willHide(){Me.instance().setDrawerMinimized(!1),queueMicrotask(()=>{A.updateResizerAndSidebarButtons(A.instance())}),super.willHide(),g.instance().setFlavor(ve,null)}showViewInWrapper(){this.view.show(this.element)}}const Td=Object.freeze(Object.defineProperty({__proto__:null,ActionDelegate:cl,DebuggerLocationRevealer:nl,DebuggerPausedDetailsRevealer:rl,QuickSourceView:ve,RevealingActionDelegate:al,SourcesPanel:A,UILocationRangeRevealer:Ke,UILocationRevealer:sl,UISourceCodeRevealer:ol,get lastModificationTimeout(){return $t},minToolbarWidth:zi},Symbol.toStringTag,{value:"Module"})),{EMPTY_BREAKPOINT_CONDITION:Ci,NEVER_PAUSE_HERE_CONDITION:Gs}=ma,C={thisScriptIsOnTheDebuggersIgnore:"This script is on the debugger's ignore list",removeFromIgnoreList:"Remove from ignore list",configure:"Configure",addBreakpoint:"Add breakpoint",addConditionalBreakpoint:"Add conditional breakpoint…",addLogpoint:"Add logpoint…",neverPauseHere:"Never pause here",removeBreakpoint:"{n, plural, =1 {Remove breakpoint} other {Remove all breakpoints in line}}",editBreakpoint:"Edit breakpoint…",disableBreakpoint:"{n, plural, =1 {Disable breakpoint} other {Disable all breakpoints in line}}",enableBreakpoint:"{n, plural, =1 {Enable breakpoint} other {Enable all breakpoints in line}}",addSourceMap:"Add source map…",addWasmDebugInfo:"Add DWARF debug info…",sourceMapLoaded:"Source map loaded.",associatedFilesAreAvailable:"Associated files are available via file tree or {PH1}.",associatedFilesShouldBeAdded:"Associated files should be added to the file tree. You can debug these resolved source files as regular JavaScript files.",theDebuggerWillSkipStepping:"The debugger will skip stepping through this script, and will not stop on exceptions.",sourceMapSkipped:"Source map skipped for this file.",sourceMapFailed:"Source map failed to load.",debuggingPowerReduced:"DevTools can't show authored sources, but you can debug the deployed code.",reloadForSourceMap:"To enable again, make sure the file isn't on the ignore list and reload.",errorLoading:"Error loading url {PH1}: {PH2}",debugFileNotFound:'Failed to load debug file "{PH1}".',debugInfoNotFound:"Failed to load any debug info for {PH1}.",showRequest:"Show request",openDeveloperResources:"Opens the request in the Developer resource panel"},ll=M("panels/sources/DebuggerPlugin.ts",C),I=N.bind(void 0,ll),dl=2500,hl=1e4,ul=500,qi=new Map;class mo extends ze{transformer;editor=void 0;executionLocation=null;controlDown=!1;controlTimeout=void 0;sourceMapInfobar=null;scriptsPanel;breakpointManager;popoverHelper=null;scriptFileForDebuggerModel;breakpoints=[];continueToLocations=null;liveLocationPool;muted;initializedMuted;ignoreListInfobar;refreshBreakpointsTimeout=void 0;activeBreakpointDialog=null;#e=void 0;#t=!1;missingDebugInfoBar=null;#i=!1;loader;ignoreListCallback;constructor(e,t){super(e),this.transformer=t,qi.set(e,this),this.scriptsPanel=A.instance(),this.breakpointManager=vn.instance(),this.breakpointManager.addEventListener(At.BreakpointAdded,this.breakpointChange,this),this.breakpointManager.addEventListener(At.BreakpointRemoved,this.breakpointChange,this),this.uiSourceCode.addEventListener(y.WorkingCopyChanged,this.workingCopyChanged,this),this.uiSourceCode.addEventListener(y.WorkingCopyCommitted,this.workingCopyCommitted,this),this.scriptFileForDebuggerModel=new Map,this.loader=Nt.instance(),this.loader.addEventListener("Update",this.showSourceMapInfobarIfNeeded.bind(this),this),this.ignoreListCallback=this.showIgnoreListInfobarIfNeeded.bind(this),X.instance().addChangeListener(this.ignoreListCallback),g.instance().addFlavorChangeListener(ee,this.callFrameChanged,this),this.liveLocationPool=new Zi,this.updateScriptFiles(),this.muted=this.uiSourceCode.isDirty(),this.initializedMuted=this.muted,this.ignoreListInfobar=null,this.showIgnoreListInfobarIfNeeded();for(const i of this.scriptFileForDebuggerModel.values())i.checkMapping()}editorExtension(){const e=this.shortcutHandlers();return[se.updateListener.of(t=>this.onEditorUpdate(t)),se.domEventHandlers({keydown:t=>this.onKeyDown(t)?!0:(e(t),t.defaultPrevented),keyup:t=>this.onKeyUp(t),mousemove:t=>this.onMouseMove(t),mousedown:t=>this.onMouseDown(t),focusout:t=>this.onBlur(t),wheel:t=>this.onWheel(t)}),ta({domEventHandlers:{click:(t,i,s)=>this.handleGutterClick(t.state.doc.lineAt(i.from),s)}}),ml,Ys,ia("cm-executionLine","cm-executionToken"),Di.lowest(Ue.field),yl,Ot.field,Di.lowest(wi.field),Al,this.uiSourceCode.project().type()===b.Debugger?se.editorAttributes.of({class:"source-frame-debugger-script"}):[]]}shortcutHandlers(){const e=t=>t.state.doc.lineAt(t.state.selection.main.head);return vt.instance().getShortcutListener({"debugger.toggle-breakpoint":async()=>this.muted||!this.editor?!1:(await this.toggleBreakpoint(e(this.editor),!1),!0),"debugger.toggle-breakpoint-enabled":async()=>this.muted||!this.editor?!1:(await this.toggleBreakpoint(e(this.editor),!0),!0),"debugger.breakpoint-input-window":async()=>{if(this.muted||!this.editor)return!1;const t=e(this.editor);return this.#s(t),!0}})}#s(e,t){if(this.muted)return;this.activeBreakpointDialog&&this.activeBreakpointDialog.finishEditing(!1,"");const i=this.breakpoints.find(s=>s.position>=e.from&&s.position<=e.to)?.breakpoint||null;t===void 0&&i!==null&&(t=i.isLogpoint()),this.editBreakpointCondition({line:e,breakpoint:i,location:null,isLogpoint:t})}editorInitialized(e){this.editor=e,gl(e.state,this.transformer,this.uiSourceCode).then(t=>{t.length&&e.dispatch({effects:La.of(t)})},console.error),this.ignoreListInfobar&&this.attachInfobar(this.ignoreListInfobar),this.missingDebugInfoBar&&this.attachInfobar(this.missingDebugInfoBar),this.sourceMapInfobar&&this.attachInfobar(this.sourceMapInfobar),this.muted||this.refreshBreakpoints(),this.callFrameChanged(),this.popoverHelper?.dispose(),this.popoverHelper=new Ln(e,this.getPopoverRequest.bind(this),"sources.object-properties"),this.popoverHelper.setDisableOnClick(!0),this.popoverHelper.setTimeout(250,250),this.popoverHelper.setHasPadding(!0)}static accepts(e){return e.contentType().hasScripts()}showIgnoreListInfobarIfNeeded(){const e=this.uiSourceCode;if(!e.contentType().hasScripts())return;if(!X.instance().isUserOrSourceMapIgnoreListedUISourceCode(e)){this.hideIgnoreListInfobar();return}this.ignoreListInfobar&&this.ignoreListInfobar.dispose();function t(){X.instance().unIgnoreListUISourceCode(e)}const i=new rt("warning",I(C.thisScriptIsOnTheDebuggersIgnore),[{text:I(C.removeFromIgnoreList),highlight:!1,delegate:t,dismiss:!0,jslogContext:"remove-from-ignore-list"},{text:I(C.configure),highlight:!1,delegate:O.instance().showView.bind(O.instance(),"blackbox"),dismiss:!1,jslogContext:"configure"}],void 0,void 0,"script-on-ignore-list");this.ignoreListInfobar=i,i.setCloseCallback(()=>this.removeInfobar(this.ignoreListInfobar)),i.createDetailsRowMessage(I(C.theDebuggerWillSkipStepping)),this.attachInfobar(this.ignoreListInfobar)}attachInfobar(e){this.editor&&this.editor.dispatch({effects:go.of(e)})}removeInfobar(e){this.editor&&e&&this.editor.dispatch({effects:fo.of(e)})}hideIgnoreListInfobar(){this.ignoreListInfobar&&(this.ignoreListInfobar.dispose(),this.ignoreListInfobar=null)}willHide(){this.popoverHelper?.hidePopover()}editBreakpointLocation({breakpoint:e,uiLocation:t}){const{lineNumber:i}=this.transformer.uiLocationToEditorLocation(t.lineNumber,t.columnNumber),s=this.editor?.state.doc.line(i+1);s&&this.editBreakpointCondition({line:s,breakpoint:e,location:null,isLogpoint:e.isLogpoint()})}populateLineGutterContextMenu(e,t){const i=new as(this.uiSourceCode,t,0);if(this.scriptsPanel.appendUILocationItems(e,i),this.muted||!this.editor)return;const s=this.editor.state.doc.line(t+1),n=this.lineBreakpoints(s),o=_.instance().supportsConditionalBreakpoints(this.uiSourceCode);if(!n.length)this.editor&&hi(this.editor.state,s)&&(e.debugSection().appendItem(I(C.addBreakpoint),this.createNewBreakpoint.bind(this,s,Ci,!0,!1),{jslogContext:"add-breakpoint"}),o&&(e.debugSection().appendItem(I(C.addConditionalBreakpoint),()=>{this.editBreakpointCondition({line:s,breakpoint:null,location:null,isLogpoint:!1})},{jslogContext:"add-cnd-breakpoint"}),e.debugSection().appendItem(I(C.addLogpoint),()=>{this.editBreakpointCondition({line:s,breakpoint:null,location:null,isLogpoint:!0})},{jslogContext:"add-logpoint"}),e.debugSection().appendItem(I(C.neverPauseHere),this.createNewBreakpoint.bind(this,s,Gs,!0,!1),{jslogContext:"never-pause-here"})));else{const r=I(C.removeBreakpoint,{n:n.length});if(e.debugSection().appendItem(r,()=>n.forEach(d=>{ne.actionTaken(Pe.BreakpointRemovedFromGutterContextMenu),d.remove(!1)}),{jslogContext:"remove-breakpoint"}),n.length===1&&o&&e.debugSection().appendItem(I(C.editBreakpoint),()=>{this.editBreakpointCondition({line:s,breakpoint:n[0],location:null})},{jslogContext:"edit-breakpoint"}),n.some(d=>d.enabled())){const d=I(C.disableBreakpoint,{n:n.length});e.debugSection().appendItem(d,()=>n.forEach(h=>h.setEnabled(!1)),{jslogContext:"enable-breakpoint"})}if(n.some(d=>!d.enabled())){const d=I(C.enableBreakpoint,{n:n.length});e.debugSection().appendItem(d,()=>n.forEach(h=>h.setEnabled(!0)),{jslogContext:"disable-breakpoint"})}}}populateTextAreaContextMenu(e){function t(o){$e.createAddSourceMapURLDialog(i.bind(null,o)).show()}function i(o,r){r&&o.addSourceMapURL(r)}function s(o){$e.createAddDWARFSymbolsURLDialog(n.bind(null,o)).show()}function n(o,r){r&&o.addDebugInfoURL(r)}if(this.uiSourceCode.project().type()===b.Network&&v.instance().moduleSetting("js-source-maps-enabled").get()&&!X.instance().isUserIgnoreListedURL(this.uiSourceCode.url())&&this.scriptFileForDebuggerModel.size){const o=this.scriptFileForDebuggerModel.values().next().value,r=I(C.addSourceMap);e.debugSection().appendItem(r,t.bind(null,o),{jslogContext:"add-source-map"}),o.script?.isWasm()&&!_.instance().pluginManager.hasPluginForScript(o.script)&&e.debugSection().appendItem(I(C.addWasmDebugInfo),s.bind(null,o),{jslogContext:"add-wasm-debug-info"})}}workingCopyChanged(){this.scriptFileForDebuggerModel.size||this.setMuted(this.uiSourceCode.isDirty())}workingCopyCommitted(){this.scriptsPanel.updateLastModificationTime(),this.scriptFileForDebuggerModel.size||this.setMuted(!1)}didMergeToVM(){this.consistentScripts()&&this.setMuted(!1)}didDivergeFromVM(){this.setMuted(!0)}setMuted(e){this.initializedMuted||e!==this.muted&&(this.muted=e,e?this.editor&&this.editor.dispatch({effects:So.of(null)}):this.restoreBreakpointsAfterEditing())}consistentScripts(){for(const e of this.scriptFileForDebuggerModel.values())if(e.hasDivergedFromVM()||e.isMergingToVM())return!1;return!0}isVariableIdentifier(e){return e==="VariableName"||e==="VariableDefinition"}isIdentifier(e){return e==="VariableName"||e==="VariableDefinition"||e==="PropertyName"||e==="PropertyDefinition"}getPopoverRequest(e){if(at.eventHasCtrlEquivalentKey(e))return null;const t=g.instance().flavor($),i=t?t.model(W):null,{editor:s}=this;if(!i||!i.isPaused()||!s)return null;const n=g.instance().flavor(ee);if(!n)return null;let o=s.editor.posAtCoords(e);if(!o)return null;const r=s.editor.coordsAtPos(o);if(!r||e.clientY<r.top||e.clientY>r.bottom||e.clientX<r.left-30||e.clientX>r.right+30)return null;e.clientX<r.left&&o>s.state.doc.lineAt(o).from&&(o-=1);const c=yo(s.state,this.uiSourceCode.mimeType(),o);if(!c)return null;const l=s.state.doc.lineAt(c.from);if(c.to>l.to)return null;const d=s.editor.coordsAtPos(c.from),h=s.editor.coordsAtPos(c.to);if(!d||!h)return null;const u=new AnchorBox(d.left,d.top-2,h.right-d.left,h.bottom-d.top),p=s.state.sliceDoc(c.from,c.to);let m=null;return{box:u,show:async f=>{let w="";if(n.script.isJavaScript()){const To=await In(n);try{w=await yn().javaScriptSubstitute(p,To)}catch{}}const V=c.containsSideEffects,E=await n.evaluate({expression:w||p,objectGroup:"popover",includeCommandLineAPI:!1,silent:!0,returnByValue:!1,generatePreview:!1,throwOnSideEffect:V,timeout:void 0,disableBreaks:void 0,replMode:void 0,allowUnsafeEvalBlockedByCSP:void 0});if(!E||"error"in E||!E.object||E.object.type==="object"&&E.object.subtype==="error")return!1;m=await sa.buildObjectPopover(E.object,f);const re=g.instance().flavor(ee);if(!m||n!==re)return i.runtimeModel().releaseObjectGroup("popover"),m&&m.dispose(),!1;const oi=U.set(Ml.range(c.from,c.to));return s.dispatch({effects:wi.update.of(oi)}),!0},hide:()=>{m&&m.dispose(),i.runtimeModel().releaseObjectGroup("popover"),s.dispatch({effects:wi.update.of(U.none)})}}}onEditorUpdate(e){if(!e.changes.empty)for(const t of this.breakpoints)t.position=e.changes.mapPos(t.position)}onWheel(e){this.executionLocation&&at.eventHasCtrlEquivalentKey(e)&&e.preventDefault()}onKeyDown(e){const t=at.eventHasCtrlEquivalentKey(e);return t||this.setControlDown(!1),e.key===na&&this.popoverHelper&&this.popoverHelper.isPopoverVisible()?(this.popoverHelper.hidePopover(),e.consume(),!0):(t&&this.executionLocation&&this.setControlDown(!0),!1)}onMouseMove(e){this.executionLocation&&this.controlDown&&at.eventHasCtrlEquivalentKey(e)&&(this.continueToLocations||this.showContinueToLocations())}onMouseDown(e){if(!this.executionLocation||!at.eventHasCtrlEquivalentKey(e)||!this.continueToLocations||!this.editor)return;e.consume();const t=this.editor.editor.posAtCoords(e);if(t!==null){for(const{from:i,to:s,click:n}of this.continueToLocations)if(i<=t&&s>=t){n();break}}}onBlur(e){this.setControlDown(!1)}onKeyUp(e){this.setControlDown(!1)}setControlDown(e){e!==this.controlDown&&(this.controlDown=e,clearTimeout(this.controlTimeout),this.controlTimeout=void 0,e&&this.executionLocation?this.controlTimeout=window.setTimeout(()=>{this.executionLocation&&this.controlDown&&this.showContinueToLocations()},150):this.clearContinueToLocations())}editBreakpointCondition(e){const{line:t,breakpoint:i,location:s,isLogpoint:n}=e;if(i?.isRemoved||(this.#t=!1,this.#e&&p(this.#e,e)))return;this.activeBreakpointDialog&&this.activeBreakpointDialog.saveAndFinish();const r=this.editor,c=i?i.condition():"",l=i?.isLogpoint()??!!n,d=document.createElement("div"),h=new Et,u=new Mn(t.number-1,c,l,async m=>{if(this.activeBreakpointDialog=null,this.#e=void 0,u.detach(),r.dispatch({effects:h.reconfigure([])}),!m.committed){Vi.instance().breakpointEditFinished(i,!1);return}Vi.instance().breakpointEditFinished(i,c!==m.condition),i?i.setCondition(m.condition,m.isLogpoint):s?await this.setBreakpoint(s.lineNumber,s.columnNumber,m.condition,!0,m.isLogpoint):await this.createNewBreakpoint(t,m.condition,!0,m.isLogpoint)});r.dispatch({effects:Ie.appendConfig.of(h.of(se.decorations.of(U.set([U.widget({block:!0,widget:new class extends nt{toDOM(){return d}},side:1}).range(t.to)]))))}),u.element.addEventListener("blur",async m=>{(!m.relatedTarget||m.relatedTarget&&!m.relatedTarget.isSelfOrDescendant(u.element))&&(this.#t=!0,setTimeout(()=>{this.activeBreakpointDialog===u&&(this.#t?(u.saveAndFinish(),this.#t=!1):u.focusEditor())},200))},!0),u.markAsExternallyManaged(),u.show(d),u.focusEditor(),this.activeBreakpointDialog=u,this.#e=e;function p(m,f){return m.line.number!==f.line.number||m.line.from!==f.line.from||m.line.text!==f.line.text||m.breakpoint!==f.breakpoint||m.location!==f.location?!1:m.isLogpoint===f.isLogpoint}}async updateValueDecorations(){if(!this.editor)return;const e=this.executionLocation?await this.computeValueDecorations():null;this.editor&&(e||this.editor.state.field(Ot.field).size)&&this.editor.dispatch({effects:Ot.update.of(e||U.none)})}async#n(e,t){const i=e&&await _.instance().rawLocationToUILocation(e);return!i||i.uiSourceCode.url()!==t?null:this.editor?.toOffset(this.transformer.uiLocationToEditorLocation(i.lineNumber,i.columnNumber))??null}async computeValueDecorations(){if(!this.editor||!v.instance().moduleSetting("inline-variable-values").get()||!g.instance().flavor(He))return null;const t=g.instance().flavor(ee);if(!t)return null;const i=this.uiSourceCode.url(),s=p=>this.#n(p,i),n=this.#n(t.functionLocation(),i),o=this.#n(t.location(),i),[r,c]=await Promise.all([n,o]);if(!r||!c||!this.editor||r>=c||c-r>hl)return null;for(;oa(this.editor.editor);){if(await new Promise(p=>window.requestIdleCallback(p)),!this.editor)return null;is(this.editor.state,c,16)}const l=Co(this.editor.state,r,c,c);if(l.length===0)return null;const d=await wo(t,s);if(!this.editor||d.length===0)return null;const h=Io(d,l);if(!h||!this.editor)return null;const u=[];for(const[p,m]of h){const f=h.get(p-1);let w=f?Array.from(m).filter(V=>f.get(V[0])!==V[1]):Array.from(m);w.length&&(w.length>10&&(w=w.slice(0,10)),u.push(U.widget({widget:new El(w),side:1}).range(this.editor.state.doc.line(p+1).to)))}return U.set(u,!0)}async showContinueToLocations(){if(this.popoverHelper?.hidePopover(),!g.instance().flavor(He)||!this.editor)return;const t=g.instance().flavor(ee);if(!t)return;const i=t.functionLocation()||t.location(),s=t.debuggerModel,{state:n}=this.editor,o=await s.getPossibleBreakpoints(i,null,!0);this.continueToLocations=[];let r=-1;for(const l of o.reverse()){const d=this.transformer.uiLocationToEditorLocation(l.lineNumber,l.columnNumber);if(r===d.lineNumber&&l.type!=="call"||d.lineNumber>=n.doc.lines)continue;const h=n.doc.line(d.lineNumber+1),u=Math.min(h.to,h.from+d.columnNumber);let p=Lt(n).resolveInner(u,1);if(p.firstChild||p.from<h.from||p.to>h.to)continue;if(p.name==="."){const E=p.resolve(p.to,1);if(E.firstChild||E.from<h.from||E.to>h.to)continue;p=E}const m=p.name,f=m==="this"||m==="return"||m==="new"||m==="break"||m==="continue";if(!f&&!this.isIdentifier(m))continue;this.continueToLocations.push({from:p.from,to:p.to,async:!1,click:()=>l.continueToLocation()}),l.type==="call"&&(r=d.lineNumber);const w=f?"":h.text.slice(p.from-h.from,p.to-h.from);let V=null;if(w==="then"&&p.parent?.name==="MemberExpression"?V=p.parent.parent:(w==="setTimeout"||w==="setInterval"||w==="postMessage")&&(V=p.parent),m==="new"){const E=p.parent?.getChild("Expression");E&&E.name==="VariableName"&&n.sliceDoc(E.from,E.to)==="Worker"&&(V=p.parent)}if(V&&(V.name==="CallExpression"||V.name==="NewExpression")&&l.type==="call"){const E=V.getChild("ArgList")?.firstChild?.nextSibling;let re;if(E?.name==="VariableName"?re=E:(E?.name==="ArrowFunction"||E?.name==="FunctionExpression")&&(re=E.firstChild,re?.name==="async"&&(re=re.nextSibling)),re){const oi=this.executionLocation&&l.lineNumber===this.executionLocation.lineNumber&&l.columnNumber===this.executionLocation.columnNumber;this.continueToLocations.push({from:re.from,to:re.to,async:!0,click:()=>this.asyncStepIn(l,!!oi)})}}}const c=U.set(this.continueToLocations.map(l=>(l.async?Cl:vl).range(l.from,l.to)),!0);this.editor.dispatch({effects:Ue.update.of(c)})}clearContinueToLocations(){this.editor&&this.editor.state.field(Ue.field).size&&this.editor.dispatch({effects:Ue.update.of(U.none)})}asyncStepIn(e,t){t?i():e.continueToLocation(i);function i(){e.debuggerModel.scheduleStepIntoAsync()}}fetchBreakpoints(){if(!this.editor)return[];const{editor:e}=this;return this.breakpointManager.breakpointLocationsForUISourceCode(this.uiSourceCode).map(({uiLocation:i,breakpoint:s})=>{const n=this.transformer.uiLocationToEditorLocation(i.lineNumber,i.columnNumber);return{position:e.toOffset(n),breakpoint:s}})}lineBreakpoints(e){return this.breakpoints.filter(t=>t.position>=e.from&&t.position<=e.to).map(t=>t.breakpoint)}async linePossibleBreakpoints(e){const t=this.transformer.editorLocationToUILocation(e.number-1,0),i=this.transformer.editorLocationToUILocation(e.number-1,Math.min(e.length,dl)),s=new Tt(t.lineNumber,t.columnNumber||0,i.lineNumber,i.columnNumber||0);return await this.breakpointManager.possibleBreakpoints(this.uiSourceCode,s)}async computeBreakpointDecoration(e,t){const i=[],s=[],n=new Map,o=new Map,r=[],c=new Set,l=(h,u,p)=>{let m=o.get(h);m||(m=[],o.set(h,m)),m.push({breakpoint:p,column:u})};for(const{position:h,breakpoint:u}of t){const p=e.doc.lineAt(h);let m=n.get(p.from);m||(m=[],n.set(p.from,m)),u.enabled()&&m.every(f=>!f.enabled())&&r.push(this.linePossibleBreakpoints(p).then(f=>d(p,f))),m.push(u),u.enabled()&&(c.add(h),l(p.from,h-p.from,u))}for(const[h,u]of n){const p=u.sort(Sl)[0];let m="cm-breakpoint";p.enabled()||(m+=" cm-breakpoint-disabled"),p.bound()||(m+=" cm-breakpoint-unbound"),p.isLogpoint()?m+=" cm-breakpoint-logpoint":p.condition()&&(m+=" cm-breakpoint-conditional"),s.push(new vo(m,h).range(h))}const d=(h,u)=>{for(const p of u){const m=this.transformer.uiLocationToEditorLocation(p.lineNumber,p.columnNumber);if(m.lineNumber!==h.number-1)continue;const f=Math.min(h.to,h.from+m.columnNumber);c.has(f)||l(h.from,m.columnNumber,null)}};await Promise.all(r);for(const[h,u]of o)if(u.length>1)for(const{column:p,breakpoint:m}of u){const f=new bl(m,this);i.push(U.widget({widget:f,side:-1}).range(h+p))}return{content:U.set(i,!0),gutter:De.of(s,!0)}}async restoreBreakpointsAfterEditing(){const{breakpoints:e}=this,t=this.editor;this.breakpoints=[],await Promise.all(e.map(async i=>{const{breakpoint:s,position:n}=i,o=s.condition(),r=s.enabled(),c=s.isLogpoint();await s.remove(!1);const l=t.toLineColumn(n),d=this.transformer.editorLocationToUILocation(l.lineNumber,l.columnNumber);await this.setBreakpoint(d.lineNumber,d.columnNumber,o,r,c)}))}async refreshBreakpoints(){if(this.editor){this.breakpoints=this.fetchBreakpoints();const e=this.breakpoints,t=await this.computeBreakpointDecoration(this.editor.state,e);this.editor&&this.breakpoints===e&&(t.gutter.size||this.editor.state.field(Ys,!1)?.gutter.size)&&this.editor.dispatch({effects:bo.of(t)})}}breakpointChange(e){const{uiLocation:t}=e.data;if(!(t.uiSourceCode!==this.uiSourceCode||this.muted)){for(const i of this.scriptFileForDebuggerModel.values())if(i.isDivergingFromVM()||i.isMergingToVM())return;window.clearTimeout(this.refreshBreakpointsTimeout),this.refreshBreakpointsTimeout=window.setTimeout(()=>this.refreshBreakpoints(),50)}}onInlineBreakpointMarkerClick(e,t){if(e.consume(!0),t)e.shiftKey?t.setEnabled(!t.enabled()):t.remove(!1);else if(this.editor){const i=this.editor.editor.posAtDOM(e.target),s=this.editor.state.doc.lineAt(i),n=this.transformer.editorLocationToUILocation(s.number-1,i-s.from);this.setBreakpoint(n.lineNumber,n.columnNumber,Ci,!0,!1)}}onInlineBreakpointMarkerContextMenu(e,t){e.consume(!0);const i=this.editor,s=i.editor.posAtDOM(e.target),n=i.state.doc.lineAt(s);if(!hi(i.state,n)||!_.instance().supportsConditionalBreakpoints(this.uiSourceCode))return;const o=new Re(e);if(t)o.debugSection().appendItem(I(C.editBreakpoint),()=>{this.editBreakpointCondition({line:n,breakpoint:t,location:null})},{jslogContext:"edit-breakpoint"});else{const r=this.transformer.editorLocationToUILocation(n.number-1,s-n.from);o.debugSection().appendItem(I(C.addConditionalBreakpoint),()=>{this.editBreakpointCondition({line:n,breakpoint:null,location:r,isLogpoint:!1})},{jslogContext:"add-cnd-breakpoint"}),o.debugSection().appendItem(I(C.addLogpoint),()=>{this.editBreakpointCondition({line:n,breakpoint:null,location:r,isLogpoint:!0})},{jslogContext:"add-logpoint"}),o.debugSection().appendItem(I(C.neverPauseHere),()=>this.setBreakpoint(r.lineNumber,r.columnNumber,Gs,!0,!1),{jslogContext:"never-pause-here"})}o.show()}updateScriptFiles(){for(const e of T.instance().models(W))_.instance().scriptFile(this.uiSourceCode,e)&&this.updateScriptFile(e);this.showSourceMapInfobarIfNeeded()}updateScriptFile(e){const t=this.scriptFileForDebuggerModel.get(e),i=_.instance().scriptFile(this.uiSourceCode,e);this.scriptFileForDebuggerModel.delete(e),t&&(t.removeEventListener("DidMergeToVM",this.didMergeToVM,this),t.removeEventListener("DidDivergeFromVM",this.didDivergeFromVM,this),this.muted&&!this.uiSourceCode.isDirty()&&this.consistentScripts()&&this.setMuted(!1)),i&&(this.scriptFileForDebuggerModel.set(e,i),i.addEventListener("DidMergeToVM",this.didMergeToVM,this),i.addEventListener("DidDivergeFromVM",this.didDivergeFromVM,this),i.checkMapping(),i.missingSymbolFiles().then(s=>{if(s){const n=I(C.debugInfoNotFound,{PH1:i.uiSourceCode.url()});this.updateMissingDebugInfoInfobar({resources:s,details:n})}else this.updateMissingDebugInfoInfobar(null)}))}updateMissingDebugInfoInfobar(e){if(!this.missingDebugInfoBar){if(e===null){this.removeInfobar(this.missingDebugInfoBar),this.missingDebugInfoBar=null;return}if(this.missingDebugInfoBar=rt.create("error",e.details,[],void 0,"missing-debug-info"),!!this.missingDebugInfoBar){for(const t of e.resources){const i=this.missingDebugInfoBar?.createDetailsRowMessage(I(C.debugFileNotFound,{PH1:z.extractName(t.resourceUrl)}));if(i){const s=Nt.makeExtensionKey(t.resourceUrl,t.initiator);if(Nt.instance().getResourcesLoaded().get(s)){const n=Xs(I(C.showRequest),()=>{Oe(new ga(s))},{jslogContext:"show-request",variant:"text"});n.style.setProperty("margin-left","10px"),n.title=I(C.openDeveloperResources),i.appendChild(n)}i.classList.add("infobar-selectable")}}this.missingDebugInfoBar.setCloseCallback(()=>{this.removeInfobar(this.missingDebugInfoBar),this.missingDebugInfoBar=null}),this.attachInfobar(this.missingDebugInfoBar)}}}scriptHasSourceMap(){for(const e of T.instance().models(W)){const t=_.instance().scriptFile(this.uiSourceCode,e);if(t&&t.hasSourceMapURL())return!0}return!1}getSourceMapResource(){const e=this.loader.getResourcesLoaded();for(const[t,i]of this.scriptFileForDebuggerModel.entries()){const s=i.script?.sourceMapURL;if(s){const n=ra.resolveRelativeSourceURL(t.target(),i.script.sourceURL),o=z.completeURL(n,s);if(o){const r=e.get(Nt.makeKey(o,i.script.createPageResourceLoadInitiator()));if(r)return r}}}return null}showSourceMapInfobarIfNeeded(){if(this.sourceMapInfobar||!v.instance().moduleSetting("js-source-maps-enabled").get()||!this.scriptHasSourceMap())return;const e=this.getSourceMapResource();if(!(e&&e.success===null)){if(e)if(e.success){if(this.sourceMapInfobar=rt.create("info",I(C.sourceMapLoaded),[],v.instance().createSetting("source-map-infobar-disabled",!1),"source-map-loaded"),!this.sourceMapInfobar)return;this.sourceMapInfobar.createDetailsRowMessage(I(C.associatedFilesShouldBeAdded)),this.sourceMapInfobar.createDetailsRowMessage(I(C.associatedFilesAreAvailable,{PH1:String(vt.instance().shortcutTitleForAction("quick-open.show"))}))}else{if(this.sourceMapInfobar=rt.create("warning",I(C.sourceMapFailed),[],void 0,"source-map-failed"),!this.sourceMapInfobar)return;this.sourceMapInfobar.createDetailsRowMessage(I(C.debuggingPowerReduced)),e.errorMessage&&this.sourceMapInfobar.createDetailsRowMessage(I(C.errorLoading,{PH1:es(e.url,aa),PH2:e.errorMessage}))}else{if(this.sourceMapInfobar=rt.create("info",I(C.sourceMapSkipped),[],v.instance().createSetting("source-map-skipped-infobar-disabled",!1),"source-map-skipped"),!this.sourceMapInfobar)return;this.sourceMapInfobar.createDetailsRowMessage(I(C.debuggingPowerReduced)),this.sourceMapInfobar.createDetailsRowMessage(I(C.reloadForSourceMap))}this.sourceMapInfobar.setCloseCallback(()=>{this.removeInfobar(this.sourceMapInfobar),this.sourceMapInfobar=null}),this.attachInfobar(this.sourceMapInfobar)}}handleGutterClick(e,t){return this.muted||t.button!==0||t.altKey?!1:t.metaKey||t.ctrlKey?(this.#s(e,t.shiftKey),!0):(this.toggleBreakpoint(e,t.shiftKey),!0)}async toggleBreakpoint(e,t){if(this.muted)return;this.activeBreakpointDialog&&this.activeBreakpointDialog.finishEditing(!1,"");const i=this.lineBreakpoints(e);if(!i.length){await this.createNewBreakpoint(e,Ci,!0,!1);return}const s=i.some(n=>!n.enabled());for(const n of i)t?n.setEnabled(s):(ne.actionTaken(Pe.BreakpointRemovedFromGutterToggle),n.remove(!1))}async defaultBreakpointLocation(e){if(this.executionLocation&&this.transformer.uiLocationToEditorLocation(this.executionLocation.lineNumber,this.executionLocation.columnNumber).lineNumber===e.number-1){const i=await this.linePossibleBreakpoints(e);for(const s of i)if(s.compareTo(this.executionLocation)===0)return this.executionLocation}return this.transformer.editorLocationToUILocation(e.number-1)}async createNewBreakpoint(e,t,i,s){if(!this.editor||!hi(this.editor.state,e))return;ne.actionTaken(Pe.ScriptsBreakpointSet),this.#o();const n=await this.defaultBreakpointLocation(e);await this.setBreakpoint(n.lineNumber,n.columnNumber,t,i,s)}async setBreakpoint(e,t,i,s,n){v.instance().moduleSetting("breakpoints-active").set(!0);const o=await this.breakpointManager.setBreakpoint(this.uiSourceCode,e,t,i,s,n,"USER_ACTION");return this.breakpointWasSetForTest(e,t,i,s),o}breakpointWasSetForTest(e,t,i,s){}async callFrameChanged(){this.liveLocationPool.disposeAll();const e=g.instance().flavor(ee);e?await _.instance().createCallFrameLiveLocation(e.location(),async t=>{const i=await t.uiLocation();i&&i.uiSourceCode.canononicalScriptId()===this.uiSourceCode.canononicalScriptId()?(this.setExecutionLocation(i),this.updateMissingDebugInfoInfobar(e.missingDebugInfoDetails),this.#o()):this.setExecutionLocation(null)},this.liveLocationPool):this.setExecutionLocation(null)}setExecutionLocation(e){if(!(this.executionLocation===e||!this.editor))if(this.executionLocation=e,e){const t=this.transformer.uiLocationToEditorLocation(e.lineNumber,e.columnNumber),i=ca(this.editor.state.doc,t);this.editor.dispatch({effects:[la.of(i)]}),this.updateValueDecorations(),this.controlDown&&this.showContinueToLocations()}else this.editor.dispatch({effects:[Ue.update.of(U.none),Ot.update.of(U.none),da.of()]})}dispose(){this.hideIgnoreListInfobar(),this.sourceMapInfobar&&this.sourceMapInfobar.dispose();for(const e of this.scriptFileForDebuggerModel.values())e.removeEventListener("DidMergeToVM",this.didMergeToVM,this),e.removeEventListener("DidDivergeFromVM",this.didDivergeFromVM,this);this.scriptFileForDebuggerModel.clear(),this.popoverHelper?.hidePopover(),this.popoverHelper?.dispose(),this.setExecutionLocation(null),this.breakpointManager.removeEventListener(At.BreakpointAdded,this.breakpointChange,this),this.breakpointManager.removeEventListener(At.BreakpointRemoved,this.breakpointChange,this),this.uiSourceCode.removeEventListener(y.WorkingCopyChanged,this.workingCopyChanged,this),this.uiSourceCode.removeEventListener(y.WorkingCopyCommitted,this.workingCopyCommitted,this),X.instance().removeChangeListener(this.ignoreListCallback),qi.delete(this.uiSourceCode),super.dispose(),window.clearTimeout(this.refreshBreakpointsTimeout),this.editor=void 0,g.instance().removeFlavorChangeListener(ee,this.callFrameChanged,this),this.liveLocationPool.disposeAll()}#o(){if(this.#i)return;this.#i=!0;const e=Ze.mimeFromURL(this.uiSourceCode.url()),t=Ze.mediaTypeForMetrics(e??"",this.uiSourceCode.contentType().isFromSourceMap(),Sn(this.uiSourceCode.content()),this.uiSourceCode.url().startsWith("snippet://"),this.uiSourceCode.url().startsWith("debugger://"));ne.sourcesPanelFileDebugged(t)}}class pl{async reveal(e,t){const{uiLocation:i}=e;A.instance().showUILocation(i,t);const s=qi.get(i.uiSourceCode);s?s.editBreakpointLocation(e):Vi.instance().breakpointEditFinished(e.breakpoint,!1)}}const go=Ie.define(),fo=Ie.define(),ml=_e.define({create(){return[]},update(a,e){for(const t of e.effects)t.is(go)?a=a.concat(t.value):t.is(fo)&&(a=a.filter(i=>i!==t.value));return a},provide:a=>ha.computeN([a],e=>e.field(a).map(t=>()=>({dom:t.element})))});async function gl(a,e,t){const s=await _.instance().getMappedLines(t);if(!s)return[];const n=[];for(let o=0;o<a.doc.lines;o++){const{lineNumber:r}=e.editorLocationToUILocation(o,0);s.has(r)||n.push(a.doc.line(o+1).from)}return n}const bo=Ie.define(),So=Ie.define();function fl(a,e){const t=[];return a.between(0,e.length,(i,s,n)=>{let o=n.elementClass;/cm-breakpoint-disabled/.test(o)||(o+=" cm-breakpoint-disabled"),t.push(new vo(o,i).range(i))}),De.of(t,!1)}const Ys=_e.define({create(){return{content:De.empty,gutter:De.empty}},update(a,e){e.changes.empty||(a={content:a.content.map(e.changes),gutter:a.gutter.map(e.changes)});for(const t of e.effects)t.is(bo)?a=t.value:t.is(So)&&(a={content:De.empty,gutter:fl(a.gutter,e.state.doc)});return a},provide:a=>[se.decorations.from(a,e=>e.content),ua.from(a,e=>e.gutter)]});class bl extends nt{breakpoint;parent;class;constructor(e,t){super(),this.breakpoint=e,this.parent=t,this.class="cm-inlineBreakpoint",e?.isLogpoint()?this.class+=" cm-inlineBreakpoint-logpoint":e?.condition()&&(this.class+=" cm-inlineBreakpoint-conditional"),e?.enabled()||(this.class+=" cm-inlineBreakpoint-disabled")}eq(e){return e.class===this.class&&e.breakpoint===this.breakpoint}toDOM(){const e=document.createElement("span");return e.className=this.class,e.setAttribute("jslog",`${En().track({click:!0})}`),e.addEventListener("click",t=>{this.parent.onInlineBreakpointMarkerClick(t,this.breakpoint),t.consume()}),e.addEventListener("contextmenu",t=>{this.parent.onInlineBreakpointMarkerContextMenu(t,this.breakpoint),t.consume()}),e}ignoreEvent(){return!0}}class vo extends kt{elementClass;#e;constructor(e,t){super(),this.elementClass=e,this.#e=t}eq(e){return e.elementClass===this.elementClass}toDOM(e){const t=document.createElement("div");t.setAttribute("jslog",`${En().track({click:!0})}`);const i=e.state.doc.lineAt(this.#e).number,s=e.state.facet(Pa);return t.textContent=s(i,e.state),t}}function Sl(a,e){return a.enabled()!==e.enabled()?a.enabled()?-1:1:a.bound()!==e.bound()?a.bound()?-1:1:!!a.condition()!=!!e.condition()?a.condition()?-1:1:0}function ps(){const a=Ie.define(),e=_e.define({create(){return U.none},update(t,i){return i.effects.reduce((s,n)=>n.is(a)?n.value:s,t.map(i.changes))},provide:t=>se.decorations.from(t)});return{update:a,field:e}}const vl=U.mark({class:"cm-continueToLocation"}),Cl=U.mark({class:"cm-continueToLocation cm-continueToLocation-async"}),Ue=ps(),wl={},Il={class:"cm-hasContinueMarkers"},yl=se.contentAttributes.compute([Ue.field],a=>a.field(Ue.field).size?Il:wl);class El extends nt{pairs;constructor(e){super(),this.pairs=e}eq(e){return this.pairs.length===e.pairs.length&&this.pairs.every((t,i)=>t[0]===e.pairs[i][0]&&t[1]===e.pairs[i][1])}toDOM(){const e=new fa,t=document.createElement("div");t.classList.add("cm-variableValues");let i=!0;for(const[s,n]of this.pairs){i?i=!1:Oi(t,", ");const o=t.createChild("span");Oi(o,s+" = ");const r=n.preview?n.preview.properties.length:0,c=n.preview&&n.preview.entries?n.preview.entries.length:0;if(n.preview&&r+c<10)e.appendObjectPreview(o,n.preview,!1);else{const l=Bi.createPropertyValue(n,!1,!1);o.appendChild(l.element)}}return t}}const Ot=ps();function xl(a){return a==="VariableName"||a==="VariableDefinition"}function Tl(a){return a==="VariableDefinition"}function kl(a){return a==="let"||a==="const"}function Ll(a){return a==="Block"||a==="ForSpec"}class Pl{blockList=new Set;variables=[]}function Co(a,e,t,i){const s=a.doc.lineAt(e);e=Math.min(s.to,e),t=a.doc.lineAt(t).from;const n=Lt(a);function o(u){return Ll(u.name)&&(u.to<i||i<u.from)}const r=[];let c=s;const l=[];let d=null;function h(){return l.length?l[l.length-1].variables:r}return n.iterate({from:e,to:t,enter:u=>{if(u.from<e)return;if(kl(u.name)){d=u.node.nextSibling;return}if(o(u)){l.push(new Pl);return}const p=xl(u.name)&&a.sliceDoc(u.from,u.to);if(p){if(d&&Tl(u.name)&&l.length>0){l[l.length-1].blockList.add(p);return}u.from>c.to&&(c=a.doc.lineAt(u.from)),h().push({line:c.number-1,from:u.from,id:p})}},leave:u=>{if(d===u.node)d=null;else if(o(u)){const p=l.pop(),m=h();for(const f of p?.variables??[])p?.blockList.has(f.id)||m.push(f)}}}),r}async function wo(a,e){const t=[];for(const i of a.scopeChain()){const s=await e(i.range()?.start??null);if(!s)break;const n=await e(i.range()?.end??null);if(!n)break;const{properties:o}=await pa(i).getAllProperties(!1,!1);if(!o||o.length>ul)break;const r=new Map(o.map(c=>[c.name,c.value]));if(t.push({scopeStart:s,scopeEnd:n,variableMap:r}),i.type()==="local")break}return t}function Io(a,e){const t=new Map;for(const{line:s,from:n,id:o}of e){const r=i(o,n,a);if(!r)continue;let c=t.get(s);c||(c=new Map,t.set(s,c)),c.set(o,r)}return t;function i(s,n,o){for(const r of o){if(n<r.scopeStart||n>=r.scopeEnd)continue;const c=r.variableMap.get(s);if(c)return c}return null}}function yo(a,e,t){const{main:i}=a.selection;if(!i.empty)return t<i.from||i.to<t?null:{from:i.from,to:i.to,containsSideEffects:!1};const s=is(a,t,5*1e3);if(!s)return null;const n=s.resolveInner(t,1);if(n.firstChild)return null;switch(e){case"application/wasm":{if(n.name!=="Identifier")return null;const o=["block","loop","if","else","end","br","br_if","br_table"];for(let r=n.parent;r;r=r.parent)if(r.name==="App"){const c=r.firstChild,l=c?.name==="Keyword"&&a.sliceDoc(c.from,c.to);if(l&&o.includes(l))return null}return{from:n.from,to:n.to,containsSideEffects:!1}}case"text/html":case"text/javascript":case"text/jsx":case"text/typescript":case"text/typescript-jsx":{let o=n;for(;o&&o.name!=="this"&&o.name!=="VariableDefinition"&&o.name!=="VariableName"&&o.name!=="MemberExpression"&&!(o.name==="PropertyName"&&o.parent?.name==="PatternProperty"&&o.nextSibling?.name!==":")&&!(o.name==="PropertyDefinition"&&o.parent?.name==="Property"&&o.nextSibling?.name!==":");)o=o.parent;return o?{from:o.from,to:o.to,containsSideEffects:Fl(a.doc,o)}:null}default:return n.to-n.from>50||/[^\w_\-$]/.test(a.sliceDoc(n.from,n.to))?null:{from:n.from,to:n.to,containsSideEffects:!1}}}function Fl(a,e){let t=!1;return e.toTree().iterate({enter(i){switch(i.name){case"AssignmentExpression":case"CallExpression":return t=!0,!1;case"ArithOp":{const s=a.sliceString(e.from+i.from,e.from+i.to);if(s==="++"||s==="--")return t=!0,!1;break}}return!0}}),t}const Ml=U.mark({class:"cm-evaluatedExpression"}),wi=ps(),Al=se.baseTheme({".cm-gutters .cm-gutter.cm-lineNumbers .cm-gutterElement":{"&:hover, &.cm-breakpoint":{borderStyle:"solid",borderWidth:"1px 4px 1px 1px",marginRight:"-4px",paddingLeft:"8px",lineHeight:"calc(1.2em - 2px)",position:"relative"},"&:hover":{WebkitBorderImage:ie("#ebeced","#ebeced")},"&.cm-breakpoint":{color:"#fff",WebkitBorderImage:ie("#4285f4","#1a73e8")},"&.cm-breakpoint-conditional":{WebkitBorderImage:ie("#f29900","#e37400"),"&::before":{content:'"?"',position:"absolute",top:0,left:"1px"}},"&.cm-breakpoint-logpoint":{WebkitBorderImage:ie("#f439a0","#d01884"),"&::before":{content:'"‥"',position:"absolute",top:"-3px",left:"1px"}}},"&dark .cm-gutters .cm-gutter.cm-lineNumbers .cm-gutterElement":{"&:hover":{WebkitBorderImage:ie("#3c4043","#3c4043")},"&.cm-breakpoint":{WebkitBorderImage:ie("#5186EC","#1a73e8")},"&.cm-breakpoint-conditional":{WebkitBorderImage:ie("#e9a33a","#e37400")},"&.cm-breakpoint-logpoint":{WebkitBorderImage:ie("#E54D9B","#d01884")}},":host-context(.breakpoints-deactivated) & .cm-gutters .cm-gutter.cm-lineNumbers .cm-gutterElement.cm-breakpoint, .cm-gutters .cm-gutter.cm-lineNumbers .cm-gutterElement.cm-breakpoint-disabled":{color:"#1a73e8",WebkitBorderImage:ie("#d9e7fd","#1a73e8"),"&.cm-breakpoint-conditional":{color:"#e37400",WebkitBorderImage:ie("#fcebcc","#e37400")},"&.cm-breakpoint-logpoint":{color:"#d01884",WebkitBorderImage:ie("#fdd7ec","#f439a0")}},":host-context(.breakpoints-deactivated) &dark .cm-gutters .cm-gutter.cm-lineNumbers .cm-gutterElement.cm-breakpoint, &dark .cm-gutters .cm-gutter.cm-lineNumbers .cm-gutterElement.cm-breakpoint-disabled":{WebkitBorderImage:ie("#2a384e","#1a73e8"),"&.cm-breakpoint-conditional":{WebkitBorderImage:ie("#4d3c1d","#e37400")},"&.cm-breakpoint-logpoint":{WebkitBorderImage:ie("#4e283d","#f439a0")}},".cm-inlineBreakpoint":{cursor:"pointer",position:"relative",top:"1px",content:Ii("#4285F4","#1A73E8"),height:"10px","&.cm-inlineBreakpoint-conditional":{content:yi("#F29900","#E37400")},"&.cm-inlineBreakpoint-logpoint":{content:Ei("#F439A0","#D01884")}},"&dark .cm-inlineBreakpoint":{content:Ii("#5186EC","#1A73E8"),"&.cm-inlineBreakpoint-conditional":{content:yi("#e9a33a","#E37400")},"&.cm-inlineBreakpoint-logpoint":{content:Ei("#E54D9B","#D01884")}},":host-context(.breakpoints-deactivated) & .cm-inlineBreakpoint, .cm-inlineBreakpoint-disabled":{content:Ii("#4285F4","#1A73E8","0.2"),"&.cm-inlineBreakpoint-conditional":{content:yi("#F9AB00","#E37400","0.2")},"&.cm-inlineBreakpoint-logpoint":{content:Ei("#F439A0","#D01884","0.2")}},".cm-executionLine":{backgroundColor:"var(--sys-color-yellow-container)",outline:"1px solid var(--sys-color-yellow-outline)",".cm-hasContinueMarkers &":{backgroundColor:"transparent"},"&.cm-highlightedLine":{animation:"cm-fading-highlight-execution 2s 0s"},"&.cm-line::selection, &.cm-line ::selection":{backgroundColor:"var(--sys-color-tonal-container) !important"}},".cm-executionToken":{backgroundColor:"var(--sys-color-state-focus-select)"},"@keyframes cm-fading-highlight-execution":{from:{backgroundColor:"var(--sys-color-tonal-container)"},to:{backgroundColor:"var(--sys-color-yellow-container)"}},".cm-continueToLocation":{cursor:"pointer",backgroundColor:"var(--color-continue-to-location)","&:hover":{backgroundColor:"var(--color-continue-to-location-hover)",border:"1px solid var(--color-continue-to-location-hover-border)",margin:"0 -1px"},"&.cm-continueToLocation-async":{backgroundColor:"var(--color-continue-to-location-async)","&:hover":{backgroundColor:"var(--color-continue-to-location-async-hover)",border:"1px solid var(--color-continue-to-location-async-hover-border)",margin:"0 -1px"}}},".cm-evaluatedExpression":{backgroundColor:"var(--color-evaluated-expression)",border:"1px solid var(--color-evaluated-expression-border)",margin:"0 -1px"},".cm-variableValues":{display:"inline",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"1000px",opacity:"80%",backgroundColor:"var(--color-variable-values)",marginLeft:"10px",padding:"0 5px",userSelect:"text",".cm-executionLine &":{backgroundColor:"transparent",opacity:"50%"}}});function ie(a,e){return`url('data:image/svg+xml,<svg height="11" width="26" xmlns="http://www.w3.org/2000/svg"><path d="M22.8.5l2.7 5-2.7 5H.5V.5z" fill="${encodeURIComponent(a)}" stroke="${encodeURIComponent(e)}"/></svg>') 1 3 1 1`}function Ii(a,e,t="1"){return`url('data:image/svg+xml,<svg width="11" height="12" viewBox="0 0 11 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M0.5 0.5H5.80139C6.29382 0.5 6.7549 0.741701 7.03503 1.14669L10.392 6L7.03503 10.8533C6.7549 11.2583 6.29382 11.5 5.80139 11.5H0.5V0.5Z" fill="${encodeURIComponent(a)}" stroke="${encodeURIComponent(e)}" fill-opacity="${encodeURIComponent(t)}"/></svg>')`}function yi(a,e,t="1"){return`url('data:image/svg+xml,<svg width="11" height="12" viewBox="0 0 11 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M0.5 0.5H5.80139C6.29382 0.5 6.75489 0.741701 7.03503 1.14669L10.392 6L7.03503 10.8533C6.75489 11.2583 6.29382 11.5 5.80138 11.5H0.5V0.5Z" fill="${encodeURIComponent(a)}" fill-opacity="${encodeURIComponent(t)}" stroke="${encodeURIComponent(e)}"/><path d="M3.51074 7.75635H4.68408V9H3.51074V7.75635ZM4.68408 7.23779H3.51074V6.56104C3.51074 6.271 3.55615 6.02344 3.64697 5.81836C3.73779 5.61328 3.90039 5.39648 4.13477 5.16797L4.53027 4.77686C4.71484 4.59814 4.83936 4.4502 4.90381 4.33301C4.97119 4.21582 5.00488 4.09424 5.00488 3.96826C5.00488 3.77197 4.9375 3.62402 4.80273 3.52441C4.66797 3.4248 4.46582 3.375 4.19629 3.375C3.9502 3.375 3.69238 3.42773 3.42285 3.5332C3.15625 3.63574 2.88232 3.78955 2.60107 3.99463V2.81689C2.88818 2.65283 3.17822 2.52979 3.47119 2.44775C3.76709 2.36279 4.06299 2.32031 4.35889 2.32031C4.95068 2.32031 5.41504 2.45801 5.75195 2.7334C6.08887 3.00879 6.25732 3.38818 6.25732 3.87158C6.25732 4.09424 6.20752 4.30225 6.10791 4.49561C6.0083 4.68604 5.8208 4.91602 5.54541 5.18555L5.15869 5.56348C4.95947 5.75684 4.83203 5.91504 4.77637 6.03809C4.7207 6.16113 4.69287 6.31201 4.69287 6.49072C4.69287 6.51709 4.69141 6.54785 4.68848 6.58301C4.68848 6.61816 4.68701 6.65625 4.68408 6.69727V7.23779Z" fill="white"/></svg>')`}function Ei(a,e,t="1"){return`url('data:image/svg+xml,<svg width="11" height="12" viewBox="0 0 11 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M0.5 0.5H5.80139C6.29382 0.5 6.7549 0.741701 7.03503 1.14669L10.392 6L7.03503 10.8533C6.7549 11.2583 6.29382 11.5 5.80139 11.5H0.5V0.5Z" fill="${encodeURIComponent(a)}" stroke="${encodeURIComponent(e)}" fill-opacity="${encodeURIComponent(t)}"/><circle cx="3" cy="6" r="1" fill="white"/><circle cx="7" cy="6" r="1" fill="white"/></svg>')`}const kd=Object.freeze(Object.defineProperty({__proto__:null,BreakpointLocationRevealer:pl,DebuggerPlugin:mo,computePopoverHighlightRange:yo,computeScopeMappings:wo,getVariableNamesByLine:Co,getVariableValuesByLine:Io},Symbol.toStringTag,{value:"Module"}));class _t{query;queryUpperCase;score;sequence;dataUpperCase;fileNameIndex;constructor(e){this.query=e,this.queryUpperCase=e.toUpperCase(),this.score=new Int32Array(20*100),this.sequence=new Int32Array(20*100),this.dataUpperCase="",this.fileNameIndex=0}calculateScore(e,t){if(!e||!this.query)return 0;const i=this.query.length,s=e.length;(!this.score||this.score.length<i*s)&&(this.score=new Int32Array(i*s*2),this.sequence=new Int32Array(i*s*2));const n=this.score,o=this.sequence;this.dataUpperCase=e.toUpperCase(),this.fileNameIndex=e.lastIndexOf("/");for(let c=0;c<i;++c)for(let l=0;l<s;++l){const d=l===0?0:n[c*s+l-1],h=c===0||l===0?0:n[(c-1)*s+l-1],u=c===0||l===0?0:o[(c-1)*s+l-1],p=this.match(this.query,e,c,l,u);p&&h+p>=d?(o[c*s+l]=u+1,n[c*s+l]=h+p):(o[c*s+l]=0,n[c*s+l]=d)}t&&this.restoreMatchIndexes(o,i,s,t);const r=256;return n[i*s-1]*r+(r-e.length)}testWordStart(e,t){if(t===0)return!0;const i=e.charAt(t-1);return i==="_"||i==="-"||i==="/"||i==="."||i===" "||e[t-1]!==this.dataUpperCase[t-1]&&e[t]===this.dataUpperCase[t]}restoreMatchIndexes(e,t,i,s){let n=t-1,o=i-1;for(;n>=0&&o>=0;)switch(e[n*i+o]){case 0:--o;break;default:s.push(o),--n,--o;break}s.reverse()}singleCharScore(e,t,i,s){const n=this.testWordStart(t,s),o=s>this.fileNameIndex,r=s===0||t[s-1]==="/",c=e[i]===t[s]&&e[i]===this.queryUpperCase[i];let l=10;return r&&(l+=4),n&&(l+=2),c&&(l+=6),o&&(l+=4),s===this.fileNameIndex+1&&i===0&&(l+=5),o&&n&&(l+=3),l}sequenceCharScore(e,t,i,s,n){const o=s>this.fileNameIndex,r=s===0||t[s-1]==="/";let c=10;return o&&(c+=4),r&&(c+=5),c+=n*4,c}match(e,t,i,s,n){return this.queryUpperCase[i]!==this.dataUpperCase[s]?0:n?this.sequenceCharScore(e,t,i,s-n,n):this.singleCharScore(e,t,i,s)}}const Ld=Object.freeze(Object.defineProperty({__proto__:null,FilePathScoreFunction:_t},Symbol.toStringTag,{value:"Module"})),Gi={noFilesFound:"No files found",sIgnoreListed:"{PH1} (ignore listed)"},Nl=M("panels/sources/FilteredUISourceCodeListProvider.ts",Gi),Ks=N.bind(void 0,Nl);class Dl extends ls{queryLineNumberAndColumnNumber;defaultScores;scorer;uiSourceCodes;uiSourceCodeIds;query;constructor(e){super(e),this.queryLineNumberAndColumnNumber="",this.defaultScores=null,this.scorer=new _t(""),this.uiSourceCodes=[],this.uiSourceCodeIds=new Set}projectRemoved(e){const t=e.data;this.populate(t),this.refresh()}populate(e){this.uiSourceCodes=[],this.uiSourceCodeIds.clear();for(const t of te.instance().projects())if(t!==e&&this.filterProject(t))for(const i of t.uiSourceCodes())this.filterUISourceCode(i)&&(this.uiSourceCodes.push(i),this.uiSourceCodeIds.add(i.canononicalScriptId()))}filterUISourceCode(e){if(this.uiSourceCodeIds.has(e.canononicalScriptId())||Ne.isEnabled("just-my-code")&&X.instance().isUserOrSourceMapIgnoreListedUISourceCode(e)||e.isFetchXHR())return!1;const t=P.instance().binding(e);return!t||t.fileSystem===e}uiSourceCodeSelected(e,t,i){}filterProject(e){return!0}itemCount(){return this.uiSourceCodes.length}itemContentTypeAt(e){return this.uiSourceCodes[e].contentType()}itemKeyAt(e){return this.uiSourceCodes[e].url()}setDefaultScores(e){this.defaultScores=e}itemScoreAt(e,t){const i=this.uiSourceCodes[e],s=this.defaultScores&&this.defaultScores.get(i)||0;if(!t||t.length<2)return s;this.query!==t&&(this.query=t,this.scorer=new _t(t));let n=10;i.project().type()===b.FileSystem&&!P.instance().binding(i)&&(n=5);let o=0;i.contentType().isFromSourceMap()&&!i.isKnownThirdParty()&&(o=100),i.contentType().isScript()&&(X.instance().isUserOrSourceMapIgnoreListedUISourceCode(i)||(o+=50));const r=i.fullDisplayName();return s+n*(o+this.scorer.calculateScore(r,null))}renderItem(e,t,i,s){t=this.rewriteQuery(t);const n=this.uiSourceCodes[e],o=n.fullDisplayName(),r=[];new _t(t).calculateScore(o,r);const c=o.lastIndexOf("/"),l=X.instance().isUserOrSourceMapIgnoreListedUISourceCode(n);let d=o;l&&(i.parentElement?.classList.add("is-ignore-listed"),d=Ks(Gi.sIgnoreListed,{PH1:d})),i.textContent=n.displayName()+(this.queryLineNumberAndColumnNumber||""),this.renderSubtitleElement(s,o.substring(0,c+1)),Q.install(s,d);const h=[];for(let u=0;u<r.length;++u)h.push({offset:r[u],length:1});if(r[0]>c){for(let u=0;u<h.length;++u)h[u].offset-=c+1;Ai(i,h,"highlight")}else Ai(s,h,"highlight")}renderSubtitleElement(e,t){e.removeChildren();let i=t.lastIndexOf("/");const s=43;t.length>s&&(i=t.length-s);const n=e.createChild("div","first-part");n.textContent=t.substring(0,i);const o=e.createChild("div","second-part");o.textContent=t.substring(i),Q.install(e,t)}selectItem(e,t){const i=t.trim().match(/^([^:]*)(:\d+)?(:\d+)?$/);if(!i)return;let s,n;i[2]&&(s=parseInt(i[2].substr(1),10)-1),i[3]&&(n=parseInt(i[3].substr(1),10)-1);const o=e!==null?this.uiSourceCodes[e]:null;this.uiSourceCodeSelected(o,s,n)}rewriteQuery(e){if(e=e?e.trim():"",!e||e===":")return"";const t=e.match(/^([^:]+)((?::[^:]*){0,2})$/);return this.queryLineNumberAndColumnNumber=t?t[2]:"",t?t[1]:e}uiSourceCodeAdded(e){const t=e.data;!this.filterUISourceCode(t)||!this.filterProject(t.project())||(this.uiSourceCodes.push(t),this.uiSourceCodeIds.add(t.canononicalScriptId()),this.refresh())}notFoundText(){return Ks(Gi.noFilesFound)}attach(){te.instance().addEventListener(Y.UISourceCodeAdded,this.uiSourceCodeAdded,this),te.instance().addEventListener(Y.ProjectRemoved,this.projectRemoved,this),this.populate()}detach(){te.instance().removeEventListener(Y.UISourceCodeAdded,this.uiSourceCodeAdded,this),te.instance().removeEventListener(Y.ProjectRemoved,this.projectRemoved,this),this.queryLineNumberAndColumnNumber="",this.defaultScores=null}}const Pd=Object.freeze(Object.defineProperty({__proto__:null,FilteredUISourceCodeListProvider:Dl},Symbol.toStringTag,{value:"Module"})),xe={noFileSelected:"No file selected.",noResultsFound:"No results found",typeANumberToGoToThatLine:"Type a number to go to that line.",currentPositionXsTypeAnOffset:"Current position: 0x{PH1}. Type an offset between 0x{PH2} and 0x{PH3} to navigate to.",currentLineSTypeALineNumber:"Current line: {PH1}. Type a line number between 1 and {PH2} to navigate to.",goToOffsetXs:"Go to offset 0x{PH1}.",goToLineSAndColumnS:"Go to line {PH1} and column {PH2}.",goToLineS:"Go to line {PH1}."},Rl=M("panels/sources/GoToLineQuickOpen.ts",xe),Fe=N.bind(void 0,Rl);class Ol extends ls{#e=[];constructor(){super("source-line")}selectItem(e,t){const i=this.currentSourceFrame();if(!i)return;const s=this.parsePosition(t);s&&i.revealPosition({lineNumber:s.line-1,columnNumber:s.column-1})}itemCount(){return this.#e.length}renderItem(e,t,i,s){Oi(i,this.#e[e])}rewriteQuery(e){return""}queryChanged(e){this.#e=[];const t=this.parsePosition(e),i=this.currentSourceFrame();if(!t){if(!i){this.#e.push(Fe(xe.typeANumberToGoToThatLine));return}const s=i.textEditor.state,n=i.wasmDisassembly,o=i.editorLocationToUILocation(s.doc.lineAt(s.selection.main.head).number-1).lineNumber;if(n){const c=n.lineNumberToBytecodeOffset(n.lineNumbers-1),l=c.toString(16).length,d=n.lineNumberToBytecodeOffset(o);this.#e.push(Fe(xe.currentPositionXsTypeAnOffset,{PH1:d.toString(16).padStart(l,"0"),PH2:"0".padStart(l,"0"),PH3:c.toString(16)}));return}const r=i.editorLocationToUILocation(s.doc.lines-1).lineNumber+1;this.#e.push(Fe(xe.currentLineSTypeALineNumber,{PH1:o+1,PH2:r}));return}if(i&&i.wasmDisassembly){this.#e.push(Fe(xe.goToOffsetXs,{PH1:(t.column-1).toString(16)}));return}if(t.column&&t.column>1){this.#e.push(Fe(xe.goToLineSAndColumnS,{PH1:t.line,PH2:t.column}));return}i&&t.line>i.textEditor.state.doc.lines||this.#e.push(Fe(xe.goToLineS,{PH1:t.line}))}notFoundText(e){return this.currentSourceFrame()?Fe(xe.noResultsFound):Fe(xe.noFileSelected)}parsePosition(e){const t=this.currentSourceFrame();if(t&&t.wasmDisassembly){const o=e.match(/0x([0-9a-fA-F]+)/);return!o||!o[0]||o[0].length!==e.length?null:{line:0,column:parseInt(o[0],16)+1}}const i=e.match(/([0-9]+)(\:[0-9]*)?/);if(!i||!i[0]||i[0].length!==e.length)return null;const s=parseInt(i[1],10);let n=0;return i[2]&&(n=parseInt(i[2].substring(1),10)),{line:Math.max(s|0,1),column:Math.max(n|0,1)}}currentSourceFrame(){const e=g.instance().flavor(pe);return e?e.currentSourceFrame():null}}const Fd=Object.freeze(Object.defineProperty({__proto__:null,GoToLineQuickOpen:Ol},Symbol.toStringTag,{value:"Module"})),Yi={formatS:"Format {PH1}",format:"Format"},Bl=M("panels/sources/InplaceFormatterEditorAction.ts",Yi),Js=N.bind(void 0,Bl);let xi;class si{button;sourcesView;uiSourceCodeTitleChangedEvent=null;constructor(){}static instance(e={forceNew:null}){const{forceNew:t}=e;return(!xi||t)&&(xi=new si),xi}editorSelected(e){const t=e.data;this.updateButton(t)}editorClosed(e){const{wasSelected:t}=e.data;t&&this.updateButton(null)}updateButton(e){this.uiSourceCodeTitleChangedEvent&&wt([this.uiSourceCodeTitleChangedEvent]),this.uiSourceCodeTitleChangedEvent=e?e.addEventListener(y.TitleChanged,i=>this.updateButton(i.data),this):null;const t=this.isFormattable(e);this.button.element.classList.toggle("hidden",!t),e&&t&&this.button.setTitle(Js(Yi.formatS,{PH1:e.name()}))}getOrCreateButton(e){return this.button?this.button:(this.sourcesView=e,this.sourcesView.addEventListener("EditorSelected",this.editorSelected.bind(this)),this.sourcesView.addEventListener("EditorClosed",this.editorClosed.bind(this)),this.button=new me(Js(Yi.format),"brackets"),this.button.addEventListener("Click",this.formatSourceInPlace,this),this.updateButton(e.currentUISourceCode()),this.button)}isFormattable(e){return e?!!(e.project().canSetFileContent()||P.instance().binding(e)!==null):!1}formatSourceInPlace(){const e=this.sourcesView.currentSourceFrame();if(!e)return;const t=e.uiSourceCode();this.isFormattable(t)&&(t.isDirty()?this.contentLoaded(t,e,t.workingCopy()):t.requestContent().then(i=>{this.contentLoaded(t,e,i.content||"")}))}async contentLoaded(e,t,i){const{formattedContent:s,formattedMapping:n}=await Ta(e.contentType(),t.contentType,i);if(e.workingCopy()===s)return;const o=t.textEditor.toLineColumn(t.textEditor.state.selection.main.head),[r,c]=n.originalToFormatted(o.lineNumber,o.columnNumber);e.setWorkingCopy(s),this.sourcesView.showSourceLocation(e,{lineNumber:r,columnNumber:c})}}co(si.instance);const Md=Object.freeze(Object.defineProperty({__proto__:null,InplaceFormatterEditorAction:si},Symbol.toStringTag,{value:"Module"})),zt={noFileSelected:"No file selected.",openAJavascriptOrCssFileToSee:"Open a JavaScript or CSS file to see symbols",noResultsFound:"No results found"},Ul=M("panels/sources/OutlineQuickOpen.ts",zt),Ti=N.bind(void 0,Ul);function Eo(a){function e(o){o=Math.max(0,Math.min(o,a.doc.length));const r=a.doc.lineAt(o);return{lineNumber:r.number-1,columnNumber:o-r.from}}function t(){for(;n.name!=="ParamList"&&n.nextSibling(););let o="";if(n.name==="ParamList"&&n.firstChild())do switch(n.name){case"ArrayPattern":o+="[‥]";break;case"ObjectPattern":o+="{‥}";break;case"VariableDefinition":o+=a.sliceDoc(n.from,n.to);break;case"Spread":o+="...";break;case",":o+=", ";break}while(n.nextSibling());return`(${o})`}const i=Lt(a),s=[],n=i.cursor();do switch(n.name){case"RuleSet":{for(n.firstChild();;n.nextSibling()){const o=a.sliceDoc(n.from,n.to),{lineNumber:r,columnNumber:c}=e(n.from);if(s.push({title:o,lineNumber:r,columnNumber:c}),n.nextSibling(),n.name!==",")break}break}case"FunctionDeclaration":case"MethodDeclaration":{let o="";n.firstChild();do switch(n.name){case"abstract":case"async":case"get":case"set":case"static":o=`${o}${n.name} `;break;case"Star":o+="*";break;case"PropertyDefinition":case"PrivatePropertyDefinition":case"VariableDefinition":{const r=o+a.sliceDoc(n.from,n.to),{lineNumber:c,columnNumber:l}=e(n.from),d=t();s.push({title:r,subtitle:d,lineNumber:c,columnNumber:l});break}}while(n.nextSibling());break}case"Property":{let o="";n.firstChild();do if(n.name==="async"||n.name==="get"||n.name==="set")o=`${o}${n.name} `;else if(n.name==="Star")o+="*";else if(n.name==="PropertyDefinition"){let r=a.sliceDoc(n.from,n.to);const{lineNumber:c,columnNumber:l}=e(n.from);for(;n.nextSibling();){if(n.name==="ClassExpression"){r=`class ${r}`,s.push({title:r,lineNumber:c,columnNumber:l});break}if((n.name==="ArrowFunction"||n.name==="FunctionExpression")&&n.firstChild(),n.name==="async")o=`async ${o}`;else if(n.name==="Star")o+="*";else if(n.name==="ParamList"){r=o+r;const d=t();s.push({title:r,subtitle:d,lineNumber:c,columnNumber:l});break}}break}else break;while(n.nextSibling());break}case"PropertyName":case"VariableDefinition":{if(n.matchContext(["ClassDeclaration"])){const o="class "+a.sliceDoc(n.from,n.to),{lineNumber:r,columnNumber:c}=e(n.from);s.push({title:o,lineNumber:r,columnNumber:c})}else if(n.matchContext(["AssignmentExpression","MemberExpression"])||n.matchContext(["VariableDeclaration"])){let o=a.sliceDoc(n.from,n.to);const{lineNumber:r,columnNumber:c}=e(n.from);for(;n.name!=="Equals"&&n.next(););if(!n.nextSibling())break;if(n.name==="ArrowFunction"||n.name==="FunctionExpression"){n.firstChild();let l="";for(;n.name!=="ParamList"&&(n.name==="async"?l=`async ${l}`:n.name==="Star"&&(l+="*"),!!n.nextSibling()););o=l+o;const d=t();s.push({title:o,subtitle:d,lineNumber:r,columnNumber:c})}else n.name==="ClassExpression"&&(o=`class ${o}`,s.push({title:o,lineNumber:r,columnNumber:c}))}break}case"App":{if(n.firstChild()&&n.nextSibling()&&a.sliceDoc(n.from,n.to)==="module"){if(n.nextSibling()&&n.name==="Identifier"){const o=a.sliceDoc(n.from,n.to),{lineNumber:r,columnNumber:c}=e(n.from);s.push({title:o,lineNumber:r,columnNumber:c})}do if(n.name==="App"&&n.firstChild()){if(n.nextSibling()&&a.sliceDoc(n.from,n.to)==="func"&&n.nextSibling()&&n.name==="Identifier"){const o=a.sliceDoc(n.from,n.to),{lineNumber:r,columnNumber:c}=e(n.from),l=[];for(;n.nextSibling();)n.name==="App"&&n.firstChild()&&(n.nextSibling()&&a.sliceDoc(n.from,n.to)==="param"&&(n.nextSibling()&&n.name==="Identifier"?l.push(a.sliceDoc(n.from,n.to)):l.push(`$${l.length}`)),n.parent());const d=`(${l.join(", ")})`;s.push({title:o,subtitle:d,lineNumber:r,columnNumber:c})}n.parent()}while(n.nextSibling())}break}case"FieldIdentifier":case"Identifier":{if(n.matchContext(["FunctionDeclarator"])){const o=a.sliceDoc(n.from,n.to),{lineNumber:r,columnNumber:c}=e(n.from);s.push({title:o,lineNumber:r,columnNumber:c})}break}case"TypeIdentifier":{if(n.matchContext(["ClassSpecifier"])){const o=`class ${a.sliceDoc(n.from,n.to)}`,{lineNumber:r,columnNumber:c}=e(n.from);s.push({title:o,lineNumber:r,columnNumber:c})}else if(n.matchContext(["StructSpecifier"])){const o=`struct ${a.sliceDoc(n.from,n.to)}`,{lineNumber:r,columnNumber:c}=e(n.from);s.push({title:o,lineNumber:r,columnNumber:c})}break}}while(n.next());return s}class Vl extends ls{items=[];active=!1;constructor(){super("source-symbol")}attach(){const e=this.currentSourceFrame();e?(this.active=!0,this.items=Eo(e.textEditor.state).map(({title:t,subtitle:i,lineNumber:s,columnNumber:n})=>({lineNumber:s,columnNumber:n}=e.editorLocationToUILocation(s,n),{title:t,subtitle:i,lineNumber:s,columnNumber:n}))):(this.active=!1,this.items=[])}detach(){this.active=!1,this.items=[]}itemCount(){return this.items.length}itemKeyAt(e){const t=this.items[e];return t.title+(t.subtitle?t.subtitle:"")}itemScoreAt(e,t){const i=this.items[e];return t.split("(")[0].toLowerCase()===i.title.toLowerCase()?1/(1+i.lineNumber):-i.lineNumber-1}renderItem(e,t,i,s){const n=this.items[e];i.textContent=n.title+(n.subtitle?n.subtitle:""),ba.highlightRanges(i,t);const o=this.currentSourceFrame();if(!o)return;const r=i.parentElement?.parentElement?.createChild("span","tag");if(!r)return;const c=o.wasmDisassembly;if(c){const d=c.lineNumberToBytecodeOffset(c.lineNumbers-1).toString(16).length;r.textContent=`:0x${n.columnNumber.toString(16).padStart(d,"0")}`}else r.textContent=`:${n.lineNumber+1}`}selectItem(e,t){if(e===null)return;const i=this.currentSourceFrame();if(!i)return;const s=this.items[e];i.revealPosition({lineNumber:s.lineNumber,columnNumber:s.columnNumber},!0)}currentSourceFrame(){const e=g.instance().flavor(pe);return e&&e.currentSourceFrame()}notFoundText(){return this.currentSourceFrame()?this.active?Ti(zt.noResultsFound):Ti(zt.openAJavascriptOrCssFileToSee):Ti(zt.noFileSelected)}}const Ad=Object.freeze(Object.defineProperty({__proto__:null,OutlineQuickOpen:Vl,outline:Eo},Symbol.toStringTag,{value:"Module"})),Ki=new CSSStyleSheet;Ki.replaceSync(`/*
 * Copyright 2017 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

.scope-chain-sidebar-pane-section-header {
  flex: auto;
}

.scope-chain-sidebar-pane-section-icon {
  float: left;
  margin-right: 5px;
}

.scope-chain-sidebar-pane-section-subtitle {
  float: right;
  margin-left: 5px;
  max-width: 55%;
  text-overflow: ellipsis;
  overflow: hidden;
}

.scope-chain-sidebar-pane-section-title {
  font-weight: normal;
  word-wrap: break-word;
  white-space: normal;
}

.scope-chain-sidebar-pane-section {
  padding: 2px 4px;
  flex: none;
}

/*# sourceURL=scopeChainSidebarPane.css */
`);const Ye={loading:"Loading...",notPaused:"Not paused",noVariables:"No variables",closureS:"Closure ({PH1})",closure:"Closure"},jl=M("panels/sources/ScopeChainSidebarPane.ts",Ye),dt=N.bind(void 0,jl);let ki;class ms extends Be{treeOutline;expandController;linkifier;infoElement;#e=null;constructor(){super(!0),this.contentElement.setAttribute("jslog",`${Zt("sources.scope-chain")}`),this.treeOutline=new xn,this.treeOutline.hideOverflow(),this.treeOutline.setShowSelectionOnKeyboardFocus(!0),this.expandController=new Tn(this.treeOutline),this.linkifier=new tt,this.infoElement=document.createElement("div"),this.infoElement.className="gray-info-message",this.infoElement.tabIndex=-1,this.flavorChanged(g.instance().flavor(ee))}static instance(){return ki||(ki=new ms),ki}flavorChanged(e){this.#e?.dispose(),this.#e=null,this.linkifier.reset(),this.contentElement.removeChildren(),this.contentElement.appendChild(this.infoElement),e?(this.infoElement.textContent=dt(Ye.loading),this.#e=new Wa(e),this.#e.addEventListener("ScopeChainUpdated",t=>this.buildScopeTreeOutline(t.data),this)):this.infoElement.textContent=dt(Ye.notPaused)}focus(){this.hasFocus()||g.instance().flavor(ft)&&this.treeOutline.forceSelect()}buildScopeTreeOutline(e){const{scopeChain:t}=e;this.treeOutline.removeChildren(),this.contentElement.removeChildren(),this.contentElement.appendChild(this.treeOutline.element);let i=!1;for(const[s,n]of t.entries()){n.type()==="local"&&(i=!0);const o=this.createScopeSectionTreeElement(n);n.type()==="global"?o.collapse():(!i||n.type()==="local")&&o.expand(),this.treeOutline.appendChild(o),s===0&&o.select(!0)}this.sidebarPaneUpdatedForTest()}createScopeSectionTreeElement(e){let t=null;(e.type()==="local"||e.type()==="closure")&&(t=dt(Ye.noVariables));let i=e.typeName();if(e.type()==="closure"){const c=e.name();c?i=dt(Ye.closureS,{PH1:Mi(c)}):i=dt(Ye.closure)}let s=e.description();(!i||i===s)&&(s=null);const n=e.icon(),o=document.createElement("div");if(o.classList.add("scope-chain-sidebar-pane-section-header"),o.classList.add("tree-element-title"),n){const c=document.createElement("img");c.classList.add("scope-chain-sidebar-pane-section-icon"),c.src=n,o.appendChild(c)}o.createChild("div","scope-chain-sidebar-pane-section-subtitle").textContent=s,o.createChild("div","scope-chain-sidebar-pane-section-title").textContent=i;const r=new kn(e.object(),this.linkifier,t,0,e.extraProperties());return r.title=o,r.listItemElement.classList.add("scope-chain-sidebar-pane-section"),r.listItemElement.setAttribute("aria-label",i),this.expandController.watchSection(i+(s?":"+s:""),r),r}sidebarPaneUpdatedForTest(){}wasShown(){super.wasShown(),this.treeOutline.registerCSSFiles([Ki]),this.registerCSSFiles([Ki])}}const Nd=Object.freeze(Object.defineProperty({__proto__:null,ScopeChainSidebarPane:ms},Symbol.toStringTag,{value:"Module"})),xo=new CSSStyleSheet;xo.replaceSync(`/*
 * Copyright 2022 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

.border-container {
  border-bottom: 1px solid var(--sys-color-divider);
  flex-shrink: 0;
}

/*# sourceURL=sourcesNavigator.css */
`);const q={explainWorkspace:"Set up workspace to sync edits directly to the sources you develop",explainLocalOverrides:"Override network requests and web content locally to mock remote resources",learnMore:"Learn more",clearConfiguration:"Clear configuration",selectFolderForOverrides:"Select folder for overrides",explainContentScripts:"View content scripts served by extensions",explainSnippets:"Save the JavaScript code you run often to run it again anytime",newSnippet:"New snippet",createNewSnippet:"Create new snippet",run:"Run",rename:"Rename…",remove:"Remove",saveAs:"Save as..."},Wl=M("panels/sources/SourcesNavigator.ts",q),G=N.bind(void 0,Wl);let Li;class gs extends ce{constructor(){super("navigator-network",!0),T.instance().addEventListener("InspectedURLChanged",this.inspectedURLChanged,this),ne.panelLoaded("sources","DevTools.Launch.Sources"),T.instance().addScopeChangeListener(this.onScopeChange.bind(this))}wasShown(){this.registerCSSFiles([xo]),super.wasShown()}static instance(e={forceNew:null}){const{forceNew:t}=e;return(!Li||t)&&(Li=new gs),Li}acceptProject(e){return e.type()===b.Network&&T.instance().isInScope(Qe.getTargetForProject(e))}onScopeChange(){for(const e of te.instance().projects())this.acceptProject(e)?this.tryAddProject(e):this.removeProject(e)}inspectedURLChanged(e){const t=T.instance().scopeTarget();if(e.data!==t)return;const i=t&&t.inspectedURL();if(i)for(const s of this.workspace().uiSourceCodes())this.acceptProject(s.project())&&s.url()===i&&this.revealUISourceCode(s,!0)}uiSourceCodeAdded(e){const t=T.instance().scopeTarget(),i=t&&t.inspectedURL();i&&e.url()===i&&this.revealUISourceCode(e,!0)}}class Hl extends ce{constructor(){super("navigator-files");const e=new it("");this.setPlaceholder(e),e.appendParagraph().appendChild(xt`
  <div>${G(q.explainWorkspace)}</div><br />
  ${ei.create("https://goo.gle/devtools-workspace",G(q.learnMore),void 0,void 0,"learn-more")}
  `);const t=new Z("navigator-toolbar");t.appendItemsAtLocation("files-navigator-toolbar").then(()=>{t.empty()||this.contentElement.insertBefore(t.element,this.contentElement.firstChild)})}sourceSelected(e,t){ne.actionTaken(Pe.WorkspaceSourceSelected),super.sourceSelected(e,t)}acceptProject(e){return e.type()===b.FileSystem&&we.fileSystemType(e)!=="overrides"&&!os(e)}handleContextMenu(e){const t=new Re(e);t.defaultSection().appendAction("sources.add-folder-to-workspace",void 0,!0),t.show()}}let Pi;class fs extends ce{toolbar;constructor(){super("navigator-overrides");const e=new it("");this.setPlaceholder(e),e.appendParagraph().appendChild(xt`
  <div>${G(q.explainLocalOverrides)}</div><br />
  ${ei.create("https://goo.gle/devtools-overrides",G(q.learnMore),void 0,void 0,"learn-more")}
  `),this.toolbar=new Z("navigator-toolbar"),this.contentElement.insertBefore(this.toolbar.element,this.contentElement.firstChild),Ae.instance().addEventListener("ProjectChanged",this.updateProjectAndUI,this),this.workspace().addEventListener(Y.ProjectAdded,this.onProjectAddOrRemoved,this),this.workspace().addEventListener(Y.ProjectRemoved,this.onProjectAddOrRemoved,this),this.updateProjectAndUI()}static instance(e={forceNew:null}){const{forceNew:t}=e;return(!Pi||t)&&(Pi=new fs),Pi}onProjectAddOrRemoved(e){const t=e.data;t&&t.type()===b.FileSystem&&we.fileSystemType(t)!=="overrides"||this.updateUI()}updateProjectAndUI(){this.reset();const e=Ae.instance().project();e&&this.tryAddProject(e),this.updateUI()}updateUI(){this.toolbar.removeToolbarItems();const e=Ae.instance().project();if(e){const s=new Sa(v.instance().moduleSetting("persistence-network-overrides-enabled"));this.toolbar.appendToolbarItem(s),this.toolbar.appendToolbarItem(new bn(!0));const n=new me(G(q.clearConfiguration),"clear");n.addEventListener("Click",()=>{v.instance().moduleSetting("persistence-network-overrides-enabled").set(!1),e.remove()}),this.toolbar.appendToolbarItem(n);return}const t=G(q.selectFolderForOverrides),i=new me(t,"plus",t);i.addEventListener("Click",s=>{this.setupNewWorkspace()},this),this.toolbar.appendToolbarItem(i)}async setupNewWorkspace(){await cs.instance().addFileSystem("overrides")&&v.instance().moduleSetting("persistence-network-overrides-enabled").set(!0)}sourceSelected(e,t){ne.actionTaken(Pe.OverridesSourceSelected),super.sourceSelected(e,t)}acceptProject(e){return e===Ae.instance().project()}}class $l extends ce{constructor(){super("navigator-content-scripts");const e=new it("");this.setPlaceholder(e),e.appendParagraph().appendChild(xt`
  <div>${G(q.explainContentScripts)}</div><br />
  ${ei.create("https://developer.chrome.com/extensions/content_scripts",G(q.learnMore),void 0,void 0,"learn-more")}
  `)}acceptProject(e){return e.type()===b.ContentScripts}}class _l extends ce{constructor(){super("navigator-snippets");const e=new it("");this.setPlaceholder(e),e.appendParagraph().appendChild(xt`
  <div>${G(q.explainSnippets)}</div><br />
  ${ei.create("https://goo.gle/devtools-snippets",G(q.learnMore),void 0,void 0,"learn-more")}
  `);const t=new Z("navigator-toolbar"),i=new me(G(q.newSnippet),"plus",G(q.newSnippet),"sources.new-snippet");i.addEventListener("Click",s=>{this.create(Ui(),"")}),t.appendToolbarItem(i),this.contentElement.insertBefore(t.element,this.contentElement.firstChild)}acceptProject(e){return os(e)}handleContextMenu(e){const t=new Re(e);t.headerSection().appendItem(G(q.createNewSnippet),()=>this.create(Ui(),""),{jslogContext:"create-new-snippet"}),t.show()}handleFileContextMenu(e,t){const i=t.uiSourceCode(),s=new Re(e);s.headerSection().appendItem(G(q.run),()=>Cn(i),{jslogContext:"run"}),s.editSection().appendItem(G(q.rename),()=>this.rename(t,!1),{jslogContext:"rename"}),s.editSection().appendItem(G(q.remove),()=>i.project().deleteFile(i),{jslogContext:"remove"}),s.saveSection().appendItem(G(q.saveAs),this.handleSaveAs.bind(this,i),{jslogContext:"save-as"}),s.show()}async handleSaveAs(e){e.commitWorkingCopy();const{content:t}=await e.requestContent();await Ms.instance().save(this.addJSExtension(e.url()),t||"",!0,!1),Ms.instance().close(e.url())}addJSExtension(e){return z.concatenate(e,".js")}}class zl{handleAction(e,t){switch(t){case"sources.create-snippet":return Ui().createFile(ht,null,"").then(i=>Oe(i)),!0;case"sources.add-folder-to-workspace":return cs.instance().addFileSystem(),!0}return!1}}const Dd=Object.freeze(Object.defineProperty({__proto__:null,ActionDelegate:zl,ContentScriptsNavigatorView:$l,FilesNavigatorView:Hl,NetworkNavigatorView:gs,OverridesNavigatorView:fs,SnippetsNavigatorView:_l},Symbol.toStringTag,{value:"Module"})),Ji=new CSSStyleSheet;Ji.replaceSync(`/*
 * Copyright 2017 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

.watch-expression-delete-button {
  position: absolute;
  opacity: 0%;
  right: 0;

  .watch-expression-title:hover & {
    opacity: 100%;
  }

  .watch-expression-title:focus-within & {
    opacity: 100%;
  }
}

:host-context(.theme-with-dark-background) .watch-expression-delete-button {
  /* This is a workaround due to a sprite with hardcoded color.
     It should no longer be necessary after we update icons. */
  filter: brightness(1.5);
}

.watch-expressions {
  min-height: 26px;
}

.watch-expression-title {
  white-space: nowrap;
  line-height: 20px;
  display: flex;
}

.watch-expression-title:hover,
.watch-expression-title:focus-within {
  padding-right: 26px;
}

.watch-expression-object-header .watch-expression-title {
  margin-left: 1px;
}

.watch-expression {
  position: relative;
  flex: auto;
  min-height: 20px;
}

.watch-expression .name {
  color: var(--sys-color-purple);
  white-space: nowrap;
  text-overflow: ellipsis;
  overflow: hidden;
  flex-shrink: 1000000;
  min-width: 2em;
}

.watch-expression-error {
  color: var(--sys-color-error);
}

.watch-expressions-separator {
  flex-shrink: 0;
  flex-grow: 0;
}

.watch-expression .value {
  white-space: nowrap;
  display: inline;
  overflow: hidden;
  padding-left: 4px;
  text-overflow: ellipsis;
  flex-shrink: 1;
}

.watch-expression .text-prompt {
  text-overflow: clip;
  overflow: hidden;
  white-space: nowrap;
  padding-left: 4px;
  min-height: 18px;
  line-height: 18px;
  user-select: text;
}

.watch-expression-text-prompt-proxy {
  margin: 2px 12px 2px -4px;
  padding-bottom: 3px;
}

.watch-expression-header {
  flex: auto;
  margin-left: -16px;
  padding-left: 15px;
}

li.watch-expression-tree-item {
  padding-left: 4px;
}

li.watch-expression-tree-item.selected {
  background: var(--sys-color-neutral-container);
}

li.watch-expression-tree-item.selected:focus {
  background: var(--sys-color-tonal-container);
}

li.watch-expression-tree-item.selected:focus-within:focus-visible {
  background: var(--sys-color-tonal-container);
}

.watch-expression-header:focus-visible {
  background: var(--sys-color-tonal-container);
}

li.watch-expression-editing::before {
  background-color: transparent;
}

@media (forced-colors: active) {
  .watch-expression-title:hover .watch-expression-delete-button,
  .watch-expressions .dimmed {
    opacity: 100%;
  }

  li.watch-expression-tree-item * {
    forced-color-adjust: none;
    color: ButtonText;
  }

  li.watch-expression-tree-item:hover {
    forced-color-adjust: none;
    background-color: Highlight;
  }

  li.watch-expression-tree-item:hover * {
    color: HighlightText;
  }

  li.watch-expression-tree-item:hover .watch-expression-delete-button {
    background-color: HighlightText;
  }
}

/*# sourceURL=watchExpressionsSidebarPane.css */
`);const ae={addWatchExpression:"Add watch expression",refreshWatchExpressions:"Refresh watch expressions",noWatchExpressions:"No watch expressions",deleteAllWatchExpressions:"Delete all watch expressions",addPropertyPathToWatch:"Add property path to watch",deleteWatchExpression:"Delete watch expression",notAvailable:"<not available>",copyValue:"Copy value"},ql=M("panels/sources/WatchExpressionsSidebarPane.ts",ae),he=N.bind(void 0,ql);let Fi;class bs extends va{watchExpressions;emptyElement;watchExpressionsSetting;addButton;refreshButton;treeOutline;expandController;linkifier;constructor(){super(!0),this.watchExpressions=[],this.watchExpressionsSetting=v.instance().createLocalSetting("watch-expressions",[]),this.addButton=new me(he(ae.addWatchExpression),"plus",void 0,"add-watch-expression"),this.addButton.setSize("SMALL"),this.addButton.addEventListener("Click",e=>{this.addButtonClicked()}),this.refreshButton=new me(he(ae.refreshWatchExpressions),"refresh",void 0,"refresh-watch-expressions"),this.refreshButton.setSize("SMALL"),this.refreshButton.addEventListener("Click",this.update,this),this.contentElement.classList.add("watch-expressions"),this.contentElement.setAttribute("jslog",`${Zt("sources.watch")}`),this.contentElement.addEventListener("contextmenu",this.contextMenu.bind(this),!1),this.treeOutline=new xn,this.treeOutline.hideOverflow(),this.treeOutline.setShowSelectionOnKeyboardFocus(!0),this.expandController=new Tn(this.treeOutline),g.instance().addFlavorChangeListener(He,this.update,this),g.instance().addFlavorChangeListener(ee,this.update,this),this.linkifier=new tt,this.update()}static instance(){return Fi||(Fi=new bs),Fi}toolbarItems(){return[this.addButton,this.refreshButton]}focus(){this.hasFocus()||this.watchExpressions.length>0&&this.treeOutline.forceSelect()}hasExpressions(){return!!this.watchExpressionsSetting.get().length}saveExpressions(){const e=[];for(let t=0;t<this.watchExpressions.length;t++){const i=this.watchExpressions[t].expression();i&&e.push(i)}this.watchExpressionsSetting.set(e)}async addButtonClicked(){await O.instance().showView("sources.watch"),this.emptyElement.classList.add("hidden"),this.createWatchExpression(null).startEditing()}async doUpdate(){this.linkifier.reset(),this.contentElement.removeChildren(),this.treeOutline.removeChildren(),this.watchExpressions=[],this.emptyElement=this.contentElement.createChild("div","gray-info-message"),this.emptyElement.textContent=he(ae.noWatchExpressions),this.emptyElement.tabIndex=-1;const e=this.watchExpressionsSetting.get();e.length&&this.emptyElement.classList.add("hidden");for(let t=0;t<e.length;++t){const i=e[t];i&&this.createWatchExpression(i)}}createWatchExpression(e){this.contentElement.appendChild(this.treeOutline.element);const t=new ni(e,this.expandController,this.linkifier);return ue(this.contentElement,he(ae.addWatchExpression)),t.addEventListener("ExpressionUpdated",this.watchExpressionUpdated,this),this.treeOutline.appendChild(t.treeElement()),this.watchExpressions.push(t),t}watchExpressionUpdated({data:e}){e.expression()||(Ca(this.watchExpressions,e),this.treeOutline.removeChild(e.treeElement()),this.emptyElement.classList.toggle("hidden",!!this.watchExpressions.length),this.watchExpressions.length===0&&this.treeOutline.element.remove()),this.saveExpressions()}contextMenu(e){const t=new Re(e);this.populateContextMenu(t,e),t.show()}populateContextMenu(e,t){let i=!1;for(const o of this.watchExpressions)i=i||o.isEditing();i||e.debugSection().appendItem(he(ae.addWatchExpression),this.addButtonClicked.bind(this),{jslogContext:"add-watch-expression"}),this.watchExpressions.length>1&&e.debugSection().appendItem(he(ae.deleteAllWatchExpressions),this.deleteAllButtonClicked.bind(this),{jslogContext:"delete-all-watch-expressions"});const s=this.treeOutline.treeElementFromEvent(t);if(!s)return;const n=this.watchExpressions.find(o=>s.hasAncestorOrSelf(o.treeElement()));n&&n.populateContextMenu(e,t)}deleteAllButtonClicked(){this.watchExpressions=[],this.saveExpressions(),this.update()}async focusAndAddExpressionToWatch(e){await O.instance().showView("sources.watch"),this.createWatchExpression(e),this.saveExpressions(),this.update()}handleAction(e,t){const i=g.instance().flavor(J);if(!i)return!1;const{state:s}=i.textEditor,n=s.sliceDoc(s.selection.main.from,s.selection.main.to);return this.focusAndAddExpressionToWatch(n),!0}appendApplicableItems(e,t,i){if(i instanceof wa){i.property.synthetic||t.debugSection().appendItem(he(ae.addPropertyPathToWatch),()=>this.focusAndAddExpressionToWatch(i.path()),{jslogContext:"add-property-path-to-watch"});return}i.textEditor.state.selection.main.empty||t.debugSection().appendAction("sources.add-to-watch")}wasShown(){super.wasShown(),this.treeOutline.registerCSSFiles([Ji]),this.registerCSSFiles([Ji,Ia])}}class ni extends Xi{treeElementInternal;nameElement;valueElement;expressionInternal;expandController;element;editing;linkifier;textPrompt;result;preventClickTimeout;constructor(e,t,i){super(),this.expressionInternal=e,this.expandController=t,this.element=document.createElement("div"),this.element.classList.add("watch-expression"),this.element.classList.add("monospace"),this.editing=!1,this.linkifier=i,this.createWatchExpression(),this.update()}treeElement(){return this.treeElementInternal}expression(){return this.expressionInternal}async#e(e,t){const i=e.debuggerModel.selectedCallFrame();if(i&&i.script.isJavaScript()){const s=await In(i);try{t=await yn().javaScriptSubstitute(t,s)}catch{}}return e.evaluate({expression:t,objectGroup:ni.watchObjectGroupId,includeCommandLineAPI:!1,silent:!0,returnByValue:!1,generatePreview:!1},!1,!1)}update(){const e=g.instance().flavor(He);e&&this.expressionInternal?this.#e(e,this.expressionInternal).then(t=>{"object"in t?this.createWatchExpression(t.object,t.exceptionDetails):this.createWatchExpression()}):this.createWatchExpression()}startEditing(){this.editing=!0,this.treeElementInternal.setDisableSelectFocus(!0),this.element.removeChildren();const e=this.element.createChild("div");e.textContent=this.nameElement.textContent,this.textPrompt=new ya,this.textPrompt.renderAsBlock();const t=this.textPrompt.attachAndStartEditing(e,this.finishEditing.bind(this));this.treeElementInternal.listItemElement.classList.add("watch-expression-editing"),this.treeElementInternal.collapse(),t.classList.add("watch-expression-text-prompt-proxy"),t.addEventListener("keydown",this.promptKeyDown.bind(this),!1);const i=this.element.getComponentSelection();i&&i.selectAllChildren(e)}isEditing(){return!!this.editing}finishEditing(e,t){if(e&&e.consume(t),this.editing=!1,this.treeElementInternal.setDisableSelectFocus(!1),this.treeElementInternal.listItemElement.classList.remove("watch-expression-editing"),this.textPrompt){this.textPrompt.detach();const i=t?this.expressionInternal:this.textPrompt.text();this.textPrompt=void 0,this.element.removeChildren(),this.updateExpression(i)}}dblClickOnWatchExpression(e){e.consume(),this.isEditing()||this.startEditing()}updateExpression(e){this.expressionInternal&&this.expandController.stopWatchSectionsWithId(this.expressionInternal),this.expressionInternal=e,this.update(),this.dispatchEventToListeners("ExpressionUpdated",this)}deleteWatchExpression(e){e.consume(!0),this.updateExpression(null)}createWatchExpression(e,t){this.result=e||null,this.element.removeChildren();const i=this.treeElementInternal;if(this.createWatchExpressionTreeElement(e,t),i&&i.parent){const s=i.parent,n=s.indexOfChild(i);s.removeChild(i),s.insertChild(this.treeElementInternal,n)}this.treeElementInternal.select()}createWatchExpressionHeader(e,t){const i=this.element.createChild("div","watch-expression-header"),s=new ns;s.data={variant:"icon",iconName:"bin",size:"SMALL",jslogContext:"delete-watch-expression"},s.className="watch-expression-delete-button",Q.install(s,he(ae.deleteWatchExpression)),s.addEventListener("click",this.deleteWatchExpression.bind(this),!1),s.addEventListener("keydown",r=>{r.key==="Enter"&&this.deleteWatchExpression(r)});const n=i.createChild("div","watch-expression-title tree-element-title");if(n.appendChild(s),this.nameElement=Bi.createNameElement(this.expressionInternal),Q.install(this.nameElement,this.expressionInternal),t||!e)this.valueElement=document.createElement("span"),this.valueElement.classList.add("watch-expression-error"),this.valueElement.classList.add("value"),n.classList.add("dimmed"),this.valueElement.textContent=he(ae.notAvailable),t!==void 0&&t.exception!==void 0&&t.exception.description!==void 0&&Q.install(this.valueElement,t.exception.description);else{const r=Bi.createPropertyValueWithCustomSupport(e,!!t,!1,n,this.linkifier);this.valueElement=r.element}const o=document.createElement("span");return o.classList.add("watch-expressions-separator"),o.textContent=": ",n.append(this.nameElement,o,this.valueElement),i}createWatchExpressionTreeElement(e,t){const i=this.createWatchExpressionHeader(e,t);!t&&e&&e.hasChildren&&!e.customPreview()?(i.classList.add("watch-expression-object-header"),this.treeElementInternal=new kn(e,this.linkifier),this.expandController.watchSection(this.expressionInternal,this.treeElementInternal),this.treeElementInternal.toggleOnClick=!1,this.treeElementInternal.listItemElement.addEventListener("click",this.onSectionClick.bind(this),!1),this.treeElementInternal.listItemElement.addEventListener("dblclick",this.dblClickOnWatchExpression.bind(this))):(i.addEventListener("dblclick",this.dblClickOnWatchExpression.bind(this)),this.treeElementInternal=new Xe),this.treeElementInternal.title=this.element,this.treeElementInternal.listItemElement.classList.add("watch-expression-tree-item"),this.treeElementInternal.listItemElement.addEventListener("keydown",s=>{s.key==="Enter"&&!this.isEditing()?(this.startEditing(),s.consume(!0)):s.key==="Delete"&&!this.isEditing()&&this.deleteWatchExpression(s)})}onSectionClick(e){e.consume(!0),e.detail===1?this.preventClickTimeout=window.setTimeout(i.bind(this),333):this.preventClickTimeout!==void 0&&(window.clearTimeout(this.preventClickTimeout),this.preventClickTimeout=void 0);function i(){this.treeElementInternal&&(this.treeElementInternal.expanded?this.treeElementInternal.collapse():this.editing||this.treeElementInternal.expand())}}promptKeyDown(e){const t=Ea(e);(e.key==="Enter"||t)&&this.finishEditing(e,t)}populateContextMenu(e,t){this.isEditing()||e.editSection().appendItem(he(ae.deleteWatchExpression),this.updateExpression.bind(this,null),{jslogContext:"delete-watch-expression"}),!this.isEditing()&&this.result&&(this.result.type==="number"||this.result.type==="string")&&e.clipboardSection().appendItem(he(ae.copyValue),this.copyValueButtonClicked.bind(this),{jslogContext:"copy-watch-expression-value"});const i=xa(t);i&&this.valueElement.isSelfOrAncestor(i)&&this.result&&e.appendApplicableItems(this.result)}copyValueButtonClicked(){Je.copyText(this.valueElement.textContent)}static watchObjectGroupId="watch-group"}const Rd=Object.freeze(Object.defineProperty({__proto__:null,WatchExpression:ni,WatchExpressionsSidebarPane:bs},Symbol.toStringTag,{value:"Module"}));export{nd as A,od as B,ad as C,ud as D,bd as E,Dl as F,Fd as G,Md as I,fd as N,Ad as O,ld as P,Sd as R,pe as S,wd as T,Cd as U,Rd as W,cd as a,dd as b,hd as c,kd as d,Ld as e,Pd as f,Nd as g,gd as h,vd as i,Dd as j,Td as k,pd as l,yd as m,Ed as n,Nn as o,Wn as p,fs as q,A as r,yc as s};
//# sourceMappingURL=WatchExpressionsSidebarPane-ByQ6h9QR.js.map
