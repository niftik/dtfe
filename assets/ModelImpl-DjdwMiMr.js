import{ko as k,kp as Es,kq as rt,kr as bi,ks as Oi,kt as Di,ku as Fi,kv as ys,kw as Ss,kx as Li,ky as Bi,kz as Vt,kA as qi,kB as ws,kC as Ai,kD as Ui,kE as xi,kF as Wi,kG as Kt,kH as Xt,kI as $i,kJ as Hi,kK as H,kL as zi,kM as at,kN as Is,kO as Rs,kP as ot,kQ as C,kR as g,fR as ss,kS as ji,kT as Gi,kU as Vi,kV as Ms,kW as vs,kX as Ps,kY as Ns,kZ as _s,k_ as ks,k$ as Cs,l0 as bs,l1 as Os,l2 as Ki,l3 as Xi,l4 as Yi,l5 as Qi,l6 as Ji,l7 as Yt,l8 as Zi,l9 as Qt,la as Ds,lb as er,lc as tr,ld as nr,le as sr,lf as ir,lg as Fs,lh as Jt,li as Ls,lj as Bs,lk as rr,ll as ar,lm as Pt,ln as or,lo as qs,lp as As,lq as cr,lr as dr,ls as lr,lt as ur,lu as fr,ge as R,b7 as M,lv as ct,lw as mr,lx as hr,ly as gr,lz as pr,lA as Zt,lB as en,lC as Tr,lD as Er,lE as yr,lF as Sr,lG as wr,lH as Ir,lI as Rr,lJ as Mr,lK as vr,bv as Pr,lL as Nr,lM as _r,lN as kr,lO as Cr,lP as br,lQ as Or,lR as tn,lS as nn,lT as Q,lU as sn,lV as rn,lW as an,lX as on,dA as cn,lY as Dr,lZ as dt,l_ as x,l$ as J,m0 as Fr,m1 as Lr,m2 as Br,m3 as qr,m4 as Ar,m5 as Ur,m6 as xr,m7 as Wr,m8 as $r,m9 as Hr,ma as zr,mb as Us,mc as jr,md as Gr,me as z,b8 as X,gu as Vr,mf as Ae,mg as P,mh as Nt,mi as _t,mj as is,mk as Kr}from"./inspector-CyOA7R9n.js";const rs=new WeakMap;function pl(n,e){const t=[],s=typeof e<"u"?e:n.Meta.traceBounds.min,i=n.Meta.traceBounds.range,a=rs.get(n)?.get(s);if(a)return a;for(const c of n.Screenshots.all){if(c.ts<s)continue;const d={index:t.length,screenshotEvent:c};t.push(d)}const o={zeroTime:s,spanTime:i,frames:Array.from(t)};return k(rs,n,()=>new Map).set(s,o),o}function Tl(n,e){const t=Es(n.frames,s=>s.screenshotEvent.ts<e);return t===null?null:n.frames[t]}function Xr(n,e,t){const s=new Map;for(const i of n){const a=i.args.trackGroup||`track-name-${i.args.track}`,o=k(s,a,()=>({name:i.args.trackGroup||i.args.track,isTrackGroup:!!i.args.trackGroup,entriesByTrack:{[i.args.track]:[]}}));o.entriesByTrack[i.args.track]||(o.entriesByTrack[i.args.track]=[]),o.entriesByTrack[i.args.track].push(i)}for(const i of s.values()){for(const a of Object.values(i.entriesByTrack))if(rt(a),bi(a))for(const[o,r]of Oi(a).entryToNode)t.set(o,r);e.push(i)}return{extensionTrackData:e,entryToNode:t}}const Yr=new Set(["non_blocking","dynamically_injected_non_blocking","potentially_blocking"]);function xs(n){return!Yr.has(n.args.data.renderBlocking)}function kt(n,e){if(Di(e))return e.callFrame.url;if(e.args?.data?.stackTrace&&e.args.data.stackTrace.length>0)return e.args.data.stackTrace[0].url;if(Fi(e))return e.args.data.url;if(ys(e)){const t=n.ImagePainting.paintImageForEvent.get(e);return t?kt(n,t):null}if(Ss(e)&&e.args?.LazyPixelRef){const t=n.ImagePainting.paintImageByDrawLazyPixelRef.get(e.args.LazyPixelRef);return t?kt(n,t):null}return Li(e)?e.args.beginData.url:e.args?.data?.url?e.args.data.url:null}const dn=[],ln=[];let Ws=1;function Qr(){dn.length=0,ln.length=0}function Jr(n){if(Bi(n)){dn.push(n);return}}async function Zr(){const n=Vt(dn);ln.push(...n),Ws=3}function ea(){if(Ws!==3)throw new Error("Animation handler is not finalized");return{animations:ln}}const ta=Object.freeze(Object.defineProperty({__proto__:null,data:ea,finalize:Zr,handleEvent:Jr,reset:Qr},Symbol.toStringTag,{value:"Module"}));let V=[];const un=[],fn=[],mn=[],hn=[];let Ee=1;function na(){V.length=0,un.length=0,fn.length=0,mn.length=0,hn.length=0,Ee=2}const sa=["workerStart","redirectStart","redirectEnd","fetchStart","domainLookupStart","domainLookupEnd","connectStart","connectEnd","secureConnectionStart","requestStart","responseStart","responseEnd"],ia=["navigationStart","unloadEventStart","unloadEventEnd","redirectStart","redirectEnd","fetchStart","commitNavigationEnd","domainLookupStart","domainLookupEnd","connectStart","connectEnd","secureConnectionStart","requestStart","responseStart","responseEnd","domLoading","domInteractive","domContentLoadedEventStart","domContentLoadedEventEnd","domComplete","loadEventStart","loadEventEnd"],ra=[...sa,...ia];function aa(n,e,t){const s=n.ts,i=e.ts;if(s<i)return-1;if(s>i)return 1;const a=n.dur??0,o=e.dur??0,r=s+a,c=i+o;return r>c?-1:r<c?1:t.indexOf(e)-t.indexOf(n)}function oa(n){if(Ee!==2)throw new Error("UserTimings handler is not initialized");if(!ra.includes(n.name)){if(qi(n)){un.push(n);return}ws(n)&&fn.push(n),Ai(n)&&mn.push(n),Ui(n)&&hn.push(n)}}async function ca(){if(Ee!==2)throw new Error("UserTimings handler is not initialized");const n=[...un,...mn];V=Vt(n),V=V.sort((e,t)=>aa(e,t,[...V])),Ee=3}function Ct(){if(Ee!==3)throw new Error("UserTimings handler is not finalized");return{performanceMeasures:V.filter(n=>n.cat==="blink.user_timing"),consoleTimings:V.filter(n=>n.cat==="blink.console"),performanceMarks:[...fn],timestampEvents:[...hn]}}const da=Object.freeze(Object.defineProperty({__proto__:null,data:Ct,finalize:ca,handleEvent:oa,reset:na},Symbol.toStringTag,{value:"Module"})),gn=[],pn=[],Tn=[],En=new Map;let Ue=1;function la(n){}function ua(){Ue=2,gn.length=0,pn.length=0,Tn.length=0,En.clear()}async function fa(){if(Ue!==2)throw new Error("ExtensionTraceData handler is not initialized");ma(),Ue=3}function ma(){const n=Ct().performanceMeasures,e=Ct().performanceMarks,t=Wi(n,e);$s(t),Xr(gn,pn,En)}function $s(n){for(const e of n){const t=Hs(e);if(!t)continue;const s={name:e.name,ph:"X",pid:Kt(0),tid:Xt(0),ts:e.ts,dur:e.dur,cat:"devtools.extension",args:t,rawSourceEvent:$i(e)?e.rawSourceEvent:e};if(Hi(t)){const i=H.getActiveManager().registerSyntheticEvent(s);Tn.push(i);continue}if(zi(s.args)){const i=H.getActiveManager().registerSyntheticEvent(s);gn.push(i);continue}}}function Hs(n){const e=ws(n)?n.args.data?.detail:n.args.data.beginEvent.args.detail;if(!e)return null;try{const t=JSON.parse(e);return!("devtools"in t)||!xi(t.devtools)?null:t.devtools}catch{return null}}function ha(){if(Ue!==3)throw new Error("ExtensionTraceData handler is not finalized");return{entryToNode:En,extensionTrackData:[...pn],extensionMarkers:[...Tn]}}function ga(){return["UserTimings"]}const pa=Object.freeze(Object.defineProperty({__proto__:null,data:ha,deps:ga,extensionDataInTiming:Hs,extractExtensionEntries:$s,finalize:fa,handleEvent:la,reset:ua},Symbol.toStringTag,{value:"Module"}));let ye=1;const yn=[],Sn=[],wn=new Map;let bt={},Ot=null;const be=[],xe=[];function Ta(){ye=1,yn.length=0,Sn.length=0,wn.clear(),bt={},Ot=null,be.length=0,xe.length=0}function Ea(){if(ye!==1)throw new Error("LayerTree Handler was not reset before being initialized");ye=2}function ya(n){(at(n)||Is(n)||Rs(n)||ot(n))&&xe.push(n)}async function Sa(){if(ye!==2)throw new Error("LayerTree Handler is not initialized");const n=C();rt(xe);for(const e of xe)if(ot(e)){if(n.mainFrameId!==e.args.data.frame)continue;Ot=e.args.data.layerTreeId}else if(Rs(e))be.push(e);else if(at(e)){if(!e.args.data.layerId)continue;yn.push(e),bt[e.args.data.layerId]=e;continue}else if(Is(e)){let t=null;for(let i=be.length-1;i>-1;i--){const a=be[i];if(a.pid===e.pid&&a.tid===e.tid){t=a;break}}if(!t||t.args.layerTreeId!==Ot)continue;const s=bt[t.args.layerId];if(!s)continue;Sn.push(e),wn.set(s,e)}ye=3}function zs(){return{paints:yn,snapshots:Sn,paintsToSnapshots:wn}}function wa(){return["Meta"]}const Ia=Object.freeze(Object.defineProperty({__proto__:null,data:zs,deps:wa,finalize:Sa,handleEvent:ya,initialize:Ea,reset:Ta},Symbol.toStringTag,{value:"Module"}));function Ra(n,e,t){let s="OTHER";return e.name==="CrRendererMain"?s="MAIN_THREAD":e.name==="DedicatedWorker thread"?s="WORKER":e.name?.startsWith("CompositorTileWorker")?s="RASTERIZER":t.worklets.has(n)?s="AUCTION_WORKLET":e.name?.startsWith("ThreadPool")&&(s="THREAD_POOL"),s}function js(n,e){const t=[];if(n.processes.size)for(const[s,i]of n.processes)for(const[a,o]of i.threads){if(!o.tree)continue;const r=Ra(s,o,e);t.push({name:o.name,pid:s,tid:a,processIsOnMainFrame:i.isOnMainFrame,entries:o.entries,tree:o.tree,type:r,entryToNode:n.entryToNode})}return t}function El(n){const e=js(n.Renderer,n.AuctionWorklets);if(e.length)return e;const t=[];if(n.Samples.profilesInProcess.size)for(const[s,i]of n.Samples.profilesInProcess)for(const[a,o]of i)o.profileTree&&t.push({pid:s,tid:a,name:null,entries:o.profileCalls,processIsOnMainFrame:!1,tree:o.profileTree,type:"CPU_PROFILE",entryToNode:n.Samples.entryToNode});return t}let We=1;const $e=[];let oe=null;function Ma(){We=1,$e.length=0}function va(){if(We!==1)throw new Error("FramesHandler was not reset before being initialized");We=2}function Pa(n){$e.push(n)}async function Na(){if(We!==2)throw new Error("FramesHandler is not initialized");rt($e),oe=new Gs($e,ji(),Gi(),C(),zs())}function _a(){return{frames:oe?Array.from(oe.frames()):[],framesById:oe?{...oe.framesById()}:{}}}function ka(){return["Meta","Renderer","AuctionWorklets","LayerTree"]}function Ca(n){return ot(n)||Ms(n)||ks(n)||Ns(n)||Cs(n)||_s(n)||Os(n)||bs(n)||Ps(n)||vs(n)}function ba(n){return n.name==="RunTask"&&n.cat.includes("disabled-by-default-devtools.timeline")}class Gs{#e=[];#n={};#a=new Ys;#t=null;#s=!1;#i=!1;#c=null;#r=null;#o=null;#d=null;#l=null;#g=null;#u=null;#f=null;#m=null;#p;constructor(e,t,s,i,a){const r=js(t,s).filter(c=>c.type==="MAIN_THREAD"&&c.processIsOnMainFrame).map(c=>({tid:c.tid,pid:c.pid,startTime:c.entries[0].ts}));this.#p=a,this.#N(e,r,i.mainFrameId)}framesById(){return this.#n}frames(){return this.#e}#E(e,t){this.#t||this.#h(e,t),this.#d=e,this.#a.addFrameIfNotExists(t,e,!1,!1)}#y(e,t,s){this.#t||this.#h(e,t),this.#a.addFrameIfNotExists(t,e,!0,s),this.#a.setDropped(t,!0),this.#a.setPartial(t,s)}#S(e,t){if(!this.#t){this.#h(e,t);return}if(this.#s||!this.#i){this.#l&&((this.#r?this.#r.triggerTime:this.#d||this.#l)>this.#t.startTime&&(this.#t.idle=!0,this.#d=null),this.#l=null);const s=this.#a.processPendingBeginFramesOnDrawFrame(t);for(const i of s){const a=this.#t.idle;this.#h(i.startTime,t),a&&this.#r&&this.#T(),i.isDropped&&(this.#t.dropped=!0),i.isPartial&&(this.#t.isPartial=!0)}}this.#s=!1}#w(){this.#t&&this.#r&&!this.#l&&this.#T()}#I(){this.#t&&(this.#i=!0)}#R(){this.#o&&(this.#r=this.#o,this.#o=null,this.#i=!1,this.#s=!0)}#M(e){this.#c=e}#v(e,t){t&&(this.#l=e)}#h(e,t){this.#t&&this.#P(this.#t,e),this.#t=new Vs(t,e,g(e-C().traceBounds.min))}#P(e,t){e.setLayerTree(this.#c),e.setEndTime(t),this.#c&&(this.#c.paints=e.paints);const s=this.#e[this.#e.length-1];this.#e.length&&s&&(e.startTime!==s.endTime||e.startTime>e.endTime)&&console.assert(!1,`Inconsistent frame time for frame ${this.#e.length} (${e.startTime} - ${e.endTime})`);const i=this.#e.push(e);e.setIndex(i-1),typeof e.mainFrameId=="number"&&(this.#n[e.mainFrameId]=e)}#T(){!this.#r||!this.#t||(this.#t.paints=this.#r.paints,this.#t.mainFrameId=this.#r.mainFrameId,this.#r=null)}#N(e,t,s){let i=0;this.#m=t.length&&t[0].tid||null,this.#f=t.length&&t[0].pid||null;for(let a=0;a<e.length;++a){for(;i+1<t.length&&t[i+1].startTime<=e[a].ts;)this.#m=t[++i].tid,this.#f=t[i].pid;this.#_(e[a],s)}this.#m=null,this.#f=null}#_(e,t){ot(e)&&e.args.data.frame===t?this.#u=e.args.data.layerTreeId:Vi(e)&&Number(e.id)===this.#u?this.#M({entry:e,paints:[]}):(Ca(e)&&this.#k(e),e.tid===this.#m&&e.pid===this.#f&&this.#C(e))}#k(e){e.args.layerTreeId===this.#u&&(Ms(e)?this.#E(e.ts,e.args.frameSeqId):vs(e)?this.#S(e.ts,e.args.frameSeqId):Ps(e)?this.#w():Ns(e)?this.#I():_s(e)?this.#v(e.ts,e.args.data&&!!e.args.data.needsBeginFrame):ks(e)&&this.#y(e.ts,e.args.frameSeqId,!!e.args.hasPartialUpdate))}#C(e){if(ba(e)&&(this.#g=e.ts),!this.#o&&Oa.has(e.name)&&(this.#o=new Xs(this.#g||e.ts)),!!this.#o){if(Cs(e)&&e.args.data.frameId&&(this.#o.mainFrameId=e.args.data.frameId),at(e)){const t=this.#p.paintsToSnapshots.get(e);t&&this.#o.paints.push(new Ks(e,t))}(bs(e)||Os(e))&&e.args.layerTreeId===this.#u&&this.#R()}}}const Oa=new Set(["ScheduleStyleRecalculation","InvalidateLayout","BeginMainThreadFrame","ScrollLayer"]);class Vs{cat="devtools.legacy_frame";name="frame";ph="X";ts;pid=Kt(-1);tid=Xt(-1);index=-1;startTime;startTimeOffset;endTime;duration;idle;dropped;isPartial;layerTree;paints;mainFrameId;seqId;constructor(e,t,s){this.seqId=e,this.startTime=t,this.ts=t,this.startTimeOffset=s,this.endTime=this.startTime,this.duration=g(0),this.idle=!1,this.dropped=!1,this.isPartial=!1,this.layerTree=null,this.paints=[],this.mainFrameId=void 0}setIndex(e){this.index=e}setEndTime(e){this.endTime=e,this.duration=g(this.endTime-this.startTime)}setLayerTree(e){this.layerTree=e}get dur(){return this.duration}}class Ks{#e;#n;constructor(e,t){this.#e=e,this.#n=t}layerId(){return this.#e.args.data.layerId}event(){return this.#e}picture(){const e=this.#n.args.snapshot.params?.layer_rect,t=this.#n.args.snapshot.skp64;return e&&t?{rect:e,serializedPicture:t}:null}}class Xs{paints;mainFrameId;triggerTime;constructor(e){this.paints=[],this.mainFrameId=void 0,this.triggerTime=e}}class Da{seqId;startTime;isDropped;isPartial;constructor(e,t,s,i){this.seqId=e,this.startTime=t,this.isDropped=s,this.isPartial=i}}class Ys{queueFrames=[];mapFrames={};addFrameIfNotExists(e,t,s,i){e in this.mapFrames||(this.mapFrames[e]=new Da(e,t,s,i),this.queueFrames.push(e))}setDropped(e,t){e in this.mapFrames&&(this.mapFrames[e].isDropped=t)}setPartial(e,t){e in this.mapFrames&&(this.mapFrames[e].isPartial=t)}processPendingBeginFramesOnDrawFrame(e){const t=[];if(e in this.mapFrames){for(;this.queueFrames[0]!==e;){const s=this.queueFrames[0];this.mapFrames[s].isDropped&&t.push(this.mapFrames[s]),delete this.mapFrames[s],this.queueFrames.shift()}t.push(this.mapFrames[e]),delete this.mapFrames[e],this.queueFrames.shift()}return t}}function Fa(n,e,t){const s=ss(n,e||0,(a,o)=>a-o.endTime),i=ss(n,t||1/0,(a,o)=>a-o.startTime);return n.slice(s,i)}const La=Object.freeze(Object.defineProperty({__proto__:null,LayerPaintEvent:Ks,PendingFrame:Xs,TimelineFrame:Vs,TimelineFrameBeginFrameQueue:Ys,TimelineFrameModel:Gs,data:_a,deps:ka,finalize:Na,framesWithinWindow:Fa,handleEvent:Pa,initialize:va,reset:Ma},Symbol.toStringTag,{value:"Module"}));let Z=1;const In=new Map;let Rn=[];function Ba(){In.clear(),Rn=[],Z=1}function qa(){if(Z!==1)throw new Error("GPU Handler was not reset before being initialized");Z=2}function Aa(n){if(Z!==2)throw new Error("GPU Handler is not initialized");Ki(n)&&Xi(n,In)}async function Ua(){if(Z!==2)throw new Error("GPU Handler is not initialized");const{gpuProcessId:n,gpuThreadId:e}=C(),t=In.get(n);t&&e&&(Rn=t.get(e)||[]),Z=3}function xa(){if(Z!==3)throw new Error("GPU Handler is not finalized");return{mainGPUThreadTasks:Rn}}function Wa(){return["Meta"]}const $a=Object.freeze(Object.defineProperty({__proto__:null,data:xa,deps:Wa,finalize:Ua,handleEvent:Aa,initialize:qa,reset:Ba},Symbol.toStringTag,{value:"Module"})),ce=new Map,Oe=new Map,He=new Map,ze=new Map;function Ha(){ce.clear(),Oe.clear(),He.clear(),ze.clear()}function za(n){if(Yi(n)){const e=ce.get(n.pid)||new Map,t=e.get(n.tid)||[];t.push(n),e.set(n.tid,t),ce.set(n.pid,e);return}if(Qi(n)&&typeof n.args?.LazyPixelRef<"u"){const e=Oe.get(n.pid)||new Map,t=e.get(n.tid)||[];t.push(n),e.set(n.tid,t),Oe.set(n.pid,e)}if(Ss(n)&&typeof n.args?.LazyPixelRef<"u"){const e=ce.get(n.pid)?.get(n.tid)?.at(-1);if(!e)return;He.set(n.args.LazyPixelRef,e);return}if(ys(n)){const e=ce.get(n.pid)?.get(n.tid)?.at(-1);if(e){ze.set(n,e);return}const t=Oe.get(n.pid)?.get(n.tid)?.at(-1);if(!t||typeof t.args?.LazyPixelRef>"u")return;const s=He.get(t.args.LazyPixelRef);if(!s)return;ze.set(n,s)}}function ja(){return{paintImageByDrawLazyPixelRef:He,paintImageForEvent:ze}}const Ga=Object.freeze(Object.defineProperty({__proto__:null,data:ja,handleEvent:za,reset:Ha},Symbol.toStringTag,{value:"Module"}));let Se=1;const Dt=new Map,de=new Map,Ft=new Map,Mn=[],vn=new Map,lt=new Map,je=new Map,Lt=new Map,Bt=new Map,qt=new Map,At=new Map;function Va(){Dt.clear(),de.clear(),Ft.clear(),Bt.clear(),lt.clear(),je.clear(),Lt.clear(),qt.clear(),At.clear(),vn.clear(),Mn.length=0,Se=1}function Ka(){if(Se!==1)throw new Error("InitiatorsHandler was not reset before being initialized");Se=2}function G(n){lt.set(n.event,n.initiator);const e=je.get(n.initiator)||[];e.push(n.event),je.set(n.initiator,e)}function Xa(n){if(Ji(n))Dt.set(n.args.data.frame,n);else if(Yt(n)){if(n.args.beginData){Ft.set(n.args.beginData.frame,n);const e=Dt.get(n.args.beginData.frame);e&&G({event:n,initiator:e})}}else if(Zi(n)){let e=n;if(!de.has(n.args.data.frame)){const t=Ft.get(n.args.data.frame);if(t){const{endTime:s}=Qt(t),i=lt.get(t);i&&s&&s>n.ts&&(e=i)}}de.set(n.args.data.frame,e)}else if(Ds(n)){const e=de.get(n.args.beginData.frame);e&&G({event:n,initiator:e}),de.delete(n.args.beginData.frame)}else if(er(n))Lt.set(n.args.data.id,n);else if(tr(n)){const e=Lt.get(n.args.data.id);e&&G({event:n,initiator:e})}else if(nr(n))Bt.set(n.args.data.timerId,n);else if(sr(n)){const e=Bt.get(n.args.data.timerId);e&&G({event:n,initiator:e})}else if(ir(n))qt.set(n.args.data.id,n);else if(Fs(n)){const e=qt.get(n.args.data.id);e&&G({event:n,initiator:e})}else if(Jt(n))At.set(n.args.data.identifier,n);else if(Ls(n)||Bs(n)){const e=At.get(n.args.data.identifier);e&&G({event:n,initiator:e})}else if(rr(n))Mn.push(n);else if(ar(n)){const e=n.args.data?.traceId;e&&vn.set(e,n)}}function Ya(){for(const n of Mn){const e=n.args.data?.traceId,t=vn.get(e);t&&G({event:n,initiator:t})}}async function Qa(){if(Se!==2)throw new Error("InitiatorsHandler is not initialized");Ya(),Se=3}function Ja(){return{eventToInitiator:lt,initiatorToEvents:je}}const Za=Object.freeze(Object.defineProperty({__proto__:null,data:Ja,finalize:Qa,handleEvent:Xa,initialize:Ka,reset:Va},Symbol.toStringTag,{value:"Module"}));let we=1;const Ge=new Map,Ut=new Map;let q=null,De=!1;const le=[];function eo(){we=1,Ge.clear(),q=null,le.length=0,De=!1,Ie=null}let Ie=null;function to(n){Ie=n.maxInvalidationEventsPerEvent}function no(){if(we!==1)throw new Error("InvalidationsHandler was not reset before being initialized");we=2}function Rt(n,e){const t=Ge.get(n)||[];t.push(e),Ie!==null&&t.length>Ie&&t.shift(),Ge.set(n,t);const s=Ut.get(n)??0;Ut.set(n,s+1)}function so(n){if(Ie!==0){if(Yt(n)){q=n;for(const e of le){if(Pt(e))continue;const t=q.args.beginData?.frame;t&&e.args.data.frame===t&&Rt(n,e)}return}if(or(n)){if(De&&(le.length=0,q=null,De=!1),q&&(qs(n)||As(n)||cr(n))){const e=q.ts+(q.dur||0);n.ts>=q.ts&&n.ts<=e&&q.args.beginData?.frame===n.args.data.frame&&Rt(q,n)}le.push(n);return}if(at(n)){De=!0;return}if(Ds(n)){const e=n.args.beginData.frame;for(const t of le)Pt(t)&&t.args.data.frame===e&&Rt(n,t)}}}async function io(){if(we!==2)throw new Error("InvalidationsHandler is not initialized");we=3}function ro(){return{invalidationsForEvent:Ge,invalidationCountForEvent:Ut}}const ao=Object.freeze(Object.defineProperty({__proto__:null,data:ro,finalize:io,handleEvent:so,handleUserConfig:to,initialize:no,reset:eo},Symbol.toStringTag,{value:"Module"})),Pn=new Map;function oo(){Pn.clear()}function co(n){dr(n)&&n.args.data&&Pn.set(n.args.data.DOMNodeId,n)}function lo(){return Pn}const uo=Object.freeze(Object.defineProperty({__proto__:null,data:lo,handleEvent:co,reset:oo},Symbol.toStringTag,{value:"Module"})),Nn=new Map;function fo(){Nn.clear()}function mo(n){lr(n)&&n.args.data&&Nn.set(n.args.data.DOMNodeId,n)}function ho(){return Nn}const go=Object.freeze(Object.defineProperty({__proto__:null,data:ho,handleEvent:mo,reset:fo},Symbol.toStringTag,{value:"Module"})),_n=[],kn=[],Cn=[];function po(){_n.length=0,kn.length=0,Cn.length=0}function To(n){ur(n)?kn.push(n):fr(n)&&_n.push(n)}async function Eo(){const n=Vt(_n);Object.fromEntries(n.map(e=>{const t=e.args.data.beginEvent.args.chrome_frame_reporter.frame_sequence,s=g(e.ts+e.dur);return[t,s]}));for(const e of kn){const{cat:t,name:s,ph:i,pid:a,tid:o}=e,r=H.registerSyntheticEvent({rawSourceEvent:e,cat:t,name:s,ph:i,pid:a,tid:o,ts:e.ts,args:{dataUri:`data:image/jpg;base64,${e.args.snapshot}`}});Cn.push(r)}}function Qs(){return{all:Cn}}function yo(){return["Meta"]}const So=Object.freeze(Object.defineProperty({__proto__:null,data:Qs,deps:yo,finalize:Eo,handleEvent:To,reset:po},Symbol.toStringTag,{value:"Module"})),Fe=R(M(5e3)),ue=R(M(1e3)),$=[],Pe=[],ut=[],ft=[],mt=[],ht=[],te=new Set,gt=[];let Ve=0,bn=-1;const N=[],On=new Map,ne=[];let se=1;function wo(){if(se!==1)throw new Error("LayoutShifts Handler was not reset");se=2}function Io(){se=1,$.length=0,Pe.length=0,ut.length=0,gt.length=0,ft.length=0,mt.length=0,ht.length=0,te.clear(),N.length=0,Ve=0,ne.length=0,bn=-1,On.clear()}function Ro(n){if(se!==2)throw new Error("Handler is not initialized");if(ct(n)&&!n.args.data?.had_recent_input){$.push(n);return}if(Pt(n)){Pe.push(n);return}if(qs(n)&&ut.push(n),As(n),mr(n)){gt.push(n);return}hr(n)&&ft.push(n),gr(n)&&mt.push(n),pr(n)&&ht.push(n)}function _e(n){return{min:n,max:n,range:g(0)}}function b(n,e){n.max=e,n.range=g(n.max-n.min)}function Mo(n){const e=Qs().all,t=Tr(e,n),s=t?e[e.indexOf(t)+1]:null;return{before:t,after:s}}function vo(){const{traceBounds:n}=C();ne.push({ts:n.min,score:0});for(const e of N){let t=0;e.events[0].args.data&&ne.push({ts:e.clusterWindow.min,score:e.events[0].args.data.weighted_score_delta});for(let s=0;s<e.events.length;s++){const i=e.events[s];i.args.data&&(t+=i.args.data.weighted_score_delta,ne.push({ts:i.ts,score:t}))}ne.push({ts:e.clusterWindow.max,score:0})}}function Po(){te.clear();for(const n of $)if(n.args.data?.impacted_nodes)for(const e of n.args.data.impacted_nodes)te.add(e.node_id);for(const n of Pe)n.args.data?.nodeId&&te.add(n.args.data.nodeId);for(const n of ut)n.args.data?.nodeId&&te.add(n.args.data.nodeId)}async function No(){$.sort((n,e)=>n.ts-e.ts),gt.sort((n,e)=>n.ts-e.ts),Pe.sort((n,e)=>n.ts-e.ts),ft.sort((n,e)=>n.ts-e.ts),mt.sort((n,e)=>n.ts-e.ts),ht.sort((n,e)=>n.ts-e.ts),await _o(),vo(),Po(),se=3}async function _o(){const{navigationsByFrameId:n,mainFrameId:e,traceBounds:t}=C(),s=n.get(e)||[];if($.length===0)return;let i=$[0].ts,a=$[0].ts,o=null;for(const r of $){const c=r.ts-i>Fe,d=r.ts-a>ue,l=Es(s,p=>p.ts<r.ts),m=o!==l&&l!==null;if(c||d||m||!N.length){const p=r.ts,y=c?i+Fe:1/0,E=d?a+ue:1/0,I=m?s[l].ts:1/0,v=Math.min(y,E,I);if(N.length>0){const A=N[N.length-1];b(A.clusterWindow,g(v))}const _=l===null?Zt:s[l].args.data?.navigationId;N.push({name:"SyntheticLayoutShiftCluster",events:[],clusterWindow:_e(p),clusterCumulativeScore:0,scoreWindows:{good:_e(p)},navigationId:_,ts:r.ts,pid:r.pid,tid:r.tid,ph:"X",cat:"",dur:g(-1)}),i=p}const h=N[N.length-1],u=l!==null?g(r.ts-s[l].ts):void 0;if(h.clusterCumulativeScore+=r.args.data?r.args.data.weighted_score_delta:0,!r.args.data)continue;const f=H.registerSyntheticEvent({rawSourceEvent:r,...r,args:{frame:r.args.frame,data:{...r.args.data,rawEvent:r,navigationId:h.navigationId??void 0}},parsedData:{timeFromNavigation:u,screenshots:Mo(r.ts),cumulativeWeightedScoreInWindow:h.clusterCumulativeScore,sessionWindowData:{cumulativeWindowScore:0,id:N.length}}});h.events.push(f),b(h.clusterWindow,r.ts),a=r.ts,o=l}for(const r of N){let c=0,d=-1;if(r===N[N.length-1]){const u=Fe+r.clusterWindow.min,f=r.clusterWindow.max+ue,p=en(s,I=>I.ts>r.clusterWindow.max),y=p?s[p].ts:1/0,E=Math.min(u,f,t.max,y);b(r.clusterWindow,g(E))}let l=0,m=null;for(const u of r.events){c+=u.args.data?u.args.data.weighted_score_delta:0,d=u.parsedData.sessionWindowData.id;const f=u.ts;u.parsedData.sessionWindowData.cumulativeWindowScore=r.clusterCumulativeScore,c<.1?b(r.scoreWindows.good,f):c>=.1&&c<.25?(r.scoreWindows.needsImprovement||(b(r.scoreWindows.good,g(f-1)),r.scoreWindows.needsImprovement=_e(f)),b(r.scoreWindows.needsImprovement,f)):c>=.25&&(r.scoreWindows.bad||(r.scoreWindows.needsImprovement?b(r.scoreWindows.needsImprovement,g(f-1)):b(r.scoreWindows.good,g(f-1)),r.scoreWindows.bad=_e(u.ts)),b(r.scoreWindows.bad,f)),r.scoreWindows.bad?b(r.scoreWindows.bad,r.clusterWindow.max):r.scoreWindows.needsImprovement?b(r.scoreWindows.needsImprovement,r.clusterWindow.max):b(r.scoreWindows.good,r.clusterWindow.max);const p=u.args.data?.weighted_score_delta;p!==void 0&&p>l&&(l=p,m=u)}m&&(r.worstShiftEvent=m),r.ts=r.events[0].ts;const h=Qt(r.events[r.events.length-1]);r.dur=g(h.endTime-r.events[0].ts+ue),c>Ve&&(bn=d,Ve=c),r.navigationId&&k(On,r.navigationId,()=>[]).push(r)}}function ko(){if(se!==3)throw new Error("Layout Shifts Handler is not finalized");return{clusters:N,sessionMaxScore:Ve,clsWindowID:bn,prePaintEvents:gt,layoutInvalidationEvents:Pe,scheduleStyleInvalidationEvents:ut,styleRecalcInvalidationEvents:[],renderFrameImplCreateChildFrameEvents:ft,domLoadingEvents:mt,beginRemoteFontLoadEvents:ht,scoreRecords:ne,backendNodeIds:[...te],clustersByNavigationId:new Map(On)}}function Co(){return["Screenshots","Meta"]}function bo(n){let e="good";return n>=.1&&(e="ok"),n>=.25&&(e="bad"),e}const Oo=Object.freeze(Object.defineProperty({__proto__:null,MAX_CLUSTER_DURATION:Fe,MAX_SHIFT_TIME_DELTA:ue,data:ko,deps:Co,finalize:No,handleEvent:Ro,initialize:wo,reset:Io,scoreClassificationForLayoutShift:bo},Symbol.toStringTag,{value:"Module"})),Ke=new Map;function Do(){Ke.clear()}function Fo(n){if(Er(n)){const e=k(Ke,n.pid,()=>[]);e.push(n),Ke.set(n.pid,e)}}function Lo(){return{updateCountersByProcess:Ke}}const Bo=Object.freeze(Object.defineProperty({__proto__:null,data:Lo,handleEvent:Fo,reset:Do},Symbol.toStringTag,{value:"Module"})),L=1e3,ke=1e6,K=new Map,me=new Map,Dn=new Map,Fn=new Map,Xe=[],Le=new Map,Ln=new Map;function j(n,e,t){me.has(n)||me.set(n,{});const s=me.get(n);if(!s)throw new Error(`Unable to locate trace events for request ID ${n}`);if(Array.isArray(s[e])){const i=s[e],a=t;i.push(...a)}else s[e]=t}function qo(n){for(const e of n)if(e>0)return e;return 0}let ie=1;function Ao(){Dn.clear(),Fn.clear(),me.clear(),Xe.length=0,Le.clear(),Ln.clear(),K.clear(),ie=1}function Uo(){ie=2}function xo(n){if(ie!==2)throw new Error("Network Request handler is not initialized");if(yr(n)){j(n.args.data.requestId,"changePriority",n);return}if(Sr(n)){j(n.args.data.requestId,"willSendRequests",[n]);return}if(wr(n)){j(n.args.data.requestId,"sendRequests",[n]);return}if(Ir(n)){j(n.args.data.requestId,"receiveResponse",n);return}if(Rr(n)){j(n.args.data.requestId,"receivedData",[n]);return}if(Mr(n)){j(n.args.data.requestId,"resourceFinish",n);return}if(vr(n)){j(n.args.data.requestId,"resourceMarkAsCached",n);return}if(Jt(n)||Ls(n)||Bs(n)){const e=n.args.data.identifier;K.has(e)||(n.args.data.frame?K.set(e,{frame:n.args.data.frame,webSocketIdentifier:e,events:[],syntheticConnection:null}):n.args.data.workerId&&K.set(e,{workerId:n.args.data.workerId,webSocketIdentifier:e,events:[],syntheticConnection:null})),K.get(e)?.events.push(n)}}async function Wo(){if(ie!==2)throw new Error("Network Request handler is not initialized");const{rendererProcessesByFrame:n}=C();for(const[e,t]of me.entries()){if(!t.sendRequests||!t.receiveResponse)continue;const s=[];for(let F=0;F<t.sendRequests.length-1;F++){const re=t.sendRequests[F],ki=t.sendRequests[F+1];let es=re.ts,ts=g(ki.ts-re.ts);if(t.willSendRequests&&t.willSendRequests[F]&&t.willSendRequests[F+1]){const ns=t.willSendRequests[F],Ci=t.willSendRequests[F+1];es=ns.ts,ts=g(Ci.ts-ns.ts)}s.push({url:re.args.data.url,priority:re.args.data.priority,requestMethod:re.args.data.requestMethod,ts:es,dur:ts})}const i=t.resourceFinish?.args.data.encodedDataLength!==0,a=t.receiveResponse.args.data.fromCache&&!t.receiveResponse.args.data.fromServiceWorker&&!i,o=t.resourceMarkAsCached!==void 0,r=o?void 0:t.receiveResponse.args.data.timing;if(!r&&!o)continue;const c=t.sendRequests[0],d=t.sendRequests[t.sendRequests.length-1],l=d.args.data.priority;let m=l;t.changePriority&&(m=t.changePriority.args.data.priority);const h=t.willSendRequests&&t.willSendRequests.length?g(t.willSendRequests[0].ts):g(c.ts),u=t.willSendRequests&&t.willSendRequests.length?g(t.willSendRequests[t.willSendRequests.length-1].ts):g(d.ts),f=t.resourceFinish?t.resourceFinish.ts:u,p=t.resourceFinish?.args.data.finishTime?g(t.resourceFinish.args.data.finishTime*ke):g(f),y=g(r?(p||u)-u:0),E=g(f-(p||f)),I=g(u-h),v=r?r.requestTime*ke-u:0,_=g(Pr(v,0,Number.MAX_VALUE)),A=r?g(qo([r.dnsStart*L,r.connectStart*L,r.sendStart*L,t.receiveResponse.ts-u])):g(t.receiveResponse.ts-h),U=r?g(r.requestTime*ke+r.sendStart*L):h,pi=r?g((r.receiveHeadersEnd-r.sendEnd)*L):g(0),St=r?g(r.requestTime*ke+r.receiveHeadersEnd*L):h,Ti=r?g((p||St)-St):g(f-t.receiveResponse.ts),Ei=g(y+E),yi=r?g((r.dnsEnd-r.dnsStart)*L):g(0),Si=r?g((r.sslEnd-r.sslStart)*L):g(0),wi=r?g((r.proxyEnd-r.proxyStart)*L):g(0),Ii=r?g((r.sendEnd-r.sendStart)*L):g(0),Ri=r?g((r.connectEnd-r.connectStart)*L):g(0),{frame:Qn,url:Jn,renderBlocking:Mi}=d.args.data,{encodedDataLength:vi,decodedBodyLength:Pi}=t.resourceFinish?t.resourceFinish.args.data:{encodedDataLength:0,decodedBodyLength:0},Zn=new URL(Jn),Ni=Zn.protocol==="https:",_i=Nr(Qn,d.ts,n)||"",B=H.registerSyntheticEvent({rawSourceEvent:d,args:{data:{syntheticData:{dnsLookup:yi,download:Ti,downloadStart:St,finishTime:p,initialConnection:Ri,isDiskCached:a,isHttps:Ni,isMemoryCached:o,isPushedResource:i,networkDuration:y,processingDuration:E,proxyNegotiation:wi,queueing:_,redirectionDuration:I,requestSent:Ii,sendStartTime:U,ssl:Si,stalled:A,totalTime:Ei,waiting:pi},decodedBodyLength:Pi,encodedDataLength:vi,frame:Qn,fromServiceWorker:t.receiveResponse.args.data.fromServiceWorker,isLinkPreload:d.args.data.isLinkPreload||!1,mimeType:t.receiveResponse.args.data.mimeType,priority:m,initialPriority:l,protocol:t.receiveResponse.args.data.protocol??"unknown",redirects:s,renderBlocking:Mi??"non_blocking",requestId:e,requestingFrameUrl:_i,requestMethod:d.args.data.requestMethod,resourceType:d.args.data.resourceType??"Other",statusCode:t.receiveResponse.args.data.statusCode,responseHeaders:t.receiveResponse.args.data.headers||[],fetchPriorityHint:d.args.data.fetchPriorityHint??"auto",initiator:d.args.data.initiator,stackTrace:d.args.data.stackTrace,timing:r,url:Jn,failed:t.resourceFinish?.args.data.didFail??!1,finished:!!t.resourceFinish,connectionId:t.receiveResponse.args.data.connectionId,connectionReused:t.receiveResponse.args.data.connectionReused}},cat:"loading",name:"SyntheticNetworkRequest",ph:"X",dur:g(f-h),tdur:g(f-h),ts:g(h),tts:g(h),pid:d.pid,tid:d.tid}),wt=k(Fn,Zn.host,()=>({renderBlocking:[],nonRenderBlocking:[],all:[]}));xs(B)?wt.renderBlocking.push(B):wt.nonRenderBlocking.push(B),wt.all.push(B),Xe.push(B),Dn.set(B.args.data.requestId,B);const It=B.args.data.initiator?.url||_r(B)?.at(0)?.url;if(It){const F=Le.get(It)??[];F.push(B),Le.set(It,F)}}for(const e of Xe){const t=Le.get(e.args.data.url);if(t)for(const s of t)Ln.set(s,e)}Ho(),ie=3}function Js(){if(ie!==3)throw new Error("Network Request handler is not finalized");return{byId:Dn,byOrigin:Fn,byTime:Xe,eventToInitiator:Ln,webSocket:[...K.values()]}}function $o(){return["Meta"]}function Ho(){K.forEach(n=>{let e=null,t=null;for(const s of n.events)Jt(s)&&(e=s),kr(s)&&(t=s);n.syntheticConnection=zo(e,t,n.events[0])})}function zo(n,e,t){const{traceBounds:s}=C(),i=n?n.ts:s.min,o=(e?e.ts:s.max)-i,r=n||e||t;return{name:"SyntheticWebSocketConnection",cat:r.cat,ph:"X",ts:i,dur:o,pid:r.pid,tid:r.tid,s:r.s,rawSourceEvent:r,_tag:"SyntheticEntryTag",args:{data:{identifier:r.args.data.identifier,priority:"Low",url:r.args.data.url||""}}}}const jo=Object.freeze(Object.defineProperty({__proto__:null,data:Js,deps:$o,finalize:Wo,handleEvent:xo,initialize:Uo,reset:Ao},Symbol.toStringTag,{value:"Module"})),he=new Map;function Go(){he.clear()}function Vo(n){if(Cr(n)){for(const e of n.args.data?.frames??[])he.set(e.frame,e);return}if(br(n)){const e=n.args.data;if(!e)return;const t=he.get(e.frame);if(!t)return;he.set(e.frame,{...t,url:e.url||t.url,name:e.name||e.name})}}function Ko(){return{frames:he}}const Xo=Object.freeze(Object.defineProperty({__proto__:null,data:Ko,handleEvent:Vo,reset:Go},Symbol.toStringTag,{value:"Module"})),Ne=new Map;let Bn=[];function Yo(){Ne.clear(),ge=[],Bn=[],Be.clear()}let ge=[];const Be=new Set;function Qo(n){Or(n)&&ge.push(n)}function Jo(n,e){const t=n.args.data?.navigationId;if(!t)throw new Error("Navigation event unexpectedly had no navigation ID.");const s=pt(e),{rendererProcessesByFrame:i}=C(),a=i.get(s);if(!(!a||!a.get(e.pid))&&!sn(e)){if(tn(e)){const r=g(e.ts-n.ts),c=Zs(r);W(s,t,{event:e,metricName:"FCP",classification:c,navigation:n,timing:r});return}if(rn(e)){const r=g(e.ts-n.ts);W(s,t,{event:e,metricName:"FP",classification:"unclassified",navigation:n,timing:r});return}if(an(e)){const r=g(e.ts-n.ts),c={event:e,metricName:"DCL",classification:ni(),navigation:n,timing:r};W(s,t,c);return}if(nn(e)){const r=g(e.ts-n.ts),c={event:e,metricName:"TTI",classification:ei(r),navigation:n,timing:r};W(s,t,c);const d=R(M(e.args.args.total_blocking_time_ms)),l={event:e,metricName:"TBT",classification:si(d),navigation:n,timing:d};W(s,t,l);return}if(on(e)){const r=g(e.ts-n.ts);W(s,t,{event:e,metricName:"L",classification:"unclassified",navigation:n,timing:r});return}if(Q(e)){const r=e.args.data?.candidateIndex;if(!r)throw new Error("Largest Contenful Paint unexpectedly had no candidateIndex.");const c=g(e.ts-n.ts),d={event:e,metricName:"LCP",classification:ti(c),navigation:n,timing:c},l=k(Ne,s,()=>new Map),h=k(l,t,()=>new Map).get("LCP");if(h===void 0){Be.add(d.event),W(s,t,d);return}const u=h.event;if(!Q(u))return;const f=u.args.data?.candidateIndex;if(!f)return;f<r&&(Be.delete(u),Be.add(d.event),W(s,t,d));return}if(!ct(e))return cn(e,`Unexpected event type: ${e}`)}}function W(n,e,t){const s=k(Ne,n,()=>new Map),i=k(s,e,()=>new Map);i.delete(t.metricName),i.set(t.metricName,t)}function pt(n){if(tn(n)||nn(n)||Q(n)||sn(n)||ct(n)||rn(n))return n.args.frame;if(an(n)||on(n)){const e=n.args.data?.frame;if(!e)throw new Error("MarkDOMContent unexpectedly had no frame ID.");return e}cn(n,`Unexpected event type: ${n}`)}function Zo(n){if(tn(n)||Q(n)||rn(n)){const e=n.args.data?.navigationId;if(!e)throw new Error("Trace event unexpectedly had no navigation ID.");const{navigationsByNavigationId:t}=C(),s=t.get(e);return s||null}if(an(n)||nn(n)||ct(n)||on(n)){const e=pt(n),{navigationsByFrameId:t}=C();return dt(n,e,t)}return sn(n)?null:cn(n,`Unexpected event type: ${n}`)}function Zs(n){const e=x(J(1.8)),t=x(J(3));let s="bad";return n<=t&&(s="ok"),n<=e&&(s="good"),s}function ei(n){const e=x(J(3.8)),t=x(J(7.3));let s="bad";return n<=t&&(s="ok"),n<=e&&(s="good"),s}function ti(n){const e=x(J(2.5)),t=x(J(4));let s="bad";return n<=t&&(s="ok"),n<=e&&(s="good"),s}function ni(n){return"unclassified"}function si(n){const e=R(M(200)),t=R(M(600));let s="bad";return n<=t&&(s="ok"),n<=e&&(s="good"),s}function ec(){const n=[],t=[...Ne.values()].flatMap(s=>[...s.values()]);for(let s=0;s<t.length;s++){const a=t[s].get("LCP");!a||!a.event||n.push(a.event)}return n}async function tc(){ge.sort((i,a)=>i.ts-a.ts);for(const i of ge){const a=Zo(i);a&&Jo(a,i)}const n=ec(),e=C().mainFrameId,t=ge.filter(i=>!Q(i));Bn=[...n,...t].filter(Dr).filter(i=>pt(i)===e).sort((i,a)=>i.ts-a.ts)}function nc(){return{metricScoresByFrameId:Ne,allMarkerEvents:Bn}}function sc(){return["Meta"]}const ic=Object.freeze(Object.defineProperty({__proto__:null,data:nc,deps:sc,finalize:tc,getFrameIdForPageLoadEvent:pt,handleEvent:Qo,reset:Yo,scoreClassificationForDOMContentLoaded:ni,scoreClassificationForFirstContentfulPaint:Zs,scoreClassificationForLargestContentfulPaint:ti,scoreClassificationForTimeToInteractive:ei,scoreClassificationForTotalBlockingTime:si},Symbol.toStringTag,{value:"Module"}));let qe=null;const qn=new Map;function rc(){qe=null,qn.clear()}function ac(n){if(Fr(n)&&qe&&n.args.selector_stats){qn.set(qe,{timings:n.args.selector_stats.selector_timings});return}if(Yt(n)){qe=n;return}}function oc(){return{dataForUpdateLayoutEvent:qn}}const cc=Object.freeze(Object.defineProperty({__proto__:null,data:oc,handleEvent:ac,reset:rc},Symbol.toStringTag,{value:"Module"})),Tt=[];let Re=1;function dc(){Tt.length=0,Re=1}function lc(){Re=2}function uc(n){}async function fc(){if(Re!==2)throw new Error("Server Timings handler is not initialized");mc(),rt(Tt),Re=3}const ii="response-start",ri="response-end";function mc(){for(const n of Js().byTime){let e=null;for(const o of n.args.data.responseHeaders){const r=o.name.toLocaleLowerCase();if(r==="server-timing"||r==="server-timing-test"){o.name="server-timing",e=Lr.parseHeaders([o]);continue}}const t=e?.find(o=>o.metric===ii)?.start,s=e?.find(o=>o.metric===ri)?.start;if(!t||!s||!e)continue;const i=t*1e3,a=s*1e3;Tt.push(...hc(n,i,a,e))}}function hc(n,e,t,s){const i=n.args.data.syntheticData.sendStartTime,a=n.args.data.syntheticData.sendStartTime+n.args.data.syntheticData.waiting,o=g((e-i+t-a)/2),r=[];for(const c of s){if(c.metric===ii||c.metric===ri||c.start===null)continue;const d=R(M(c.start))-o,m=new URL(n.args.data.url).origin,h=H.registerServerTiming({rawSourceEvent:n.rawSourceEvent,name:c.metric,ph:"X",pid:Kt(0),tid:Xt(0),ts:g(d),dur:R(M(c.value)),cat:"devtools.server-timing",args:{data:{desc:c.description||void 0,origin:m}}});n.args.data.syntheticServerTimings||(n.args.data.syntheticServerTimings=[]),n.args.data.syntheticServerTimings.push(h),r.push(h)}return r}function gc(){if(Re!==3)throw new Error("Server Timing handler is not finalized");return{serverTimings:Tt}}function pc(){return["NetworkRequests"]}const Tc=Object.freeze(Object.defineProperty({__proto__:null,data:gc,deps:pc,finalize:fc,handleEvent:uc,initialize:lc,reset:dc},Symbol.toStringTag,{value:"Module"})),An=[],Un=[],xn=[],Wn=R(M(200)),Ec=Wn,yc=R(M(500));let pe=null;const Me=[],Ye=[],$n=new Map,Hn=[];let zn=1;function Sc(){An.length=0,Un.length=0,xn.length=0,Me.length=0,Hn.length=0,$n.clear(),Ye.length=0,pe=null,zn=2}function wc(n){if(zn!==2)throw new Error("Handler is not initialized");if(Br(n)){Un.push(n);return}if(qr(n)){xn.push(n);return}if(!Ar(n)||(Ur(n)&&$n.set(n.id,n),An.push(n),!n.args.data||!xr(n)))return;const{duration:e,interactionId:t}=n.args.data;e<1||t===void 0||t===0||Hn.push(n)}const Ic=new Set(["pointerdown","touchstart","pointerup","touchend","mousedown","mouseup","click"]),Rc=new Set(["keydown","keypress","keyup"]);function ai(n){return Ic.has(n.type)?"POINTER":Rc.has(n.type)?"KEYBOARD":"OTHER"}function oi(n){const e={POINTER:new Map,KEYBOARD:new Map,OTHER:new Map};function t(i){const a=ai(i),o=e[a],r=g(i.ts+i.dur),c=o.get(r);if(!c){o.set(r,i);return}if(i.ts<c.ts)o.set(r,i);else if(i.ts===c.ts&&i.interactionId===c.interactionId){const d=c.processingEnd-c.processingStart;i.processingEnd-i.processingStart>d&&o.set(r,i)}i.processingStart<c.processingStart&&(c.processingStart=i.processingStart,xt(c)),i.processingEnd>c.processingEnd&&(c.processingEnd=i.processingEnd,xt(c))}for(const i of n)t(i);const s=Object.values(e).flatMap(i=>Array.from(i.values()));return s.sort((i,a)=>i.ts-a.ts),s}function xt(n){const e=n.args.data.beginEvent,t=n.args.data.endEvent;n.inputDelay=g(n.processingStart-e.ts),n.mainThreadHandling=g(n.processingEnd-n.processingStart),n.presentationDelay=g(t.ts-n.processingEnd)}async function Mc(){const{navigationsByFrameId:n}=C();for(const e of Hn){const t=$n.get(e.id);if(!t||!e.args.data?.type||!e.args.data?.interactionId)continue;const s=g(R(e.args.data.processingStart)-R(e.args.data.timeStamp)+e.ts),i=g(R(e.args.data.processingEnd)-R(e.args.data.timeStamp)+e.ts),a=e.args.frame??e.args.data.frame,r=dt(e,a,n)?.args.data?.navigationId,c=H.registerSyntheticEvent({rawSourceEvent:e,cat:e.cat,name:e.name,pid:e.pid,tid:e.tid,ph:e.ph,processingStart:s,processingEnd:i,inputDelay:g(-1),mainThreadHandling:g(-1),presentationDelay:g(-1),args:{data:{beginEvent:e,endEvent:t,frame:a,navigationId:r}},ts:e.ts,dur:g(t.ts-e.ts),type:e.args.data.type,interactionId:e.args.data.interactionId});xt(c),Me.push(c)}zn=3,Ye.push(...oi(Me));for(const e of Ye)(!pe||pe.dur<e.dur)&&(pe=e)}function ci(){return{allEvents:An,beginCommitCompositorFrameEvents:Un,parseMetaViewportEvents:xn,interactionEvents:Me,interactionEventsWithNoNesting:Ye,longestInteractionEvent:pe,interactionsOverThreshold:new Set(Me.filter(n=>n.dur>Wn))}}function vc(){return["Meta"]}function Pc(n){return n<=Ec?"good":n<=yc?"ok":"bad"}const Nc=Object.freeze(Object.defineProperty({__proto__:null,LONG_INTERACTION_THRESHOLD:Wn,categoryOfInteraction:ai,data:ci,deps:vc,finalize:Mc,handleEvent:wc,removeNestedInteractions:oi,reset:Sc,scoreClassificationForInteractionToNextPaint:Pc},Symbol.toStringTag,{value:"Module"})),Qe=new Map,Je=new Map,Wt=[],$t=[],fe=[],di=R(M(30)),li=R(M(50));function _c(){Qe.clear(),Je.clear(),Wt.length=0,$t.length=0,fe.length=0}function Ze(n,e){const t=k(Qe,n,()=>[]);t.push(e),Qe.set(n,t);const s=k(Je,e,()=>[]);s.push(n),Je.set(e,s)}function kc(n){if(Cc(n),n.name==="RunTask"){const{duration:e}=Qt(n);e>li&&Ze(n,"LONG_TASK");return}if(Fs(n)){const{duration:e}=Wr(n);e>n.args.data.allottedMilliseconds&&Ze(n,"IDLE_CALLBACK_OVER_TIME");return}}function Cc(n){if(as(n,Wt),as(n,$t,$r(n)),$t.length&&(n.name==="Layout"||n.name==="UpdateLayoutTree")){fe.push(n);return}Wt.length===1&&(fe.reduce((t,s)=>t+(s.dur||0),0)>=di&&fe.forEach(t=>Ze(t,"FORCED_REFLOW")),fe.length=0)}function as(n,e,t=!0){let s=e.at(-1);for(;s&&n.ts>s.ts+(s.dur||0);)e.pop(),s=e.at(-1);t&&e.push(n)}function bc(){return["UserInteractions"]}async function Oc(){const n=ci().interactionsOverThreshold;for(const e of n)Ze(e,"LONG_INTERACTION")}function Dc(){return{perEvent:Qe,perWarning:Je}}const Fc=Object.freeze(Object.defineProperty({__proto__:null,FORCED_REFLOW_THRESHOLD:di,LONG_MAIN_THREAD_TASK_THRESHOLD:li,data:Dc,deps:bc,finalize:Oc,handleEvent:kc,reset:_c},Symbol.toStringTag,{value:"Module"}));let ee=1;const Et=[],jn=new Map,Gn=new Map;function Lc(){if(ee!==1)throw new Error("Workers Handler was not reset");ee=2}function Bc(){Et.length=0,jn.clear(),Gn.clear(),ee=1}function qc(n){if(ee!==2)throw new Error("Workers Handler is not initialized");Hr(n)&&Et.push(n)}async function Ac(){if(ee!==2)throw new Error("Handler is not initialized");for(const n of Et)n.args.data&&(jn.set(n.args.data.workerThreadId,n.args.data.workerId),Gn.set(n.args.data.workerId,n.args.data.url));ee=3}function Uc(){if(ee!==3)throw new Error("Workers Handler is not finalized");return{workerSessionIdEvents:Et,workerIdByThread:jn,workerURLById:Gn}}const xc=Object.freeze(Object.defineProperty({__proto__:null,data:Uc,finalize:Ac,handleEvent:qc,initialize:Lc,reset:Bc},Symbol.toStringTag,{value:"Module"})),Ht=Object.freeze(Object.defineProperty({__proto__:null,Animations:ta,AuctionWorklets:zr,ExtensionTraceData:pa,Frames:La,GPU:$a,ImagePainting:Ga,Initiators:Za,Invalidations:ao,LargestImagePaint:uo,LargestTextPaint:go,LayerTree:Ia,LayoutShifts:Oo,Memory:Bo,Meta:Us,NetworkRequests:jo,PageFrames:Xo,PageLoadMetrics:ic,Renderer:jr,Samples:Gr,Screenshots:So,SelectorStats:cc,ServerTimings:Tc,UserInteractions:Nc,UserTimings:da,Warnings:Fc,Workers:xc},Symbol.toStringTag,{value:"Module"}));function yl(n,e,t){if(!e||!t)return null;const s=e.get(t);if(!s)return null;const i=s.data[n];return i instanceof Error?null:i}function Wc(n,e,t){return n.NetworkRequests.byTime.find(i=>i.args.data.url===t||i.args.data.redirects.some(r=>r.url===t)?dt(i,e.frameId,n.Meta.navigationsByFrameId)===e.navigation:!1)??null}function ui(n,e,t){const s=t.args.data?.nodeId;if(!s)throw new Error("no lcp node id");const i=n.LargestImagePaint.get(s);if(!i)return null;const a=i.args.data?.imageUrl;if(!a)throw new Error("no lcp url");const o=Wc(n,e,a);if(!o)throw new Error("no lcp request found");return o}function $c(){return["Meta","Animations","LayoutShifts","NetworkRequests"]}const Hc=[{flag:1,failure:"ACCELERATED_ANIMATIONS_DISABLED"},{flag:2,failure:"EFFECT_SUPPRESSED_BY_DEVTOOLS"},{flag:4,failure:"INVALID_ANIMATION_OR_EFFECT"},{flag:8,failure:"EFFECT_HAS_UNSUPPORTED_TIMING_PARAMS"},{flag:16,failure:"EFFECT_HAS_NON_REPLACE_COMPOSITE_MODE"},{flag:32,failure:"TARGET_HAS_INVALID_COMPOSITING_STATE"},{flag:64,failure:"TARGET_HAS_INCOMPATIBLE_ANIMATIONS"},{flag:128,failure:"TARGET_HAS_CSS_OFFSET"},{flag:512,failure:"ANIMATION_AFFECTS_NON_CSS_PROPERTIES"},{flag:1024,failure:"TRANSFORM_RELATED_PROPERTY_CANNOT_BE_ACCELERATED_ON_TARGET"},{flag:2048,failure:"TRANSFROM_BOX_SIZE_DEPENDENT"},{flag:4096,failure:"FILTER_RELATED_PROPERTY_MAY_MOVE_PIXELS"},{flag:8192,failure:"UNSUPPORTED_CSS_PROPERTY"},{flag:32768,failure:"MIXED_KEYFRAME_VALUE_TYPES"},{flag:65536,failure:"TIMELINE_SOURCE_HAS_INVALID_COMPOSITING_STATE"},{flag:1<<17,failure:"ANIMATION_HAS_NO_VISIBLE_CHANGE"},{flag:1<<18,failure:"AFFECTS_IMPORTANT_PROPERTY"},{flag:1<<19,failure:"SVG_TARGET_HAS_INDEPENDENT_TRANSFORM_PROPERTY"}],zc=x(J(.5));function fi(n,e){const t=n.dur?n.ts+n.dur:n.ts;return t<e.ts&&t>=e.ts-zc}function mi(n){const e=[],t=n.args.data.beginEvent,s=n.args.data.instantEvents||[];for(const i of s){const a=i.args.data.compositeFailed,o=i.args.data.unsupportedProperties;if(!a)continue;const r=Hc.filter(d=>a&d.flag).map(d=>d.failure),c={name:t.args.data.displayName,failureReasons:r,unsupportedProperties:o,animation:n};e.push(c)}return e}function jc(n,e,t,s){const i=[];for(const a of n){const o=mi(a);if(!o)continue;i.push(...o);const r=Vn(e,a);if(!r||!fi(a,r))continue;const c=t.get(r);if(c)for(const d of c){const l=s.get(d);if(!l)throw new Error("Unaccounted shift");l.nonCompositedAnimations.push(...o)}}return i}function Gc(n,e){const t=new Map;for(const s of e){const i=en(n,a=>a.ts>=s.ts);if(i!==null)for(let a=i;a<n.length;a++){const o=n[a];if(o.ts>=s.ts&&o.ts<=s.ts+s.dur&&k(t,s,()=>[]).push(o),o.ts>s.ts+s.dur)break}}return t}function Vn(n,e){const t=en(n,s=>s.ts>e.ts+(e.dur||0));if(t!==null)return n[t]}function Vc(n,e,t,s,i){for(const a of n){const o=Vn(e,a);if(!o)continue;const r=t.get(o);if(r)for(const c of r){const d=s.get(c);if(!d)throw new Error("Unaccounted shift");const l=i.find(m=>{const h=g(a.ts+(a.dur??0));return m.ts>=a.ts&&m.ts<=h});l&&l.args.frame&&d.iframeIds.push(l.args.frame)}}return s}function Kc(n,e,t,s){const i=n.filter(a=>a.args.data.resourceType==="Font"&&a.args.data.mimeType.startsWith("font"));for(const a of i){const o=Vn(e,a);if(!o||!fi(a,o))continue;const r=t.get(o);if(r)for(const c of r){const d=s.get(c);if(!d)throw new Error("Unaccounted shift");d.fontRequests.push(a)}}return s}function Xc(n,e){const t=E=>z(E,e.bounds),s=n.Animations.animations.filter(t),i=n.LayoutShifts.renderFrameImplCreateChildFrameEvents.filter(t),a=n.NetworkRequests.byTime.filter(t),o=n.LayoutShifts.domLoadingEvents.filter(t),r=e.navigation?e.navigationId:Zt,c=n.LayoutShifts.clustersByNavigationId.get(r)??[],l=c.toSorted((E,I)=>I.clusterCumulativeScore-E.clusterCumulativeScore).at(0),m=c.flatMap(E=>E.events),h=n.LayoutShifts.prePaintEvents.filter(t),u=new Map,f=Gc(m,h);for(const E of m)u.set(E,{iframeIds:[],fontRequests:[],nonCompositedAnimations:[]});Vc(i,h,f,u,o),Kc(a,h,f,u);const p=jc(s,h,f,u),y=[...m];return l&&y.push(l),{relatedEvents:y,animationFailures:p,shifts:u,clusters:c,worstCluster:l}}const Yc=Object.freeze(Object.defineProperty({__proto__:null,deps:$c,generateInsight:Xc,getNonCompositedFailure:mi},Symbol.toStringTag,{value:"Module"})),os=600,Qc=100,Jc=1400;function Zc(){return["Meta","NetworkRequests"]}function ed(n){if(!n.args.data.timing)return null;const t=X(n.args.data.syntheticData.waiting);return Math.round(t)}function td(n){const e=[/^content-encoding$/i,/^x-content-encoding-over-network$/i],t=["gzip","br","deflate","zstd"];if(n.args.data.responseHeaders.some(o=>e.some(r=>o.name.match(r))&&t.includes(o.value)))return 0;const i=n.args.data.decodedBodyLength;let a=0;switch(n.args.data.mimeType){case"text/css":a=Math.round(i*.8);break;case"text/html":case"text/javascript":a=Math.round(i*.67);break;case"text/plain":case"text/xml":case"text/x-component":case"application/javascript":case"application/json":case"application/manifest+json":case"application/vnd.api+json":case"application/xml":case"application/xhtml+xml":case"application/rss+xml":case"application/atom+xml":case"application/vnd.ms-fontobject":case"application/x-font-ttf":case"application/x-font-opentype":case"application/x-font-truetype":case"image/svg+xml":case"image/x-icon":case"image/vnd.microsoft.icon":case"font/ttf":case"font/eot":case"font/otf":case"font/opentype":a=Math.round(i*.5);break}return a<Jc?0:a}function nd(n,e){if(!e.navigation)return{};const t=n.NetworkRequests.byTime.find(c=>c.args.data.requestId===e.navigationId);if(!t)throw new Error("missing document request");const s=ed(t);if(s===null)throw new Error("missing document request timing");const i=s>os;let a=0;s>os&&(a=Math.max(s-Qc,0));const o=Math.round(t.args.data.syntheticData.redirectionDuration/1e3);a+=o;const r={FCP:a,LCP:a};return{relatedEvents:[t],data:{serverResponseTime:s,serverResponseTooSlow:i,redirectDuration:M(o),uncompressedResponseBytes:td(t),documentRequest:t},metricSavings:r}}const sd=Object.freeze(Object.defineProperty({__proto__:null,deps:Zc,generateInsight:nd},Symbol.toStringTag,{value:"Module"}));function id(){return["Meta","NetworkRequests","LayoutShifts"]}function rd(n,e){const t=[];for(const i of n.LayoutShifts.beginRemoteFontLoadEvents){if(!z(i,e.bounds))continue;const a=`${i.pid}.${i.args.id}`,o=n.NetworkRequests.byId.get(a);if(!o)continue;const r=i.args.display;let c=M(0);if(/^(block|fallback|auto)$/.test(r)){const d=g(o.args.data.syntheticData.finishTime-o.args.data.syntheticData.sendStartTime);c=Vr(X(d),1/5),c=Math.min(c,3e3)}t.push({request:o,display:r,wastedTime:c})}t.sort((i,a)=>a.wastedTime-i.wastedTime);const s=Math.max(...t.map(i=>i.wastedTime));return{relatedEvents:t.map(i=>i.request),fonts:t,metricSavings:{FCP:s}}}const ad=Object.freeze(Object.defineProperty({__proto__:null,deps:id,generateInsight:rd},Symbol.toStringTag,{value:"Module"}));function od(){return["UserInteractions"]}function cd(n,e){const t=n.UserInteractions.interactionEventsWithNoNesting.filter(o=>z(o,e.bounds));if(!t.length)return{};const s=new Map;for(const o of t){const r=o.interactionId,c=s.get(r);(!c||o.dur>c.dur)&&s.set(r,o)}const i=[...s.values()];i.sort((o,r)=>r.dur-o.dur);const a=Math.min(9,Math.floor(i.length/50));return{relatedEvents:[i[0]],longestInteractionEvent:i[0],highPercentileInteractionEvent:i[a]}}const dd=Object.freeze(Object.defineProperty({__proto__:null,deps:od,generateInsight:cd},Symbol.toStringTag,{value:"Module"}));function ld(){return["NetworkRequests","PageLoadMetrics","LargestImagePaint","Meta"]}function cs(...n){return n.some(e=>Number.isNaN(e))}function ds(n,e,t,s){const i=e.args.data.timing;if(!i)throw new Error("no timing for document request");const a=x(i.requestTime)+R(i.receiveHeadersStart),o=g(a-n.ts),r=X(o);let c=M(t-r);if(!s)return cs(r,c)?null:{ttfb:r,renderDelay:c};const d=g(s.ts-n.ts),l=X(d),m=g(s.args.data.syntheticData.finishTime-n.ts),h=X(m),u=M(l-r),f=M(h-l);return c=M(t-h),cs(r,u,f,c)?null:{ttfb:r,loadDelay:u,loadTime:f,renderDelay:c}}function ud(n,e){if(!e.navigation)return{};const t=n.NetworkRequests,s=n.PageLoadMetrics.metricScoresByFrameId.get(e.frameId);if(!s)throw new Error("no frame metrics");const i=s.get(e.navigationId);if(!i)throw new Error("no navigation metrics");const a=i.get("LCP"),o=a?.event;if(!o||!Q(o))return{warnings:[Ae.NO_LCP]};const r=X(a.timing),c=a.event?.ts?X(a.event?.ts):void 0,d=ui(n,e,o),l=t.byTime.find(E=>E.args.data.requestId===e.navigationId);if(!l)return{lcpMs:r,lcpTs:c,lcpEvent:o,warnings:[Ae.NO_DOCUMENT_REQUEST]};if(!d)return{lcpMs:r,lcpTs:c,lcpEvent:o,phases:ds(e.navigation,l,r,d)??void 0};const m=d.args.data.initiator?.url,h=d?.args.data.initiator?.type==="parser"&&l.args.data.url===m,u=d?.args.data.isLinkPreload||h,f=o.args.data?.loadingAttr,p=d?.args.data.fetchPriorityHint,y=l&&l.args.data.timing?x(l.args.data.timing.requestTime)+R(l.args.data.timing.receiveHeadersStart):void 0;return{lcpMs:r,lcpTs:c,lcpEvent:o,phases:ds(e.navigation,l,r,d)??void 0,shouldRemoveLazyLoading:f==="lazy",shouldIncreasePriorityHint:p!=="high",shouldPreloadImage:!u,lcpRequest:d,earliestDiscoveryTimeTs:y?g(y):void 0}}const fd=Object.freeze(Object.defineProperty({__proto__:null,deps:ld,generateInsight:ud},Symbol.toStringTag,{value:"Module"})),md=50;function hd(){return["NetworkRequests","PageLoadMetrics","LargestImagePaint"]}function gd(n){const e=new Map;for(const[t,s]of n)t.type==="network"&&e.set(t.request.requestId,{node:t,nodeTiming:s});return e}function pd(n,e){const t=e.simulator,s=e.metrics.firstContentfulPaint.optimisticGraph,{nodeTimings:i}=e.simulator.simulate(s),a=new Map(i),o=0,r=s.cloneWithRelationships(h=>!n.has(h.id));if(r.type!=="network")throw new Error("minimalFCPGraph not a NetworkNode");const c=Math.max(...Array.from(Array.from(a).map(h=>h[1].endTime))),d=r.request.transferSize,l=d||0;r.request.transferSize=l+o;const m=t.simulate(r).timeInMs;return r.request.transferSize=d,Math.round(Math.max(c-m,0))}function Td(n,e){const t=n.PageLoadMetrics.metricScoresByFrameId.get(e.frameId);if(!t)throw new Error("no frame metrics");const s=t.get(e.navigationId);if(!s)throw new Error("no navigation metrics");const a=s.get("LCP")?.event;return!a||!Q(a)?!1:ui(n,e,a)!==null}function Ed(n,e,t){if(!e.lantern)return;const s=gd(e.lantern.metrics.firstContentfulPaint.optimisticEstimate.nodeTimings),i={FCP:0,LCP:0},a=new Map,o=new Set;for(const r of t){const c=s.get(r.args.data.requestId);if(!c)continue;const{node:d,nodeTiming:l}=c;d.traverse(h=>o.add(h.id));const m=Math.round(l.duration);m<md||a.set(d.id,m)}return a.size&&(i.FCP=pd(o,e.lantern),Td(n,e)||(i.LCP=i.FCP)),{metricSavings:i,requestIdToWastedMs:a}}function yd(n,e){if(!e.navigation)return{renderBlockingRequests:[]};const t=n.PageLoadMetrics.metricScoresByFrameId.get(e.frameId)?.get(e.navigationId)?.get("FP")?.event?.ts;if(!t)return{renderBlockingRequests:[],warnings:[Ae.NO_FP]};let s=[];for(const a of n.NetworkRequests.byTime){if(a.args.data.frame!==e.frameId||!xs(a)||a.args.data.syntheticData.finishTime>t)continue;if(a.args.data.renderBlocking==="in_body_parser_blocking"){const r=a.args.data.priority,d=a.args.data.resourceType==="Script"&&r==="High";if(r!=="VeryHigh"&&!d)continue}dt(a,e.frameId,n.Meta.navigationsByFrameId)===e.navigation&&s.push(a)}const i=Ed(n,e,s);return s=s.sort((a,o)=>o.dur-a.dur),{relatedEvents:s,renderBlockingRequests:s,...i}}const Sd=Object.freeze(Object.defineProperty({__proto__:null,deps:hd,generateInsight:yd},Symbol.toStringTag,{value:"Module"}));function wd(){return["SelectorStats"]}function Id(n,e){const t=new Map;for(const[s,i]of n)if(s.args.beginData?.frame===e.frameId&&z(s,e.bounds))for(const a of i.timings){const o=a[P.Selector]+"_"+a[P.StyleSheetId],r=t.get(o);r!==void 0?(r[P.Elapsed]+=a[P.Elapsed],r[P.FastRejectCount]+=a[P.FastRejectCount],r[P.MatchAttempts]+=a[P.MatchAttempts],r[P.MatchCount]+=a[P.MatchCount]):t.set(o,{...a})}return[...t.values()]}function Rd(n,e){const t=n.SelectorStats;if(!t)throw new Error("no selector stats data");const s=Id(t.dataForUpdateLayoutEvent,e);let i=0,a=0,o=0;s.map(d=>{i+=d[P.Elapsed],a+=d[P.MatchAttempts],o+=d[P.MatchCount]});const r=s.toSorted((d,l)=>l[P.Elapsed]-d[P.Elapsed]),c=s.toSorted((d,l)=>l[P.MatchAttempts]-d[P.MatchAttempts]);return{relatedEvents:[],totalElapsedMs:M(i/1e3),totalMatchAttempts:a,totalMatchCount:o,topElapsedMs:r.slice(0,3),topMatchAttempts:c.slice(0,3)}}const Md=Object.freeze(Object.defineProperty({__proto__:null,deps:wd,generateInsight:Rd},Symbol.toStringTag,{value:"Module"}));function vd(){return["Meta","NetworkRequests","Renderer","ImagePainting"]}function Pd(n){return n.protocol+"//"+n.host}function Nd(n,e,t){const s=new URL(e),i=Pd(s),a=new URL(i).host,o=t||a,r=n.get(i);if(r)return r;const c={name:o,company:o,category:"Chrome Extension",homepage:"https://chromewebstore.google.com/detail/"+a,categories:[],domains:[],averageExecutionTime:0,totalExecutionTime:0,totalOccurrences:0};return n.set(i,c),c}function ls(n,e){if(e.startsWith("chrome-extension:"))return Nd(n,e);if(!e.startsWith("http"))return;const t=Nt.getRootDomain(e);if(!t)return;if(n.has(t))return n.get(t);const s={name:t,company:t,category:"",categories:[],domains:[t],averageExecutionTime:0,totalExecutionTime:0,totalOccurrences:0,isUnrecognized:!0};return n.set(t,s),s}function _d(n,e){const t=new Map;for(const s of n.Renderer.processes.values())if(s.isOnMainFrame){for(const i of s.threads.values())if(i.name==="CrRendererMain"){if(!i.tree)break;for(const a of i.entries){if(!z(a,e.bounds))continue;const o=n.Renderer.entryToNode.get(a);if(!o||!o.selfTime)continue;const r=kt(n,a);r&&t.set(r,o.selfTime+(t.get(r)??0))}}}return t}function kd(n,e,t){const s=new Map,i=new Map,a={transferSize:0,mainThreadTime:g(0)};for(const r of n){const c=s.get(r)||{...a};c.transferSize+=r.args.data.encodedDataLength,c.mainThreadTime=g(c.mainThreadTime+(t.get(r.args.data.url)??0)),s.set(r,c)}const o=new Map;for(const[r,c]of s.entries()){const d=e.get(r);if(!d){s.delete(r);continue}const l=i.get(d)||{...a};l.transferSize+=c.transferSize,l.mainThreadTime=g(l.mainThreadTime+c.mainThreadTime),i.set(d,l);const m=o.get(d)||[];m.push(r),o.set(d,m)}return{byEntity:i,byRequest:s,requestsByEntity:o}}function Cd(n,e){const t=[];for(const[s,i]of n.requestsByEntity.entries())s!==e&&t.push(...i);return t}function bd(n,e){const t=n.NetworkRequests.byTime.filter(d=>!e.navigation||d.args.data.frame!==e.frameId?!1:z(d,e.bounds)),s=new Map,i=new Map;for(const d of t){const l=d.args.data.url,m=Nt.getEntity(l)??ls(i,l);m&&s.set(d,m)}const a=_d(n,e),o=kd(t,s,a),r=e.navigation?.args.data?.documentLoaderURL??n.Meta.mainFrameURL,c=Nt.getEntity(r)||ls(i,r);return{relatedEvents:Cd(o,c),entityByRequest:s,requestsByEntity:o.requestsByEntity,summaryByRequest:o.byRequest,summaryByEntity:o.byEntity,firstPartyEntity:c}}const Od=Object.freeze(Object.defineProperty({__proto__:null,deps:vd,generateInsight:bd},Symbol.toStringTag,{value:"Module"}));function Dd(){return["Meta","UserInteractions"]}function Fd(n,e){const t=n.UserInteractions.beginCommitCompositorFrameEvents.filter(i=>i.args.frame!==e.frameId?!1:z(i,e.bounds));if(!t.length)return{mobileOptimized:null,warnings:[Ae.NO_LAYOUT]};const s=n.UserInteractions.parseMetaViewportEvents.find(i=>i.args.data.frame!==e.frameId?!1:z(i,e.bounds));for(const i of t)if(!i.args.is_mobile_optimized)return{mobileOptimized:!1,viewportEvent:s,metricSavings:{INP:300}};return{mobileOptimized:!0,viewportEvent:s}}const Ld=Object.freeze(Object.defineProperty({__proto__:null,deps:Dd,generateInsight:Fd},Symbol.toStringTag,{value:"Module"})),Bd=Object.freeze(Object.defineProperty({__proto__:null,CumulativeLayoutShift:Yc,DocumentLatency:sd,FontDisplay:ad,InteractionToNextPaint:dd,LargestContentfulPaint:fd,RenderBlocking:Sd,SlowCSSSelector:Md,ThirdPartyWeb:Od,Viewport:Ld},Symbol.toStringTag,{value:"Module"}));class T extends Error{}class us{static rewriteChromeInternalUrl(e){return!e||!e.startsWith("chrome://")?e:(e.endsWith("/")&&(e=e.replace(/\/$/,"")),e.replace(/^chrome:\/\/chrome\//,"chrome://"))}static equalWithExcludedFragments(e,t){[e,t]=[e,t].map(this.rewriteChromeInternalUrl);try{const s=new URL(e);s.hash="";const i=new URL(t);return i.hash="",s.href===i.href}catch{return!1}}}const fs=14*1024,qd=.4,Ad={Document:.9,XHR:.9,Fetch:.9};class S{static get summary(){return"__SUMMARY__"}static groupByOrigin(e){const t=new Map;return e.forEach(s=>{const i=s.parsedURL.securityOrigin,a=t.get(i)||[];a.push(s),t.set(i,a)}),t}static getSummary(e){e.sort((s,i)=>s-i);let t;if(e.length===0)t=e[0];else if(e.length%2===0){const s=e[Math.floor((e.length-1)/2)],i=e[Math.floor((e.length-1)/2)+1];t=(s+i)/2}else t=e[Math.floor((e.length-1)/2)];return{min:e[0],max:e[e.length-1],avg:e.reduce((s,i)=>s+i,0)/e.length,median:t}}static summarize(e){const t=new Map,s=[];for(const[i,a]of e)t.set(i,S.getSummary(a)),s.push(...a);return t.set(S.summary,S.getSummary(s)),t}static estimateValueByOrigin(e,t){const s=S.estimateIfConnectionWasReused(e),i=S.groupByOrigin(e),a=new Map;for(const[o,r]of i.entries()){let c=[];for(const d of r){const l=d.timing;if(!l)continue;const m=t({request:d,timing:l,connectionReused:s.get(d.requestId)});typeof m<"u"&&(c=c.concat(m))}c.length&&a.set(o,c)}return a}static estimateRTTViaConnectionTiming(e){const{timing:t,connectionReused:s,request:i}=e;if(s)return;const{connectStart:a,sslStart:o,sslEnd:r,connectEnd:c}=t;if(c>=0&&a>=0&&i.protocol.startsWith("h3"))return c-a;if(o>=0&&r>=0&&o!==a)return[c-o,o-a];if(a>=0&&c>=0)return c-a}static estimateRTTViaDownloadTiming(e){const{timing:t,connectionReused:s,request:i}=e;if(s||i.transferSize<=fs||!Number.isFinite(t.receiveHeadersEnd)||t.receiveHeadersEnd<0)return;const o=i.networkEndTime-i.networkRequestTime-t.receiveHeadersEnd,r=Math.log2(i.transferSize/fs);if(!(r>5))return o/r}static estimateRTTViaSendStartTiming(e){const{timing:t,connectionReused:s,request:i}=e;if(s||!Number.isFinite(t.sendStart)||t.sendStart<0)return;let a=1;return i.protocol.startsWith("h3")||(a+=1),i.parsedURL.scheme==="https"&&(a+=1),t.sendStart/a}static estimateRTTViaHeadersEndTiming(e){const{timing:t,connectionReused:s,request:i}=e;if(!Number.isFinite(t.receiveHeadersEnd)||t.receiveHeadersEnd<0||!i.resourceType)return;const a=Ad[i.resourceType]||qd,o=t.receiveHeadersEnd*a;let r=1;return s||(r+=1,i.protocol.startsWith("h3")||(r+=1),i.parsedURL.scheme==="https"&&(r+=1)),Math.max((t.receiveHeadersEnd-o)/r,3)}static estimateResponseTimeByOrigin(e,t){return S.estimateValueByOrigin(e,({request:s,timing:i})=>{if(s.serverResponseTime!==void 0)return s.serverResponseTime;if(!Number.isFinite(i.receiveHeadersEnd)||i.receiveHeadersEnd<0||!Number.isFinite(i.sendEnd)||i.sendEnd<0)return;const a=i.receiveHeadersEnd-i.sendEnd,o=s.parsedURL.securityOrigin,r=t.get(o)||t.get(S.summary)||0;return Math.max(a-r,0)})}static canTrustConnectionInformation(e){const t=new Map;for(const s of e){const i=t.get(s.connectionId)||!s.connectionReused;t.set(s.connectionId,i)}return t.size<=1?!1:Array.from(t.values()).every(s=>s)}static estimateIfConnectionWasReused(e,t){const{forceCoarseEstimates:s=!1}=t||{};if(!s&&S.canTrustConnectionInformation(e))return new Map(e.map(o=>[o.requestId,!!o.connectionReused]));const i=new Map,a=S.groupByOrigin(e);for(const o of a.values()){const r=o.map(d=>d.networkEndTime).reduce((d,l)=>Math.min(d,l),1/0);for(const d of o)i.set(d.requestId,d.networkRequestTime>=r||d.protocol==="h2");const c=o.reduce((d,l)=>d.networkRequestTime>l.networkRequestTime?l:d);i.set(c.requestId,!1)}return i}static estimateRTTByOrigin(e,t){const{forceCoarseEstimates:s=!1,coarseEstimateMultiplier:i=.3,useDownloadEstimates:a=!0,useSendStartEstimates:o=!0,useHeadersEndEstimates:r=!0}=t||{},c=S.estimateIfConnectionWasReused(e),d=S.groupByOrigin(e),l=new Map;for(const[m,h]of d.entries()){let f=function(p,y=1){for(const E of h){const I=E.timing;if(!I)continue;const v=p({request:E,timing:I,connectionReused:c.get(E.requestId)});v!==void 0&&(Array.isArray(v)?u.push(...v.map(_=>_*y)):u.push(v*y))}};const u=[];s||f(this.estimateRTTViaConnectionTiming),u.length||(a&&f(this.estimateRTTViaDownloadTiming,i),o&&f(this.estimateRTTViaSendStartTiming,i),r&&f(this.estimateRTTViaHeadersEndTiming,i)),u.length&&l.set(m,u)}if(!l.size)throw new T("No timing information available");return S.summarize(l)}static estimateServerResponseTimeByOrigin(e,t){let s=(t||{}).rttByOrigin;if(!s){s=new Map;const a=S.estimateRTTByOrigin(e,t);for(const[o,r]of a.entries())s.set(o,r.min)}const i=S.estimateResponseTimeByOrigin(e,s);return S.summarize(i)}static estimateThroughput(e){let t=0;const s=e.reduce((r,c)=>(c.parsedURL?.scheme==="data"||c.failed||!c.finished||c.statusCode>300||!c.transferSize||(t+=c.transferSize,r.push({time:c.responseHeadersEndTime/1e3,isStart:!0}),r.push({time:c.networkEndTime/1e3,isStart:!1})),r),[]).sort((r,c)=>r.time-c.time);if(!s.length)return 1/0;let i=0,a=0,o=0;return s.forEach(r=>{r.isStart?(i===0&&(a=r.time),i++):(i--,i===0&&(o+=r.time-a))}),t*8/o}static computeRTTAndServerResponseTime(e){const t=new Map;for(const[r,c]of S.estimateRTTByOrigin(e).entries())t.set(r,c.min);const s=Math.min(...Array.from(t.values())),i=S.estimateServerResponseTimeByOrigin(e,{rttByOrigin:t}),a=new Map,o=new Map;for(const[r,c]of i.entries()){const d=t.get(r)||s;a.set(r,d-s),o.set(r,c.median)}return{rtt:s,additionalRttByOrigin:a,serverResponseTimeByOrigin:o}}static analyze(e){return{throughput:S.estimateThroughput(e),...S.computeRTTAndServerResponseTime(e)}}static findResourceForUrl(e,t){return e.find(s=>t.startsWith(s.url)&&us.equalWithExcludedFragments(s.url,t))}static findLastDocumentForUrl(e,t){const s=e.filter(i=>i.resourceType==="Document"&&t.startsWith(i.url)&&us.equalWithExcludedFragments(i.url,t));return s[s.length-1]}static resolveRedirects(e){for(;e.redirectDestination;)e=e.redirectDestination;return e}}class w{static types={NETWORK:"network",CPU:"cpu"};_id;_isMainDocument;dependents;dependencies;constructor(e){this._id=e,this._isMainDocument=!1,this.dependents=[],this.dependencies=[]}get id(){return this._id}get type(){throw new T("Unimplemented")}get startTime(){throw new T("Unimplemented")}get endTime(){throw new T("Unimplemented")}setIsMainDocument(e){this._isMainDocument=e}isMainDocument(){return this._isMainDocument}getDependents(){return this.dependents.slice()}getNumberOfDependents(){return this.dependents.length}getDependencies(){return this.dependencies.slice()}getNumberOfDependencies(){return this.dependencies.length}getRootNode(){let e=this;for(;e.dependencies.length;)e=e.dependencies[0];return e}addDependent(e){e.addDependency(this)}addDependency(e){if(e===this)throw new T("Cannot add dependency on itself");this.dependencies.includes(e)||(e.dependents.push(this),this.dependencies.push(e))}removeDependent(e){e.removeDependency(this)}removeDependency(e){if(!this.dependencies.includes(e))return;const t=e.dependents.indexOf(this);e.dependents.splice(t,1),this.dependencies.splice(this.dependencies.indexOf(e),1)}removeAllDependencies(){for(const e of this.dependencies.slice())this.removeDependency(e)}isDependentOn(e){let t=!1;return this.traverse(s=>{t||(t=s===e)},s=>t?[]:s.getDependencies()),t}cloneWithoutRelationships(){const e=new w(this.id);return e.setIsMainDocument(this._isMainDocument),e}cloneWithRelationships(e){const t=this.getRootNode(),s=new Map;t.traverse(a=>{if(!s.has(a.id)){if(e===void 0){s.set(a.id,a.cloneWithoutRelationships());return}e(a)&&a.traverse(o=>s.set(o.id,o.cloneWithoutRelationships()),o=>o.dependencies.filter(r=>!s.has(r.id)))}}),t.traverse(a=>{const o=s.get(a.id);if(o)for(const r of a.dependencies){const c=s.get(r.id);if(!c)throw new T("Dependency somehow not cloned");o.addDependency(c)}});const i=s.get(this.id);if(!i)throw new T("Cloned graph missing node");return i}traverse(e,t){for(const{node:s,traversalPath:i}of this.traverseGenerator(t))e(s,i)}*traverseGenerator(e){e||(e=i=>i.getDependents());const t=[[this]],s=new Set([this.id]);for(;t.length;){const i=t.shift(),a=i[0];yield{node:a,traversalPath:i};for(const o of e(a))s.has(o.id)||(s.add(o.id),t.push([o,...i]))}}static hasCycle(e,t="both"){if(t==="both")return w.hasCycle(e,"dependents")||w.hasCycle(e,"dependencies");const s=new Set,i=[],a=[e],o=new Map([[e,0]]);for(;a.length;){const r=a.pop();if(i.includes(r))return!0;if(s.has(r))continue;for(;i.length>o.get(r);)i.pop();s.add(r),i.push(r);const c=t==="dependents"?r.dependents:r.dependencies;for(const d of c)a.includes(d)||(a.push(d),o.set(d,i.length))}return!1}canDependOn(e){return e.startTime<=this.startTime}}class Kn extends w{_event;_childEvents;correctedEndTs;constructor(e,t=[],s){const i=`${e.tid}.${e.ts}`;super(i),this._event=e,this._childEvents=t,this.correctedEndTs=s}get type(){return w.types.CPU}get startTime(){return this._event.ts}get endTime(){return this.correctedEndTs?this.correctedEndTs:this._event.ts+this._event.dur}get duration(){return this.endTime-this.startTime}get event(){return this._event}get childEvents(){return this._childEvents}didPerformLayout(){return this._childEvents.some(e=>e.name==="Layout")}getEvaluateScriptURLs(){const e=new Set;for(const t of this._childEvents)t.name==="EvaluateScript"&&(!t.args.data||!t.args.data.url||e.add(t.args.data.url));return e}cloneWithoutRelationships(){return new Kn(this._event,this._childEvents,this.correctedEndTs)}}const Ud=["blob","data","intent","file","filesystem","chrome-extension"];function ms(n){const e=n.includes(":")?n.slice(0,n.indexOf(":")):n;return Ud.includes(e)}class et extends w{_request;constructor(e){super(e.requestId),this._request=e}get type(){return w.types.NETWORK}get startTime(){return this._request.rendererStartTime*1e3}get endTime(){return this._request.networkEndTime*1e3}get rawRequest(){return this._request.rawRequest}get request(){return this._request}get initiatorType(){return this._request.initiator&&this._request.initiator.type}get fromDiskCache(){return!!this._request.fromDiskCache}get isNonNetworkProtocol(){return ms(this.request.protocol)||ms(this.request.parsedURL.scheme)}get isConnectionless(){return this.fromDiskCache||this.isNonNetworkProtocol}hasRenderBlockingPriority(){const e=this._request.priority,t=this._request.resourceType==="Script",s=this._request.resourceType==="Document";return e==="VeryHigh"||e==="High"&&t||e==="High"&&s}cloneWithoutRelationships(){const e=new et(this._request);return e.setIsMainDocument(this._isMainDocument),e}}const xd="RunTask",Wd="ThreadControllerImpl::RunTask",$d="ThreadControllerImpl::DoWork",Hd="TaskQueueManager::ProcessTaskFromWorkQueue",zd=10,jd=/^video/;class D{static getNetworkInitiators(e){if(!e.initiator)return[];if(e.initiator.url)return[e.initiator.url];if(e.initiator.type==="script"){const t=new Set;let s=e.initiator.stack;for(;s;){const i=s.callFrames||[];for(const a of i)a.url&&t.add(a.url);s=s.parent}return Array.from(t)}return[]}static getNetworkNodeOutput(e){const t=[],s=new Map,i=new Map,a=new Map;return e.forEach(o=>{if(jd.test(o.mimeType)||o.fromWorker)return;for(;s.has(o.requestId);)o.requestId+=":duplicate";const r=new et(o);t.push(r);const c=i.get(o.url)||[];if(c.push(r),s.set(o.requestId,r),i.set(o.url,c),o.frameId&&o.resourceType==="Document"&&o.documentURL===o.url){const d=a.has(o.frameId)?null:r;a.set(o.frameId,d)}}),{nodes:t,idToNodeMap:s,urlToNodeMap:i,frameIdToNodeMap:a}}static isScheduleableTask(e){return e.name===xd||e.name===Wd||e.name===$d||e.name===Hd}static assertHasToplevelEvents(e){if(!e.some(this.isScheduleableTask))throw new T("Could not find any top level events")}static getCPUNodes(e){const t=[];let s=0;for(D.assertHasToplevelEvents(e);s<e.length;){const i=e[s];if(s++,!D.isScheduleableTask(i)||!i.dur)continue;let a;const o=[];for(const r=i.ts+i.dur;s<e.length&&e[s].ts<r;s++){const c=e[s];if(D.isScheduleableTask(c)&&c.dur){a=c.ts-1;break}o.push(c)}t.push(new Kn(i,o,a))}return t}static linkNetworkNodes(e,t){t.nodes.forEach(s=>{const i=s.request.initiatorRequest||e.request,a=t.idToNodeMap.get(i.requestId)||e,o=!a.isDependentOn(s)&&s.canDependOn(a),r=D.getNetworkInitiators(s.request);if(r.length?r.forEach(d=>{const l=t.urlToNodeMap.get(d)||[];l.length===1&&l[0].startTime<=s.startTime&&!l[0].isDependentOn(s)?s.addDependency(l[0]):o&&a.addDependent(s)}):o&&a.addDependent(s),s!==e&&s.getDependencies().length===0&&s.canDependOn(e)&&s.addDependency(e),!s.request.redirects)return;const c=[...s.request.redirects,s.request];for(let d=1;d<c.length;d++){const l=t.idToNodeMap.get(c[d-1].requestId),m=t.idToNodeMap.get(c[d].requestId);m&&l&&m.addDependency(l)}})}static linkCPUNodes(e,t,s){const i=new Set(["XHR","Fetch","Script"]);function a(u,f){const p=t.idToNodeMap.get(f);if(!p||p.startTime<=u.startTime)return;const{request:y}=p,E=y.resourceType||y.redirectDestination?.resourceType;i.has(E)&&u.addDependent(p)}function o(u,f){if(!f)return;const p=t.frameIdToNodeMap.get(f);p&&(p.startTime>=u.startTime||u.addDependency(p))}function r(u,f){if(!f)return;const p=-100*1e3,y=t.urlToNodeMap.get(f)||[];let E=null,I=1/0;for(const v of y){if(u.startTime<=v.startTime)return;const _=u.startTime-v.endTime;_>=p&&_<I&&(E=v,I=_)}E&&u.addDependency(E)}const c=new Map;for(const u of s){for(const f of u.childEvents){if(!f.args.data)continue;const p=f.args.data.url,y=(f.args.data.stackTrace||[]).map(E=>E.url).filter(Boolean);switch(f.name){case"TimerInstall":c.set(f.args.data.timerId,u),y.forEach(E=>r(u,E));break;case"TimerFire":{const E=c.get(f.args.data.timerId);if(!E||E.endTime>u.startTime)break;E.addDependent(u);break}case"InvalidateLayout":case"ScheduleStyleRecalculation":o(u,f.args.data.frame),y.forEach(E=>r(u,E));break;case"EvaluateScript":o(u,f.args.data.frame),r(u,p),y.forEach(E=>r(u,E));break;case"XHRReadyStateChange":if(f.args.data.readyState!==4)break;r(u,p),y.forEach(E=>r(u,E));break;case"FunctionCall":case"v8.compile":o(u,f.args.data.frame),r(u,p);break;case"ParseAuthorStyleSheet":o(u,f.args.data.frame),r(u,f.args.data.styleSheetUrl);break;case"ResourceSendRequest":o(u,f.args.data.frame),a(u,f.args.data.requestId),y.forEach(E=>r(u,E));break}}u.getNumberOfDependencies()===0&&u.canDependOn(e)&&u.addDependency(e)}const d=zd*1e3;let l=!1,m=!1,h=!1;for(const u of s){let f=!1;!l&&u.childEvents.some(p=>p.name==="Layout")&&(f=l=!0),!m&&u.childEvents.some(p=>p.name==="Paint")&&(f=m=!0),!h&&u.childEvents.some(p=>p.name==="ParseHTML")&&(f=h=!0),!(f||u.duration>=d)&&(u.getNumberOfDependencies()===1||u.getNumberOfDependents()<=1)&&D.pruneNode(u)}}static pruneNode(e){const t=e.getDependencies(),s=e.getDependents();for(const i of t){e.removeDependency(i);for(const a of s)i.addDependent(a)}for(const i of s)e.removeDependent(i)}static debugNormalizeRequests(e){for(const i of e)i.rendererStartTime=Math.round(i.rendererStartTime*1e3)/1e3,i.networkRequestTime=Math.round(i.networkRequestTime*1e3)/1e3,i.responseHeadersEndTime=Math.round(i.responseHeadersEndTime*1e3)/1e3,i.networkEndTime=Math.round(i.networkEndTime*1e3)/1e3;for(const i of e)delete i.rawRequest,i.initiatorRequest&&(i.initiatorRequest={id:i.initiatorRequest.requestId}),i.redirectDestination&&(i.redirectDestination={id:i.redirectDestination.requestId}),i.redirectSource&&(i.redirectSource={id:i.redirectSource.requestId}),i.redirects&&(i.redirects=i.redirects.map(a=>a.requestId));const s=e.map(i=>({requestId:i.requestId,connectionId:i.connectionId,connectionReused:i.connectionReused,url:i.url,protocol:i.protocol,parsedURL:i.parsedURL,documentURL:i.documentURL,rendererStartTime:i.rendererStartTime,networkRequestTime:i.networkRequestTime,responseHeadersEndTime:i.responseHeadersEndTime,networkEndTime:i.networkEndTime,transferSize:i.transferSize,resourceSize:i.resourceSize,fromDiskCache:i.fromDiskCache,fromMemoryCache:i.fromMemoryCache,finished:i.finished,statusCode:i.statusCode,redirectSource:i.redirectSource,redirectDestination:i.redirectDestination,redirects:i.redirects,failed:i.failed,initiator:i.initiator,timing:i.timing?{requestTime:i.timing.requestTime,proxyStart:i.timing.proxyStart,proxyEnd:i.timing.proxyEnd,dnsStart:i.timing.dnsStart,dnsEnd:i.timing.dnsEnd,connectStart:i.timing.connectStart,connectEnd:i.timing.connectEnd,sslStart:i.timing.sslStart,sslEnd:i.timing.sslEnd,workerStart:i.timing.workerStart,workerReady:i.timing.workerReady,workerFetchStart:i.timing.workerFetchStart,workerRespondWithSettled:i.timing.workerRespondWithSettled,sendStart:i.timing.sendStart,sendEnd:i.timing.sendEnd,pushStart:i.timing.pushStart,pushEnd:i.timing.pushEnd,receiveHeadersStart:i.timing.receiveHeadersStart,receiveHeadersEnd:i.timing.receiveHeadersEnd}:i.timing,resourceType:i.resourceType,mimeType:i.mimeType,priority:i.priority,initiatorRequest:i.initiatorRequest,frameId:i.frameId,fromWorker:i.fromWorker,isLinkPreload:i.isLinkPreload,serverResponseTime:i.serverResponseTime})).filter(i=>!i.fromWorker);console.log(s)}static createGraph(e,t,s){const i=D.getNetworkNodeOutput(t),a=D.getCPUNodes(e),{requestedUrl:o,mainDocumentUrl:r}=s;if(!o)throw new T("requestedUrl is required to get the root request");if(!r)throw new T("mainDocumentUrl is required to get the main resource");const c=S.findResourceForUrl(t,o);if(!c)throw new T("rootRequest not found");const d=i.idToNodeMap.get(c.requestId);if(!d)throw new T("rootNode not found");const l=S.findLastDocumentForUrl(t,r);if(!l)throw new T("mainDocumentRequest not found");const m=i.idToNodeMap.get(l.requestId);if(!m)throw new T("mainDocumentNode not found");if(D.linkNetworkNodes(d,i),D.linkCPUNodes(d,i,a),m.setIsMainDocument(!0),et.hasCycle(d))throw new T("Invalid dependency graph created, cycle detected");return d}static printGraph(e,t=100){function s(d,l,m=" "){return d+m.repeat(Math.max(l-d.length,0))}const i=[];e.traverse(d=>i.push(d)),i.sort((d,l)=>d.startTime-l.startTime);const a=i[0].startTime,c=(i.reduce((d,l)=>Math.max(d,l.endTime),0)-a)/t;i.forEach(d=>{const l=Math.round((d.startTime-a)/c),m=Math.ceil((d.endTime-d.startTime)/c),h=s("",l)+s("",m,"="),u=d.request?d.request.url:d.type;console.log(s(h,t),`| ${u.slice(0,30)}`)})}}class ve{static getScriptUrls(e,t){const s=new Set;return e.traverse(i=>{i.type===w.types.NETWORK&&i.request.resourceType==="Script"&&t?.(i)&&s.add(i.request.url)}),s}static get coefficients(){throw new T("coefficients unimplemented!")}static getScaledCoefficients(e){return this.coefficients}static getOptimisticGraph(e,t){throw new T("Optimistic graph unimplemented!")}static getPessimisticGraph(e,t){throw new T("Pessmistic graph unimplemented!")}static getEstimateFromSimulation(e,t){return e}static compute(e,t){const{simulator:s,graph:i,processedNavigation:a}=e,o=this.name.replace("Lantern",""),r=this.getOptimisticGraph(i,a),c=this.getPessimisticGraph(i,a);let d={label:`optimistic${o}`};const l=s.simulate(r,d);d={label:`pessimistic${o}`};const m=s.simulate(c,d),h=this.getEstimateFromSimulation(l,{...t,optimistic:!0}),u=this.getEstimateFromSimulation(m,{...t,optimistic:!1}),f=this.getScaledCoefficients(s.rtt),p=f.intercept>0?Math.min(1,h.timeInMs/1e3):1;return{timing:f.intercept*p+f.optimistic*h.timeInMs+f.pessimistic*u.timeInMs,optimisticEstimate:h,pessimisticEstimate:u,optimisticGraph:r,pessimisticGraph:c}}}class zt extends ve{static get coefficients(){return{intercept:0,optimistic:.5,pessimistic:.5}}static getRenderBlockingNodeData(e,{cutoffTimestamp:t,treatNodeAsRenderBlocking:s,additionalCpuNodesToTreatAsRenderBlocking:i}){const a=new Map,o=[];e.traverse(u=>{if(u.type===w.types.CPU){u.startTime<=t&&o.push(u);const f=u.getEvaluateScriptURLs();for(const p of f){const y=a.get(p)||u;a.set(p,u.startTime<y.startTime?u:y)}}}),o.sort((u,f)=>u.startTime-f.startTime);const r=ve.getScriptUrls(e,u=>u.endTime<=t&&s(u)),c=new Set,d=new Set;for(const u of r){const f=a.get(u);if(f){if(o.includes(f)){d.add(f.id);continue}c.add(u)}}const l=o.find(u=>u.didPerformLayout());l&&d.add(l.id);const m=o.find(u=>u.childEvents.some(f=>f.name==="Paint"));m&&d.add(m.id);const h=o.find(u=>u.childEvents.some(f=>f.name==="ParseHTML"));return h&&d.add(h.id),i&&o.filter(i).forEach(u=>d.add(u.id)),{definitelyNotRenderBlockingScriptUrls:c,renderBlockingCpuNodeIds:d}}static getFirstPaintBasedGraph(e,{cutoffTimestamp:t,treatNodeAsRenderBlocking:s,additionalCpuNodesToTreatAsRenderBlocking:i}){const a=this.getRenderBlockingNodeData(e,{cutoffTimestamp:t,treatNodeAsRenderBlocking:s,additionalCpuNodesToTreatAsRenderBlocking:i}),{definitelyNotRenderBlockingScriptUrls:o,renderBlockingCpuNodeIds:r}=a;return e.cloneWithRelationships(c=>{if(c.type===w.types.NETWORK){if((c.endTime>t||c.startTime>t)&&!c.isMainDocument())return!1;const l=c.request.url;return o.has(l)?!1:s(c)}return r.has(c.id)})}static getOptimisticGraph(e,t){return this.getFirstPaintBasedGraph(e,{cutoffTimestamp:t.timestamps.firstContentfulPaint,treatNodeAsRenderBlocking:s=>s.hasRenderBlockingPriority()&&s.initiatorType!=="script"})}static getPessimisticGraph(e,t){return this.getFirstPaintBasedGraph(e,{cutoffTimestamp:t.timestamps.firstContentfulPaint,treatNodeAsRenderBlocking:s=>s.hasRenderBlockingPriority()})}}const Gd=20;class Xn extends ve{static get coefficients(){return{intercept:0,optimistic:.45,pessimistic:.55}}static getOptimisticGraph(e){const t=Gd*1e3;return e.cloneWithRelationships(s=>{if(s.type===w.types.CPU)return s.duration>t;const i=s.request.resourceType==="Image",a=s.request.resourceType==="Script";return!i&&(a||s.request.priority==="High"||s.request.priority==="VeryHigh")})}static getPessimisticGraph(e){return e}static getEstimateFromSimulation(e,t){if(!t.lcpResult)throw new T("missing lcpResult");const s=Xn.getLastLongTaskEndTime(e.nodeTimings),i=t.optimistic?t.lcpResult.optimisticEstimate.timeInMs:t.lcpResult.pessimisticEstimate.timeInMs;return{timeInMs:Math.max(i,s),nodeTimings:e.nodeTimings}}static compute(e,t){const s=t?.lcpResult;if(!s)throw new T("LCP is required to calculate the Interactive metric");const i=super.compute(e,t);return i.timing=Math.max(i.timing,s.timing),i}static getLastLongTaskEndTime(e,t=50){return Array.from(e.entries()).filter(([s,i])=>s.type!==w.types.CPU?!1:i.duration>t).map(([s,i])=>i.endTime).reduce((s,i)=>Math.max(s||0,i||0),0)}}class tt extends ve{static get coefficients(){return{intercept:0,optimistic:.5,pessimistic:.5}}static isNotLowPriorityImageNode(e){if(e.type!=="network")return!0;const t=e.request.resourceType==="Image",s=e.request.priority==="Low"||e.request.priority==="VeryLow";return!t||!s}static getOptimisticGraph(e,t){const s=t.timestamps.largestContentfulPaint;if(!s)throw new T("NO_LCP");return zt.getFirstPaintBasedGraph(e,{cutoffTimestamp:s,treatNodeAsRenderBlocking:tt.isNotLowPriorityImageNode})}static getPessimisticGraph(e,t){const s=t.timestamps.largestContentfulPaint;if(!s)throw new T("NO_LCP");return zt.getFirstPaintBasedGraph(e,{cutoffTimestamp:s,treatNodeAsRenderBlocking:i=>!0,additionalCpuNodesToTreatAsRenderBlocking:i=>i.didPerformLayout()})}static getEstimateFromSimulation(e){const t=Array.from(e.nodeTimings.entries()).filter(s=>tt.isNotLowPriorityImageNode(s[0])).map(s=>s[1].endTime);return{timeInMs:Math.max(...t),nodeTimings:e.nodeTimings}}static compute(e,t){const s=t?.fcpResult;if(!s)throw new T("FCP is required to calculate the LCP metric");const i=super.compute(e,t);return i.timing=Math.max(i.timing,s.timing),i}}const hi=50;function Vd(n,e,t,s){let i=hi;if(n.duration<i||n.end<e||n.start>t)return 0;const a=Math.max(n.start,e),r=Math.min(n.end,t)-a;return r<i?0:r-i}function Kd(n,e,t){if(t<=e)return 0;let s=0;for(const i of n)s+=Vd(i,e,t);return s}class Yn extends ve{static get coefficients(){return{intercept:0,optimistic:.5,pessimistic:.5}}static getOptimisticGraph(e){return e}static getPessimisticGraph(e){return e}static getEstimateFromSimulation(e,t){if(!t.fcpResult)throw new T("missing fcpResult");if(!t.interactiveResult)throw new T("missing interactiveResult");const s=t.optimistic?t.fcpResult.pessimisticEstimate.timeInMs:t.fcpResult.optimisticEstimate.timeInMs,i=t.optimistic?t.interactiveResult.optimisticEstimate.timeInMs:t.interactiveResult.pessimisticEstimate.timeInMs,a=hi,o=Yn.getTopLevelEvents(e.nodeTimings,a);return{timeInMs:Kd(o,s,i),nodeTimings:e.nodeTimings}}static compute(e,t){if(!t?.fcpResult)throw new T("FCP is required to calculate the TBT metric");if(!t?.fcpResult)throw new T("Interactive is required to calculate the TBT metric");return super.compute(e,t)}static getTopLevelEvents(e,t){const s=[];for(const[i,a]of e.entries())i.type===w.types.CPU&&(a.duration<t||s.push({start:a.startTime,end:a.endTime,duration:a.duration}));return s}}const Xd=10,Ce=1460;class yt{warmed;ssl;h2;rtt;throughput;serverLatency;_congestionWindow;h2OverflowBytesDownloaded;constructor(e,t,s=0,i=!0,a=!1){this.warmed=!1,this.ssl=i,this.h2=a,this.rtt=e,this.throughput=t,this.serverLatency=s,this._congestionWindow=Xd,this.h2OverflowBytesDownloaded=0}static maximumSaturatedConnections(e,t){const o=1e3/e*Ce*8;return Math.floor(t/o)}computeMaximumCongestionWindowInSegments(){const e=this.throughput/8,t=this.rtt/1e3,s=e*t;return Math.floor(s/Ce)}setThroughput(e){this.throughput=e}setCongestionWindow(e){this._congestionWindow=e}setWarmed(e){this.warmed=e}isWarm(){return this.warmed}isH2(){return this.h2}get congestionWindow(){return this._congestionWindow}setH2OverflowBytesDownloaded(e){this.h2&&(this.h2OverflowBytesDownloaded=e)}clone(){return Object.assign(new yt(this.rtt,this.throughput),this)}simulateDownloadUntil(e,t){const{timeAlreadyElapsed:s=0,maximumTimeToElapse:i=1/0,dnsResolutionTime:a=0}=t||{};this.warmed&&this.h2&&(e-=this.h2OverflowBytesDownloaded);const o=this.rtt,r=o/2,c=this.computeMaximumCongestionWindowInSegments();let d=r;this.warmed||(d=a+r+r+r+(this.ssl?o:0));let l=Math.ceil(d/o),m=d+this.serverLatency+r;this.warmed&&this.h2&&(m=0);const h=Math.max(m-s,0),u=i-h;let f=Math.min(this._congestionWindow,c),p=0;h>0?p=f*Ce:l=0;let y=0,E=e-p;for(;E>0&&y<=u;){l++,y+=o,f=Math.max(Math.min(c,f*2),1);const U=f*Ce;p+=U,E-=U}const I=h+y,v=this.h2?Math.max(p-e,0):0,_=Math.max(Math.min(p,e),0);let A;return this.warmed?this.h2?A={timeToFirstByte:m}:A={connectionTime:d,timeToFirstByte:m}:A={dnsResolutionTime:a,connectionTime:d-a,sslTime:this.ssl?o:void 0,timeToFirstByte:m},{roundTrips:l,timeElapsed:I,bytesDownloaded:_,extraBytesDownloaded:v,congestionWindow:f,connectionTiming:A}}}const Yd=30,Qd=["https","wss"],Jd=6;class Zd{options;records;connectionsByOrigin;connectionsByRequest;_connectionsInUse;connectionReusedByRequestId;constructor(e,t){this.options=t,this.records=e,this.connectionsByOrigin=new Map,this.connectionsByRequest=new Map,this._connectionsInUse=new Set,this.connectionReusedByRequestId=S.estimateIfConnectionWasReused(e,{forceCoarseEstimates:!0}),this.initializeConnections()}connectionsInUse(){return Array.from(this._connectionsInUse)}initializeConnections(){const e=this.connectionReusedByRequestId,t=this.options.additionalRttByOrigin,s=this.options.serverResponseTimeByOrigin,i=S.groupByOrigin(this.records);for(const[a,o]of i.entries()){const r=[],c=t.get(a)||0,d=s.get(a)||Yd;for(const m of o){if(e.get(m.requestId))continue;const h=Qd.includes(m.parsedURL.scheme),u=m.protocol==="h2",f=new yt(this.options.rtt+c,this.options.throughput,d,h,u);r.push(f)}if(!r.length)throw new T(`Could not find a connection for origin: ${a}`);const l=r[0].isH2()?1:Jd;for(;r.length<l;)r.push(r[0].clone());this.connectionsByOrigin.set(a,r)}}findAvailableConnectionWithLargestCongestionWindow(e){let t=null;for(let s=0;s<e.length;s++){const i=e[s];if(this._connectionsInUse.has(i))continue;const a=t?.congestionWindow||-1/0;i.congestionWindow>a&&(t=i)}return t}acquire(e){if(this.connectionsByRequest.has(e))throw new T("Record already has a connection");const t=e.parsedURL.securityOrigin,s=this.connectionsByOrigin.get(t)||[],i=this.findAvailableConnectionWithLargestCongestionWindow(s);return i?(this._connectionsInUse.add(i),this.connectionsByRequest.set(e,i),i):null}acquireActiveConnectionFromRequest(e){const t=this.connectionsByRequest.get(e);if(!t)throw new T("Could not find an active connection for request");return t}release(e){const t=this.connectionsByRequest.get(e);this.connectionsByRequest.delete(e),t&&this._connectionsInUse.delete(t)}}const Mt=3.75,ae=.9,el={DEVTOOLS_RTT_ADJUSTMENT_FACTOR:Mt,DEVTOOLS_THROUGHPUT_ADJUSTMENT_FACTOR:ae,mobileSlow4G:{rttMs:150,throughputKbps:1.6*1024,requestLatencyMs:150*Mt,downloadThroughputKbps:1.6*1024*ae,uploadThroughputKbps:750*ae,cpuSlowdownMultiplier:4},mobileRegular3G:{rttMs:300,throughputKbps:700,requestLatencyMs:300*Mt,downloadThroughputKbps:700*ae,uploadThroughputKbps:700*ae,cpuSlowdownMultiplier:4},desktopDense4G:{rttMs:40,throughputKbps:10*1024,cpuSlowdownMultiplier:1,requestLatencyMs:0,downloadThroughputKbps:0,uploadThroughputKbps:0}},jt={throttling:el},tl=2;class nt{static rttMultiplier=tl;rtt;resolvedDomainNames;constructor({rtt:e}){this.rtt=e,this.resolvedDomainNames=new Map}getTimeUntilResolution(e,t){const{requestedAt:s=0,shouldUpdateCache:i=!1}=t||{},a=e.parsedURL.host,o=this.resolvedDomainNames.get(a);let r=this.rtt*nt.rttMultiplier;if(o){const d=Math.max(o.resolvedAt-s,0);r=Math.min(d,r)}const c=s+r;return i&&this.updateCacheResolvedAtIfNeeded(e,c),r}updateCacheResolvedAtIfNeeded(e,t){const s=e.parsedURL.host,i=this.resolvedDomainNames.get(s)||{resolvedAt:t};i.resolvedAt=Math.min(i.resolvedAt,t),this.resolvedDomainNames.set(s,i)}setResolvedAt(e,t){this.resolvedDomainNames.set(e,{resolvedAt:t})}}class hs{nodeTimings;constructor(){this.nodeTimings=new Map}getNodes(){return Array.from(this.nodeTimings.keys())}setReadyToStart(e,t){this.nodeTimings.set(e,t)}setInProgress(e,t){const s={...this.getQueued(e),startTime:t.startTime,timeElapsed:0};this.nodeTimings.set(e,e.type===w.types.NETWORK?{...s,timeElapsedOvershoot:0,bytesDownloaded:0}:s)}setCompleted(e,t){const s={...this.getInProgress(e),endTime:t.endTime,connectionTiming:t.connectionTiming};this.nodeTimings.set(e,s)}setCpu(e,t){const s={...this.getCpuStarted(e),timeElapsed:t.timeElapsed};this.nodeTimings.set(e,s)}setCpuEstimated(e,t){const s={...this.getCpuStarted(e),estimatedTimeElapsed:t.estimatedTimeElapsed};this.nodeTimings.set(e,s)}setNetwork(e,t){const s={...this.getNetworkStarted(e),timeElapsed:t.timeElapsed,timeElapsedOvershoot:t.timeElapsedOvershoot,bytesDownloaded:t.bytesDownloaded};this.nodeTimings.set(e,s)}setNetworkEstimated(e,t){const s={...this.getNetworkStarted(e),estimatedTimeElapsed:t.estimatedTimeElapsed};this.nodeTimings.set(e,s)}getQueued(e){const t=this.nodeTimings.get(e);if(!t)throw new T(`Node ${e.id} not yet queued`);return t}getCpuStarted(e){const t=this.nodeTimings.get(e);if(!t)throw new T(`Node ${e.id} not yet queued`);if(!("startTime"in t))throw new T(`Node ${e.id} not yet started`);if("bytesDownloaded"in t)throw new T(`Node ${e.id} timing not valid`);return t}getNetworkStarted(e){const t=this.nodeTimings.get(e);if(!t)throw new T(`Node ${e.id} not yet queued`);if(!("startTime"in t))throw new T(`Node ${e.id} not yet started`);if(!("bytesDownloaded"in t))throw new T(`Node ${e.id} timing not valid`);return t}getInProgress(e){const t=this.nodeTimings.get(e);if(!t)throw new T(`Node ${e.id} not yet queued`);if(!("startTime"in t))throw new T(`Node ${e.id} not yet started`);if(!("estimatedTimeElapsed"in t))throw new T(`Node ${e.id} not yet in progress`);return t}getCompleted(e){const t=this.nodeTimings.get(e);if(!t)throw new T(`Node ${e.id} not yet queued`);if(!("startTime"in t))throw new T(`Node ${e.id} not yet started`);if(!("estimatedTimeElapsed"in t))throw new T(`Node ${e.id} not yet in progress`);if(!("endTime"in t))throw new T(`Node ${e.id} not yet completed`);return t}}const vt=jt.throttling.mobileSlow4G,nl=10,sl=.5,il=1e4,O={NotReadyToStart:0,ReadyToStart:1,InProgress:2,Complete:3},rl={VeryHigh:0,High:.25,Medium:.5,Low:1,VeryLow:2},gs=new Map;class Te{static createSimulator(e){const{throttlingMethod:t,throttling:s,precomputedLanternData:i,networkAnalysis:a}=e,o={additionalRttByOrigin:a.additionalRttByOrigin,serverResponseTimeByOrigin:a.serverResponseTimeByOrigin,observedThroughput:a.throughput};switch(i&&(o.additionalRttByOrigin=new Map(Object.entries(i.additionalRttByOrigin)),o.serverResponseTimeByOrigin=new Map(Object.entries(i.serverResponseTimeByOrigin))),t){case"provided":o.rtt=a.rtt,o.throughput=a.throughput,o.cpuSlowdownMultiplier=1,o.layoutTaskMultiplier=1;break;case"devtools":s&&(o.rtt=s.requestLatencyMs/jt.throttling.DEVTOOLS_RTT_ADJUSTMENT_FACTOR,o.throughput=s.downloadThroughputKbps*1024/jt.throttling.DEVTOOLS_THROUGHPUT_ADJUSTMENT_FACTOR),o.cpuSlowdownMultiplier=1,o.layoutTaskMultiplier=1;break;case"simulate":s&&(o.rtt=s.rttMs,o.throughput=s.throughputKbps*1024,o.cpuSlowdownMultiplier=s.cpuSlowdownMultiplier);break}return new Te(o)}options;_rtt;throughput;maximumConcurrentRequests;cpuSlowdownMultiplier;layoutTaskMultiplier;cachedNodeListByStartPosition;nodeTimings;numberInProgressByType;nodes;dns;connectionPool;constructor(e){if(this.options=Object.assign({rtt:vt.rttMs,throughput:vt.throughputKbps*1024,maximumConcurrentRequests:nl,cpuSlowdownMultiplier:vt.cpuSlowdownMultiplier,layoutTaskMultiplier:sl,additionalRttByOrigin:new Map,serverResponseTimeByOrigin:new Map},e),this._rtt=this.options.rtt,this.throughput=this.options.throughput,this.maximumConcurrentRequests=Math.max(Math.min(yt.maximumSaturatedConnections(this._rtt,this.throughput),this.options.maximumConcurrentRequests),1),this.cpuSlowdownMultiplier=this.options.cpuSlowdownMultiplier,this.layoutTaskMultiplier=this.cpuSlowdownMultiplier*this.options.layoutTaskMultiplier,this.cachedNodeListByStartPosition=[],this.nodeTimings=new hs,this.numberInProgressByType=new Map,this.nodes={},this.dns=new nt({rtt:this._rtt}),this.connectionPool=null,!Number.isFinite(this._rtt))throw new T(`Invalid rtt ${this._rtt}`);if(!Number.isFinite(this.throughput))throw new T(`Invalid rtt ${this.throughput}`)}get rtt(){return this._rtt}initializeConnectionPool(e){const t=[];e.getRootNode().traverse(s=>{s.type===w.types.NETWORK&&t.push(s.request)}),this.connectionPool=new Zd(t,this.options)}initializeAuxiliaryData(){this.nodeTimings=new hs,this.numberInProgressByType=new Map,this.nodes={},this.cachedNodeListByStartPosition=[];for(const e of Object.values(O))this.nodes[e]=new Set}numberInProgress(e){return this.numberInProgressByType.get(e)||0}markNodeAsReadyToStart(e,t){const s=Te.computeNodeStartPosition(e),i=this.cachedNodeListByStartPosition.findIndex(o=>Te.computeNodeStartPosition(o)>s),a=i===-1?this.cachedNodeListByStartPosition.length:i;this.cachedNodeListByStartPosition.splice(a,0,e),this.nodes[O.ReadyToStart].add(e),this.nodes[O.NotReadyToStart].delete(e),this.nodeTimings.setReadyToStart(e,{queuedTime:t})}markNodeAsInProgress(e,t){const s=this.cachedNodeListByStartPosition.indexOf(e);this.cachedNodeListByStartPosition.splice(s,1),this.nodes[O.InProgress].add(e),this.nodes[O.ReadyToStart].delete(e),this.numberInProgressByType.set(e.type,this.numberInProgress(e.type)+1),this.nodeTimings.setInProgress(e,{startTime:t})}markNodeAsComplete(e,t,s){this.nodes[O.Complete].add(e),this.nodes[O.InProgress].delete(e),this.numberInProgressByType.set(e.type,this.numberInProgress(e.type)-1),this.nodeTimings.setCompleted(e,{endTime:t,connectionTiming:s});for(const i of e.getDependents())i.getDependencies().some(o=>!this.nodes[O.Complete].has(o))||this.markNodeAsReadyToStart(i,t)}acquireConnection(e){return this.connectionPool.acquire(e)}getNodesSortedByStartPosition(){return Array.from(this.cachedNodeListByStartPosition)}startNodeIfPossible(e,t){if(e.type===w.types.CPU){this.numberInProgress(e.type)===0&&this.markNodeAsInProgress(e,t);return}if(e.type!==w.types.NETWORK)throw new T("Unsupported");!e.isConnectionless&&(this.numberInProgress(e.type)>=this.maximumConcurrentRequests||!this.acquireConnection(e.request))||this.markNodeAsInProgress(e,t)}updateNetworkCapacity(){const e=this.numberInProgress(w.types.NETWORK);if(e!==0)for(const t of this.connectionPool.connectionsInUse())t.setThroughput(this.throughput/e)}estimateTimeRemaining(e){if(e.type===w.types.CPU)return this.estimateCPUTimeRemaining(e);if(e.type===w.types.NETWORK)return this.estimateNetworkTimeRemaining(e);throw new T("Unsupported")}estimateCPUTimeRemaining(e){const t=this.nodeTimings.getCpuStarted(e),s=e.didPerformLayout()?this.layoutTaskMultiplier:this.cpuSlowdownMultiplier,a=Math.min(Math.round(e.duration/1e3*s),il)-t.timeElapsed;return this.nodeTimings.setCpuEstimated(e,{estimatedTimeElapsed:a}),a}estimateNetworkTimeRemaining(e){const t=e.request,s=this.nodeTimings.getNetworkStarted(e);let i=0;if(e.fromDiskCache)i=8+20*((t.resourceSize||0)/1024/1024)-s.timeElapsed;else if(e.isNonNetworkProtocol)i=2+10*((t.resourceSize||0)/1024/1024)-s.timeElapsed;else{const o=this.connectionPool.acquireActiveConnectionFromRequest(t),r=this.dns.getTimeUntilResolution(t,{requestedAt:s.startTime,shouldUpdateCache:!0}),c=s.timeElapsed;i=o.simulateDownloadUntil(t.transferSize-s.bytesDownloaded,{timeAlreadyElapsed:c,dnsResolutionTime:r,maximumTimeToElapse:1/0}).timeElapsed}const a=i+s.timeElapsedOvershoot;return this.nodeTimings.setNetworkEstimated(e,{estimatedTimeElapsed:a}),a}findNextNodeCompletionTime(){let e=1/0;for(const t of this.nodes[O.InProgress])e=Math.min(e,this.estimateTimeRemaining(t));return e}updateProgressMadeInTimePeriod(e,t,s){const i=this.nodeTimings.getInProgress(e),a=i.estimatedTimeElapsed===t;if(e.type===w.types.CPU||e.isConnectionless){a?this.markNodeAsComplete(e,s):i.timeElapsed+=t;return}if(e.type!==w.types.NETWORK)throw new T("Unsupported");if(!("bytesDownloaded"in i))throw new T("Invalid timing data");const o=e.request,r=this.connectionPool.acquireActiveConnectionFromRequest(o),c=this.dns.getTimeUntilResolution(o,{requestedAt:i.startTime,shouldUpdateCache:!0}),d=r.simulateDownloadUntil(o.transferSize-i.bytesDownloaded,{dnsResolutionTime:c,timeAlreadyElapsed:i.timeElapsed,maximumTimeToElapse:t-i.timeElapsedOvershoot});r.setCongestionWindow(d.congestionWindow),r.setH2OverflowBytesDownloaded(d.extraBytesDownloaded),a?(r.setWarmed(!0),this.connectionPool.release(o),this.markNodeAsComplete(e,s,d.connectionTiming)):(i.timeElapsed+=d.timeElapsed,i.timeElapsedOvershoot+=d.timeElapsed-t,i.bytesDownloaded+=d.bytesDownloaded)}computeFinalNodeTimings(){const e=this.nodeTimings.getNodes().map(s=>[s,this.nodeTimings.getCompleted(s)]);e.sort((s,i)=>s[1].startTime-i[1].startTime);const t=e.map(([s,i])=>[s,{startTime:i.startTime,endTime:i.endTime,duration:i.endTime-i.startTime}]);return{nodeTimings:new Map(t),completeNodeTimings:new Map(e)}}getOptions(){return this.options}simulate(e,t){if(w.hasCycle(e))throw new T("Cannot simulate graph with cycle");t=Object.assign({label:void 0},t),this.dns=new nt({rtt:this._rtt}),this.initializeConnectionPool(e),this.initializeAuxiliaryData();const s=this.nodes[O.NotReadyToStart],i=this.nodes[O.ReadyToStart],a=this.nodes[O.InProgress],o=e.getRootNode();o.traverse(m=>s.add(m));let r=0,c=0;for(this.markNodeAsReadyToStart(o,r);i.size||a.size;){for(const h of this.getNodesSortedByStartPosition())this.startNodeIfPossible(h,r);if(!a.size)throw new T("Failed to start a node");this.updateNetworkCapacity();const m=this.findNextNodeCompletionTime();if(r+=m,!Number.isFinite(m)||c>1e5)throw new T("Simulation failed, depth exceeded");c++;for(const h of a)this.updateProgressMadeInTimePeriod(h,m,r)}const{nodeTimings:d,completeNodeTimings:l}=this.computeFinalNodeTimings();return gs.set(t.label||"unlabeled",l),{timeInMs:r,nodeTimings:d}}computeWastedMsFromWastedBytes(e){const{throughput:t,observedThroughput:s}=this.options,i=t===0?s:t;if(i===0)return 0;const o=e*8/i*1e3;return Math.round(o/10)*10}static get allNodeTimings(){return gs}static computeNodeStartPosition(e){return e.type==="cpu"?e.startTime:e.startTime+(rl[e.request.priority]*1e3*1e3||0)}}const ps={XHR:"XHR",Fetch:"Fetch",EventSource:"EventSource",Script:"Script",Stylesheet:"Stylesheet",Image:"Image",Media:"Media",Font:"Font",Document:"Document",TextTrack:"TextTrack",WebSocket:"WebSocket",Other:"Other",Manifest:"Manifest",SignedExchange:"SignedExchange",Ping:"Ping",Preflight:"Preflight",CSPViolationReport:"CSPViolationReport",Prefetch:"Prefetch"};function al(n,e,t){const s=n.PageLoadMetrics.metricScoresByFrameId.get(e);if(!s)throw new T("missing metric scores for frame");const i=s.get(t);if(!i)throw new T("missing metric scores for specified navigation");const a=r=>{const c=i.get(r);if(c?.event)return c.event.ts};return{timestamps:{firstContentfulPaint:(r=>{const c=i.get(r);if(!c?.event)throw new T(`missing metric: ${r}`);return c.event.ts})("FCP"),largestContentfulPaint:a("LCP")}}}function gi(n){return typeof n=="string"&&(n=new URL(n)),{scheme:n.protocol.split(":")[0],host:n.hostname,securityOrigin:n.origin}}function ol(n){const e=new Map,t=["ServiceWorker thread","DedicatedWorker thread"];for(const s of n.traceEvents){if(s.name!=="thread_name"||!s.args.name||!t.includes(s.args.name))continue;const i=e.get(s.pid);i?i.push(s.tid):e.set(s.pid,[s.tid])}return e}function cl(n,e,t){if(t.args.data.connectionId===void 0||t.args.data.connectionReused===void 0)throw new T("Trace is too old");let s;try{s=new URL(t.args.data.url)}catch{return}const i=t.args.data.timing?{workerFetchStart:-1,workerRespondWithSettled:-1,...t.args.data.timing}:void 0,a=i?i.requestTime*1e3:t.args.data.syntheticData.downloadStart/1e3;let o=!1;e.get(t.pid)?.includes(t.tid)&&(o=!0),n.Workers.workerIdByThread.has(t.tid)&&(o=!0);const c=t.args.data.initiator??{type:"other"};if(t.args.data.stackTrace){const m=t.args.data.stackTrace.map(h=>({scriptId:String(h.scriptId),url:h.url,lineNumber:h.lineNumber-1,columnNumber:h.columnNumber-1,functionName:h.functionName}));c.stack={callFrames:m}}let d=t.args.data.resourceType;t.args.data.initiator?.fetchType==="xmlhttprequest"?d="XHR":t.args.data.initiator?.fetchType==="fetch"&&(d="Fetch");let l=t.args.data.decodedBodyLength??0;if(s.protocol==="data:"&&l===0){const m="base64,",h=s.pathname.indexOf(m);h!==-1&&(l=atob(s.pathname.substring(h+m.length)).length)}return{rawRequest:t,requestId:t.args.data.requestId,connectionId:t.args.data.connectionId,connectionReused:t.args.data.connectionReused,url:t.args.data.url,protocol:t.args.data.protocol,parsedURL:gi(s),documentURL:t.args.data.requestingFrameUrl,rendererStartTime:t.ts/1e3,networkRequestTime:a,responseHeadersEndTime:t.args.data.syntheticData.downloadStart/1e3,networkEndTime:t.args.data.syntheticData.finishTime/1e3,transferSize:t.args.data.encodedDataLength,resourceSize:l,fromDiskCache:t.args.data.syntheticData.isDiskCached,fromMemoryCache:t.args.data.syntheticData.isMemoryCached,isLinkPreload:t.args.data.isLinkPreload,finished:t.args.data.finished,failed:t.args.data.failed,statusCode:t.args.data.statusCode,initiator:c,timing:i,resourceType:d,mimeType:t.args.data.mimeType,priority:t.args.data.priority,frameId:t.args.data.frame,fromWorker:o,redirects:void 0,redirectSource:void 0,redirectDestination:void 0,initiatorRequest:void 0}}function dl(n,e){if(n.redirectSource)return n.redirectSource;const t=D.getNetworkInitiators(n)[0];let s=e.get(t)||[];if(s=s.filter(i=>i.responseHeadersEndTime<=n.rendererStartTime&&i.finished&&!i.failed),s.length>1){const i=s.filter(a=>a.resourceType!==ps.Other);i.length&&(s=i)}if(s.length>1){const i=s.filter(a=>a.frameId===n.frameId);i.length&&(s=i)}if(s.length>1&&n.initiator.type==="parser"){const i=s.filter(a=>a.resourceType===ps.Document);i.length&&(s=i)}if(s.length>1){const i=s.filter(a=>a.isLinkPreload);if(i.length){const a=s.filter(r=>!r.isLinkPreload),o=a.every(r=>r.fromDiskCache||r.fromMemoryCache);a.length&&o&&(s=i)}}return s.length===1?s[0]:null}function ll(n){const e=new Map;for(const t of n){const s=e.get(t.url)||[];s.push(t),e.set(t.url,s)}for(const t of n){const s=dl(t,e);s&&(t.initiatorRequest=s)}}function ul(n,e,t=0,s=Number.POSITIVE_INFINITY){const i=ol(n),a=[];for(const o of e.NetworkRequests.byTime)if(o.ts>=t&&o.ts<s){const r=cl(e,i,o);r&&a.push(r)}for(const o of[...a]){if(!o.rawRequest)continue;const r=o.rawRequest.args.data.redirects;if(!r.length)continue;const c=[];for(const d of r){const l=structuredClone(o);l.networkRequestTime=d.ts/1e3,l.rendererStartTime=l.networkRequestTime,l.networkEndTime=(d.ts+d.dur)/1e3,l.responseHeadersEndTime=l.networkEndTime,l.timing={requestTime:l.networkRequestTime/1e3,receiveHeadersStart:l.responseHeadersEndTime,receiveHeadersEnd:l.responseHeadersEndTime,proxyStart:-1,proxyEnd:-1,dnsStart:-1,dnsEnd:-1,connectStart:-1,connectEnd:-1,sslStart:-1,sslEnd:-1,sendStart:-1,sendEnd:-1,workerStart:-1,workerReady:-1,workerFetchStart:-1,workerRespondWithSettled:-1,pushStart:-1,pushEnd:-1},l.url=d.url,l.parsedURL=gi(d.url),l.statusCode=302,l.resourceType=void 0,l.transferSize=400,c.push(l),a.push(l)}c.push(o);for(let d=0;d<c.length;d++){const l=c[d];d>0&&(l.redirectSource=c[d-1],l.redirects=c.slice(0,d)),d!==c.length-1&&(l.redirectDestination=c[d+1])}for(let d=1;d<c.length;d++)c[d].requestId=`${c[d-1].requestId}:redirect`}return ll(a),a.sort((o,r)=>o.rendererStartTime-r.rendererStartTime)}function fl(n,e){const t=e.Meta,s=t.mainFrameNavigations.length?new Set(t.mainFrameNavigations.map(a=>a.pid)):t.topLevelRendererIds,i=new Map;for(const a of s){const o=t.threadsInProcess.get(a)??[];let r=!1;for(const[c,d]of o)if(d.args.name==="CrRendererMain"){i.set(a,c),r=!0;break}if(!r){for(const[c,d]of o)if(d.args.name==="CrBrowserMain"){i.set(a,c),r=!0;break}}}return n.traceEvents.filter(a=>i.get(a.pid)===a.tid)}function ml(n,e,t,s){const i=fl(e,t);if(!s){s={requestedUrl:n[0].url,mainDocumentUrl:""};let a=n[0];for(;a.redirectDestination;)a=a.redirectDestination;s.mainDocumentUrl=a.url}return D.createGraph(i,n,s)}class Y extends Event{data;static eventName="traceparseprogress";constructor(e,t={bubbles:!0}){super(Y.eventName,t),this.data=e}}function Ts(n,e){return e===.8?n*(.8-.2)+.2:n*e}class st extends EventTarget{#e;#n="IDLE";#a=_t();#t=null;#s=null;static createWithAllHandlers(){return new st(Ht,_t())}static getEnabledInsightRunners(e){const t={};for(const[s,i]of Object.entries(Bd))i.deps().some(o=>!e[o])||Object.assign(t,{[s]:i});return t}constructor(e,t){super(),this.#c(e),this.#e={Meta:Us,...e},t&&(this.#a=t),this.#i()}#i(){for(const e of Object.values(this.#e))"handleUserConfig"in e&&e.handleUserConfig&&e.handleUserConfig(this.#a)}#c(e){if(Object.keys(e).length===Object.keys(Ht).length)return;const t=new Set;for(const[i,a]of Object.entries(e)){t.add(i);const o="deps"in a?a.deps():[];for(const r of o)t.add(r)}const s=new Set(Object.keys(e));t.delete("Meta");for(const i of t)if(!s.has(i))throw new Error(`Required handler ${i} not provided.`)}reset(){if(this.#n==="PARSING")throw new Error("Trace processor can't reset while parsing.");const e=Object.values(this.#e);for(const t of e)t.reset();this.#t=null,this.#s=null,this.#n="IDLE"}async parse(e,t){if(this.#n!=="IDLE")throw new Error(`Trace processor can't start parsing when not idle. Current state: ${this.#n}`);try{this.#n="PARSING",await this.#r(e,!!t.isFreshRecording),this.#t&&!t.isCPUProfile&&this.#l(this.#t,e),this.#n="FINISHED_PARSING"}catch(s){throw this.#n="ERRORED_WHILE_PARSING",s}}async#r(e,t){const i=[...hl(this.#e).values()];for(const r of i)r.reset();for(const r of i)r.initialize?.(t);for(let r=0;r<e.length;++r){if(r%5e4===0&&r){const d=Ts(r/e.length,.2);this.dispatchEvent(new Y({percent:d})),await new Promise(l=>setTimeout(l,0))}const c=e[r];for(let d=0;d<i.length;++d)i[d].handleEvent(c)}for(const[r,c]of i.entries()){c.finalize&&(await new Promise(l=>setTimeout(l,0)),await c.finalize());const d=Ts(r/i.length,.8);this.dispatchEvent(new Y({percent:d}))}const a=(r,c=!0)=>{if(r instanceof Map)return new Map(r);if(r instanceof Set)return new Set(r);if(Array.isArray(r))return[...r];if(typeof r=="object"&&r&&c){const d={};for(const[l,m]of Object.entries(r))d[l]=a(m,!1);return d}return r},o={};for(const[r,c]of Object.entries(this.#e)){const d=a(c.data());Object.assign(o,{[r]:d})}this.dispatchEvent(new Y({percent:1})),this.#t=o}get parsedTrace(){return this.#n!=="FINISHED_PARSING"?null:this.#t}get insights(){return this.#n!=="FINISHED_PARSING"?null:this.#s}#o(e,t,s,i){if(!e.NetworkRequests||!e.Workers||!e.PageLoadMetrics)return;if(!e.NetworkRequests.byTime.length)throw new T("No network requests found in trace");const a=e.Meta.navigationsByFrameId.get(s),o=a?.findIndex(U=>U.args.data?.navigationId===i);if(!a||o===void 0||o===-1)throw new T("Could not find navigation start");const r=a[o].ts,c=o+1<a.length?a[o+1].ts:Number.POSITIVE_INFINITY,l={traceEvents:t.filter(U=>U.ts>=r&&U.ts<c)},m=ul(l,e,r,c),h=ml(m,l,e),u=al(e,s,i),f=S.analyze(m),p=Te.createSimulator({networkAnalysis:f,throttlingMethod:"provided"}),y={graph:h,simulator:p,processedNavigation:u},E=zt.compute(y),I=tt.compute(y,{fcpResult:E}),v=Xn.compute(y,{lcpResult:I}),_=Yn.compute(y,{fcpResult:E,interactiveResult:v});return{graph:h,simulator:p,metrics:{firstContentfulPaint:E,interactive:v,largestContentfulPaint:I,totalBlockingTime:_}}}#d(e,t,s,i){const a={};for(const[m,h]of Object.entries(s)){let u;try{u=h.generateInsight(t,i)}catch(f){u=f}Object.assign(a,{[m]:u})}let o,r,c;i.navigation?(o=i.navigationId,r=i.navigation.args.data?.documentLoaderURL??t.Meta.mainFrameURL,c=i.navigation):(o=Zt,r=t.Meta.mainFrameURL);let d;try{d=new URL(r)}catch{return}const l={id:o,url:d,navigation:c,frameId:i.frameId,bounds:i.bounds,data:a};e.set(l.id,l)}#l(e,t){this.#s=new Map;const s=st.getEnabledInsightRunners(e),i=e.Meta.mainFrameNavigations.filter(a=>a.args.frame&&a.args.data?.navigationId);if(i.length){const a=is(e.Meta.traceBounds.min,i[0].ts),o=R(50);if(a.range>o){const r={bounds:a,frameId:e.Meta.mainFrameId};this.#d(this.#s,e,s,r)}}else{const a={bounds:e.Meta.traceBounds,frameId:e.Meta.mainFrameId};this.#d(this.#s,e,s,a)}for(const[a,o]of i.entries()){const r=o.args.frame,c=o.args.data?.navigationId;let d;try{d=this.#o(e,t,r,c)}catch(f){const p=["mainDocumentRequest not found","missing metric scores for main frame","missing metric: FCP","missing metric: LCP","No network requests found in trace","Trace is too old"];f instanceof T?p.some(y=>f.message===y)||console.error(f.message):console.error(f)}const l=o.ts,m=a+1<i.length?i[a+1].ts:e.Meta.traceBounds.max,u={bounds:is(l,m),frameId:r,navigation:o,navigationId:c,lantern:d};this.#d(this.#s,e,s,u)}}}function hl(n){const e=new Map,t=new Set,s=i=>{if(e.has(i))return;if(t.has(i)){let r="";for(const c of t)(r||c===i)&&(r+=`${c}->`);throw r+=i,new Error(`Found dependency cycle in trace event handlers: ${r}`)}t.add(i);const a=n[i];if(!a)return;const o=a.deps?.();o&&o.forEach(s),e.set(i,a)};for(const i of Object.keys(n))s(i);return e}class Gt extends EventTarget{#e=[];#n=[];#a=new Map;#t=[];#s=0;#i;#c=_t();static createWithAllHandlers(e){return new Gt(Ht,e)}static createWithSubsetOfHandlers(e,t){return new Gt(e,t)}constructor(e,t){super(),t&&(this.#c=t),this.#i=new st(e,this.#c)}async parse(e,t){const s=t?.metadata||{},i=t?.isFreshRecording||!1,a=s?.dataOrigin==="CPUProfile",o=c=>{const{data:d}=c;this.dispatchEvent(new it({type:"PROGRESS_UPDATE",data:d}))};this.#i.addEventListener(Y.eventName,o);const r={traceEvents:e,metadata:s,parsedTrace:null,traceInsights:null};try{const c=H.createAndActivate(e);await this.#i.parse(e,{isFreshRecording:i,isCPUProfile:a}),this.#r(r,this.#i.parsedTrace,this.#i.insights),this.#e.push(r),this.#n.push(c)}catch(c){throw c}finally{this.#i.removeEventListener(Y.eventName,o),this.dispatchEvent(new it({type:"COMPLETE",data:"done"}))}}#r(e,t,s){e.parsedTrace=t,e.traceInsights=s,this.#s++;let i=`Trace ${this.#s}`,a=null;if(e.parsedTrace&&(a=Kr(e.parsedTrace.Meta.mainFrameURL),a)){const o=k(this.#a,a,()=>1);i=`${a} (${o})`,this.#a.set(a,o+1)}this.#t.push(i)}lastTraceIndex(){return this.size()-1}parsedTrace(e=this.#e.length-1){return this.#e.at(e)?.parsedTrace??null}traceInsights(e=this.#e.length-1){return this.#e.at(e)?.traceInsights??null}metadata(e=this.#e.length-1){return this.#e.at(e)?.metadata??null}overrideModifications(e,t){this.#e[e]&&(this.#e[e].metadata.modifications=t)}rawTraceEvents(e=this.#e.length-1){return this.#e.at(e)?.traceEvents??null}syntheticTraceEventsManager(e=this.#e.length-1){return this.#n.at(e)??null}size(){return this.#e.length}deleteTraceByIndex(e){this.#e.splice(e,1),this.#t.splice(e,1)}getRecordingsAvailable(){return this.#t}resetProcessor(){this.#i.reset()}}class it extends Event{data;static eventName="modelupdate";constructor(e){super(it.eventName),this.data=e}}export{Yc as C,li as L,Gt as M,So as S,Vs as T,yl as a,Pc as b,ai as c,bo as d,Tl as e,pl as f,kt as g,it as h,xs as i,Fa as j,Wn as k,Hs as l,ti as s,El as t};
//# sourceMappingURL=ModelImpl-DjdwMiMr.js.map
