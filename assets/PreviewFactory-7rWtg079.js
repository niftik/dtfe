import{b as S,g as x,ft as Se,fu as ie,fv as re,fw as H,fx as xe,fy as oe,fz as ye,ag as b,ba as be,eX as z,ct as Ce,ds as ve,fA as Te,cF as v,aj as P,X as R,fB as L,fC as Ee,eh as Ie,fD as Re,fE as Pe,fF as Le,fG as Ne,Q as $,fH as De,fI as Fe,fJ as Me,aM as q,u as ae,A as le,fK as X,fL as M,fM as Oe,ay as F,fN as Ve,fO as Ae,bO as Ue,fP as je,ei as ke,fQ as Be,fR as He,cc as j,eD as ze,fS as We,aZ as $e,cq as qe,bJ as _,eg as O,fT as Xe,fU as _e,fV as Je,aU as ce,fW as he,fX as N,bA as Ge,fY as Ye,fZ as Ze,bi as ue,bq as Qe,f_ as Ke,bS as et,ef as tt,ex as J,fo as st,aw as G,cG as V,f$ as nt,bx as it,g0 as rt,b0 as A,bG as ot,c5 as at,ca as lt,g1 as de,c9 as Y,g2 as T,cC as ct,c3 as ht,c7 as ut,cY as dt,cZ as mt,g3 as ft,g4 as gt,cs as U,cD as Z}from"./inspector-CyOA7R9n.js";import{D as pt,T as Q}from"./DropTarget-DDkHhLsd.js";import{a as wt}from"./ScriptFormatter-CdcZyJ9a.js";const St=["application/javascript","application/json","application/manifest+json","text/css","text/html","text/javascript"],xt={cssContent:`/*
 * Copyright 2017 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

.searchable-view {
  flex: 1;
}

.toolbar {
  background-color: var(--sys-color-cdt-base-container);
  border-top: 1px solid var(--sys-color-divider);
}

/*# sourceURL=resourceSourceFrame.css */
`},yt={cssContent:`/*
 * Copyright (c) 2023 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

.widget {
  padding: 20px;
}

.title {
  font-size: larger;
}

.title,
.message,
.button,
.text-input {
  margin: 5px;
}

.button {
  text-align: right;
  margin-top: 10px;
  display: flex;
  justify-content: flex-end;
  gap: var(--sys-size-6);
}

.button button {
  min-width: 80px;
}

.dialog-close-button {
  position: absolute;
  right: 9px;
  top: 9px;
  z-index: 1;
}

/*# sourceURL=selfXssDialog.css */
`},c={source:"Source",prettyPrint:"Pretty print",loading:"Loading…",dSelectionRegions:"{PH1} selection regions",bytecodePositionXs:"Bytecode position `0x`{PH1}",lineSColumnS:"Line {PH1}, Column {PH2}",dCharactersSelected:"{PH1} characters selected",dLinesDCharactersSelected:"{PH1} lines, {PH2} characters selected",doYouTrustThisCode:"Do you trust this code?",doNotPaste:"Don't paste code you do not understand or have not reviewed yourself into DevTools. This could allow attackers to steal your identity or take control of your computer. Please type ''{PH1}'' below to allow pasting.",allowPasting:"allow pasting",cancel:"Cancel",allow:"Allow",typeAllowPasting:"Type ''{PH1}''",binaryContentError:`Editor can't show binary data. Use the "Response" tab in the "Network" panel to inspect this resource.`},bt=S("ui/legacy/components/source_frame/SourceFrame.ts",c),h=x.bind(void 0,bt),Ct=Se.define({combine(a){return a.length===0?e=>e.toString():a[0]}});class vt extends be(z){options;lazyContent;prettyInternal;rawContent;formattedMap;prettyToggle;shouldAutoPrettyPrint;progressToolbarItem;textEditorInternal;baseDoc;prettyBaseDoc=null;displayedSelection=null;searchConfig;delayedFindSearchMatches;currentSearchResultIndex;searchResults;searchRegex;loadError;muteChangeEventsForSetContent;sourcePosition;searchableView;editable;positionToReveal;lineToScrollTo;selectionToSet;loadedInternal;contentRequested;wasmDisassemblyInternal;contentSet;selfXssWarningDisabledSetting;constructor(e,t={}){super(h(c.source)),this.options=t,this.lazyContent=e,this.prettyInternal=!1,this.rawContent=null,this.formattedMap=null,this.prettyToggle=new Ce(h(c.prettyPrint),"brackets",void 0,"pretty-print"),this.prettyToggle.addEventListener("Click",()=>{this.setPretty(this.prettyToggle.isToggled())}),this.shouldAutoPrettyPrint=!1,this.prettyToggle.setVisible(!1),this.progressToolbarItem=new ve(document.createElement("div")),this.textEditorInternal=new Te(this.placeholderEditorState("")),this.textEditorInternal.style.flexGrow="1",this.element.appendChild(this.textEditorInternal),this.element.addEventListener("keydown",s=>{s.defaultPrevented&&s.stopPropagation()}),this.baseDoc=this.textEditorInternal.state.doc,this.searchConfig=null,this.delayedFindSearchMatches=null,this.currentSearchResultIndex=-1,this.searchResults=[],this.searchRegex=null,this.loadError=!1,this.muteChangeEventsForSetContent=!1,this.sourcePosition=new v,this.searchableView=null,this.editable=!1,this.positionToReveal=null,this.lineToScrollTo=null,this.selectionToSet=null,this.loadedInternal=!1,this.contentRequested=!1,this.wasmDisassemblyInternal=null,this.contentSet=!1,this.selfXssWarningDisabledSetting=P.instance().createSetting("disable-self-xss-warning",!1,"Synced"),P.instance().moduleSetting("text-editor-indent").addChangeListener(this.#e,this)}disposeView(){P.instance().moduleSetting("text-editor-indent").removeChangeListener(this.#e,this)}async#e(){this.prettyInternal&&(await this.setPretty(!1),await this.setPretty(!0))}placeholderEditorState(e){return R.create({doc:e,extensions:[R.readOnly.of(!0),this.options.lineNumbers!==!1?L():[],Ee()]})}editorConfiguration(e){return[b.updateListener.of(t=>this.dispatchEventToListeners("EditorUpdate",t)),Ie(e),Re.instance(),Pe.instance(),Le.instance(),Ne.instance(),$.lowest(De.instance()),Fe.instance(),Dt,b.domEventHandlers({focus:()=>this.onFocus(),blur:()=>this.onBlur(),paste:()=>this.onPaste(),scroll:()=>this.dispatchEventToListeners("EditorScroll"),contextmenu:t=>this.onContextMenu(t)}),L({domEventHandlers:{contextmenu:(t,s,n)=>this.onLineGutterContextMenu(s.from,n)}}),b.updateListener.of(t=>{(t.selectionSet||t.docChanged)&&this.updateSourcePosition(),t.docChanged&&this.onTextChanged()}),I,$.lowest(Pt),y.language.of([]),this.wasmDisassemblyInternal?Nt(this.wasmDisassemblyInternal):W,this.options.lineWrapping?b.lineWrapping:[],this.options.lineNumbers!==!1?L():[],Me({colors:{light:"var(--sys-color-divider)",activeLight:"var(--sys-color-divider-prominent)",dark:"var(--sys-color-divider)",activeDark:"var(--sys-color-divider-prominent)"}})]}onBlur(){}onFocus(){}onPaste(){return q.queryParam("isChromeForTesting")||q.queryParam("disableSelfXssWarnings")||this.selfXssWarningDisabledSetting.get()?!1:(this.showSelfXssWarning(),!0)}async showSelfXssWarning(){await new Promise(t=>setTimeout(t,0)),await Et.show()&&(this.selfXssWarningDisabledSetting.set(!0),ae.actionTaken(le.SelfXssAllowPastingInDialog))}get wasmDisassembly(){return this.wasmDisassemblyInternal}editorLocationToUILocation(e,t){return this.wasmDisassemblyInternal?(t=this.wasmDisassemblyInternal.lineNumberToBytecodeOffset(e),e=0):this.prettyInternal&&([e,t]=this.prettyToRawLocation(e,t)),{lineNumber:e,columnNumber:t}}uiLocationToEditorLocation(e,t=0){return this.wasmDisassemblyInternal?(e=this.wasmDisassemblyInternal.bytecodeOffsetToLineNumber(t),t=0):this.prettyInternal&&([e,t]=this.rawToPrettyLocation(e,t)),{lineNumber:e,columnNumber:t}}setCanPrettyPrint(e,t){this.shouldAutoPrettyPrint=t===!0&&P.instance().moduleSetting("auto-pretty-print-minified").get(),this.prettyToggle.setVisible(e)}setEditable(e){this.editable=e,this.loaded&&e!==!this.textEditor.state.readOnly&&this.textEditor.dispatch({effects:y.editable.reconfigure(R.readOnly.of(!e))})}async setPretty(e){this.prettyInternal=e,this.prettyToggle.setEnabled(!1);const t=this.loaded,{textEditor:s}=this,n=s.state.selection.main,i=s.toLineColumn(n.from),r=s.toLineColumn(n.to);let o;if(this.prettyInternal){const l=this.rawContent instanceof X?this.rawContent.sliceString(0):this.rawContent||"",u=await wt(this.contentType,l);this.formattedMap=u.formattedMapping,await this.setContent(u.formattedContent),this.prettyBaseDoc=s.state.doc;const m=this.rawToPrettyLocation(i.lineNumber,i.columnNumber),d=this.rawToPrettyLocation(r.lineNumber,r.columnNumber);o=s.createSelection({lineNumber:m[0],columnNumber:m[1]},{lineNumber:d[0],columnNumber:d[1]})}else{await this.setContent(this.rawContent||""),this.baseDoc=s.state.doc;const l=this.prettyToRawLocation(i.lineNumber,i.columnNumber),u=this.prettyToRawLocation(r.lineNumber,r.columnNumber);o=s.createSelection({lineNumber:l[0],columnNumber:l[1]},{lineNumber:u[0],columnNumber:u[1]})}t&&s.revealPosition(o,!1),this.prettyToggle.setEnabled(!0),this.updatePrettyPrintState()}getLineNumberFormatter(){if(this.options.lineNumbers===!1)return[];let e;if(this.wasmDisassemblyInternal){const t=this.wasmDisassemblyInternal,n=t.lineNumberToBytecodeOffset(t.lineNumbers-1).toString(16).length+1;e=i=>`0x${t.lineNumberToBytecodeOffset(Math.min(t.lineNumbers,i)-1).toString(16).padStart(n,"0")}`}else this.prettyInternal&&(e=(t,s)=>{if(t<2||t>s.doc.lines)return String(t);const[n]=this.prettyToRawLocation(t-1),[i]=this.prettyToRawLocation(t-2);return n!==i?String(n+1):"-"});return e?[L({formatNumber:e}),Ct.of(e)]:[]}updateLineNumberFormatter(){this.textEditor.dispatch({effects:y.lineNumbers.reconfigure(this.getLineNumberFormatter())}),this.textEditor.shadowRoot?.querySelector(".cm-lineNumbers")?.setAttribute("jslog",`${M("line-numbers").track({click:!0})}`)}updatePrettyPrintState(){this.prettyToggle.setToggled(this.prettyInternal),this.textEditorInternal.classList.toggle("pretty-printed",this.prettyInternal),this.updateLineNumberFormatter()}prettyToRawLocation(e,t=0){return this.formattedMap?this.formattedMap.formattedToOriginal(e,t):[e,t]}rawToPrettyLocation(e,t){return this.formattedMap?this.formattedMap.originalToFormatted(e,t):[e,t]}hasLoadError(){return this.loadError}wasShown(){this.ensureContentLoaded(),this.wasShownOrLoaded()}willHide(){super.willHide(),this.clearPositionToReveal()}async toolbarItems(){return[this.prettyToggle,this.sourcePosition,this.progressToolbarItem]}get loaded(){return this.loadedInternal}get textEditor(){return this.textEditorInternal}get pretty(){return this.prettyInternal}get contentType(){return this.loadError?"":this.getContentType()}getContentType(){return""}async ensureContentLoaded(){this.contentRequested||(this.contentRequested=!0,await this.setContentDataOrError(this.lazyContent()),this.contentSet=!0)}async setContentDataOrError(e){const t=new Oe;t.setTitle(h(c.loading)),t.setTotalWork(100),this.progressToolbarItem.element.appendChild(t.element),t.setWorked(1);const s=await e;let n,i,r=!1;F.isError(s)?(n=s.error,i=s.error):s instanceof Ve?(i=X.of(s.lines),this.wasmDisassemblyInternal=s):s.isTextContent?(i=s.text,r=Ae(s.text),this.wasmDisassemblyInternal=null):(n=h(c.binaryContentError),i=null,this.wasmDisassemblyInternal=null),t.setWorked(100),t.done(),!(this.rawContent===i&&n===void 0)&&(this.rawContent=i,this.formattedMap=null,this.prettyToggle.setEnabled(!0),n?(this.loadError=!0,this.textEditor.state=this.placeholderEditorState(n),this.prettyToggle.setEnabled(!1)):this.shouldAutoPrettyPrint&&r?await this.setPretty(!0):await this.setContent(this.rawContent||""))}revealPosition(e,t){if(this.lineToScrollTo=null,this.selectionToSet=null,typeof e=="number"){let s=0,n=0;const{doc:i}=this.textEditor.state;if(e>i.length)s=i.lines-1;else if(e>=0){const r=i.lineAt(e);s=r.number-1,n=e-r.from}this.positionToReveal={to:{lineNumber:s,columnNumber:n},shouldHighlight:t}}else if("lineNumber"in e){const{lineNumber:s,columnNumber:n}=e;this.positionToReveal={to:{lineNumber:s,columnNumber:n??0},shouldHighlight:t}}else this.positionToReveal={...e,shouldHighlight:t};this.innerRevealPositionIfNeeded()}innerRevealPositionIfNeeded(){if(!this.positionToReveal||!this.loaded||!this.isShowing())return;const{from:e,to:t,shouldHighlight:s}=this.positionToReveal,n=this.uiLocationToEditorLocation(t.lineNumber,t.columnNumber),i=e?this.uiLocationToEditorLocation(e.lineNumber,e.columnNumber):void 0,{textEditor:r}=this;r.revealPosition(r.createSelection(n,i),s),this.positionToReveal=null}clearPositionToReveal(){this.positionToReveal=null}scrollToLine(e){this.clearPositionToReveal(),this.lineToScrollTo=e,this.innerScrollToLineIfNeeded()}innerScrollToLineIfNeeded(){if(this.lineToScrollTo!==null&&this.loaded&&this.isShowing()){const{textEditor:e}=this,t=e.toOffset({lineNumber:this.lineToScrollTo,columnNumber:0});e.dispatch({effects:b.scrollIntoView(t,{y:"start",yMargin:0})}),this.lineToScrollTo=null}}setSelection(e){this.selectionToSet=e,this.innerSetSelectionIfNeeded()}innerSetSelectionIfNeeded(){const e=this.selectionToSet;if(e&&this.loaded&&this.isShowing()){const{textEditor:t}=this;t.dispatch({selection:t.createSelection({lineNumber:e.startLine,columnNumber:e.startColumn},{lineNumber:e.endLine,columnNumber:e.endColumn})}),this.selectionToSet=null}}wasShownOrLoaded(){this.innerRevealPositionIfNeeded(),this.innerSetSelectionIfNeeded(),this.innerScrollToLineIfNeeded(),this.textEditor.shadowRoot?.querySelector(".cm-lineNumbers")?.setAttribute("jslog",`${M("line-numbers").track({click:!0})}`),this.textEditor.shadowRoot?.querySelector(".cm-foldGutter")?.setAttribute("jslog",`${M("fold")}`),this.textEditor.setAttribute("jslog",`${Ue().track({change:!0})}`)}onTextChanged(){const e=this.pretty;this.prettyInternal=!!(this.prettyBaseDoc&&this.textEditor.state.doc.eq(this.prettyBaseDoc)),this.prettyInternal!==e&&this.updatePrettyPrintState(),this.prettyToggle.setEnabled(this.isClean()),this.searchConfig&&this.searchableView&&this.performSearch(this.searchConfig,!1,!1)}isClean(){return this.textEditor.state.doc.eq(this.baseDoc)||this.prettyBaseDoc!==null&&this.textEditor.state.doc.eq(this.prettyBaseDoc)}contentCommitted(){this.baseDoc=this.textEditorInternal.state.doc,this.prettyBaseDoc=null,this.rawContent=this.textEditor.state.doc.toString(),this.formattedMap=null,this.prettyInternal&&(this.prettyInternal=!1,this.updatePrettyPrintState()),this.prettyToggle.setEnabled(!0)}async getLanguageSupport(e){let{contentType:t}=this;t==="text/x.vue"&&(e=typeof e=="string"?e:e.sliceString(0),e.trimStart().startsWith("<")||(t="text/javascript"));const s=await je(t);return s?[s,ke.javascriptLanguage.data.of({autocomplete:Be})]:[]}async updateLanguageMode(e){const t=await this.getLanguageSupport(e);this.textEditor.dispatch({effects:y.language.reconfigure(t)})}async setContent(e){this.muteChangeEventsForSetContent=!0;const{textEditor:t}=this,s=this.loadedInternal,n=t.editor.scrollDOM.scrollTop;this.loadedInternal=!0;const i=await this.getLanguageSupport(e),r=R.create({doc:e,extensions:[this.editorConfiguration(e),i,y.lineNumbers.of(this.getLineNumberFormatter()),y.editable.of(this.editable?[]:R.readOnly.of(!0))]});this.baseDoc=r.doc,t.state=r,s&&(t.editor.scrollDOM.scrollTop=n),this.wasShownOrLoaded(),this.delayedFindSearchMatches&&(this.delayedFindSearchMatches(),this.delayedFindSearchMatches=null),this.muteChangeEventsForSetContent=!1}setSearchableView(e){this.searchableView=e}doFindSearchMatches(e,t,s){this.currentSearchResultIndex=-1,this.searchRegex=e.toSearchRegex(!0),this.searchResults=this.collectRegexMatches(this.searchRegex),this.searchableView&&this.searchableView.updateSearchMatchesCount(this.searchResults.length);const n=this.textEditor;this.searchResults.length?t&&s?this.jumpToPreviousSearchResult():t?this.jumpToNextSearchResult():n.dispatch({effects:C.of(new E(this.searchRegex,null))}):n.state.field(I)&&n.dispatch({effects:C.of(null)})}performSearch(e,t,s){this.searchableView&&this.searchableView.updateSearchMatchesCount(0),this.resetSearch(),this.searchConfig=e,this.loaded?this.doFindSearchMatches(e,t,!!s):this.delayedFindSearchMatches=this.doFindSearchMatches.bind(this,e,t,!!s),this.ensureContentLoaded()}resetCurrentSearchResultIndex(){if(!this.searchResults.length)return;this.currentSearchResultIndex=-1,this.searchableView&&this.searchableView.updateCurrentMatchIndex(this.currentSearchResultIndex);const e=this.textEditor,t=e.state.field(I);t&&t.currentRange&&e.dispatch({effects:C.of(new E(t.regexp,null))})}resetSearch(){this.searchConfig=null,this.delayedFindSearchMatches=null,this.currentSearchResultIndex=-1,this.searchResults=[],this.searchRegex=null}onSearchCanceled(){const e=this.currentSearchResultIndex!==-1?this.searchResults[this.currentSearchResultIndex]:null;if(this.resetSearch(),!this.loaded)return;this.textEditor.dispatch({effects:C.of(null),selection:e?{anchor:e.from,head:e.to}:void 0,scrollIntoView:!0,userEvent:"select.search.cancel"})}jumpToLastSearchResult(){this.jumpToSearchResult(this.searchResults.length-1)}searchResultIndexForCurrentSelection(){return He(this.searchResults,this.textEditor.state.selection.main,(e,t)=>e.to-t.to)}jumpToNextSearchResult(){const e=this.searchResultIndexForCurrentSelection(),t=this.currentSearchResultIndex===-1?e:e+1;this.jumpToSearchResult(t)}jumpToPreviousSearchResult(){const e=this.searchResultIndexForCurrentSelection();this.jumpToSearchResult(e-1)}supportsCaseSensitiveSearch(){return!0}supportsRegexSearch(){return!0}jumpToSearchResult(e){if(!this.loaded||!this.searchResults.length||!this.searchRegex)return;this.currentSearchResultIndex=(e+this.searchResults.length)%this.searchResults.length,this.searchableView&&this.searchableView.updateCurrentMatchIndex(this.currentSearchResultIndex);const t=this.textEditor,s=this.searchResults[this.currentSearchResultIndex];t.dispatch({effects:C.of(new E(this.searchRegex,s)),selection:{anchor:s.from,head:s.to},scrollIntoView:!0,userEvent:"select.search"})}replaceSelectionWith(e,t){const s=this.searchResults[this.currentSearchResultIndex];if(!s)return;const n=this.searchRegex?.fromQuery?s.insertPlaceholders(t):t,i=this.textEditor,r=i.state.changes({from:s.from,to:s.to,insert:n});i.dispatch({changes:r,selection:{anchor:r.mapPos(i.state.selection.main.to,1)},userEvent:"input.replace"})}replaceAllWith(e,t){this.resetCurrentSearchResultIndex();const s=e.toSearchRegex(!0),n=this.collectRegexMatches(s);if(!n.length)return;const i=s.fromQuery,r=n.map(o=>({from:o.from,to:o.to,insert:i?o.insertPlaceholders(t):t}));this.textEditor.dispatch({changes:r,scrollIntoView:!0,userEvent:"input.replace.all"})}collectRegexMatches({regex:e}){const t=[];let s=0;for(const n of this.textEditor.state.doc.iterLines()){for(e.lastIndex=0;;){const i=e.exec(n);if(!i)break;if(i[0].length){const r=s+i.index;t.push(new Tt(r,r+i[0].length,i))}else e.lastIndex=i.index+1}s+=n.length+1}return t}canEditSource(){return this.editable}updateSourcePosition(){const{textEditor:e}=this,{state:t}=e,{selection:s}=t;if(this.displayedSelection?.eq(s))return;if(this.displayedSelection=s,s.ranges.length>1){this.sourcePosition.setText(h(c.dSelectionRegions,{PH1:s.ranges.length}));return}const{main:n}=t.selection;if(n.empty){const{lineNumber:i,columnNumber:r}=e.toLineColumn(n.head),o=this.prettyToRawLocation(i,r);if(this.wasmDisassemblyInternal){const l=this.wasmDisassemblyInternal,m=l.lineNumberToBytecodeOffset(l.lineNumbers-1).toString(16).length,d=l.lineNumberToBytecodeOffset(o[0]);this.sourcePosition.setText(h(c.bytecodePositionXs,{PH1:d.toString(16).padStart(m,"0")}))}else this.sourcePosition.setText(h(c.lineSColumnS,{PH1:o[0]+1,PH2:o[1]+1}))}else{const i=t.doc.lineAt(n.from),r=t.doc.lineAt(n.to);i.number===r.number?this.sourcePosition.setText(h(c.dCharactersSelected,{PH1:n.to-n.from})):this.sourcePosition.setText(h(c.dLinesDCharactersSelected,{PH1:r.number-i.number+1,PH2:n.to-n.from}))}}onContextMenu(e){e.consume(!0);const t=new j(e),{state:s}=this.textEditor,n=s.selection.main.from,i=s.doc.lineAt(n);return this.populateTextAreaContextMenu(t,i.number-1,n-i.from),t.appendApplicableItems(this),t.show(),!0}populateTextAreaContextMenu(e,t,s){}onLineGutterContextMenu(e,t){t.consume(!0);const s=new j(t),n=this.textEditor.state.doc.lineAt(e).number-1;return this.populateLineGutterContextMenu(s,n),s.appendApplicableItems(this),s.show(),!0}populateLineGutterContextMenu(e,t){}focus(){this.textEditor.focus()}}class Tt{from;to;match;constructor(e,t,s){this.from=e,this.to=t,this.match=s}insertPlaceholders(e){return e.replace(/\$(\$|&|\d+|<[^>]+>)/g,(t,s)=>s==="$"?"$":s==="&"?this.match[0]:s[0]==="<"?this.match.groups&&this.match.groups[s.slice(1,s.length-1)]||"":this.match[Number.parseInt(s,10)]||"")}}class Et{static async show(){const e=new ze("self-xss-warning");e.setMaxContentSize(new We(504,340)),e.setSizeBehavior("SetExactWidthMaxHeight"),e.setDimmed(!0);const s=$e(e.contentElement,{cssFile:yt,delegatesFocus:void 0}).createChild("div","widget"),n=await new Promise(i=>{const r=s.createChild("div","dialog-close-button","dt-close-button");r.setTabbable(!0),self.onInvokeElement(r,d=>{e.hide(),d.consume(!0),i(!1)}),s.createChild("div","title").textContent=h(c.doYouTrustThisCode),s.createChild("div","message").textContent=h(c.doNotPaste,{PH1:h(c.allowPasting)});const o=qe("text-input","text","allow-pasting");o.placeholder=h(c.typeAllowPasting,{PH1:h(c.allowPasting)}),s.appendChild(o);const l=s.createChild("div","button"),u=_(h(c.cancel),()=>i(!1),{jslogContext:"cancel"});l.appendChild(u);const m=_(h(c.allow),()=>{i(o.value===h(c.allowPasting))},{jslogContext:"confirm",variant:"primary"});m.disabled=!0,l.appendChild(m),o.addEventListener("input",()=>{m.disabled=!o.value},!1),o.addEventListener("paste",d=>d.preventDefault()),o.addEventListener("drop",d=>d.preventDefault()),e.setOutsideClickCallback(d=>{d.consume(),i(!1)}),e.show(),ae.actionTaken(le.SelfXssWarningDialogShown)});return e.hide(),n}}const y={editable:new O,language:new O,lineNumbers:new O};class E{regexp;currentRange;constructor(e,t){this.regexp=e,this.currentRange=t}map(e){return e.empty||!this.currentRange?this:new E(this.regexp,{from:e.mapPos(this.currentRange.from),to:e.mapPos(this.currentRange.to)})}static eq(e,t){return!!(e===t||e&&t&&e.currentRange?.from===t.currentRange?.from&&e.currentRange?.to===t.currentRange?.to&&e.regexp.regex.source===t.regexp.regex.source&&e.regexp.regex.flags===t.regexp.regex.flags)}}const C=ie.define({map:(a,e)=>a&&a.map(e)}),I=re.define({create(){return null},update(a,e){return e.effects.reduce((t,s)=>s.is(C)?s.value:t,a&&a.map(e.changes))}}),It=H.mark({class:"cm-searchMatch"}),Rt=H.mark({class:"cm-searchMatch cm-searchMatch-selected"}),Pt=xe.fromClass(class{decorations;constructor(a){this.decorations=this.computeDecorations(a)}update(a){const e=a.state.field(I);(!E.eq(e,a.startState.field(I))||e&&(a.viewportChanged||a.docChanged))&&(this.decorations=this.computeDecorations(a.view))}computeDecorations(a){const e=a.state.field(I);if(!e)return H.none;const t=new Xe,{doc:s}=a.state;for(const{from:n,to:i}of a.visibleRanges){let r=n;for(const o of s.iterRange(n,i)){if(o!==`
`)for(e.regexp.regex.lastIndex=0;;){const l=e.regexp.regex.exec(o);if(!l)break;if(l[0].length){const u=r+l.index,m=u+l[0].length,d=e.currentRange&&e.currentRange.from===u&&e.currentRange.to===m;t.add(u,m,d?Rt:It)}else e.regexp.regex.lastIndex=l.index+1}r+=o.length}}return t.finish()}},{decorations:a=>a.decorations}),me=new class extends _e{elementClass="cm-nonBreakableLine"},Lt=ie.define(),W=re.define({create(){return oe.empty},update(a,e){return e.effects.reduce((t,s)=>s.is(Lt)?t.update({add:s.value.map(n=>me.range(n))}):t,a.map(e.changes))},provide:a=>ye.from(a)});function Kt(a,e){const t=a.field(W);if(!t.size)return!0;let s=!1;return t.between(e.from,e.from,()=>{s=!0}),!s}function Nt(a){return W.init(e=>{const t=[];for(const s of a.nonBreakableLineNumbers())s<e.doc.lines&&t.push(me.range(e.doc.line(s+1).from));return oe.of(t)})}const Dt=b.theme({"&.cm-editor":{height:"100%"},".cm-scroller":{overflow:"auto"},".cm-lineNumbers .cm-gutterElement.cm-nonBreakableLine":{color:"var(--sys-color-state-disabled) !important"},".cm-searchMatch":{border:"1px solid var(--sys-color-outline)",borderRadius:"3px",margin:"0 -1px","&.cm-searchMatch-selected":{borderRadius:"1px",backgroundColor:"var(--sys-color-yellow-container)",borderColor:"var(--sys-color-yellow-outline)","&, & *":{color:"var(--sys-color-on-surface) !important"}}},":host-context(.pretty-printed) & .cm-lineNumbers .cm-gutterElement":{color:"var(--sys-color-primary)"}}),fe={find:"Find"},Ft=S("ui/legacy/components/source_frame/ResourceSourceFrame.ts",fe),Mt=x.bind(void 0,Ft);class ge extends vt{resourceInternal;#e;constructor(e,t,s){const n=Ye(e),i=n?()=>e.requestStreamingContent().then(Ze):()=>e.requestContentData();super(i,s),this.#e=t,this.resourceInternal=e,n&&e.requestStreamingContent().then(r=>{Je(r)||r.addEventListener("ChunkAdded",()=>{this.setContentDataOrError(Promise.resolve(r.content()))})})}static createSearchableView(e,t){return new Ot(e,t)}getContentType(){return this.#e}get resource(){return this.resourceInternal}populateTextAreaContextMenu(e,t,s){super.populateTextAreaContextMenu(e,t,s),e.appendApplicableItems(this.resourceInternal)}}class Ot extends ce{sourceFrame;constructor(e,t){super(!0),this.registerRequiredCSS(xt);const s=he.simplifyContentType(t),n=new ge(e,s);this.sourceFrame=n;const i=St.includes(s);n.setCanPrettyPrint(i,!0);const r=new N(n,n);r.element.classList.add("searchable-view"),r.setPlaceholder(Mt(fe.find)),n.show(r.element),n.setSearchableView(r),r.show(this.contentElement);const o=new Ge("toolbar",this.contentElement);n.toolbarItems().then(l=>{l.map(u=>o.appendToolbarItem(u))})}async revealPosition(e){this.sourceFrame.revealPosition(e,!0)}}const Vt={cssContent:`/*
 * Copyright (c) 2014 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

.font-view {
  font-size: 60px;
  white-space: pre-wrap;
  word-wrap: break-word;
  text-align: center;
  padding: 15px;
}

/*# sourceURL=fontView.css */
`},k={font:"Font",previewOfFontFromS:"Preview of font from {PH1}"},At=S("ui/legacy/components/source_frame/FontView.ts",k),K=x.bind(void 0,At);class Ut extends z{url;contentProvider;mimeTypeLabel;fontPreviewElement;dummyElement;fontStyleElement;inResize;constructor(e,t){super(K(k.font)),this.registerRequiredCSS(Vt),this.element.classList.add("font-view"),this.element.setAttribute("jslog",`${ue("font-view")}`),this.url=t.contentURL(),Qe(this.element,K(k.previewOfFontFromS,{PH1:this.url})),this.contentProvider=t,this.mimeTypeLabel=new v(e)}async toolbarItems(){return[this.mimeTypeLabel]}onFontContentLoaded(e,t){const s=F.isError(t)?this.url:t.asDataUrl();this.fontStyleElement&&(this.fontStyleElement.textContent=Ke('@font-face { font-family: "%s"; src: url(%s); }',e,s),this.updateFontPreviewSize())}createContentIfNeeded(){if(this.fontPreviewElement)return;const e=`WebInspectorFontPreview${++jt}`;this.fontStyleElement=document.createElement("style"),this.contentProvider.requestContentData().then(s=>{this.onFontContentLoaded(e,s)}),this.element.appendChild(this.fontStyleElement);const t=document.createElement("div");for(let s=0;s<ee.length;++s)s>0&&t.createChild("br"),et(t,ee[s]);this.fontPreviewElement=t.cloneNode(!0),this.fontPreviewElement&&(tt(this.fontPreviewElement),this.fontPreviewElement.style.overflow="hidden",this.fontPreviewElement.style.setProperty("font-family",e),this.fontPreviewElement.style.setProperty("visibility","hidden"),this.dummyElement=t,this.dummyElement.style.visibility="hidden",this.dummyElement.style.zIndex="-1",this.dummyElement.style.display="inline",this.dummyElement.style.position="absolute",this.dummyElement.style.setProperty("font-family",e),this.dummyElement.style.setProperty("font-size",te+"px"),this.element.appendChild(this.fontPreviewElement))}wasShown(){this.createContentIfNeeded(),this.updateFontPreviewSize()}onResize(){if(!this.inResize){this.inResize=!0;try{this.updateFontPreviewSize()}finally{this.inResize=null}}}measureElement(){if(!this.dummyElement)throw new Error("No font preview loaded");this.element.appendChild(this.dummyElement);const e={width:this.dummyElement.offsetWidth,height:this.dummyElement.offsetHeight};return this.element.removeChild(this.dummyElement),e}updateFontPreviewSize(){if(!this.fontPreviewElement||!this.isShowing())return;this.fontPreviewElement.style.removeProperty("visibility");const e=this.measureElement(),t=e.height,s=e.width,n=this.element.offsetWidth-50,i=this.element.offsetHeight-30;if(!t||!s||!n||!i){this.fontPreviewElement.style.removeProperty("font-size");return}const r=n/s,o=i/t,l=Math.floor(te*Math.min(r,o))-2;this.fontPreviewElement.style.setProperty("font-size",l+"px",void 0)}}let jt=0;const ee=["ABCDEFGHIJKLM","NOPQRSTUVWXYZ","abcdefghijklm","nopqrstuvwxyz","1234567890"],te=50,kt={cssContent:`/*
 * Copyright (c) 2014 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

.image-view {
  overflow: auto;
}

.image-view > .image {
  padding: 20px 20px 10px;
  text-align: center;
}

.image-view img.resource-image-view {
  max-width: 100%;
  max-height: 1000px;
  background-image: var(--image-file-checker);
  box-shadow: 0 5px 10px var(--sys-color-outline);
  user-select: text;
  -webkit-user-drag: auto;
}

/*# sourceURL=imageView.css */
`},f={image:"Image",dropImageFileHere:"Drop image file here",imageFromS:"Image from {PH1}",dD:"{PH1} × {PH2}",copyImageUrl:"Copy image URL",copyImageAsDataUri:"Copy image as data URI",openImageInNewTab:"Open image in new tab",saveImageAs:"Save image as...",download:"download"},Bt=S("ui/legacy/components/source_frame/ImageView.ts",f),g=x.bind(void 0,Bt);class Ht extends z{url;parsedURL;mimeType;contentProvider;uiSourceCode;sizeLabel;dimensionsLabel;aspectRatioLabel;mimeTypeLabel;container;imagePreviewElement;cachedContent;constructor(e,t){super(g(f.image)),this.registerRequiredCSS(kt),this.element.tabIndex=-1,this.element.classList.add("image-view"),this.element.setAttribute("jslog",`${ue("image-view")}`),this.url=t.contentURL(),this.parsedURL=new J(this.url),this.mimeType=e,this.contentProvider=t,this.uiSourceCode=t instanceof st?t:null,this.uiSourceCode&&(this.uiSourceCode.addEventListener(G.WorkingCopyCommitted,this.workingCopyCommitted,this),new pt(this.element,[Q.ImageFile,Q.URI],g(f.dropImageFileHere),this.handleDrop.bind(this))),this.sizeLabel=new v,this.dimensionsLabel=new v,this.aspectRatioLabel=new v,this.mimeTypeLabel=new v(e),this.container=this.element.createChild("div","image"),this.imagePreviewElement=this.container.createChild("img","resource-image-view"),this.imagePreviewElement.addEventListener("contextmenu",this.contextMenu.bind(this),!0)}async toolbarItems(){return await this.updateContentIfNeeded(),[this.sizeLabel,new V,this.dimensionsLabel,new V,this.aspectRatioLabel,new V,this.mimeTypeLabel]}wasShown(){this.updateContentIfNeeded()}disposeView(){this.uiSourceCode&&this.uiSourceCode.removeEventListener(G.WorkingCopyCommitted,this.workingCopyCommitted,this)}workingCopyCommitted(){this.updateContentIfNeeded()}async updateContentIfNeeded(){const e=await this.contentProvider.requestContentData();if(F.isError(e)||this.cachedContent?.contentEqualTo(e))return;this.cachedContent=e;const t=e.asDataUrl()??this.url,s=new Promise(i=>{this.imagePreviewElement.onload=i});this.imagePreviewElement.src=t,this.imagePreviewElement.alt=g(f.imageFromS,{PH1:this.url});const n=e.isTextContent?e.text.length:nt(e.base64);this.sizeLabel.setText(it(n)),await s,this.dimensionsLabel.setText(g(f.dD,{PH1:this.imagePreviewElement.naturalWidth,PH2:this.imagePreviewElement.naturalHeight})),this.aspectRatioLabel.setText(rt(this.imagePreviewElement.naturalWidth,this.imagePreviewElement.naturalHeight))}contextMenu(e){const t=new j(e),s=new J(this.imagePreviewElement.src);this.parsedURL.isDataURL()||t.clipboardSection().appendItem(g(f.copyImageUrl),this.copyImageURL.bind(this),{jslogContext:"image-view.copy-image-url"}),s.isDataURL()&&t.clipboardSection().appendItem(g(f.copyImageAsDataUri),this.copyImageAsDataURL.bind(this),{jslogContext:"image-view.copy-image-as-data-url"}),t.clipboardSection().appendItem(g(f.openImageInNewTab),this.openInNewTab.bind(this),{jslogContext:"image-view.open-in-new-tab"}),t.clipboardSection().appendItem(g(f.saveImageAs),this.saveImage.bind(this),{jslogContext:"image-view.save-image"}),t.show()}copyImageAsDataURL(){A.copyText(this.imagePreviewElement.src)}copyImageURL(){A.copyText(this.url)}async saveImage(){const e=this.cachedContent?.asDataUrl();if(!e)return;const t=document.createElement("a");t.href=e,t.download=this.parsedURL.isDataURL()?g(f.download):decodeURIComponent(this.parsedURL.displayName),t.click(),t.remove()}openInNewTab(){A.openInNewTab(this.url)}async handleDrop(e){const t=e.items;if(!t.length||t[0].kind!=="file")return;const s=t[0].getAsFile();if(!s)return;const n=!s.name.endsWith(".svg");(r=>{const o=new FileReader;o.onloadend=()=>{let l;try{l=o.result}catch(u){l=null,console.error("Can't read file: "+u)}typeof l!="string"||!this.uiSourceCode||this.uiSourceCode.setContent(n?btoa(l):l,n)},n?o.readAsBinaryString(r):o.readAsText(r)})(s)}}const zt={cssContent:`/*
 * Copyright 2021 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

.json-view {
  padding: 2px 6px;
  overflow: auto;
}

/*# sourceURL=jsonView.css */
`},B={find:"Find"},Wt=S("ui/legacy/components/source_frame/JSONView.ts",B),se=x.bind(void 0,Wt);class p extends ce{initialized;parsedJSON;startCollapsed;searchableView;treeOutline;currentSearchFocusIndex;currentSearchTreeElements;searchRegex;constructor(e,t){super(),this.initialized=!1,this.registerRequiredCSS(zt),this.parsedJSON=e,this.startCollapsed=!!t,this.element.classList.add("json-view"),this.element.setAttribute("jslog",`${ot("json-view")}`),this.currentSearchFocusIndex=0,this.currentSearchTreeElements=[],this.searchRegex=null}static async createView(e){const t=await p.parseJSON(e);if(!t||typeof t.data!="object")return null;const s=new p(t),n=new N(s,null);return n.setPlaceholder(se(B.find)),s.searchableView=n,s.show(n.element),n}static createViewSync(e){const t=new p(new ne(e,"","")),s=new N(t,null);return s.setPlaceholder(se(B.find)),t.searchableView=s,t.show(s.element),t.element.tabIndex=0,s}static parseJSON(e){let t=null;if(e&&(t=p.extractJSON(e)),!t)return Promise.resolve(null);try{const s=JSON.parse(t.data);if(!s)return Promise.resolve(null);t.data=s}catch{t=null}return Promise.resolve(t)}static extractJSON(e){if(e.startsWith("<"))return null;let t=p.findBrackets(e,"{","}");const s=p.findBrackets(e,"[","]");if(t=s.length>t.length?s:t,t.length===-1||e.length-t.length>80)return null;const n=e.substring(0,t.start),i=e.substring(t.end+1);return e=e.substring(t.start,t.end+1),i.trim().length&&!(i.trim().startsWith(")")&&n.trim().endsWith("("))?null:new ne(e,n,i)}static findBrackets(e,t,s){const n=e.indexOf(t),i=e.lastIndexOf(s);let r=i-n-1;return(n===-1||i===-1||i<n)&&(r=-1),{start:n,end:i,length:r}}wasShown(){this.initialize()}initialize(){if(this.initialized)return;this.initialized=!0;const e=at.fromLocalObject(this.parsedJSON.data),t=this.parsedJSON.prefix+e.description+this.parsedJSON.suffix;this.treeOutline=new lt(e,t,void 0,!0),this.treeOutline.enableContextMenu(),this.treeOutline.setEditable(!1),this.startCollapsed||this.treeOutline.expand(),this.element.appendChild(this.treeOutline.element);const s=this.treeOutline.firstChild();s&&s.select(!0,!1)}jumpToMatch(e){if(!this.searchRegex)return;const t=this.currentSearchTreeElements[this.currentSearchFocusIndex];t&&t.setSearchRegex(this.searchRegex);const s=this.currentSearchTreeElements[e];s?(this.updateSearchIndex(e),s.setSearchRegex(this.searchRegex,de),s.reveal()):this.updateSearchIndex(0)}updateSearchCount(e){this.searchableView&&this.searchableView.updateSearchMatchesCount(e)}updateSearchIndex(e){this.currentSearchFocusIndex=e,this.searchableView&&this.searchableView.updateCurrentMatchIndex(e)}onSearchCanceled(){this.searchRegex=null,this.currentSearchTreeElements=[];let e;for(e=this.treeOutline.rootElement();e;e=e.traverseNextTreeElement(!1))e instanceof Y&&e.revertHighlightChanges();this.updateSearchCount(0),this.updateSearchIndex(0)}performSearch(e,t,s){let n=this.currentSearchFocusIndex;const i=this.currentSearchTreeElements[n];this.onSearchCanceled(),this.searchRegex=e.toSearchRegex(!0).regex;let r;for(r=this.treeOutline.rootElement();r;r=r.traverseNextTreeElement(!1)){if(!(r instanceof Y))continue;const o=r.setSearchRegex(this.searchRegex);if(o&&this.currentSearchTreeElements.push(r),i===r){const l=this.currentSearchTreeElements.length-1;o||s?n=l:n=l+1}}if(this.updateSearchCount(this.currentSearchTreeElements.length),!this.currentSearchTreeElements.length){this.updateSearchIndex(-1);return}n=T(n,this.currentSearchTreeElements.length),this.jumpToMatch(n)}jumpToNextSearchResult(){if(!this.currentSearchTreeElements.length)return;const e=T(this.currentSearchFocusIndex+1,this.currentSearchTreeElements.length);this.jumpToMatch(e)}jumpToPreviousSearchResult(){if(!this.currentSearchTreeElements.length)return;const e=T(this.currentSearchFocusIndex-1,this.currentSearchTreeElements.length);this.jumpToMatch(e)}supportsCaseSensitiveSearch(){return!0}supportsRegexSearch(){return!0}}class ne{data;prefix;suffix;constructor(e,t,s){this.data=e,this.prefix=t,this.suffix=s}}const $t={cssContent:`/*
 * Copyright 2016 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

.tree-outline ol {
  list-style: none;
  padding: 0;
  margin: 0;
  padding-inline-start: 16px;
}

ol.tree-outline {
  padding-inline-start: 0;
}

.tree-outline li {
  min-height: 12px;
}

.tree-outline li.shadow-xml-view-close-tag {
  margin-left: -16px;
}

.shadow-xml-view-tag {
  color: var(--sys-color-purple);
}

.shadow-xml-view-comment {
  color: var(--sys-color-green);
}

.shadow-xml-view-processing-instruction {
  color: var(--sys-color-green);
}

.shadow-xml-view-attribute-name {
  color: var(--sys-color-orange);
}

.shadow-xml-view-attribute-value {
  color: var(--sys-color-blue);
}

.shadow-xml-view-text {
  color: var(--sys-color-on-surface);
  white-space: pre;
}

.shadow-xml-view-cdata {
  color: var(--sys-color-on-surface);
}

/*# sourceURL=xmlTree.css */
`},qt={cssContent:`/*
 * Copyright (c) 2014 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

.shadow-xml-view {
  user-select: text;
  overflow: auto;
  padding: 2px 4px;
}

/*# sourceURL=xmlView.css */
`},pe={find:"Find"},Xt=S("ui/legacy/components/source_frame/XMLView.ts",pe),_t=x.bind(void 0,Xt);class D extends ct{treeOutline;searchableView;currentSearchFocusIndex;currentSearchTreeElements;searchConfig;constructor(e){super(!0),this.registerRequiredCSS(qt),this.contentElement.classList.add("shadow-xml-view","source-code"),this.treeOutline=new ht,this.treeOutline.registerRequiredCSS($t),this.contentElement.appendChild(this.treeOutline.element),this.currentSearchFocusIndex=0,this.currentSearchTreeElements=[],w.populate(this.treeOutline,e,this);const t=this.treeOutline.firstChild();t&&t.select(!0,!1)}static createSearchableView(e){const t=new D(e),s=new N(t,null);return s.setPlaceholder(_t(pe.find)),t.searchableView=s,t.show(s.element),s}static parseXML(e,t){let s;try{switch(t){case"application/xhtml+xml":case"application/xml":case"image/svg+xml":case"text/html":case"text/xml":s=new DOMParser().parseFromString(e,t)}}catch{return null}return!s||s.body?null:s}jumpToMatch(e,t){if(!this.searchConfig)return;const{regex:s}=this.searchConfig.toSearchRegex(!0),n=this.currentSearchTreeElements[this.currentSearchFocusIndex];n&&n.setSearchRegex(s);const i=this.currentSearchTreeElements[e];i?(this.updateSearchIndex(e),t&&i.reveal(!0),i.setSearchRegex(s,de)):this.updateSearchIndex(0)}updateSearchCount(e){this.searchableView&&this.searchableView.updateSearchMatchesCount(e)}updateSearchIndex(e){this.currentSearchFocusIndex=e,this.searchableView&&this.searchableView.updateCurrentMatchIndex(e)}innerPerformSearch(e,t){if(!this.searchConfig)return;let s=this.currentSearchFocusIndex;const n=this.currentSearchTreeElements[s];this.innerSearchCanceled(),this.currentSearchTreeElements=[];const{regex:i}=this.searchConfig.toSearchRegex(!0);for(let r=this.treeOutline.rootElement();r;r=r.traverseNextTreeElement(!1)){if(!(r instanceof w))continue;const o=r.setSearchRegex(i);if(o&&this.currentSearchTreeElements.push(r),n===r){const l=this.currentSearchTreeElements.length-1;o||t?s=l:s=l+1}}if(this.updateSearchCount(this.currentSearchTreeElements.length),!this.currentSearchTreeElements.length){this.updateSearchIndex(0);return}s=T(s,this.currentSearchTreeElements.length),this.jumpToMatch(s,e)}innerSearchCanceled(){for(let e=this.treeOutline.rootElement();e;e=e.traverseNextTreeElement(!1))e instanceof w&&e.revertHighlightChanges();this.updateSearchCount(0),this.updateSearchIndex(0)}onSearchCanceled(){this.searchConfig=null,this.currentSearchTreeElements=[],this.innerSearchCanceled()}performSearch(e,t,s){this.searchConfig=e,this.innerPerformSearch(t,s)}jumpToNextSearchResult(){if(!this.currentSearchTreeElements.length)return;const e=T(this.currentSearchFocusIndex+1,this.currentSearchTreeElements.length);this.jumpToMatch(e,!0)}jumpToPreviousSearchResult(){if(!this.currentSearchTreeElements.length)return;const e=T(this.currentSearchFocusIndex-1,this.currentSearchTreeElements.length);this.jumpToMatch(e,!0)}supportsCaseSensitiveSearch(){return!0}supportsRegexSearch(){return!0}}class w extends ut{node;closeTag;highlightChanges;xmlView;constructor(e,t,s){super("",!t&&"childElementCount"in e&&!!e.childElementCount),this.node=e,this.closeTag=t,this.selectable=!0,this.highlightChanges=[],this.xmlView=s,this.updateTitle()}static populate(e,t,s){if(!(t instanceof Node))return;let n=t.firstChild;for(;n;){const i=n;n=n.nextSibling;const r=i.nodeType;r===3&&i.nodeValue&&i.nodeValue.match(/\s+/)||r!==1&&r!==3&&r!==4&&r!==7&&r!==8||e.appendChild(new w(i,!1,s))}}setSearchRegex(e,t){if(this.revertHighlightChanges(),!e||this.closeTag&&this.parent&&!this.parent.expanded)return!1;e.lastIndex=0;let s=gt;if(t&&(s+=" "+t),!this.listItemElement.textContent)return!1;const n=this.listItemElement.textContent.replace(/\xA0/g," ");let i=e.exec(n);const r=[];for(;i;)r.push(new dt(i.index,i[0].length)),i=e.exec(n);return r.length&&mt(this.listItemElement,r,s,this.highlightChanges),!!this.highlightChanges.length}revertHighlightChanges(){ft(this.highlightChanges),this.highlightChanges=[]}updateTitle(){const e=this.node;if("nodeType"in e)switch(e.nodeType){case 1:{if(e instanceof Element){const t=e.tagName;if(this.closeTag){this.setTitle(["</"+t+">","shadow-xml-view-tag"]);return}const s=["<"+t,"shadow-xml-view-tag"],n=e.attributes;for(let i=0;i<n.length;++i){const r=n.item(i);if(!r)return;s.push(" ","shadow-xml-view-tag",r.name,"shadow-xml-view-attribute-name",'="',"shadow-xml-view-tag",r.value,"shadow-xml-view-attribute-value",'"',"shadow-xml-view-tag")}this.expanded||(e.childElementCount?s.push(">","shadow-xml-view-tag","…","shadow-xml-view-comment","</"+t,"shadow-xml-view-tag"):e.textContent?s.push(">","shadow-xml-view-tag",e.textContent,"shadow-xml-view-text","</"+t,"shadow-xml-view-tag"):s.push(" /","shadow-xml-view-tag")),s.push(">","shadow-xml-view-tag"),this.setTitle(s);return}return}case 3:{e.nodeValue&&this.setTitle([e.nodeValue,"shadow-xml-view-text"]);return}case 4:{e.nodeValue&&this.setTitle(["<![CDATA[","shadow-xml-view-cdata",e.nodeValue,"shadow-xml-view-text","]]>","shadow-xml-view-cdata"]);return}case 7:{e.nodeValue&&this.setTitle(["<?"+e.nodeName+" "+e.nodeValue+"?>","shadow-xml-view-processing-instruction"]);return}case 8:{this.setTitle(["<!--"+e.nodeValue+"-->","shadow-xml-view-comment"]);return}}}setTitle(e){const t=document.createDocumentFragment();for(let s=0;s<e.length;s+=2)t.createChild("span",e[s+1]).textContent=e[s];this.title=t,this.xmlView.innerPerformSearch(!1,!1)}onattach(){this.listItemElement.classList.toggle("shadow-xml-view-close-tag",this.closeTag)}onexpand(){this.updateTitle()}oncollapse(){this.updateTitle()}async onpopulate(){w.populate(this,this.node,this.xmlView),this.appendChild(new w(this.node,!0,this.xmlView))}}const we={nothingToPreview:"Nothing to preview"},Jt=S("ui/legacy/components/source_frame/PreviewFactory.ts",we),Gt=x.bind(void 0,Jt);class es{static async createPreview(e,t){let s=he.fromMimeType(t);switch(s===U.Other&&(s=e.contentType()),s){case U.Image:return new Ht(t,e);case U.Font:return new Ut(t,e)}const n=await e.requestContentData();if(F.isError(n))return new Z(n.error);if(!n.isTextContent)return null;if(!n.text)return new Z(Gt(we.nothingToPreview));const i=D.parseXML(n.text,n.mimeType);if(i)return D.createSearchableView(i);const r=await p.createView(n.text);if(r)return r;const o=t.replace(/;.*/,"")||e.contentType().canonicalMimeType();return ge.createSearchableView(e,o)}}export{St as F,Ht as I,p as J,Ct as L,ne as P,ge as R,vt as S,Ut as a,Lt as b,es as c,Ot as d,Kt as i};
//# sourceMappingURL=PreviewFactory-7rWtg079.js.map
