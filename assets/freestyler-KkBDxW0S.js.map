{"version":3,"file":"freestyler-KkBDxW0S.js","sources":["../../panels/freestyler/AiAgent.js","../../panels/freestyler/ChangeManager.js","../../panels/freestyler/DrJonesFileAgent.js","../../panels/freestyler/DrJonesNetworkAgent.js","../../panels/freestyler/DrJonesPerformanceAgent.js","../../panels/freestyler/components/provideFeedback.css.js","../../panels/freestyler/components/ProvideFeedback.js","../../panels/freestyler/components/freestylerChatUi.css.js","../../panels/freestyler/components/FreestylerChatUi.js","../../panels/freestyler/ExtensionScope.js","../../panels/freestyler/FreestylerEvaluateAction.js","../../panels/freestyler/FreestylerAgent.js","../../panels/freestyler/freestylerPanel.css.js","../../panels/freestyler/FreestylerPanel.js"],"sourcesContent":["// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\nimport * as Host from '../../core/host/host.js';\nexport var ResponseType;\n(function (ResponseType) {\n    ResponseType[\"CONTEXT\"] = \"context\";\n    ResponseType[\"TITLE\"] = \"title\";\n    ResponseType[\"THOUGHT\"] = \"thought\";\n    ResponseType[\"ACTION\"] = \"action\";\n    ResponseType[\"SIDE_EFFECT\"] = \"side-effect\";\n    ResponseType[\"ANSWER\"] = \"answer\";\n    ResponseType[\"ERROR\"] = \"error\";\n    ResponseType[\"QUERYING\"] = \"querying\";\n})(ResponseType || (ResponseType = {}));\nconst MAX_STEP = 10;\nexport class AiAgent {\n    static validTemperature(temperature) {\n        return typeof temperature === 'number' && temperature >= 0 ? temperature : undefined;\n    }\n    #sessionId = crypto.randomUUID();\n    #aidaClient;\n    #serverSideLoggingEnabled;\n    /**\n     * Mapping between the unique request id and\n     * the history chuck it created\n     */\n    #chatHistory = new Map();\n    constructor(opts) {\n        this.#aidaClient = opts.aidaClient;\n        this.#serverSideLoggingEnabled = opts.serverSideLoggingEnabled ?? false;\n    }\n    get historyEntry() {\n        return [...this.#chatHistory.values()].flat();\n    }\n    get chatHistoryForTesting() {\n        return this.historyEntry;\n    }\n    set chatHistoryForTesting(history) {\n        this.#chatHistory = history;\n    }\n    removeHistoryRun(id) {\n        this.#chatHistory.delete(id);\n    }\n    addToHistory(options) {\n        const response = options.response;\n        if ('answer' in response) {\n            this.#storeHistoryEntries({\n                id: options.id,\n                query: options.query,\n                output: response.answer,\n            });\n            return;\n        }\n        const { title, thought, action, } = response;\n        if (thought) {\n            this.#storeHistoryEntries({\n                id: options.id,\n                query: options.query,\n                output: `THOUGHT: ${thought}\nTITLE: ${title}\nACTION\n${action}\nSTOP`,\n            });\n        }\n        else {\n            this.#storeHistoryEntries({\n                id: options.id,\n                query: options.query,\n                output: `ACTION\n${action}\nSTOP`,\n            });\n        }\n    }\n    #storeHistoryEntries({ id, query, output, }) {\n        const currentRunEntries = this.#chatHistory.get(id) ?? [];\n        this.#chatHistory.set(id, [\n            ...currentRunEntries,\n            {\n                text: query,\n                entity: Host.AidaClient.Entity.USER,\n            },\n            {\n                text: output,\n                entity: Host.AidaClient.Entity.SYSTEM,\n            },\n        ]);\n    }\n    #structuredLog = [];\n    async aidaFetch(input, options) {\n        const request = this.buildRequest({\n            input,\n        });\n        let rawResponse = undefined;\n        let response = '';\n        let rpcId;\n        for await (rawResponse of this.#aidaClient.fetch(request, options)) {\n            response = rawResponse.explanation;\n            rpcId = rawResponse.metadata.rpcGlobalId ?? rpcId;\n            if (rawResponse.metadata.attributionMetadata?.some(meta => meta.attributionAction === Host.AidaClient.RecitationAction.BLOCK)) {\n                throw new Error('Attribution action does not allow providing the response');\n            }\n        }\n        debugLog({\n            request,\n            response: rawResponse,\n        });\n        this.#structuredLog.push({\n            request: structuredClone(request),\n            response,\n            rawResponse,\n        });\n        localStorage.setItem('freestylerStructuredLog', JSON.stringify(this.#structuredLog));\n        return { response, rpcId };\n    }\n    buildRequest(opts) {\n        const request = {\n            input: opts.input,\n            preamble: this.preamble,\n            // eslint-disable-next-line @typescript-eslint/naming-convention\n            chat_history: this.#chatHistory.size ? this.historyEntry : undefined,\n            client: Host.AidaClient.CLIENT_NAME,\n            options: this.options,\n            metadata: {\n                disable_user_content_logging: !(this.#serverSideLoggingEnabled ?? false),\n                string_session_id: this.#sessionId,\n                user_tier: Host.AidaClient.convertToUserTierEnum(this.userTier),\n            },\n            // eslint-disable-next-line @typescript-eslint/naming-convention\n            functionality_type: Host.AidaClient.FunctionalityType.CHAT,\n            // eslint-disable-next-line @typescript-eslint/naming-convention\n            client_feature: this.clientFeature,\n        };\n        return request;\n    }\n    handleAction(_action, _rpcId) {\n        throw new Error('Unexpected action found');\n    }\n    async enhanceQuery(query) {\n        return query;\n    }\n    parseResponse(response) {\n        return {\n            answer: response,\n        };\n    }\n    #runId = 0;\n    async *run(query, options) {\n        yield* this.handleContextDetails(options.selected);\n        query = await this.enhanceQuery(query, options.selected);\n        const currentRunId = ++this.#runId;\n        for (let i = 0; i < MAX_STEP; i++) {\n            yield {\n                type: ResponseType.QUERYING,\n            };\n            let response;\n            let rpcId;\n            try {\n                const fetchResult = await this.aidaFetch(query, { signal: options.signal });\n                response = fetchResult.response;\n                rpcId = fetchResult.rpcId;\n            }\n            catch (err) {\n                debugLog('Error calling the AIDA API', err);\n                if (err instanceof Host.AidaClient.AidaAbortError) {\n                    this.removeHistoryRun(currentRunId);\n                    yield {\n                        type: ResponseType.ERROR,\n                        error: \"abort\" /* ErrorType.ABORT */,\n                        rpcId,\n                    };\n                    break;\n                }\n                yield {\n                    type: ResponseType.ERROR,\n                    error: \"unknown\" /* ErrorType.UNKNOWN */,\n                    rpcId,\n                };\n                break;\n            }\n            const parsedResponse = this.parseResponse(response);\n            this.addToHistory({\n                id: currentRunId,\n                query,\n                response: parsedResponse,\n            });\n            if ('answer' in parsedResponse) {\n                const { answer, suggestions, } = parsedResponse;\n                if (answer) {\n                    yield {\n                        type: ResponseType.ANSWER,\n                        text: answer,\n                        rpcId,\n                        suggestions,\n                    };\n                }\n                else {\n                    this.removeHistoryRun(currentRunId);\n                    yield {\n                        type: ResponseType.ERROR,\n                        error: \"unknown\" /* ErrorType.UNKNOWN */,\n                        rpcId,\n                    };\n                }\n                break;\n            }\n            const { title, thought, action, } = parsedResponse;\n            if (title) {\n                yield {\n                    type: ResponseType.TITLE,\n                    title,\n                    rpcId,\n                };\n            }\n            if (thought) {\n                yield {\n                    type: ResponseType.THOUGHT,\n                    thought,\n                    rpcId,\n                };\n            }\n            if (action) {\n                const result = yield* this.handleAction(action, rpcId);\n                yield result;\n                query = `OBSERVATION: ${result.output}`;\n            }\n            if (i === MAX_STEP - 1) {\n                yield {\n                    type: ResponseType.ERROR,\n                    error: \"max-steps\" /* ErrorType.MAX_STEPS */,\n                };\n                break;\n            }\n        }\n        if (isDebugMode()) {\n            window.dispatchEvent(new CustomEvent('freestylerdone'));\n        }\n    }\n}\nexport function isDebugMode() {\n    return Boolean(localStorage.getItem('debugFreestylerEnabled'));\n}\nexport function debugLog(...log) {\n    if (!isDebugMode()) {\n        return;\n    }\n    // eslint-disable-next-line no-console\n    console.log(...log);\n}\nfunction setDebugFreestylerEnabled(enabled) {\n    if (enabled) {\n        localStorage.setItem('debugFreestylerEnabled', 'true');\n    }\n    else {\n        localStorage.removeItem('debugFreestylerEnabled');\n    }\n}\n// @ts-ignore\nglobalThis.setDebugFreestylerEnabled = setDebugFreestylerEnabled;\n//# sourceMappingURL=AiAgent.js.map","// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\nimport * as Common from '../../core/common/common.js';\nimport * as Platform from '../../core/platform/platform.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nexport const AI_ASSISTANCE_CSS_CLASS_NAME = 'ai-style-change';\n/**\n * Keeps track of changes done by Freestyler. Currently, it is primarily\n * for stylesheet generation based on all changes.\n */\nexport class ChangeManager {\n    #stylesheetMutex = new Common.Mutex.Mutex();\n    #cssModelToStylesheetId = new Map();\n    #stylesheetChanges = new Map();\n    async #getStylesheet(cssModel, frameId) {\n        return await this.#stylesheetMutex.run(async () => {\n            let frameToStylesheet = this.#cssModelToStylesheetId.get(cssModel);\n            if (!frameToStylesheet) {\n                frameToStylesheet = new Map();\n                this.#cssModelToStylesheetId.set(cssModel, frameToStylesheet);\n                cssModel.addEventListener(SDK.CSSModel.Events.ModelDisposed, this.#onCssModelDisposed, this);\n            }\n            let stylesheetId = frameToStylesheet.get(frameId);\n            if (!stylesheetId) {\n                const styleSheetHeader = await cssModel.createInspectorStylesheet(frameId);\n                if (!styleSheetHeader) {\n                    throw new Error('inspector-stylesheet is not found');\n                }\n                stylesheetId = styleSheetHeader.id;\n            }\n            return stylesheetId;\n        });\n    }\n    async #onCssModelDisposed(event) {\n        return await this.#stylesheetMutex.run(async () => {\n            const cssModel = event.data;\n            cssModel.removeEventListener(SDK.CSSModel.Events.ModelDisposed, this.#onCssModelDisposed, this);\n            const stylesheetIds = Array.from(this.#cssModelToStylesheetId.get(cssModel)?.values() ?? []);\n            // Empty stylesheets.\n            const results = await Promise.allSettled(stylesheetIds.map(async (id) => {\n                this.#stylesheetChanges.delete(id);\n                await cssModel.setStyleSheetText(id, '', true);\n            }));\n            this.#cssModelToStylesheetId.delete(cssModel);\n            const firstFailed = results.find(result => result.status === 'rejected');\n            if (firstFailed) {\n                throw new Error(firstFailed.reason);\n            }\n        });\n    }\n    async clear() {\n        const models = Array.from(this.#cssModelToStylesheetId.keys());\n        const results = await Promise.allSettled(models.map(async (model) => {\n            await this.#onCssModelDisposed({ data: model });\n        }));\n        this.#cssModelToStylesheetId.clear();\n        this.#stylesheetChanges.clear();\n        const firstFailed = results.find(result => result.status === 'rejected');\n        if (firstFailed) {\n            throw new Error(firstFailed.reason);\n        }\n    }\n    async addChange(cssModel, frameId, change) {\n        const stylesheetId = await this.#getStylesheet(cssModel, frameId);\n        const changes = this.#stylesheetChanges.get(stylesheetId) || [];\n        const existingChange = changes.find(c => c.className === change.className);\n        if (existingChange) {\n            Object.assign(existingChange.styles, change.styles);\n        }\n        else {\n            changes.push(change);\n        }\n        await cssModel.setStyleSheetText(stylesheetId, this.buildChanges(changes), true);\n        this.#stylesheetChanges.set(stylesheetId, changes);\n    }\n    buildChanges(changes) {\n        function formatStyles(styles) {\n            const kebabStyles = Platform.StringUtilities.toKebabCaseKeys(styles);\n            const lines = Object.entries(kebabStyles).map(([key, value]) => `${key}: ${value};`);\n            return lines.join('\\n');\n        }\n        return changes\n            .map(change => {\n            return `.${change.className} {\n  ${change.selector}& {\n    ${formatStyles(change.styles)}\n  }\n}`;\n        })\n            .join('\\n');\n    }\n}\n//# sourceMappingURL=ChangeManager.js.map","// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\nimport * as Common from '../../core/common/common.js';\nimport * as Host from '../../core/host/host.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport { AiAgent, ResponseType, } from './AiAgent.js';\nconst preamble = `You are a highly skilled software engineer with expertise in various programming languages and frameworks.\nYou are provided with the content of a file from the Chrome DevTools Sources panel.\n\n**Important Note:** The provided code may represent an incomplete fragment of a larger file.\n\nAnalyze the code and provide the following information:\n* Describe the primary functionality of the code. What does it do? Be specific and concise.\n* If possible, identify the framework or library the code is associated with (e.g., React, Angular, jQuery). List any key technologies, APIs, or patterns used in the code (e.g., Fetch API, WebSockets, object-oriented programming).\n* (Only provide if available and accessible externally) External Resources: Suggest relevant documentation that could help a developer understand the code better. Prioritize official documentation if available. Do not provide any internal resources.\n\n# Considerations\n* Keep your analysis concise and focused, highlighting only the most critical aspects for a software engineer.\n* **CRITICAL** If the user asks a question about religion, race, politics, sexuality, gender, or other sensitive topics, answer with \"Sorry, I can't answer that. I'm best at questions about files.\"\n\n## Example session\n\n**User:** (Selects a file containing the following JavaScript code)\n\nfunction calculateTotal(price, quantity) {\n  const total = price * quantity;\n  return total;\n}\nExplain this file.\n\n\nThis code defines a function called calculateTotal that calculates the total cost by multiplying the price and quantity arguments.\nThis code is written in JavaScript and doesn't seem to be associated with a specific framework. It's likely a utility function.\nRelevant Technologies: JavaScript, functions, arithmetic operations.\nExternal Resources:\nMDN Web Docs: JavaScript Functions: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Functions\n`;\n/*\n* Strings that don't need to be translated at this time.\n*/\nconst UIStringsNotTranslate = {\n    /**\n     *@description Title for thinking step of DrJones File agent.\n     */\n    analyzingFile: 'Analyzing file',\n};\nconst lockedString = i18n.i18n.lockedString;\nconst MAX_FILE_SIZE = 50000;\n/**\n * One agent instance handles one conversation. Create a new agent\n * instance for a new conversation.\n */\nexport class DrJonesFileAgent extends AiAgent {\n    preamble = preamble;\n    clientFeature = Host.AidaClient.ClientFeature.CHROME_DRJONES_FILE_AGENT;\n    get userTier() {\n        const config = Common.Settings.Settings.instance().getHostConfig();\n        return config.devToolsAiAssistanceFileAgentDogfood?.userTier;\n    }\n    get options() {\n        const config = Common.Settings.Settings.instance().getHostConfig();\n        const temperature = AiAgent.validTemperature(config.devToolsAiAssistanceFileAgentDogfood?.temperature);\n        const modelId = config.devToolsAiAssistanceFileAgentDogfood?.modelId;\n        return {\n            temperature,\n            model_id: modelId,\n        };\n    }\n    async *handleContextDetails(selectedFile) {\n        if (!selectedFile) {\n            return;\n        }\n        yield {\n            type: ResponseType.CONTEXT,\n            title: lockedString(UIStringsNotTranslate.analyzingFile),\n            details: createContextDetailsForDrJonesFileAgent(selectedFile),\n        };\n    }\n    async enhanceQuery(query, selectedFile) {\n        const fileEnchantmentQuery = selectedFile ? `# Selected file\\n${formatFile(selectedFile)}\\n\\n# User request\\n\\n` : '';\n        return `${fileEnchantmentQuery}${query}`;\n    }\n    parseResponse(response) {\n        return {\n            answer: response,\n        };\n    }\n}\nfunction createContextDetailsForDrJonesFileAgent(selectedFile) {\n    return [\n        {\n            title: 'Selected file',\n            text: formatFile(selectedFile),\n        },\n    ];\n}\nfunction formatFile(selectedFile) {\n    return `File Name: ${selectedFile.displayName()}\nURL: ${selectedFile.url()}\nFile Content:\n${selectedFile.content().slice(0, MAX_FILE_SIZE)}`;\n}\nfunction setDebugFreestylerEnabled(enabled) {\n    if (enabled) {\n        localStorage.setItem('debugFreestylerEnabled', 'true');\n    }\n    else {\n        localStorage.removeItem('debugFreestylerEnabled');\n    }\n}\n// @ts-ignore\nglobalThis.setDebugFreestylerEnabled = setDebugFreestylerEnabled;\n//# sourceMappingURL=DrJonesFileAgent.js.map","// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\nimport * as Common from '../../core/common/common.js';\nimport * as Host from '../../core/host/host.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport * as Logs from '../../models/logs/logs.js';\nimport * as Network from '../../panels/network/network.js';\nimport { AiAgent, ResponseType, } from './AiAgent.js';\n/* clang-format off */\nconst preamble = `You are the most advanced network request debugging assistant integrated into Chrome DevTools.\nThe user selected a network request in the browser's DevTools Network Panel and sends a query to understand the request.\nProvide a comprehensive analysis of the network request, focusing on areas crucial for a software engineer. Your analysis should include:\n* Briefly explain the purpose of the request based on the URL, method, and any relevant headers or payload.\n* Analyze timing information to identify potential bottlenecks or areas for optimization.\n* Highlight potential issues indicated by the status code.\n\n# Considerations\n* If the response payload or request payload contains sensitive data, redact or generalize it in your analysis to ensure privacy.\n* Tailor your explanations and suggestions to the specific context of the request and the technologies involved (if discernible from the provided details).\n* Keep your analysis concise and focused, highlighting only the most critical aspects for a software engineer.\n* **CRITICAL** If the user asks a question about religion, race, politics, sexuality, gender, or other sensitive topics, answer with \"Sorry, I can't answer that. I'm best at questions about network requests.\"\n\n## Example session\n\nExplain this network request\nRequest: https://api.example.com/products/search?q=laptop&category=electronics\nResponse Headers:\n    Content-Type: application/json\n    Cache-Control: max-age=300\n...\nRequest Headers:\n    User-Agent: Mozilla/5.0\n...\nRequest Status: 200 OK\n\n\nThis request aims to retrieve a list of products matching the search query \"laptop\" within the \"electronics\" category. The successful 200 OK status confirms that the server fulfilled the request and returned the relevant data.\n`;\n/* clang-format on */\nconst MAX_HEADERS_SIZE = 1000;\n/*\n* Strings that don't need to be translated at this time.\n*/\nconst UIStringsNotTranslate = {\n    /**\n     *@description Title for thinking step of DrJones Network agent.\n     */\n    inspectingNetworkData: 'Inspecting network data',\n    /**\n     *@description Heading text for the block that shows the network request details.\n     */\n    request: 'Request',\n    /**\n     *@description Heading text for the block that shows the network response details.\n     */\n    response: 'Response',\n    /**\n     *@description Prefix text for request URL.\n     */\n    requestUrl: 'Request URL',\n    /**\n     *@description Title text for request headers.\n     */\n    requestHeaders: 'Request Headers',\n    /**\n     *@description Title text for request timing details.\n     */\n    timing: 'Timing',\n    /**\n     *@description Title text for response headers.\n     */\n    responseHeaders: 'Response Headers',\n    /**\n     *@description Prefix text for response status.\n     */\n    responseStatus: 'Response Status',\n    /**\n     *@description Title text for request initiator chain.\n     */\n    requestInitiatorChain: 'Request Initiator Chain',\n};\nconst lockedString = i18n.i18n.lockedString;\n/**\n * One agent instance handles one conversation. Create a new agent\n * instance for a new conversation.\n */\nexport class DrJonesNetworkAgent extends AiAgent {\n    preamble = preamble;\n    clientFeature = Host.AidaClient.ClientFeature.CHROME_DRJONES_NETWORK_AGENT;\n    get userTier() {\n        const config = Common.Settings.Settings.instance().getHostConfig();\n        return config.devToolsExplainThisResourceDogfood?.userTier;\n    }\n    get options() {\n        const config = Common.Settings.Settings.instance().getHostConfig();\n        const temperature = AiAgent.validTemperature(config.devToolsExplainThisResourceDogfood?.temperature);\n        const modelId = config.devToolsExplainThisResourceDogfood?.modelId;\n        return {\n            temperature,\n            model_id: modelId,\n        };\n    }\n    async *handleContextDetails(selectedNetworkRequest) {\n        if (!selectedNetworkRequest) {\n            return;\n        }\n        yield {\n            type: ResponseType.CONTEXT,\n            title: lockedString(UIStringsNotTranslate.inspectingNetworkData),\n            details: createContextDetailsForDrJonesNetworkAgent(selectedNetworkRequest),\n        };\n    }\n    async enhanceQuery(query, selectedNetworkRequest) {\n        const networkEnchantmentQuery = selectedNetworkRequest ?\n            `# Selected network request \\n${formatNetworkRequest(selectedNetworkRequest)}\\n\\n# User request\\n\\n` :\n            '';\n        return `${networkEnchantmentQuery}${query}`;\n    }\n    parseResponse(response) {\n        return {\n            answer: response,\n        };\n    }\n}\nfunction formatLines(title, lines, maxLength) {\n    let result = '';\n    for (const line of lines) {\n        if (result.length + line.length > maxLength) {\n            break;\n        }\n        result += line;\n    }\n    result = result.trim();\n    return result && title ? title + '\\n' + result : result;\n}\nexport function allowHeader(header) {\n    const normalizedName = header.name.toLowerCase().trim();\n    // Skip custom headers.\n    if (normalizedName.startsWith('x-')) {\n        return false;\n    }\n    // Skip cookies as they might contain auth.\n    if (normalizedName === 'cookie' || normalizedName === 'set-cookie') {\n        return false;\n    }\n    if (normalizedName === 'authorization') {\n        return false;\n    }\n    return true;\n}\nexport function formatHeaders(title, headers) {\n    return formatLines(title, headers.filter(allowHeader).map(header => header.name + ': ' + header.value + '\\n'), MAX_HEADERS_SIZE);\n}\nexport function formatNetworkRequestTiming(request) {\n    const calculator = Network.NetworkPanel.NetworkPanel.instance().networkLogView.timeCalculator();\n    const results = Network.RequestTimingView.RequestTimingView.calculateRequestTimeRanges(request, calculator.minimumBoundary());\n    function getDuration(name) {\n        const result = results.find(r => r.name === name);\n        if (!result) {\n            return;\n        }\n        return i18n.TimeUtilities.secondsToString(result.end - result.start, true);\n    }\n    const labels = [\n        {\n            label: 'Queued at (timestamp)',\n            value: calculator.formatValue(request.issueTime(), 2),\n        },\n        {\n            label: 'Started at (timestamp)',\n            value: calculator.formatValue(request.startTime, 2),\n        },\n        {\n            label: 'Queueing (duration)',\n            value: getDuration('queueing'),\n        },\n        {\n            label: 'Connection start (stalled) (duration)',\n            value: getDuration('blocking'),\n        },\n        {\n            label: 'Request sent (duration)',\n            value: getDuration('sending'),\n        },\n        {\n            label: 'Waiting for server response (duration)',\n            value: getDuration('waiting'),\n        },\n        {\n            label: 'Content download (duration)',\n            value: getDuration('receiving'),\n        },\n        {\n            label: 'Duration (duration)',\n            value: getDuration('total'),\n        },\n    ];\n    return labels.filter(label => Boolean(label.value)).map(label => `${label.label}: ${label.value}`).join('\\n');\n}\nfunction formatRequestInitiated(request, initiatorChain, lineStart) {\n    const initiated = Logs.NetworkLog.NetworkLog.instance().initiatorGraphForRequest(request).initiated;\n    initiated.forEach((v, initiatedRequest) => {\n        if (request === v) {\n            initiatorChain = initiatorChain + lineStart + initiatedRequest.url() + '\\n';\n            initiatorChain = formatRequestInitiated(initiatedRequest, initiatorChain, '\\t' + lineStart);\n        }\n    });\n    return initiatorChain;\n}\nfunction formatRequestInitiatorChain(request) {\n    let initiatorChain = '';\n    let lineStart = '- URL: ';\n    const initiators = Logs.NetworkLog.NetworkLog.instance().initiatorGraphForRequest(request).initiators;\n    for (const initator of Array.from(initiators).reverse()) {\n        initiatorChain = initiatorChain + lineStart + initator.url() + '\\n';\n        lineStart = '\\t' + lineStart;\n        if (initator === request) {\n            initiatorChain = formatRequestInitiated(initator, initiatorChain, lineStart);\n            break;\n        }\n    }\n    return initiatorChain.trim();\n}\nexport function formatNetworkRequest(request) {\n    // TODO: anything else that might be relavant?\n    // TODO: handle missing headers\n    return `Request: ${request.url()}\n\n${formatHeaders('Request headers:', request.requestHeaders())}\n\n${formatHeaders('Response headers:', request.responseHeaders)}\n\nResponse status: ${request.statusCode} ${request.statusText}\n\nRequest Timing:\\n${formatNetworkRequestTiming(request)}\n\nRequest Initiator Chain:\\n${formatRequestInitiatorChain(request)}`;\n}\nfunction createContextDetailsForDrJonesNetworkAgent(request) {\n    const requestContextDetail = {\n        title: lockedString(UIStringsNotTranslate.request),\n        text: lockedString(UIStringsNotTranslate.requestUrl) + ': ' + request.url() + '\\n\\n' +\n            formatHeaders(lockedString(UIStringsNotTranslate.requestHeaders), request.requestHeaders()),\n    };\n    const responseContextDetail = {\n        title: lockedString(UIStringsNotTranslate.response),\n        text: lockedString(UIStringsNotTranslate.responseStatus) + ': ' + request.statusCode + ' ' + request.statusText +\n            '\\n\\n' + formatHeaders(lockedString(UIStringsNotTranslate.responseHeaders), request.responseHeaders),\n    };\n    const timingContextDetail = {\n        title: lockedString(UIStringsNotTranslate.timing),\n        text: formatNetworkRequestTiming(request),\n    };\n    const initiatorChainContextDetail = {\n        title: lockedString(UIStringsNotTranslate.requestInitiatorChain),\n        text: formatRequestInitiatorChain(request),\n    };\n    return [\n        requestContextDetail,\n        responseContextDetail,\n        timingContextDetail,\n        initiatorChainContextDetail,\n    ];\n}\n//# sourceMappingURL=DrJonesNetworkAgent.js.map","// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\nimport * as Common from '../../core/common/common.js';\nimport * as Host from '../../core/host/host.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport { AiAgent, ResponseType, } from './AiAgent.js';\nconst preamble = `You are a performance expert deeply integrated with Chrome DevTools.\nYou specialize in analyzing web application behavior captured by Chrome DevTools Performance Panel.\nYou will be provided with a string containing the JSON.stringify representation of a tree of events captured in a Chrome DevTools performance recording.\nThis tree originates from the root task of a specific event that was selected by a user in the Performance panel's flame graph.\nEach node in this tree represents an event and contains the following information:\n* id: A unique identifier for the event.\n* url:  The URL of the JavaScript file where the event originated (if applicable).\n* line: The line number in the JavaScript file where the event originated (if applicable).\n* column: The column number in the JavaScript file where the event originated (if applicable).\n* function: The name of the function associated with this event.\n* start: The start time of the event in milliseconds.\n* totalTime: The total duration of the event, including the time spent in its children, in milliseconds.\n* selfTime:  The duration of the event itself, excluding the time spent in its children, in milliseconds.\n* selected: A boolean value indicating whether this is the event the user selected in the Performance panel.\n* children: An array of child events, each represented as another node with the same structure.\n\nYour task is to analyze this event and its surrounding context within the performance recording. Your analysis may include:\n* Clearly state the name and purpose of the selected event based on its properties (e.g., function name, URL, line number). Explain what the task is broadly doing. You can also mention the function\n* Describe its execution context:\n  * Ancestors: Trace back through the tree to identify the chain of parent events that led to the execution of the selected event. Describe this execution path.\n  * Descendants:  Analyze the children of the selected event. What tasks did it initiate? Did it spawn any long-running or resource-intensive sub-tasks?\n* Quantify performance:\n    * Duration\n    * Relative Cost:  How much did this event contribute to the overall duration of its parent tasks and the entire recorded trace?\n    * Potential Bottlenecks: Analyze the totalTime and selfTime of the selected event and its children to identify any potential performance bottlenecks. Are there any excessively long tasks or periods of idle time?\n4. (Only provide if you have specific suggestions) Based on your analysis, provide specific and actionable suggestions for improving the performance of the selected event and its related tasks.  Are there any resources being acquired or held for longer than necessary?\n\n# Considerations\n* Keep your analysis concise and focused, highlighting only the most critical aspects for a software engineer.\n* Do not mention id of the event in your response.\n* **CRITICAL** If the user asks a question about religion, race, politics, sexuality, gender, or other sensitive topics, answer with \"Sorry, I can't answer that. I'm best at questions about performance of websites.\"\n\n## Example session\n\nSelected call tree\n'{\"id\":\"1\",\"function\":\"main\",\"start\":0,\"totalTime\":500,\"selfTime\":100,\"children\":[{\"id\":\"2\",\"function\":\"update\",\"start\":100,\"totalTime\":200,\"selfTime\":50,\"children\":[{\"id\":\"3\",\"function\":\"animate\",\"url\":\"[invalid URL removed]\",\"line\":120,\"column\":10,\"start\":150,\"totalTime\":150,\"selfTime\":20,\"selected\":true,\"children\":[{\"id\":\"4\",\"function\":\"calculatePosition\",\"start\":160,\"totalTime\":80,\"selfTime\":80,\"children\":[]},{\"id\":\"5\",\"function\":\"applyStyles\",\"start\":240,\"totalTime\":50,\"selfTime\":50,\"children\":[]}]}]}]}'\nExplain the selected task.\n\n\nIt looks like you've selected the animate function, which is responsible for animating elements on the page.\nThis function took a total of 150ms to execute, but only 20ms of that time was spent within the animate function itself.\nThe remaining 130ms were spent in its child functions, calculatePosition and applyStyles.\nIt seems like a significant portion of the animation time is spent calculating the position of the elements.\nPerhaps there's room for optimization there. You could investigate whether the calculatePosition function can be made more efficient or if the number of calculations can be reduced.\n`;\n/*\n* Strings that don't need to be translated at this time.\n*/\nconst UIStringsNotTranslate = {\n    analyzingStackTrace: 'Analyzing stack trace',\n};\nconst lockedString = i18n.i18n.lockedString;\n/**\n * One agent instance handles one conversation. Create a new agent\n * instance for a new conversation.\n */\nexport class DrJonesPerformanceAgent extends AiAgent {\n    preamble = preamble;\n    clientFeature = Host.AidaClient.ClientFeature.CHROME_DRJONES_PERFORMANCE_AGENT;\n    get userTier() {\n        const config = Common.Settings.Settings.instance().getHostConfig();\n        return config.devToolsAiAssistancePerformanceAgentDogfood?.userTier;\n    }\n    get options() {\n        const config = Common.Settings.Settings.instance().getHostConfig();\n        const temperature = AiAgent.validTemperature(config.devToolsAiAssistancePerformanceAgentDogfood?.temperature);\n        const modelId = config.devToolsAiAssistancePerformanceAgentDogfood?.modelId;\n        return {\n            temperature,\n            model_id: modelId,\n        };\n    }\n    async *handleContextDetails(selectedStackTrace) {\n        yield {\n            type: ResponseType.CONTEXT,\n            title: lockedString(UIStringsNotTranslate.analyzingStackTrace),\n            details: createContextDetailsForDrJonesPerformanceAgent(selectedStackTrace),\n        };\n    }\n    async enhanceQuery(query, selectedStackTrace) {\n        const networkEnchantmentQuery = selectedStackTrace ? `# Selected stack trace\\n${JSON.stringify(selectedStackTrace)}\\n\\n# User request\\n\\n` : '';\n        return `${networkEnchantmentQuery}${query}`;\n    }\n    parseResponse(response) {\n        return {\n            answer: response,\n        };\n    }\n}\nfunction createContextDetailsForDrJonesPerformanceAgent(selectedStackTrace) {\n    return [\n        {\n            title: 'Selected stack trace',\n            text: JSON.stringify(selectedStackTrace).trim(),\n        },\n    ];\n}\nfunction setDebugFreestylerEnabled(enabled) {\n    if (enabled) {\n        localStorage.setItem('debugFreestylerEnabled', 'true');\n    }\n    else {\n        localStorage.removeItem('debugFreestylerEnabled');\n    }\n}\n// @ts-ignore\nglobalThis.setDebugFreestylerEnabled = setDebugFreestylerEnabled;\n//# sourceMappingURL=DrJonesPerformanceAgent.js.map","// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n// IMPORTANT: this file is auto generated. Please do not edit this file.\n/* istanbul ignore file */\nconst styles = new CSSStyleSheet();\nstyles.replaceSync(\n`/*\n * Copyright 2024 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n* {\n  box-sizing: border-box;\n}\n\n.rate-buttons {\n  display: flex;\n  align-items: center;\n  gap: var(--sys-size-2);\n}\n\n.feedback-form {\n  display: flex;\n  flex-direction: column;\n  gap: var(--sys-size-5);\n  margin-top: var(--sys-size-4);\n  background-color: var(--sys-color-surface3);\n  padding: var(--sys-size-6);\n  border-radius: var(--sys-shape-corner-medium-small);\n\n  .feedback-input {\n    height: var(--sys-size-11);\n    padding: 0 var(--sys-size-5);\n    background-color: var(--sys-color-surface3);\n  }\n\n  .feedback-input::placeholder {\n    color: var(--sys-color-on-surface-subtle);\n    font: var(--sys-typescale-body4-regular);\n  }\n}\n\n.feedback-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.feedback-title {\n  margin: 0;\n  font: var(--sys-typescale-body3-medium);\n}\n\n.feedback-disclaimer {\n  padding: 0 var(--sys-size-4);\n}\n\n.vertical-separator {\n  height: 16px;\n  width: 1px;\n  vertical-align: top;\n  margin: 0 var(--sys-size-2);\n  background: var(--sys-color-divider);\n  display: inline-block;\n}\n\n/*# sourceURL=./components/provideFeedback.css */\n`);\n\nexport default styles;\n","// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\nimport * as Host from '../../../core/host/host.js';\nimport * as i18n from '../../../core/i18n/i18n.js';\nimport * as Buttons from '../../../ui/components/buttons/buttons.js';\nimport * as Input from '../../../ui/components/input/input.js';\nimport * as LitHtml from '../../../ui/lit-html/lit-html.js';\nimport * as VisualLogging from '../../../ui/visual_logging/visual_logging.js';\nimport provideFeedbackStyles from './provideFeedback.css.js';\nconst { html } = LitHtml;\n/*\n* Strings that don't need to be translated at this time.\n*/\nconst UIStringsNotTranslate = {\n    /**\n     * @description The title of the button that allows submitting positive\n     * feedback about the response for AI assistance.\n     */\n    thumbsUp: 'Good response',\n    /**\n     * @description The title of the button that allows submitting negative\n     * feedback about the response for AI assistance.\n     */\n    thumbsDown: 'Bad response',\n    /**\n     * @description The placeholder text for the feedback input.\n     */\n    provideFeedbackPlaceholder: 'Provide additional feedback',\n    /**\n     * @description The disclaimer text that tells the user what will be shared\n     * and what will be stored.\n     */\n    disclaimer: 'Submitted feedback will also include your conversation',\n    /**\n     * @description The button text for the action of submitting feedback.\n     */\n    submit: 'Submit',\n    /**\n     * @description The header of the feedback form asking.\n     */\n    whyThisRating: 'Why did you choose this rating? (optional)',\n    /**\n     * @description The button text for the action that hides the feedback form.\n     */\n    close: 'Close',\n    /**\n     * @description The title of the button that opens a page to report a legal\n     * issue with the AI assistance message.\n     */\n    report: 'Report legal issue',\n};\nconst lockedString = i18n.i18n.lockedString;\nconst REPORT_URL = 'https://support.google.com/legal/troubleshooter/1114905?hl=en#ts=1115658%2C13380504';\nexport class ProvideFeedback extends HTMLElement {\n    #shadow = this.attachShadow({ mode: 'open' });\n    #props;\n    #isShowingFeedbackForm = false;\n    #currentRating;\n    constructor(props) {\n        super();\n        this.#props = props;\n    }\n    set props(props) {\n        this.#props = props;\n        this.#render();\n    }\n    connectedCallback() {\n        this.#shadow.adoptedStyleSheets = [provideFeedbackStyles, Input.textInputStyles];\n        this.#render();\n    }\n    #handleRateClick(rating) {\n        if (this.#currentRating === rating) {\n            return;\n        }\n        this.#currentRating = rating;\n        this.#isShowingFeedbackForm = this.#props.canShowFeedbackForm;\n        this.#props.onFeedbackSubmit(this.#currentRating);\n        this.#render();\n    }\n    #handleClose = () => {\n        this.#isShowingFeedbackForm = false;\n        this.#render();\n    };\n    #handleSubmit = (ev) => {\n        ev.preventDefault();\n        const input = this.#shadow.querySelector('.feedback-input');\n        if (!this.#currentRating || !input || !input.value) {\n            return;\n        }\n        this.#props.onFeedbackSubmit(this.#currentRating, input.value);\n        this.#isShowingFeedbackForm = false;\n        this.#render();\n    };\n    #handleReportClick = () => {\n        Host.InspectorFrontendHost.InspectorFrontendHostInstance.openInNewTab(REPORT_URL);\n    };\n    #renderButtons() {\n        // clang-format off\n        return html `\n      <devtools-button\n        .data=${{\n            variant: \"icon\" /* Buttons.Button.Variant.ICON */,\n            size: \"SMALL\" /* Buttons.Button.Size.SMALL */,\n            iconName: 'thumb-up',\n            toggledIconName: 'thumb-up-filled',\n            toggled: this.#currentRating === \"POSITIVE\" /* Host.AidaClient.Rating.POSITIVE */,\n            toggleType: \"primary-toggle\" /* Buttons.Button.ToggleType.PRIMARY */,\n            title: lockedString(UIStringsNotTranslate.thumbsUp),\n            jslogContext: 'thumbs-up',\n        }}\n        @click=${() => this.#handleRateClick(\"POSITIVE\" /* Host.AidaClient.Rating.POSITIVE */)}\n      ></devtools-button>\n      <devtools-button\n        .data=${{\n            variant: \"icon\" /* Buttons.Button.Variant.ICON */,\n            size: \"SMALL\" /* Buttons.Button.Size.SMALL */,\n            iconName: 'thumb-down',\n            toggledIconName: 'thumb-down-filled',\n            toggled: this.#currentRating === \"NEGATIVE\" /* Host.AidaClient.Rating.NEGATIVE */,\n            toggleType: \"primary-toggle\" /* Buttons.Button.ToggleType.PRIMARY */,\n            title: lockedString(UIStringsNotTranslate.thumbsDown),\n            jslogContext: 'thumbs-down',\n        }}\n        @click=${() => this.#handleRateClick(\"NEGATIVE\" /* Host.AidaClient.Rating.NEGATIVE */)}\n      ></devtools-button>\n      <div class=\"vertical-separator\"></div>\n      <devtools-button\n        .data=${{\n            variant: \"icon\" /* Buttons.Button.Variant.ICON */,\n            size: \"SMALL\" /* Buttons.Button.Size.SMALL */,\n            title: lockedString(UIStringsNotTranslate.report),\n            iconName: 'report',\n            jslogContext: 'report',\n        }}\n        @click=${this.#handleReportClick}\n      ></devtools-button>\n    `;\n        // clang-format on\n    }\n    #renderFeedbackForm() {\n        // clang-format off\n        return html `\n      <form class=\"feedback-form\" @submit=${this.#handleSubmit}>\n        <div class=\"feedback-header\">\n          <h4 class=\"feedback-title\">${lockedString(UIStringsNotTranslate.whyThisRating)}</h4>\n          <devtools-button\n            aria-label=${lockedString(UIStringsNotTranslate.close)}\n            @click=${this.#handleClose}\n            .data=${{\n            variant: \"icon\" /* Buttons.Button.Variant.ICON */,\n            iconName: 'cross',\n            size: \"SMALL\" /* Buttons.Button.Size.SMALL */,\n            title: lockedString(UIStringsNotTranslate.close),\n            jslogContext: 'close',\n        }}\n          ></devtools-button>\n        </div>\n        <input\n          type=\"text\"\n          class=\"devtools-text-input feedback-input\"\n          placeholder=${lockedString(UIStringsNotTranslate.provideFeedbackPlaceholder)}\n          jslog=${VisualLogging.textField('feedback').track({ keydown: 'Enter' })}\n        >\n        <span class=\"feedback-disclaimer\">${lockedString(UIStringsNotTranslate.disclaimer)}</span>\n        <devtools-button\n        aria-label=${lockedString(UIStringsNotTranslate.submit)}\n        .data=${{\n            type: 'submit',\n            variant: \"outlined\" /* Buttons.Button.Variant.OUTLINED */,\n            size: \"SMALL\" /* Buttons.Button.Size.SMALL */,\n            title: lockedString(UIStringsNotTranslate.submit),\n            jslogContext: 'send',\n        }}\n        >${lockedString(UIStringsNotTranslate.submit)}</devtools-button>\n      </div>\n    </form>\n    `;\n        // clang-format on\n    }\n    #render() {\n        // clang-format off\n        LitHtml.render(html `\n        <div class=\"feedback\">\n          <div class=\"rate-buttons\">\n            ${this.#renderButtons()}\n          </div>\n          ${this.#isShowingFeedbackForm\n            ? this.#renderFeedbackForm()\n            : LitHtml.nothing}\n        </div>`, this.#shadow, { host: this });\n        // clang-format on\n    }\n}\ncustomElements.define('devtools-provide-feedback', ProvideFeedback);\n//# sourceMappingURL=ProvideFeedback.js.map","// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n// IMPORTANT: this file is auto generated. Please do not edit this file.\n/* istanbul ignore file */\nconst styles = new CSSStyleSheet();\nstyles.replaceSync(\n`/*\n * Copyright 2024 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n* {\n  box-sizing: border-box;\n  margin: 0;\n  padding: 0;\n}\n\n:host {\n  width: 100%;\n  height: 100%;\n  user-select: text;\n  display: flex;\n  flex-direction: column;\n  background-color: var(--sys-color-cdt-base-container);\n}\n\n.chat-ui {\n  width: 100%;\n  height: 100%;\n  max-height: 100%;\n  display: flex;\n  flex-direction: column;\n}\n\n.input-form {\n  display: flex;\n  flex-direction: column;\n  padding: var(--sys-size-8) var(--sys-size-5) 0 var(--sys-size-5);\n  max-width: var(--sys-size-36);\n  width: 100%;\n}\n\n.chat-input-container {\n  margin: var(--sys-size-4) 0;\n  width: 100%;\n  display: flex;\n  position: relative;\n}\n\n.chat-input {\n  --right-padding:\n    calc(\n      var(--sys-size-3) + 26px\n    ); /* Gap between the button and the edge + icon's width */\n\n  scrollbar-width: none;\n  field-sizing: content; /* stylelint-disable-line property-no-unknown */\n  resize: none;\n  width: 100%;\n  max-height: 84px; /* 4 rows */\n  border: 1px solid var(--sys-color-neutral-outline);\n  border-radius: var(--sys-shape-corner-small);\n  font: var(--sys-typescale-body4-regular);\n  line-height: 18px;\n  min-height: var(--sys-size-11);\n  padding:\n    var(--sys-size-4) var(--right-padding) var(--sys-size-4)\n    var(--sys-size-4);\n  color: var(--sys-color-on-surface);\n  background-color: var(--sys-color-cdt-base-container);\n\n  &::placeholder {\n    opacity: 60%;\n  }\n\n  &:focus-visible {\n    outline: 1px solid var(--sys-color-primary);\n    border-color: var(--sys-color-primary);\n  }\n\n  &:disabled {\n    color: var(--sys-color-state-disabled);\n    background-color: var(--sys-color-state-disabled-container);\n    border-color: transparent;\n  }\n}\n\n.chat-input-button {\n  position: absolute;\n  right: 0;\n  bottom: 0;\n  padding-bottom: 3px;\n  padding-right: var(--sys-size-3);\n}\n\n.disclaimer {\n  display: flex;\n  justify-content: center;\n  border-top: var(--sys-size-1) solid var(--sys-color-divider);\n\n  .disclaimer-text {\n    max-width: var(--sys-size-36);\n    color: var(--sys-color-on-surface-subtle);\n    font: var(--sys-typescale-body5-regular);\n    text-wrap: pretty;\n    padding: var(--sys-size-2) var(--sys-size-5);\n  }\n}\n\n.messages-scroll-container {\n  overflow: auto;\n  flex-grow: 1;\n  scrollbar-gutter: stable both-edges;\n  scrollbar-width: thin;\n  width: 100%;\n}\n\n.messages-container {\n  margin: 0 auto;\n  max-width: var(--sys-size-36);\n}\n\n.chat-message {\n  user-select: text;\n  cursor: initial;\n  display: flex;\n  flex-direction: column;\n  gap: var(--sys-size-5);\n  width: 100%;\n  padding: var(--sys-size-7) var(--sys-size-5);\n  font-size: 12px;\n  word-break: break-word;\n  border-bottom: var(--sys-size-1) solid var(--sys-color-divider);\n\n  &:last-child {\n    border-bottom: 0;\n  }\n\n  .message-info {\n    display: flex;\n    align-items: center;\n    height: var(--sys-size-11);\n    gap: var(--sys-size-4);\n    font: var(--sys-typescale-body4-bold);\n\n    img {\n      border: 0;\n      border-radius: var(--sys-shape-corner-full);\n      display: block;\n      height: var(--sys-size-9);\n      width: var(--sys-size-9);\n    }\n\n    h2 {\n      font: var(--sys-typescale-body4-bold);\n    }\n  }\n\n  .actions {\n    display: flex;\n    gap: var(--sys-size-8);\n    justify-content: space-between;\n    align-items: flex-end;\n  }\n\n  /*\n    Scroll driven animation below is used for generating shadows\n    when the \\\\'.suggestions\\\\' area is scrollable.\n  */\n  .suggestions {\n    display: flex;\n    overflow-y: hidden;\n    overflow-x: auto;\n    scrollbar-width: none;\n    gap: var(--sys-size-3);\n    scroll-timeline: --scroll-timeline x; /* stylelint-disable-line property-no-unknown */\n    animation: detect-scroll;\n    animation-timeline: --scroll-timeline; /* stylelint-disable-line property-no-unknown */\n    animation-fill-mode: none;\n    position: relative;\n  }\n\n  .suggestions::before,\n  .suggestions::after {\n    content: \"\";\n    display: block;\n    position: sticky;\n    min-width: var(--sys-size-3);\n    height: var(--sys-size-11);\n    left: 0;\n    right: 0;\n    z-index: 999;\n    animation-name: reveal;\n    animation-timeline: --scroll-timeline; /* stylelint-disable-line property-no-unknown */\n    animation-fill-mode: both;\n  }\n\n  .suggestions::before {\n    top: 0;\n    visibility: var(--visibility-if-can-scroll, hidden);\n    animation-range: var(--sys-size-6) var(--sys-size-11); /* stylelint-disable-line property-no-unknown */\n    background:\n      radial-gradient(\n        farthest-side at 0 50%,\n        var(--app-color-scroll-area-shadow-start),\n        transparent\n      );\n  }\n\n  .suggestions::after {\n    bottom: 0;\n    visibility: var(--visibility-if-can-scroll, hidden);\n    animation-direction: reverse;\n    /* stylelint-disable-next-line property-no-unknown */\n    animation-range:\n      calc(100% - var(--sys-size-11))\n      calc(100% - var(--sys-size-6));\n    background:\n      radial-gradient(\n        farthest-side at 100% 50%,\n        var(--app-color-scroll-area-shadow-start),\n        transparent\n      );\n  }\n\n  .aborted {\n    color: var(--sys-color-on-surface-subtle);\n  }\n}\n\n.select-element {\n  display: flex;\n  gap: var(--sys-size-3);\n  align-items: center;\n  width: 100%;\n\n  .resource-link {\n    cursor: pointer;\n  }\n\n  .resource-link,\n  .resource-task {\n    padding: var(--sys-size-2) var(--sys-size-4);\n    font: var(--sys-typescale-body4-size);\n    border: var(--sys-size-1) solid var(--sys-color-divider);\n    border-radius: var(--sys-shape-corner-extra-small);\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    max-width: var(--sys-size-32);\n\n    .icon,\n    devtools-file-source-icon {\n      display: inline-flex;\n      vertical-align: top;\n      margin-right: var(--sys-size-3);\n      width: var(--sys-size-9);\n      height: var(--sys-size-9);\n    }\n\n    /*\n      CSS styling for \\\\'network-override-marker\\\\' is similar to\n      https://source.chromium.org/chromium/chromium/src/+/main:third_party/devtools-frontend/src/front_end/panels/network/networkLogView.css;l=379.\n      There is a difference in \\\\'left\\\\' and \\\\'top\\\\' values to make sure\n      it is placed correctly for the network icon in assistance panel.\n    */\n    .network-override-marker {\n      position: relative;\n      float: left;\n    }\n\n    .network-override-marker::before {\n      content: var(--image-file-empty);\n      width: var(--sys-size-4);\n      height: var(--sys-size-4);\n      border-radius: 50%;\n      outline: var(--sys-size-1) solid var(--icon-gap-focus-selected);\n      left: 11px;\n      position: absolute;\n      top: 13px;\n      z-index: 1;\n      background-color: var(--sys-color-purple-bright);\n    }\n\n    .image.icon {\n      display: inline-flex;\n      justify-content: center;\n      align-items: center;\n      margin-right: var(--sys-size-3);\n\n      img {\n        max-width: var(--sys-size-8);\n        max-height: var(--sys-size-8);\n      }\n    }\n  }\n\n  .resource-link.not-selected,\n  .resource-task.not-selected {\n    color: var(--sys-color-state-disabled);\n    border-color: var(--sys-color-neutral-outline);\n  }\n}\n\n.no-agent-message {\n  user-select: text;\n  cursor: initial;\n  display: flex;\n  flex-direction: column;\n  gap: var(--sys-size-5);\n  width: 100%;\n  padding: var(--sys-size-7) var(--sys-size-5);\n  height: 100%;\n\n  .header {\n    display: flex;\n    align-items: center;\n    height: var(--sys-size-11);\n    gap: var(--sys-size-4);\n\n    h2 {\n      font: var(--sys-typescale-body4-bold);\n    }\n  }\n\n  .instructions {\n    display: flex;\n    flex-direction: column;\n    gap: var(--sys-size-6);\n    line-height: 18px;\n  }\n}\n\n.indicator {\n  color: var(--sys-color-green-bright);\n}\n\n.summary {\n  display: grid;\n  grid-template-columns: auto 1fr auto;\n  padding: var(--sys-size-3);\n  line-height: var(--sys-size-9);\n  cursor: default;\n  gap: var(--sys-size-3);\n  justify-content: center;\n  align-items: center;\n\n  .title {\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    overflow: hidden;\n    font: var(--sys-typescale-body4-regular);\n\n    .paused {\n      font: var(--sys-typescale-body4-bold);\n    }\n  }\n}\n\n.step-code {\n  display: flex;\n  flex-direction: column;\n  gap: var(--sys-size-2);\n}\n\n.js-code-output {\n  devtools-code-block {\n    --code-block-max-code-height: 50px;\n  }\n}\n\n.context-details {\n  devtools-code-block {\n    --code-block-max-code-height: 80px;\n  }\n}\n\n.step {\n  width: fit-content;\n  background-color: var(--sys-color-surface3);\n  border-radius: var(--sys-size-6);\n  position: relative;\n\n  &.empty {\n    pointer-events: none;\n\n    .arrow {\n      display: none;\n    }\n  }\n\n  &:not(&[open]):hover::after {\n    content: \"\";\n    height: 100%;\n    width: 100%;\n    border-radius: inherit;\n    position: absolute;\n    top: 0;\n    left: 0;\n    pointer-events: none;\n    background-color: var(--sys-color-state-hover-on-subtle);\n  }\n\n  &.paused {\n    .indicator {\n      color: var(--sys-color-on-surface-subtle);\n    }\n  }\n\n  &.canceled {\n    .summary {\n      color: var(--sys-color-state-disabled);\n      text-decoration: line-through;\n    }\n\n    .indicator {\n      color: var(--sys-color-state-disabled);\n    }\n  }\n\n  devtools-markdown-view {\n    --code-background-color: var(--sys-color-surface1);\n  }\n\n  devtools-icon {\n    vertical-align: bottom;\n  }\n\n  devtools-spinner {\n    width: var(--sys-size-9);\n    height: var(--sys-size-9);\n    padding: var(--sys-size-2);\n  }\n\n  &[open] {\n    width: auto;\n\n    .summary .title {\n      white-space: normal;\n      overflow: unset;\n    }\n\n    .summary .arrow {\n      transform: rotate(180deg);\n    }\n  }\n\n  summary::marker {\n    content: \"\";\n  }\n\n  .step-details {\n    padding: 0 var(--sys-size-5) var(--sys-size-4) var(--sys-size-12);\n    display: flex;\n    flex-direction: column;\n    gap: var(--sys-size-6);\n\n    devtools-code-block {\n      --code-block-background-color: var(--sys-color-surface1);\n    }\n  }\n}\n\n.input-header {\n  display: inline-flex;\n  align-items: center;\n  justify-content: space-between;\n  margin-bottom: 2px;\n  line-height: 20px;\n  gap: var(--sys-size-8);\n\n  & .feedback-icon {\n    width: var(--sys-size-8);\n    height: var(--sys-size-8);\n  }\n\n  & .header-link-container {\n    display: inline-flex;\n    align-items: center;\n    gap: var(--sys-size-2);\n    flex-shrink: 0;\n  }\n\n  & .header-link-container:first-of-type {\n    flex-shrink: 1;\n    min-width: 0;\n  }\n}\n\n.link {\n  color: var(--text-link);\n  text-decoration: underline;\n  cursor: pointer;\n}\n\nbutton.link {\n  border: none;\n  background: none;\n  font: inherit;\n}\n\n.select-an-element-text {\n  margin-left: 2px;\n}\n\nmain {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  height: 100%;\n  overflow-y: auto;\n}\n\n.empty-state-container {\n  display: grid;\n  align-items: center;\n  justify-content: center;\n  font: var(--sys-typescale-headline4);\n  gap: var(--sys-size-11);\n  padding: var(--sys-size-3);\n\n  .header {\n    display: flex;\n    flex-direction: column;\n    width: 100%;\n    align-items: center;\n    justify-content: center;\n    align-self: end;\n    gap: var(--sys-size-5);\n\n    .icon {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      height: var(--sys-size-14);\n      width: var(--sys-size-14);\n      border-radius: var(--sys-shape-corner-small);\n      background:\n        linear-gradient(\n          135deg,\n          var(--sys-color-gradient-primary),\n          var(--sys-color-gradient-tertiary)\n        );\n    }\n\n    h1 {\n      font: var(--sys-typescale-headline4);\n    }\n  }\n\n  .suggestions {\n    display: flex;\n    flex-direction: column;\n    gap: var(--sys-size-5);\n    align-items: center;\n    justify-content: center;\n    align-self: start;\n  }\n}\n\n.disabled-view {\n  border-radius: var(--sys-shape-corner-small);\n  padding: var(--sys-size-6) var(--sys-size-8);\n  box-shadow: var(--drop-shadow);\n  font: var(--sys-typescale-body4-regular);\n  margin: var(--sys-size-4) 0;\n  max-width: var(--sys-size-34);\n  display: flex;\n  text-wrap: pretty;\n\n  .disabled-view-icon-container {\n    border-radius: var(--sys-shape-corner-extra-small);\n    width: var(--sys-size-9);\n    height: var(--sys-size-9);\n    background:\n      linear-gradient(\n        135deg,\n        var(--sys-color-gradient-primary),\n        var(--sys-color-gradient-tertiary)\n      );\n    margin-right: var(--sys-size-5);\n\n    devtools-icon {\n      margin: var(--sys-size-2);\n    }\n  }\n}\n\n.error-step {\n  color: var(--sys-color-error);\n}\n\n.side-effect-confirmation {\n  display: flex;\n  flex-direction: column;\n  gap: var(--sys-size-5);\n  padding-bottom: var(--sys-size-4);\n}\n\n.side-effect-buttons-container {\n  display: flex;\n  gap: var(--sys-size-4);\n}\n\n@keyframes reveal {\n  0% {\n    opacity: 0%;\n  }\n\n  100% {\n    opacity: 100%;\n  }\n}\n\n@keyframes detect-scroll {\n  from,\n  to {\n    --visibility-if-can-scroll: visible;\n  }\n}\n\n/*# sourceURL=./components/freestylerChatUi.css */\n`);\n\nexport default styles;\n","// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\nimport '../../../ui/components/spinners/spinners.js';\nimport './ProvideFeedback.js';\nimport * as Common from '../../../core/common/common.js';\nimport * as Host from '../../../core/host/host.js';\nimport * as i18n from '../../../core/i18n/i18n.js';\nimport * as Trace from '../../../models/trace/trace.js';\nimport * as Marked from '../../../third_party/marked/marked.js';\nimport * as Buttons from '../../../ui/components/buttons/buttons.js';\nimport * as MarkdownView from '../../../ui/components/markdown_view/markdown_view.js';\nimport * as UI from '../../../ui/legacy/legacy.js';\nimport * as LitHtml from '../../../ui/lit-html/lit-html.js';\nimport * as VisualLogging from '../../../ui/visual_logging/visual_logging.js';\nimport { PanelUtils } from '../../utils/utils.js';\nimport freestylerChatUiStyles from './freestylerChatUi.css.js';\nconst { html, Directives: { ifDefined } } = LitHtml;\nconst UIStrings = {\n    /**\n     * @description The error message when the user is not logged in into Chrome.\n     */\n    notLoggedIn: 'This feature is only available when you are signed into Chrome with your Google account',\n    /**\n     * @description Message shown when the user is offline.\n     */\n    offline: 'Check your internet connection and try again',\n    /**\n     *@description Disclaimer text right after the chat input.\n     */\n    inputDisclaimerForEmptyState: 'This is an experimental AI feature and won\\'t always get it right.',\n    /**\n     * @description Text for a link to Chrome DevTools Settings.\n     */\n    settingsLink: 'AI assistance in Settings',\n    /**\n     * @description Placeholder text for an inactive text field. When active, it's used for the user's input to the GenAI assistance.\n     */\n    followTheSteps: 'Follow the steps above to ask a question',\n    /**\n     *@description Text for asking the user to turn the AI assistance feature in settings first before they are able to use it.\n     *@example {AI assistance in Settings} PH1\n     */\n    turnOnForStyles: 'Turn on {PH1} to get help with understanding CSS styles',\n    /**\n     *@description Text for asking the user to turn the AI assistance feature in settings first before they are able to use it.\n     *@example {AI assistance in Settings} PH1\n     */\n    turnOnForStylesAndRequests: 'Turn on {PH1} to get help with styles and network requests',\n    /**\n     *@description The footer disclaimer that links to more information about the AI feature.\n     */\n    learnAbout: 'Learn about AI in DevTools',\n};\n/*\n* Strings that don't need to be translated at this time.\n*/\nconst UIStringsNotTranslate = {\n    /**\n     *@description Disclaimer text right after the chat input.\n     */\n    inputDisclaimerForFreestylerAgent: 'Chat messages and any data the inspected page can access via Web APIs are sent to Google and may be seen by human reviewers to improve this feature. This is an experimental AI feature and wont always get it right.',\n    /**\n     *@description Disclaimer text right after the chat input.\n     */\n    inputDisclaimerForDrJonesNetworkAgent: 'Chat messages and the selected network request are sent to Google and may be seen by human reviewers to improve this feature. This is an experimental AI feature and wont always get it right.',\n    /**\n     *@description Disclaimer text right after the chat input.\n     */\n    inputDisclaimerForDrJonesFileAgent: 'Chat messages and the selected file are sent to Google and may be seen by human reviewers to improve this feature. This is an experimental AI feature and won\\'t always get it right.',\n    /**\n     *@description Disclaimer text right after the chat input.\n     */\n    inputDisclaimerForDrJonesPerformanceAgent: 'Chat messages and the selected call stack are sent to Google and may be seen by human reviewers to improve this feature. This is an experimental AI feature and won\\'t always get it right.',\n    /**\n     *@description Placeholder text for the chat UI input.\n     */\n    inputPlaceholderForFreestylerAgent: 'Ask a question about the selected element',\n    /**\n     *@description Placeholder text for the chat UI input.\n     */\n    inputPlaceholderForDrJonesNetworkAgent: 'Ask a question about the selected network request',\n    /**\n     *@description Placeholder text for the chat UI input.\n     */\n    inputPlaceholderForDrJonesFileAgent: 'Ask a question about the selected file',\n    /**\n     *@description Placeholder text for the chat UI input.\n     */\n    inputPlaceholderForDrJonesPerformanceAgent: 'Ask a question about the selected stack trace',\n    /**\n     *@description Title for the send icon button.\n     */\n    sendButtonTitle: 'Send',\n    /**\n     *@description Title for the cancel icon button.\n     */\n    cancelButtonTitle: 'Cancel',\n    /**\n     *@description Label for the \"select an element\" button.\n     */\n    selectAnElement: 'Select an element',\n    /**\n     *@description Label for the \"select an element\" button.\n     */\n    noElementSelected: 'No element selected',\n    /**\n     *@description Text for the empty state of the AI assistance panel.\n     */\n    emptyStateText: 'How can I help you?',\n    /**\n     * @description The error message when the LLM loop is stopped for some reason (Max steps reached or request to LLM failed)\n     */\n    systemError: 'Something unforeseen happened and I can no longer continue. Try your request again and see if that resolves the issue.',\n    /**\n     * @description The error message when the LLM loop is stopped for some reason (Max steps reached or request to LLM failed)\n     */\n    maxStepsError: 'Seems like I am stuck with the investigation. It would be better if you start over.',\n    /**\n     *@description Displayed when the user stop the response\n     */\n    stoppedResponse: 'You stopped this response',\n    /**\n     * @description Prompt for user to confirm code execution that may affect the page.\n     */\n    sideEffectConfirmationDescription: 'This code may modify page content. Continue?',\n    /**\n     * @description Button text that confirm code execution that may affect the page.\n     */\n    positiveSideEffectConfirmation: 'Continue',\n    /**\n     * @description Button text that cancels code execution that may affect the page.\n     */\n    negativeSideEffectConfirmation: 'Cancel',\n    /**\n     *@description The generic name of the AI agent (do not translate)\n     */\n    ai: 'AI',\n    /**\n     *@description The fallback text when we can't find the user full name\n     */\n    you: 'You',\n    /**\n     *@description The fallback text when a step has no title yet\n     */\n    investigating: 'Investigating',\n    /**\n     *@description Prefix to the title of each thinking step of a user action is required to continue\n     */\n    paused: 'Paused',\n    /**\n     *@description Heading text for the code block that shows the executed code.\n     */\n    codeExecuted: 'Code executed',\n    /**\n     *@description Heading text for the code block that shows the code to be executed after side effect confirmation.\n     */\n    codeToExecute: 'Code to execute',\n    /**\n     *@description Heading text for the code block that shows the returned data.\n     */\n    dataReturned: 'Data returned',\n    /**\n     *@description Aria label for the check mark icon to be read by screen reader\n     */\n    completed: 'Completed',\n    /**\n     *@description Aria label for the loading icon to be read by screen reader\n     */\n    inProgress: 'In progress',\n    /**\n     *@description Aria label for the cancel icon to be read by screen reader\n     */\n    canceled: 'Canceled',\n    /*\n     * @description Header text for instructions on how to use the AI assistance feature.\n     */\n    getStarted: 'Hi! Heres how to get started:',\n    /**\n     * @description AI assistance for CSS.\n     */\n    cssHelp: 'CSS help:',\n    /**\n     * @description Explanation on how to use AI assistance for DOM elements.\n     */\n    cssHelpExplainer: 'Navigate to the Elements panel, right-click a DOM element, and select \"Ask AI assistant\". Ill be happy to explain its styles or behavior.',\n    /**\n     * @description AI assistance for files.\n     */\n    fileHelp: 'File insights:',\n    /**\n     * @description Explanation on how to use AI assistance for files in the Sources panel.\n     */\n    fileHelpExplainer: 'Open the Sources panel, right-click a file, and select \"Ask AI\". I can provide insights into its purpose or origin.',\n    /**\n     * @description AI assistance for network requests.\n     */\n    networkHelp: 'Network request insights:',\n    /**\n     * @description Explanation on how to use AI assistance for network requests.\n     */\n    networkHelpExplainer: 'In the Network panel, right-click any request and select \"Ask AI assistant\". Ill help break down whats happening with each request.',\n    /**\n     * @description AI assistance for performance traces.\n     */\n    performanceHelp: 'Performance analysis:',\n    /**\n     * @description Explanation on how to use AI assistance for performance traces.\n     */\n    performanceHelpExplainer: 'In the Performance panel, run a trace. Then, right-click any function in the timeline and select \"Ask AI\". Ill help you analyze its performance impact and suggest improvements.',\n};\nconst str_ = i18n.i18n.registerUIStrings('panels/freestyler/components/FreestylerChatUi.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nconst lockedString = i18n.i18n.lockedString;\nfunction getInputPlaceholderString(state, agentType) {\n    if (state === \"consent-view\" /* State.CONSENT_VIEW */ || !agentType) {\n        return i18nString(UIStrings.followTheSteps);\n    }\n    switch (agentType) {\n        case \"freestyler\" /* AgentType.FREESTYLER */:\n            return lockedString(UIStringsNotTranslate.inputPlaceholderForFreestylerAgent);\n        case \"drjones-file\" /* AgentType.DRJONES_FILE */:\n            return lockedString(UIStringsNotTranslate.inputPlaceholderForDrJonesFileAgent);\n        case \"drjones-network-request\" /* AgentType.DRJONES_NETWORK_REQUEST */:\n            return lockedString(UIStringsNotTranslate.inputPlaceholderForDrJonesNetworkAgent);\n        case \"drjones-performance\" /* AgentType.DRJONES_PERFORMANCE */:\n            return lockedString(UIStringsNotTranslate.inputPlaceholderForDrJonesPerformanceAgent);\n    }\n}\n// The model returns multiline code blocks in an erroneous way with the language being in new line.\n// This renderer takes that into account and correctly updates the parsed multiline token with the language\n// correctly identified and stripped from the content.\n// Example:\n// ```\n// css <-- This should have been on the first line.\n// * {\n//   color: red;\n// }\n// ```\nclass MarkdownRendererWithCodeBlock extends MarkdownView.MarkdownView.MarkdownInsightRenderer {\n    templateForToken(token) {\n        if (token.type === 'code') {\n            const lines = token.text.split('\\n');\n            if (lines[0]?.trim() === 'css') {\n                token.lang = 'css';\n                token.text = lines.slice(1).join('\\n');\n            }\n        }\n        return super.templateForToken(token);\n    }\n}\nexport class FreestylerChatUi extends HTMLElement {\n    #shadow = this.attachShadow({ mode: 'open' });\n    #markdownRenderer = new MarkdownRendererWithCodeBlock();\n    #scrollTop;\n    #props;\n    constructor(props) {\n        super();\n        this.#props = props;\n    }\n    set props(props) {\n        this.#props = props;\n        this.#render();\n    }\n    connectedCallback() {\n        this.#shadow.adoptedStyleSheets = [freestylerChatUiStyles];\n        this.#render();\n    }\n    focusTextInput() {\n        const textArea = this.#shadow.querySelector('.chat-input');\n        if (!textArea) {\n            return;\n        }\n        textArea.focus();\n    }\n    restoreScrollPosition() {\n        if (this.#scrollTop === undefined) {\n            return;\n        }\n        const scrollContainer = this.#shadow.querySelector('.messages-scroll-container');\n        if (!scrollContainer) {\n            return;\n        }\n        scrollContainer.scrollTop = this.#scrollTop;\n    }\n    scrollToLastMessage() {\n        const message = this.#shadow.querySelector('.chat-message:last-child');\n        if (!message) {\n            return;\n        }\n        message.scrollIntoViewIfNeeded();\n    }\n    #setInputText(text) {\n        const textArea = this.#shadow.querySelector('.chat-input');\n        if (!textArea) {\n            return;\n        }\n        textArea.value = text;\n    }\n    #isTextInputDisabled = () => {\n        const isAidaAvailable = this.#props.aidaAvailability === \"available\" /* Host.AidaClient.AidaAccessPreconditions.AVAILABLE */;\n        const isConsentView = this.#props.state === \"consent-view\" /* State.CONSENT_VIEW */;\n        const showsSideEffects = this.#props.messages.some(message => {\n            return message.entity === \"model\" /* ChatMessageEntity.MODEL */ && message.steps.some(step => {\n                return Boolean(step.sideEffect);\n            });\n        });\n        const isInputDisabledCheckForFreestylerAgent = !Boolean(this.#props.selectedElement) || showsSideEffects;\n        const isInputDisabledCheckForDrJonesNetworkAgent = !Boolean(this.#props.selectedNetworkRequest);\n        const isInputDisabledCheckForDrJonesFileAgent = !Boolean(this.#props.selectedFile) || !this.#props.selectedFile?.contentType().isTextType();\n        return (this.#props.agentType === \"freestyler\" /* AgentType.FREESTYLER */ && isInputDisabledCheckForFreestylerAgent) ||\n            (this.#props.agentType === \"drjones-network-request\" /* AgentType.DRJONES_NETWORK_REQUEST */ && isInputDisabledCheckForDrJonesNetworkAgent) ||\n            (this.#props.agentType === \"drjones-file\" /* AgentType.DRJONES_FILE */ && isInputDisabledCheckForDrJonesFileAgent) ||\n            !isAidaAvailable || isConsentView || !this.#props.agentType;\n    };\n    #handleScroll = (ev) => {\n        if (!ev.target || !(ev.target instanceof HTMLElement)) {\n            return;\n        }\n        this.#scrollTop = ev.target.scrollTop;\n    };\n    #handleSubmit = (ev) => {\n        ev.preventDefault();\n        const textArea = this.#shadow.querySelector('.chat-input');\n        if (!textArea || !textArea.value) {\n            return;\n        }\n        this.#props.onTextSubmit(textArea.value);\n        textArea.value = '';\n    };\n    #handleTextAreaKeyDown = (ev) => {\n        if (!ev.target || !(ev.target instanceof HTMLTextAreaElement)) {\n            return;\n        }\n        if (ev.key === 'Enter' && !ev.shiftKey) {\n            // Do not go to a new line whenver Shift + Enter is pressed.\n            ev.preventDefault();\n            // Only submit the text when there isn't a request already in flight.\n            if (!this.#props.isLoading) {\n                this.#props.onTextSubmit(ev.target.value);\n                ev.target.value = '';\n            }\n        }\n    };\n    #handleCancel = (ev) => {\n        ev.preventDefault();\n        if (!this.#props.isLoading) {\n            return;\n        }\n        this.#props.onCancelClick();\n    };\n    #handleSuggestionClick = (suggestion) => {\n        this.#setInputText(suggestion);\n        this.focusTextInput();\n    };\n    #renderRateButtons(rpcId) {\n        // clang-format off\n        return html `<devtools-provide-feedback\n      .props=${{\n            onFeedbackSubmit: (rating, feedback) => {\n                this.#props.onFeedbackSubmit(rpcId, rating, feedback);\n            },\n            canShowFeedbackForm: this.#props.canShowFeedbackForm,\n        }}\n      ></devtools-provide-feedback>`;\n        // clang-format on\n    }\n    #renderTextAsMarkdown(text) {\n        let tokens = [];\n        try {\n            tokens = Marked.Marked.lexer(text);\n            for (const token of tokens) {\n                // Try to render all the tokens to make sure that\n                // they all have a template defined for them. If there\n                // isn't any template defined for a token, we'll fallback\n                // to rendering the text as plain text instead of markdown.\n                this.#markdownRenderer.renderToken(token);\n            }\n        }\n        catch (err) {\n            // The tokens were not parsed correctly or\n            // one of the tokens are not supported, so we\n            // continue to render this as text.\n            return html `${text}`;\n        }\n        // clang-format off\n        return html `<devtools-markdown-view\n      .data=${{ tokens, renderer: this.#markdownRenderer }}>\n    </devtools-markdown-view>`;\n        // clang-format on\n    }\n    #renderTitle(step) {\n        const paused = step.sideEffect ? html `<span class=\"paused\">${lockedString(UIStringsNotTranslate.paused)}: </span>` :\n            LitHtml.nothing;\n        const actionTitle = step.title ?? `${lockedString(UIStringsNotTranslate.investigating)}`;\n        return html `<span class=\"title\">${paused}${actionTitle}</span>`;\n    }\n    #renderStepCode(step) {\n        if (!step.code && !step.output) {\n            return LitHtml.nothing;\n        }\n        // If there is no \"output\" yet, it means we didn't execute the code yet (e.g. maybe it is still waiting for confirmation from the user)\n        // thus we show \"Code to execute\" text rather than \"Code executed\" text on the heading of the code block.\n        const codeHeadingText = (step.output && !step.canceled) ? lockedString(UIStringsNotTranslate.codeExecuted) :\n            lockedString(UIStringsNotTranslate.codeToExecute);\n        // If there is output, we don't show notice on this code block and instead show\n        // it in the data returned code block.\n        // clang-format off\n        const code = step.code ? html `<div class=\"action-result\">\n        <devtools-code-block\n          .code=${step.code.trim()}\n          .codeLang=${'js'}\n          .displayNotice=${!Boolean(step.output)}\n          .header=${codeHeadingText}\n          .showCopyButton=${true}\n        ></devtools-code-block>\n    </div>` :\n            LitHtml.nothing;\n        const output = step.output ? html `<div class=\"js-code-output\">\n      <devtools-code-block\n        .code=${step.output}\n        .codeLang=${'js'}\n        .displayNotice=${true}\n        .header=${lockedString(UIStringsNotTranslate.dataReturned)}\n        .showCopyButton=${false}\n      ></devtools-code-block>\n    </div>` :\n            LitHtml.nothing;\n        return html `<div class=\"step-code\">${code}${output}</div>`;\n        // clang-format on\n    }\n    #renderStepDetails(step, options) {\n        const sideEffects = options.isLast && step.sideEffect ? this.#renderSideEffectConfirmationUi(step) : LitHtml.nothing;\n        const thought = step.thought ? html `<p>${this.#renderTextAsMarkdown(step.thought)}</p>` : LitHtml.nothing;\n        // clang-format off\n        const contextDetails = step.contextDetails ?\n            html `${LitHtml.Directives.repeat(step.contextDetails, contextDetail => {\n                return html `<div class=\"context-details\">\n        <devtools-code-block\n          .code=${contextDetail.text}\n          .codeLang=${contextDetail.codeLang || ''}\n          .displayNotice=${false}\n          .header=${contextDetail.title}\n          .showCopyButton=${true}\n        ></devtools-code-block>\n      </div>`;\n            })}` : LitHtml.nothing;\n        return html `<div class=\"step-details\">\n      ${thought}\n      ${this.#renderStepCode(step)}\n      ${sideEffects}\n      ${contextDetails}\n    </div>`;\n        // clang-format on\n    }\n    #renderStepBadge(step, options) {\n        if (this.#props.isLoading && options.isLast && !step.sideEffect) {\n            return html `<devtools-spinner></devtools-spinner>`;\n        }\n        let iconName = 'checkmark';\n        let ariaLabel = lockedString(UIStringsNotTranslate.completed);\n        let role = 'button';\n        if (options.isLast && step.sideEffect) {\n            role = undefined;\n            ariaLabel = undefined;\n            iconName = 'pause-circle';\n        }\n        else if (step.canceled) {\n            ariaLabel = lockedString(UIStringsNotTranslate.canceled);\n            iconName = 'cross';\n        }\n        return html `<devtools-icon\n        class=\"indicator\"\n        role=${ifDefined(role)}\n        aria-label=${ifDefined(ariaLabel)}\n        .name=${iconName}\n      ></devtools-icon>`;\n    }\n    #renderStep(step, options) {\n        const stepClasses = LitHtml.Directives.classMap({\n            step: true,\n            empty: !step.thought && !step.code && !step.contextDetails,\n            paused: Boolean(step.sideEffect),\n            canceled: Boolean(step.canceled),\n        });\n        // clang-format off\n        return html `\n      <details class=${stepClasses}\n        jslog=${VisualLogging.section('step')}\n        .open=${Boolean(step.sideEffect)}>\n        <summary>\n          <div class=\"summary\">\n            ${this.#renderStepBadge(step, options)}\n            ${this.#renderTitle(step)}\n            <devtools-icon\n              class=\"arrow\"\n              .name=${'chevron-down'}\n            ></devtools-icon>\n          </div>\n        </summary>\n        ${this.#renderStepDetails(step, {\n            isLast: options.isLast,\n        })}\n      </details>`;\n        // clang-format on\n    }\n    #renderSideEffectConfirmationUi(step) {\n        if (!step.sideEffect) {\n            return LitHtml.nothing;\n        }\n        const sideEffectAction = (answer) => {\n            step.sideEffect?.onAnswer(answer);\n            step.sideEffect = undefined;\n            this.#render();\n        };\n        // clang-format off\n        return html `<div\n      class=\"side-effect-confirmation\"\n      jslog=${VisualLogging.section('side-effect-confirmation')}\n    >\n      <p>${lockedString(UIStringsNotTranslate.sideEffectConfirmationDescription)}</p>\n      <div class=\"side-effect-buttons-container\">\n        <devtools-button\n          .data=${{\n            variant: \"outlined\" /* Buttons.Button.Variant.OUTLINED */,\n            jslogContext: 'decline-execute-code',\n        }}\n          @click=${() => sideEffectAction(false)}\n        >${lockedString(UIStringsNotTranslate.negativeSideEffectConfirmation)}</devtools-button>\n        <devtools-button\n          .data=${{\n            variant: \"primary\" /* Buttons.Button.Variant.PRIMARY */,\n            jslogContext: 'accept-execute-code',\n            iconName: 'play',\n        }}\n          @click=${() => sideEffectAction(true)}\n        >${lockedString(UIStringsNotTranslate.positiveSideEffectConfirmation)}</devtools-button>\n      </div>\n    </div>`;\n        // clang-format on\n    }\n    #renderError(message) {\n        if (message.error) {\n            let errorMessage;\n            switch (message.error) {\n                case \"unknown\" /* ErrorType.UNKNOWN */:\n                    errorMessage = UIStringsNotTranslate.systemError;\n                    break;\n                case \"max-steps\" /* ErrorType.MAX_STEPS */:\n                    errorMessage = UIStringsNotTranslate.maxStepsError;\n                    break;\n                case \"abort\" /* ErrorType.ABORT */:\n                    return html `<p class=\"aborted\" jslog=${VisualLogging.section('aborted')}>${lockedString(UIStringsNotTranslate.stoppedResponse)}</p>`;\n            }\n            return html `<p class=\"error\" jslog=${VisualLogging.section('error')}>${lockedString(errorMessage)}</p>`;\n        }\n        return LitHtml.nothing;\n    }\n    #renderChatMessage = (message, { isLast }) => {\n        if (message.entity === \"user\" /* ChatMessageEntity.USER */) {\n            const name = this.#props.userInfo.accountFullName || lockedString(UIStringsNotTranslate.you);\n            const image = this.#props.userInfo.accountImage ?\n                html `<img src=\"data:image/png;base64, ${this.#props.userInfo.accountImage}\" alt=\"Account avatar\" />` :\n                html `<devtools-icon\n            .name=${'profile'}\n          ></devtools-icon>`;\n            // clang-format off\n            return html `<section\n        class=\"chat-message query\"\n        jslog=${VisualLogging.section('question')}\n      >\n        <div class=\"message-info\">\n          ${image}\n          <div class=\"message-name\">\n            <h2>${name}</h2>\n          </div>\n        </div>\n        <div class=\"message-content\">${this.#renderTextAsMarkdown(message.text)}</div>\n      </section>`;\n            // clang-format on\n        }\n        const shouldShowSuggestions = (isLast && !this.#props.isLoading && message.suggestions);\n        // clang-format off\n        return html `\n      <section class=\"chat-message answer\" jslog=${VisualLogging.section('answer')}>\n        <div class=\"message-info\">\n          <devtools-icon\n            name=\"smart-assistant\"\n          ></devtools-icon>\n          <div class=\"message-name\">\n            <h2>${lockedString(UIStringsNotTranslate.ai)}</h2>\n          </div>\n        </div>\n        ${LitHtml.Directives.repeat(message.steps, (_, index) => index, step => {\n            return this.#renderStep(step, {\n                isLast: [...message.steps.values()].at(-1) === step && isLast,\n            });\n        })}\n        ${message.answer\n            ? html `<p>${this.#renderTextAsMarkdown(message.answer)}</p>`\n            : LitHtml.nothing}\n        ${this.#renderError(message)}\n        <div class=\"actions\">\n          ${message.rpcId !== undefined\n            ? this.#renderRateButtons(message.rpcId)\n            : LitHtml.nothing}\n          ${shouldShowSuggestions ?\n            html `<div class=\"suggestions\">\n              ${message.suggestions?.map(suggestion => html `<devtools-button\n                  .data=${{\n                variant: \"outlined\" /* Buttons.Button.Variant.OUTLINED */,\n                title: suggestion,\n                jslogContext: 'suggestion',\n            }}\n                  @click=${() => this.#handleSuggestionClick(suggestion)}\n                >${suggestion}</devtools-button>`)}\n            </div>` : LitHtml.nothing}\n        </div>\n      </section>\n    `;\n        // clang-format on\n    };\n    #renderSelection() {\n        if (!this.#props.agentType) {\n            return LitHtml.nothing;\n        }\n        switch (this.#props.agentType) {\n            case \"freestyler\" /* AgentType.FREESTYLER */:\n                return this.#renderSelectAnElement();\n            case \"drjones-file\" /* AgentType.DRJONES_FILE */:\n                return this.#renderSelectedFileName();\n            case \"drjones-network-request\" /* AgentType.DRJONES_NETWORK_REQUEST */:\n                return this.#renderSelectedNetworkRequest();\n            case \"drjones-performance\" /* AgentType.DRJONES_PERFORMANCE */:\n                return this.#renderSelectedTask();\n        }\n    }\n    #renderSelectedFileName() {\n        const resourceClass = LitHtml.Directives.classMap({\n            'not-selected': !this.#props.selectedFile,\n            'resource-link': true,\n        });\n        if (!this.#props.selectedFile) {\n            return html `${LitHtml.nothing}`;\n        }\n        const icon = PanelUtils.getIconForSourceFile(this.#props.selectedFile);\n        // clang-format off\n        return html `<div class=\"select-element\">\n    <div role=button class=${resourceClass}\n    @click=${this.#props.onSelectedFileRequestClick}>\n      ${icon}${this.#props.selectedFile?.displayName()}\n    </div></div>`;\n        // clang-format on\n    }\n    #renderSelectedNetworkRequest = () => {\n        const resourceClass = LitHtml.Directives.classMap({\n            'not-selected': !this.#props.selectedNetworkRequest,\n            'resource-link': true,\n        });\n        if (!this.#props.selectedNetworkRequest) {\n            return html `${LitHtml.nothing}`;\n        }\n        const icon = PanelUtils.getIconForNetworkRequest(this.#props.selectedNetworkRequest);\n        // clang-format off\n        return html `<div class=\"select-element\">\n    <div role=button class=${resourceClass}\n    @click=${this.#props.onSelectedNetworkRequestClick}>\n      ${icon}${this.#props.selectedNetworkRequest?.name()}\n    </div></div>`;\n        // clang-format on\n    };\n    #renderSelectAnElement = () => {\n        const resourceClass = LitHtml.Directives.classMap({\n            'not-selected': !this.#props.selectedElement,\n            'resource-link': true,\n        });\n        // clang-format off\n        return html `\n      <div class=\"select-element\">\n        <devtools-button\n          .data=${{\n            variant: \"icon_toggle\" /* Buttons.Button.Variant.ICON_TOGGLE */,\n            size: \"REGULAR\" /* Buttons.Button.Size.REGULAR */,\n            iconName: 'select-element',\n            toggledIconName: 'select-element',\n            toggleType: \"primary-toggle\" /* Buttons.Button.ToggleType.PRIMARY */,\n            toggled: this.#props.inspectElementToggled,\n            title: lockedString(UIStringsNotTranslate.selectAnElement),\n            jslogContext: 'select-element',\n        }}\n          @click=${this.#props.onInspectElementClick}\n        ></devtools-button>\n        <div class=${resourceClass}>${this.#props.selectedElement\n            ? LitHtml.Directives.until(Common.Linkifier.Linkifier.linkify(this.#props.selectedElement))\n            : html `<span>${lockedString(UIStringsNotTranslate.noElementSelected)}</span>`}</div>\n      </div>`;\n        // clang-format on\n    };\n    #renderSelectedTask = () => {\n        const resourceClass = LitHtml.Directives.classMap({\n            'not-selected': !this.#props.selectedStackTrace,\n            'resource-task': true,\n        });\n        if (!this.#props.selectedStackTrace) {\n            return html `${LitHtml.nothing}`;\n        }\n        const selectedNode = Trace.Helpers.TreeHelpers.TraceEntryNodeForAI.getSelectedNodeForTraceEntryTreeForAI(this.#props.selectedStackTrace);\n        if (!selectedNode) {\n            return html `${LitHtml.nothing}`;\n        }\n        let displayName = selectedNode.type;\n        if (selectedNode.type === 'ProfileCall' && selectedNode.function) {\n            displayName = selectedNode.function;\n        }\n        const iconData = {\n            iconName: 'performance',\n            color: 'var(--sys-color-on-surface-subtle)',\n        };\n        const icon = PanelUtils.createIconElement(iconData, 'Performance');\n        icon.classList.add('icon');\n        // TODO(b/371118936): Make the div clickable\n        // clang-format off\n        return html `<div class=\"select-element\">\n    <div class=${resourceClass}>\n      ${icon}${displayName}\n    </div></div>`;\n        // clang-format on\n    };\n    #renderMessages = () => {\n        // clang-format off\n        return html `\n      <div class=\"messages-scroll-container\" @scroll=${this.#handleScroll}>\n        <div class=\"messages-container\">\n          ${this.#props.messages.map((message, _, array) => this.#renderChatMessage(message, {\n            isLast: array.at(-1) === message,\n        }))}\n        </div>\n      </div>\n    `;\n        // clang-format on\n    };\n    #renderEmptyState = () => {\n        const suggestions = this.#getEmptyStateSuggestions();\n        // clang-format off\n        return html `<div class=\"empty-state-container messages-scroll-container\">\n      <div class=\"header\">\n        <div class=\"icon\">\n          <devtools-icon\n            name=\"smart-assistant\"\n          ></devtools-icon>\n        </div>\n        <h1>${lockedString(UIStringsNotTranslate.emptyStateText)}</h1>\n      </div>\n      <div class=\"suggestions\">\n        ${suggestions.map(suggestion => {\n            return html `<devtools-button\n            class=\"suggestion\"\n            @click=${() => this.#handleSuggestionClick(suggestion)}\n            .data=${{\n                variant: \"outlined\" /* Buttons.Button.Variant.OUTLINED */,\n                size: \"REGULAR\" /* Buttons.Button.Size.REGULAR */,\n                title: suggestion,\n                jslogContext: 'suggestion',\n                disabled: this.#isTextInputDisabled(),\n            }}\n          >${suggestion}</devtools-button>`;\n        })}\n      </div>\n    </div>`;\n        // clang-format on\n    };\n    #getEmptyStateSuggestions = () => {\n        if (!this.#props.agentType) {\n            return [];\n        }\n        switch (this.#props.agentType) {\n            case \"freestyler\" /* AgentType.FREESTYLER */:\n                return [\n                    'What can you help me with?',\n                    'Why isnt this element visible?',\n                    'How do I center this element?',\n                ];\n            case \"drjones-file\" /* AgentType.DRJONES_FILE */:\n                return [\n                    'What does this script do?',\n                    'Is the script optimized for performance?',\n                    'Does the script handle user input safely?',\n                ];\n            case \"drjones-network-request\" /* AgentType.DRJONES_NETWORK_REQUEST */:\n                return [\n                    'Why is this network request taking so long?',\n                    'Are there any security headers present?',\n                    'Why is the request failing?',\n                ];\n            case \"drjones-performance\" /* AgentType.DRJONES_PERFORMANCE */:\n                return [\n                    'Identify performance issues in this call stack',\n                    'Where is most of the time being spent in this call stack?',\n                    'How can I reduce the time of this call stack?',\n                ];\n        }\n    };\n    #renderChatInput = () => {\n        // clang-format off\n        return html `\n      <div class=\"chat-input-container\">\n        <textarea class=\"chat-input\"\n          .disabled=${this.#isTextInputDisabled()}\n          wrap=\"hard\"\n          @keydown=${this.#handleTextAreaKeyDown}\n          placeholder=${getInputPlaceholderString(this.#props.state, this.#props.agentType)}\n          jslog=${VisualLogging.textField('query').track({ keydown: 'Enter' })}></textarea>\n          ${this.#props.isLoading\n            ? html `<devtools-button\n              class=\"chat-input-button\"\n              aria-label=${lockedString(UIStringsNotTranslate.cancelButtonTitle)}\n              @click=${this.#handleCancel}\n              .data=${{\n                variant: \"icon\" /* Buttons.Button.Variant.ICON */,\n                size: \"REGULAR\" /* Buttons.Button.Size.REGULAR */,\n                disabled: this.#isTextInputDisabled(),\n                iconName: 'record-stop',\n                title: lockedString(UIStringsNotTranslate.cancelButtonTitle),\n                jslogContext: 'stop',\n            }}\n            ></devtools-button>`\n            : html `<devtools-button\n              class=\"chat-input-button\"\n              aria-label=${lockedString(UIStringsNotTranslate.sendButtonTitle)}\n              .data=${{\n                type: 'submit',\n                variant: \"icon\" /* Buttons.Button.Variant.ICON */,\n                size: \"REGULAR\" /* Buttons.Button.Size.REGULAR */,\n                disabled: this.#isTextInputDisabled(),\n                iconName: 'send',\n                title: lockedString(UIStringsNotTranslate.sendButtonTitle),\n                jslogContext: 'send',\n            }}\n            ></devtools-button>`}\n      </div>`;\n        // clang-format on\n    };\n    #getDisclaimerText = () => {\n        if (this.#props.state === \"consent-view\" /* State.CONSENT_VIEW */ || !this.#props.agentType) {\n            return i18nString(UIStrings.inputDisclaimerForEmptyState);\n        }\n        switch (this.#props.agentType) {\n            case \"freestyler\" /* AgentType.FREESTYLER */:\n                return lockedString(UIStringsNotTranslate.inputDisclaimerForFreestylerAgent);\n            case \"drjones-file\" /* AgentType.DRJONES_FILE */:\n                return lockedString(UIStringsNotTranslate.inputDisclaimerForDrJonesFileAgent);\n            case \"drjones-network-request\" /* AgentType.DRJONES_NETWORK_REQUEST */:\n                return lockedString(UIStringsNotTranslate.inputDisclaimerForDrJonesNetworkAgent);\n            case \"drjones-performance\" /* AgentType.DRJONES_PERFORMANCE */:\n                return lockedString(UIStringsNotTranslate.inputDisclaimerForDrJonesPerformanceAgent);\n        }\n    };\n    #getConsentViewContents() {\n        const settingsLink = document.createElement('button');\n        settingsLink.textContent = i18nString(UIStrings.settingsLink);\n        settingsLink.classList.add('link');\n        UI.ARIAUtils.markAsLink(settingsLink);\n        settingsLink.addEventListener('click', () => {\n            void UI.ViewManager.ViewManager.instance().showView('chrome-ai');\n        });\n        settingsLink.setAttribute('jslog', `${VisualLogging.action('open-ai-settings').track({ click: true })}`);\n        const config = Common.Settings.Settings.instance().getHostConfig();\n        return html `${config.devToolsExplainThisResourceDogfood?.enabled ?\n            i18n.i18n.getFormatLocalizedString(str_, UIStrings.turnOnForStylesAndRequests, { PH1: settingsLink }) :\n            i18n.i18n.getFormatLocalizedString(str_, UIStrings.turnOnForStyles, { PH1: settingsLink })}`;\n    }\n    #getUnavailableAidaAvailabilityContents(aidaAvailability) {\n        switch (aidaAvailability) {\n            case \"no-account-email\" /* Host.AidaClient.AidaAccessPreconditions.NO_ACCOUNT_EMAIL */:\n            case \"sync-is-paused\" /* Host.AidaClient.AidaAccessPreconditions.SYNC_IS_PAUSED */: {\n                return html `${i18nString(UIStrings.notLoggedIn)}`;\n            }\n            case \"no-internet\" /* Host.AidaClient.AidaAccessPreconditions.NO_INTERNET */: {\n                return html `${i18nString(UIStrings.offline)}`;\n            }\n        }\n    }\n    #renderDisabledState(contents) {\n        // clang-format off\n        return html `\n      <div class=\"empty-state-container messages-scroll-container\">\n        <div class=\"disabled-view\">\n          <div class=\"disabled-view-icon-container\">\n            <devtools-icon .data=${{\n            iconName: 'smart-assistant',\n            width: 'var(--sys-size-8)',\n            height: 'var(--sys-size-8)',\n        }}>\n            </devtools-icon>\n          </div>\n          <div>\n            ${contents}\n          </div>\n        </div>\n      </div>\n    `;\n        // clang-format on\n    }\n    #renderNoAgentState() {\n        const config = Common.Settings.Settings.instance().getHostConfig();\n        // clang-format off\n        return html `\n      <main class=\"messages-scroll-container\" @scroll=${this.#handleScroll}>\n        <div class=\"messages-container\">\n          <section class=\"no-agent-message\" jslog=${VisualLogging.section('no-agent-entrypoint')}>\n            <div class=\"header\">\n              <devtools-icon name=\"smart-assistant\"></devtools-icon>\n              <h2>${lockedString(UIStringsNotTranslate.ai)}</h2>\n            </div>\n            <div class=\"instructions\">\n              <p>${lockedString(UIStringsNotTranslate.getStarted)}</p>\n              ${config.devToolsFreestyler?.enabled ? html `\n                <p><strong>${lockedString(UIStringsNotTranslate.cssHelp)}</strong> ${lockedString(UIStringsNotTranslate.cssHelpExplainer)}</p>\n              ` : LitHtml.nothing}\n              ${config.devToolsAiAssistanceFileAgentDogfood?.enabled ? html `\n                <p><strong>${lockedString(UIStringsNotTranslate.fileHelp)}</strong> ${lockedString(UIStringsNotTranslate.fileHelpExplainer)}</p>\n              ` : LitHtml.nothing}\n              ${config.devToolsExplainThisResourceDogfood?.enabled ? html `\n                <p><strong>${lockedString(UIStringsNotTranslate.networkHelp)}</strong> ${lockedString(UIStringsNotTranslate.networkHelpExplainer)}</p>\n              ` : LitHtml.nothing}\n              ${config.devToolsAiAssistancePerformanceAgentDogfood?.enabled ? html `\n                <p><strong>${lockedString(UIStringsNotTranslate.performanceHelp)}</strong> ${lockedString(UIStringsNotTranslate.performanceHelpExplainer)}</p>\n              ` : LitHtml.nothing}\n            </div>\n          </section>\n        </div>\n      </main>\n    `;\n        // clang-format on\n    }\n    #renderMainContents() {\n        if (this.#props.state === \"consent-view\" /* State.CONSENT_VIEW */) {\n            return this.#renderDisabledState(this.#getConsentViewContents());\n        }\n        if (this.#props.aidaAvailability !== \"available\" /* Host.AidaClient.AidaAccessPreconditions.AVAILABLE */) {\n            return this.#renderDisabledState(this.#getUnavailableAidaAvailabilityContents(this.#props.aidaAvailability));\n        }\n        if (!this.#props.agentType) {\n            return this.#renderNoAgentState();\n        }\n        if (this.#props.messages.length > 0) {\n            return this.#renderMessages();\n        }\n        return this.#renderEmptyState();\n    }\n    #render() {\n        // clang-format off\n        LitHtml.render(html `\n      <div class=\"chat-ui\">\n        <main>\n          ${this.#renderMainContents()}\n          <form class=\"input-form\" @submit=${this.#handleSubmit}>\n            ${this.#props.state !== \"consent-view\" /* State.CONSENT_VIEW */ ? html `\n              <div class=\"input-header\">\n                <div class=\"header-link-container\">\n                  ${this.#renderSelection()}\n                </div>\n              </div>\n            ` : LitHtml.nothing}\n            ${this.#renderChatInput()}\n          </form>\n        </main>\n        <footer class=\"disclaimer\">\n          <p class=\"disclaimer-text\">\n            ${this.#getDisclaimerText()}\n            <x-link\n              class=\"link\"\n              jslog=${VisualLogging.link('open-ai-settings').track({\n            click: true,\n        })}\n              @click=${(event) => {\n            event.preventDefault();\n            void UI.ViewManager.ViewManager.instance().showView('chrome-ai');\n        }}\n            >${i18nString(UIStrings.learnAbout)}</x-link>\n          </p>\n        </footer>\n      </div>\n    `, this.#shadow, { host: this });\n        // clang-format on\n    }\n}\nexport const FOR_TEST = {\n    MarkdownRendererWithCodeBlock,\n};\ncustomElements.define('devtools-freestyler-chat-ui', FreestylerChatUi);\n//# sourceMappingURL=FreestylerChatUi.js.map","// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\nimport * as Common from '../../core/common/common.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport { AI_ASSISTANCE_CSS_CLASS_NAME } from './ChangeManager.js';\nexport const FREESTYLER_WORLD_NAME = 'devtools_freestyler';\nexport const FREESTYLER_BINDING_NAME = '__freestyler';\n/**\n * Injects Freestyler extension functions in to the isolated world.\n */\nexport class ExtensionScope {\n    #listeners = [];\n    #changeManager;\n    #frameId;\n    #target;\n    #bindingMutex = new Common.Mutex.Mutex();\n    constructor(changes) {\n        this.#changeManager = changes;\n        const selectedNode = UI.Context.Context.instance().flavor(SDK.DOMModel.DOMNode);\n        const frameId = selectedNode?.frameId();\n        const target = selectedNode?.domModel().target();\n        this.#target = target;\n        this.#frameId = frameId;\n    }\n    get target() {\n        if (this.#target) {\n            return this.#target;\n        }\n        const target = UI.Context.Context.instance().flavor(SDK.Target.Target);\n        if (!target) {\n            throw new Error('Target is not found for executing code');\n        }\n        return target;\n    }\n    get frameId() {\n        if (this.#frameId) {\n            return this.#frameId;\n        }\n        const resourceTreeModel = this.target.model(SDK.ResourceTreeModel.ResourceTreeModel);\n        if (!resourceTreeModel?.mainFrame) {\n            throw new Error('Main frame is not found for executing code');\n        }\n        return resourceTreeModel.mainFrame.id;\n    }\n    async install() {\n        const runtimeModel = this.target.model(SDK.RuntimeModel.RuntimeModel);\n        const pageAgent = this.target.pageAgent();\n        // This returns previously created world if it exists for the frame.\n        const { executionContextId } = await pageAgent.invoke_createIsolatedWorld({ frameId: this.frameId, worldName: FREESTYLER_WORLD_NAME });\n        const isolatedWorldContext = runtimeModel?.executionContext(executionContextId);\n        if (!isolatedWorldContext) {\n            throw new Error('Execution context is not found for executing code');\n        }\n        const handler = this.#bindingCalled.bind(this, isolatedWorldContext);\n        runtimeModel?.addEventListener(SDK.RuntimeModel.Events.BindingCalled, handler);\n        this.#listeners.push(handler);\n        await this.target.runtimeAgent().invoke_addBinding({\n            name: FREESTYLER_BINDING_NAME,\n            executionContextId,\n        });\n        await this.#simpleEval(isolatedWorldContext, freestylerBinding);\n        await this.#simpleEval(isolatedWorldContext, functions);\n    }\n    async uninstall() {\n        const runtimeModel = this.target.model(SDK.RuntimeModel.RuntimeModel);\n        for (const handler of this.#listeners) {\n            runtimeModel?.removeEventListener(SDK.RuntimeModel.Events.BindingCalled, handler);\n        }\n        this.#listeners = [];\n        await this.target.runtimeAgent().invoke_removeBinding({\n            name: FREESTYLER_BINDING_NAME,\n        });\n    }\n    async #simpleEval(context, expression) {\n        const response = await context.evaluate({\n            expression,\n            replMode: true,\n            includeCommandLineAPI: false,\n            returnByValue: true,\n            silent: false,\n            generatePreview: false,\n            allowUnsafeEvalBlockedByCSP: true,\n            throwOnSideEffect: false,\n        }, \n        /* userGesture */ false, /* awaitPromise */ true);\n        if (!response) {\n            throw new Error('Response is not found');\n        }\n        if ('error' in response) {\n            throw new Error(response.error);\n        }\n        if (response.exceptionDetails) {\n            const exceptionDescription = response.exceptionDetails.exception?.description;\n            throw new Error(exceptionDescription || 'JS exception');\n        }\n        return response;\n    }\n    async #bindingCalled(executionContext, event) {\n        const { data } = event;\n        if (data.name !== FREESTYLER_BINDING_NAME) {\n            return;\n        }\n        await this.#bindingMutex.run(async () => {\n            const id = data.payload;\n            const { object } = await this.#simpleEval(executionContext, `freestyler.getArgs(${id})`);\n            const arg = JSON.parse(object.value);\n            const selector = arg.selector;\n            const className = arg.className;\n            const cssModel = this.target.model(SDK.CSSModel.CSSModel);\n            if (!cssModel) {\n                throw new Error('CSSModel is not found');\n            }\n            await this.#changeManager.addChange(cssModel, this.frameId, {\n                selector,\n                className,\n                styles: arg.styles,\n            });\n            await this.#simpleEval(executionContext, `freestyler.respond(${id})`);\n        });\n    }\n}\nconst freestylerBinding = `globalThis.freestyler = (args) => {\n  let resolver;\n  let rejecter;\n  const p = new Promise((resolve, reject) => {\n    resolver = resolve;\n    rejecter = reject;\n  });\n  freestyler.callbacks.set(freestyler.id , {\n    args: JSON.stringify(args),\n    callbackId: freestyler.id,\n    resolver,\n    rejecter\n  });\n  ${FREESTYLER_BINDING_NAME}(String(freestyler.id));\n  freestyler.id++;\n  return p;\n}\nfreestyler.id = 1;\nfreestyler.callbacks = new Map();\nfreestyler.getArgs = (callbackId) => {\n  return freestyler.callbacks.get(callbackId).args;\n}\nfreestyler.respond = (callbackId) => {\n  freestyler.callbacks.get(callbackId).resolver();\n  freestyler.callbacks.delete(callbackId);\n}`;\nconst functions = `async function setElementStyles(el, styles) {\n  let selector = el.tagName.toLowerCase();\n  if (el.id) {\n    selector = '#' + el.id;\n  } else if (el.classList.length) {\n    const parts = [];\n    for (const cls of el.classList) {\n      if (cls.startsWith('${AI_ASSISTANCE_CSS_CLASS_NAME}')) {\n        continue;\n      }\n      parts.push('.' + cls);\n    }\n    if (parts.length) {\n      selector = parts.join('');\n    }\n  }\n\n  // __freestylerClassName is not exposed to the page due to this being\n  // run in the isolated world.\n  const className = el.__freestylerClassName ?? '${AI_ASSISTANCE_CSS_CLASS_NAME}-' + freestyler.id;\n  el.__freestylerClassName = className;\n  el.classList.add(className);\n\n  // Remove inline styles with the same keys so that the edit applies.\n  for (const [key, value] of Object.entries(styles)) {\n    // if it's kebap case.\n    el.style.removeProperty(key);\n    // If it's camel case.\n    el.style[key] = '';\n  }\n\n  await freestyler({\n    method: 'setElementStyles',\n    selector: selector,\n    className,\n    styles\n  });\n}`;\n//# sourceMappingURL=ExtensionScope.js.map","// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\nimport * as SDK from '../../core/sdk/sdk.js';\nexport class ExecutionError extends Error {\n}\nexport class SideEffectError extends Error {\n}\n/* istanbul ignore next */\nfunction stringifyObjectOnThePage() {\n    const seenBefore = new WeakMap();\n    return JSON.stringify(this, function replacer(key, value) {\n        if (typeof value === 'object' && value !== null) {\n            if (seenBefore.has(value)) {\n                return '(cycle)';\n            }\n            seenBefore.set(value, true);\n        }\n        if (value instanceof HTMLElement) {\n            const idAttribute = value.id ? ` id=\"${value.id}\"` : '';\n            const classAttribute = value.classList.value ? ` class=\"${value.classList.value}\"` : '';\n            return `<${value.nodeName.toLowerCase()}${idAttribute}${classAttribute}>${value.hasChildNodes() ? '...' : ''}</${value.nodeName.toLowerCase()}>`;\n        }\n        if (this instanceof CSSStyleDeclaration) {\n            // Do not add number keys to the output.\n            if (!isNaN(Number(key))) {\n                return undefined;\n            }\n        }\n        return value;\n    });\n}\nasync function stringifyRemoteObject(object) {\n    switch (object.type) {\n        case \"string\" /* Protocol.Runtime.RemoteObjectType.String */:\n            return `'${object.value}'`;\n        case \"bigint\" /* Protocol.Runtime.RemoteObjectType.Bigint */:\n            return `${object.value}n`;\n        case \"boolean\" /* Protocol.Runtime.RemoteObjectType.Boolean */:\n        case \"number\" /* Protocol.Runtime.RemoteObjectType.Number */:\n            return `${object.value}`;\n        case \"undefined\" /* Protocol.Runtime.RemoteObjectType.Undefined */:\n            return 'undefined';\n        case \"symbol\" /* Protocol.Runtime.RemoteObjectType.Symbol */:\n        case \"function\" /* Protocol.Runtime.RemoteObjectType.Function */:\n            return `${object.description}`;\n        case \"object\" /* Protocol.Runtime.RemoteObjectType.Object */: {\n            const res = await object.callFunction(stringifyObjectOnThePage);\n            if (!res.object || res.object.type !== \"string\" /* Protocol.Runtime.RemoteObjectType.String */) {\n                throw new Error('Could not stringify the object' + object);\n            }\n            return res.object.value;\n        }\n        default:\n            throw new Error('Unknown type to stringify ' + object.type);\n    }\n}\nexport class FreestylerEvaluateAction {\n    static async execute(code, executionContext, { throwOnSideEffect }) {\n        if (executionContext.debuggerModel.selectedCallFrame()) {\n            throw new ExecutionError('Cannot evaluate JavaScript because the execution is paused on a breakpoint.');\n        }\n        const response = await executionContext.evaluate({\n            expression: code,\n            replMode: true,\n            includeCommandLineAPI: true,\n            returnByValue: false,\n            silent: false,\n            generatePreview: true,\n            allowUnsafeEvalBlockedByCSP: false,\n            throwOnSideEffect,\n        }, \n        /* userGesture */ false, /* awaitPromise */ true);\n        try {\n            if (!response) {\n                throw new Error('Response is not found');\n            }\n            if ('error' in response) {\n                throw new ExecutionError(response.error);\n            }\n            if (response.exceptionDetails) {\n                const exceptionDescription = response.exceptionDetails.exception?.description;\n                if (SDK.RuntimeModel.RuntimeModel.isSideEffectFailure(response)) {\n                    throw new SideEffectError(exceptionDescription);\n                }\n                throw new ExecutionError(exceptionDescription || 'JS exception');\n            }\n            return stringifyRemoteObject(response.object);\n        }\n        finally {\n            executionContext.runtimeModel.releaseEvaluationResult(response);\n        }\n    }\n}\n//# sourceMappingURL=FreestylerEvaluateAction.js.map","// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\nimport * as Common from '../../core/common/common.js';\nimport * as Host from '../../core/host/host.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport * as Platform from '../../core/platform/platform.js';\nimport * as Root from '../../core/root/root.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport { AiAgent, debugLog, isDebugMode, ResponseType, } from './AiAgent.js';\nimport { ChangeManager } from './ChangeManager.js';\nimport { ExtensionScope, FREESTYLER_WORLD_NAME } from './ExtensionScope.js';\nimport { ExecutionError, FreestylerEvaluateAction, SideEffectError } from './FreestylerEvaluateAction.js';\n/*\n* Strings that don't need to be translated at this time.\n*/\nconst UIStringsNotTranslate = {\n    /**\n     *@description Title for context details for Freestyler.\n     */\n    analyzingThePrompt: 'Analyzing the prompt',\n    /**\n     *@description Heading text for context details of Freestyler agent.\n     */\n    dataUsed: 'Data used',\n};\nconst lockedString = i18n.i18n.lockedString;\n/* clang-format off */\nconst preamble = `You are the most advanced CSS debugging assistant integrated into Chrome DevTools.\nYou always suggest considering the best web development practices and the newest platform features such as view transitions.\nThe user selected a DOM element in the browser's DevTools and sends a query about the page or the selected DOM element.\n\n# Considerations\n* After applying a fix, please ask the user to confirm if the fix worked or not.\n* Meticulously investigate all potential causes for the observed behavior before moving on. Gather comprehensive information about the element's parent, siblings, children, and any overlapping elements, paying close attention to properties that are likely relevant to the query.\n* Avoid making assumptions without sufficient evidence, and always seek further clarification if needed.\n* Always explore multiple possible explanations for the observed behavior before settling on a conclusion.\n* When presenting solutions, clearly distinguish between the primary cause and contributing factors.\n* Please answer only if you are sure about the answer. Otherwise, explain why you're not able to answer.\n* When answering, always consider MULTIPLE possible solutions.\n* You're also capable of executing the fix for the issue user mentioned. Reflect this in your suggestions.\n* Use \\`window.getComputedStyle\\` to gather **rendered** styles and make sure that you take the distinction between authored styles and computed styles into account.\n* **CRITICAL** Use \\`window.getComputedStyle\\` ALWAYS with property access, like \\`window.getComputedStyle($0.parentElement)['color']\\`.\n* **CRITICAL** Never assume a selector for the elements unless you verified your knowledge.\n* **CRITICAL** Consider that \\`data\\` variable from the previous ACTION blocks are not available in a different ACTION block.\n* **CRITICAL** If the user asks a question about religion, race, politics, sexuality, gender, or other sensitive topics, answer with \"Sorry, I can't answer that. I'm best at questions about debugging web pages.\"\n\n# Instructions\nYou are going to answer to the query in these steps:\n* THOUGHT\n* TITLE\n* ACTION\n* ANSWER\n* SUGGESTIONS\nUse THOUGHT to explain why you take the ACTION. Use TITLE to provide a short summary of the thought.\nUse ACTION to evaluate JavaScript code on the page to gather all the data needed to answer the query and put it inside the data variable - then return STOP.\nYou have access to a special $0 variable referencing the current element in the scope of the JavaScript code.\nOBSERVATION will be the result of running the JS code on the page.\nAfter that, you can answer the question with ANSWER or run another ACTION query.\nPlease run ACTION again if the information you received is not enough to answer the query.\nPlease answer only if you are sure about the answer. Otherwise, explain why you're not able to answer.\nWhen answering, remember to consider CSS concepts such as the CSS cascade, explicit and implicit stacking contexts and various CSS layout types.\nWhen answering, always consider MULTIPLE possible solutions.\nAfter the ANSWER, output SUGGESTIONS: string[] for the potential responses the user might give. Make sure that the array and the \\`SUGGESTIONS: \\` text is in the same line.\n\nIf you need to set styles on an HTML element, always call the \\`async setElementStyles(el: Element, styles: object)\\` function.\n\n## Example session\n\nQUERY: Why am I not able to see the popup in this case?\n\nTHOUGHT: There are a few reasons why a popup might not be visible. It could be related to its positioning, its z-index, its display property, or overlapping elements. Let's gather information about these properties for the popup, its parent, and any potentially overlapping elements.\nTITLE: Analyzing popup, container, and overlaps\nACTION\nconst computedStyles = window.getComputedStyle($0);\nconst parentComputedStyles = window.getComputedStyle($0.parentElement);\nconst data = {\n  numberOfChildren: $0.children.length,\n  numberOfSiblings: $0.parentElement.children.length,\n  hasPreviousSibling: !!$0.previousElementSibling,\n  hasNextSibling: !!$0.nextElementSibling,\n  elementStyles: {\n    display: computedStyles['display'],\n    visibility: computedStyles['visibility'],\n    position: computedStyles['position'],\n    clipPath: computedStyles['clip-path'],\n    zIndex: computedStyles['z-index']\n  },\n  parentStyles: {\n    display: parentComputedStyles['display'],\n    visibility: parentComputedStyles['visibility'],\n    position: parentComputedStyles['position'],\n    clipPath: parentComputedStyles['clip-path'],\n    zIndex: parentComputedStyles['z-index']\n  },\n  overlappingElements: Array.from(document.querySelectorAll('*'))\n    .filter(el => {\n      const rect = el.getBoundingClientRect();\n      const popupRect = $0.getBoundingClientRect();\n      return (\n        el !== $0 &&\n        rect.left < popupRect.right &&\n        rect.right > popupRect.left &&\n        rect.top < popupRect.bottom &&\n        rect.bottom > popupRect.top\n      );\n    })\n    .map(el => ({\n      tagName: el.tagName,\n      id: el.id,\n      className: el.className,\n      zIndex: window.getComputedStyle(el)['z-index']\n    }))\n};\nSTOP\n\nOBSERVATION: {\"elementStyles\":{\"display\":\"block\",\"visibility\":\"visible\",\"position\":\"absolute\",\"zIndex\":\"3\",\"opacity\":\"1\"},\"parentStyles\":{\"display\":\"block\",\"visibility\":\"visible\",\"position\":\"relative\",\"zIndex\":\"1\",\"opacity\":\"1\"},\"overlappingElements\":[{\"tagName\":\"HTML\",\"id\":\"\",\"className\":\"\",\"zIndex\":\"auto\"},{\"tagName\":\"BODY\",\"id\":\"\",\"className\":\"\",\"zIndex\":\"auto\"},{\"tagName\":\"DIV\",\"id\":\"\",\"className\":\"container\",\"zIndex\":\"auto\"},{\"tagName\":\"DIV\",\"id\":\"\",\"className\":\"background\",\"zIndex\":\"2\"}]}\"\n\nANSWER: Even though the popup itself has a z-index of 3, its parent container has position: relative and z-index: 1. This creates a new stacking context for the popup. Because the \"background\" div has a z-index of 2, which is higher than the stacking context of the popup, it is rendered on top, obscuring the popup.\nSUGGESTIONS: [\"What is a stacking context?\", \"How can I change the stacking order?\"]\n`;\n/* clang-format on */\nasync function executeJsCode(code, { throwOnSideEffect }) {\n    const selectedNode = UI.Context.Context.instance().flavor(SDK.DOMModel.DOMNode);\n    const target = selectedNode?.domModel().target() ?? UI.Context.Context.instance().flavor(SDK.Target.Target);\n    if (!target) {\n        throw new Error('Target is not found for executing code');\n    }\n    const resourceTreeModel = target.model(SDK.ResourceTreeModel.ResourceTreeModel);\n    const frameId = selectedNode?.frameId() ?? resourceTreeModel?.mainFrame?.id;\n    if (!frameId) {\n        throw new Error('Main frame is not found for executing code');\n    }\n    const runtimeModel = target.model(SDK.RuntimeModel.RuntimeModel);\n    const pageAgent = target.pageAgent();\n    // This returns previously created world if it exists for the frame.\n    const { executionContextId } = await pageAgent.invoke_createIsolatedWorld({ frameId, worldName: FREESTYLER_WORLD_NAME });\n    const executionContext = runtimeModel?.executionContext(executionContextId);\n    if (!executionContext) {\n        throw new Error('Execution context is not found for executing code');\n    }\n    try {\n        return await FreestylerEvaluateAction.execute(code, executionContext, { throwOnSideEffect });\n    }\n    catch (err) {\n        if (err instanceof ExecutionError) {\n            return `Error: ${err.message}`;\n        }\n        throw err;\n    }\n}\nconst MAX_OBSERVATION_BYTE_LENGTH = 25_000;\n/**\n * One agent instance handles one conversation. Create a new agent\n * instance for a new conversation.\n */\nexport class FreestylerAgent extends AiAgent {\n    preamble = preamble;\n    clientFeature = Host.AidaClient.ClientFeature.CHROME_FREESTYLER;\n    get userTier() {\n        const config = Common.Settings.Settings.instance().getHostConfig();\n        return config.devToolsFreestyler?.userTier;\n    }\n    get executionMode() {\n        const config = Common.Settings.Settings.instance().getHostConfig();\n        return config.devToolsFreestyler?.executionMode ?? Root.Runtime.HostConfigFreestylerExecutionMode.ALL_SCRIPTS;\n    }\n    get options() {\n        const config = Common.Settings.Settings.instance().getHostConfig();\n        const temperature = AiAgent.validTemperature(config.devToolsFreestyler?.temperature);\n        const modelId = config.devToolsFreestyler?.modelId;\n        return {\n            temperature,\n            model_id: modelId,\n        };\n    }\n    parseResponse(response) {\n        // We're returning an empty answer to denote the erroneous case.\n        if (!response) {\n            return { answer: '' };\n        }\n        const lines = response.split('\\n');\n        let thought;\n        let title;\n        let action;\n        let answer;\n        let suggestions;\n        let i = 0;\n        // If one of these is present, it means we're going to follow the instruction tags\n        // to parse the response. If none of these is present, we'll assume the whole `response`\n        // to be the `answer`.\n        const isDefiningInstructionStart = (line) => {\n            const trimmed = line.trim();\n            return trimmed.startsWith('THOUGHT:') || trimmed.startsWith('ACTION') || trimmed.startsWith('ANSWER:');\n        };\n        const isInstructionStart = (line) => {\n            const trimmed = line.trim();\n            return isDefiningInstructionStart(line) || trimmed.startsWith('OBSERVATION:') || trimmed.startsWith('TITLE:') ||\n                trimmed.startsWith('SUGGESTIONS:');\n        };\n        // Sometimes agent answers with no \"ANSWER: \" tag at the start, and also does not\n        // include any \"defining instructions\". Then we use the whole `response` as the answer.\n        // However, that case sometimes includes `SUGGESTIONS: ` tag in the response which is then shown to the user.\n        // The block below ensures that the response we parse always contains a defining instruction tag.\n        const hasDefiningInstruction = lines.some(line => isDefiningInstructionStart(line));\n        if (!hasDefiningInstruction) {\n            return this.parseResponse(`ANSWER: ${response}`);\n        }\n        while (i < lines.length) {\n            const trimmed = lines[i].trim();\n            if (trimmed.startsWith('THOUGHT:') && !thought) {\n                // Start with the initial `THOUGHT: text` line and move forward by one line.\n                const thoughtLines = [trimmed.substring('THOUGHT:'.length).trim()];\n                i++;\n                // Move until we see a new instruction, otherwise we're still inside the `THOUGHT` block.\n                while (i < lines.length && !isInstructionStart(lines[i])) {\n                    const trimmedLine = lines[i].trim();\n                    if (trimmedLine) {\n                        thoughtLines.push(trimmedLine);\n                    }\n                    i++;\n                }\n                thought = thoughtLines.join('\\n');\n            }\n            else if (trimmed.startsWith('TITLE:')) {\n                title = trimmed.substring('TITLE:'.length).trim();\n                i++;\n            }\n            else if (trimmed.startsWith('ACTION') && !action) {\n                const actionLines = [];\n                i++;\n                while (i < lines.length) {\n                    if (lines[i].trim() === 'STOP') {\n                        i++;\n                        break;\n                    }\n                    if (isInstructionStart(lines[i])) {\n                        break;\n                    }\n                    // Sometimes the code block is in the form of \"`````\\njs\\n{code}`````\"\n                    if (lines[i].trim() !== 'js') {\n                        actionLines.push(lines[i]);\n                    }\n                    i++;\n                }\n                // Sometimes the LLM puts the STOP response to the last line of the code block.\n                // Here, we check whether the last line ends with STOP keyword and if so, remove it\n                // from the last line.\n                const lastActionLine = actionLines[actionLines.length - 1];\n                if (lastActionLine && lastActionLine.endsWith('STOP')) {\n                    actionLines[actionLines.length - 1] = lastActionLine.substring(0, lastActionLine.length - 'STOP'.length);\n                }\n                action = actionLines.join('\\n').replaceAll('```', '').replaceAll('``', '').trim();\n            }\n            else if (trimmed.startsWith('ANSWER:') && !answer) {\n                const answerLines = [\n                    trimmed.substring('ANSWER:'.length).trim(),\n                ];\n                let j = i + 1;\n                while (j < lines.length) {\n                    const line = lines[j].trim();\n                    if (isInstructionStart(line)) {\n                        break;\n                    }\n                    answerLines.push(lines[j]);\n                    j++;\n                }\n                answer = answerLines.join('\\n').trim();\n                i = j;\n            }\n            else if (trimmed.startsWith('SUGGESTIONS:')) {\n                try {\n                    // TODO: Do basic validation this is an array with strings\n                    suggestions = JSON.parse(trimmed.substring('SUGGESTIONS:'.length).trim());\n                }\n                catch {\n                }\n                i++;\n            }\n            else {\n                i++;\n            }\n        }\n        // Sometimes the answer will follow an action and a thought. In\n        // that case, we only use the action and the thought (if present)\n        // since the answer is not based on the observation resulted from\n        // the action.\n        if (action) {\n            return {\n                title,\n                thought,\n                action,\n            };\n        }\n        // If we have a thought and an answer we want to give priority\n        // to the answer as no observation is happening.\n        if (thought && !answer) {\n            return {\n                title,\n                thought,\n            };\n        }\n        return {\n            // If we could not parse the parts, consider the response to be an\n            // answer.\n            answer: answer || response,\n            suggestions,\n        };\n    }\n    #execJs;\n    #confirmSideEffect;\n    #changes;\n    #createExtensionScope;\n    constructor(opts) {\n        super({\n            aidaClient: opts.aidaClient,\n            serverSideLoggingEnabled: opts.serverSideLoggingEnabled,\n        });\n        this.#changes = opts.changeManager || new ChangeManager();\n        this.#execJs = opts.execJs ?? executeJsCode;\n        this.#createExtensionScope = opts.createExtensionScope ?? ((changes) => {\n            return new ExtensionScope(changes);\n        });\n        this.#confirmSideEffect = opts.confirmSideEffectForTest ?? (() => Promise.withResolvers());\n        SDK.TargetManager.TargetManager.instance().addModelListener(SDK.ResourceTreeModel.ResourceTreeModel, SDK.ResourceTreeModel.Events.PrimaryPageChanged, this.onPrimaryPageChanged, this);\n    }\n    onPrimaryPageChanged() {\n        void this.#changes.clear();\n    }\n    async #generateObservation(action, { throwOnSideEffect, confirmExecJs: confirm, }) {\n        const actionExpression = `{\n      const scope = {$0, $1, getEventListeners};\n      with (scope) {\n        ${action}\n        ;((typeof data !== \"undefined\") ? data : undefined)\n      }\n    }`;\n        try {\n            const runConfirmed = await confirm ?? Promise.resolve(true);\n            if (!runConfirmed) {\n                return {\n                    observation: 'Error: User denied code execution with side effects.',\n                    sideEffect: false,\n                    canceled: true,\n                };\n            }\n            const result = await this.#execJs(actionExpression, { throwOnSideEffect });\n            const byteCount = Platform.StringUtilities.countWtf8Bytes(result);\n            Host.userMetrics.freestylerEvalResponseSize(byteCount);\n            if (byteCount > MAX_OBSERVATION_BYTE_LENGTH) {\n                throw new Error('Output exceeded the maximum allowed length.');\n            }\n            return {\n                observation: result,\n                sideEffect: false,\n                canceled: false,\n            };\n        }\n        catch (error) {\n            if (error instanceof SideEffectError) {\n                return {\n                    observation: error.message,\n                    sideEffect: true,\n                    canceled: false,\n                };\n            }\n            return {\n                observation: `Error: ${error.message}`,\n                sideEffect: false,\n                canceled: false,\n            };\n        }\n    }\n    static async describeElement(element) {\n        let output = `* Its selector is \\`${element.simpleSelector()}\\``;\n        const childNodes = await element.getChildNodesPromise();\n        if (childNodes) {\n            const textChildNodes = childNodes.filter(childNode => childNode.nodeType() === Node.TEXT_NODE);\n            const elementChildNodes = childNodes.filter(childNode => childNode.nodeType() === Node.ELEMENT_NODE);\n            switch (elementChildNodes.length) {\n                case 0:\n                    output += '\\n* It doesn\\'t have any child element nodes';\n                    break;\n                case 1:\n                    output += `\\n* It only has 1 child element node: \\`${elementChildNodes[0].simpleSelector()}\\``;\n                    break;\n                default:\n                    output += `\\n* It has ${elementChildNodes.length} child element nodes: ${elementChildNodes.map(node => `\\`${node.simpleSelector()}\\``).join(', ')}`;\n            }\n            switch (textChildNodes.length) {\n                case 0:\n                    output += '\\n* It doesn\\'t have any child text nodes';\n                    break;\n                case 1:\n                    output += '\\n* It only has 1 child text node';\n                    break;\n                default:\n                    output += `\\n* It has ${textChildNodes.length} child text nodes`;\n            }\n        }\n        if (element.nextSibling) {\n            const elementOrNodeElementNodeText = element.nextSibling.nodeType() === Node.ELEMENT_NODE ? 'an element' : 'a non element';\n            output += `\\n* It has a next sibling and it is ${elementOrNodeElementNodeText} node`;\n        }\n        if (element.previousSibling) {\n            const elementOrNodeElementNodeText = element.previousSibling.nodeType() === Node.ELEMENT_NODE ? 'an element' : 'a non element';\n            output += `\\n* It has a previous sibling and it is ${elementOrNodeElementNodeText} node`;\n        }\n        const parentNode = element.parentNode;\n        if (parentNode) {\n            const parentChildrenNodes = await parentNode.getChildNodesPromise();\n            output += `\\n* Its parent's selector is \\`${parentNode.simpleSelector()}\\``;\n            if (parentChildrenNodes) {\n                const childElementNodes = parentChildrenNodes.filter(siblingNode => siblingNode.nodeType() === Node.ELEMENT_NODE);\n                switch (childElementNodes.length) {\n                    case 0:\n                        break;\n                    case 1:\n                        output += '\\n* Its parent has only 1 child element node';\n                        break;\n                    default:\n                        output += `\\n* Its parent has ${childElementNodes.length} child element nodes: ${childElementNodes.map(node => `\\`${node.simpleSelector()}\\``).join(', ')}`;\n                        break;\n                }\n                const siblingTextNodes = parentChildrenNodes.filter(siblingNode => siblingNode.nodeType() === Node.TEXT_NODE);\n                switch (siblingTextNodes.length) {\n                    case 0:\n                        break;\n                    case 1:\n                        output += '\\n* Its parent has only 1 child text node';\n                        break;\n                    default:\n                        output += `\\n* Its parent has ${siblingTextNodes.length} child text nodes: ${siblingTextNodes.map(node => `\\`${node.simpleSelector()}\\``).join(', ')}`;\n                        break;\n                }\n            }\n        }\n        return output.trim();\n    }\n    async *handleAction(action, rpcId) {\n        debugLog(`Action to execute: ${action}`);\n        if (this.executionMode === Root.Runtime.HostConfigFreestylerExecutionMode.NO_SCRIPTS) {\n            return {\n                type: ResponseType.ACTION,\n                code: action,\n                output: 'Error: JavaScript execution is currently disabled.',\n                canceled: true,\n                rpcId,\n            };\n        }\n        const scope = this.#createExtensionScope(this.#changes);\n        await scope.install();\n        try {\n            let result = await this.#generateObservation(action, { throwOnSideEffect: true });\n            debugLog(`Action result: ${JSON.stringify(result)}`);\n            if (result.sideEffect) {\n                if (this.executionMode === Root.Runtime.HostConfigFreestylerExecutionMode.SIDE_EFFECT_FREE_SCRIPTS_ONLY) {\n                    return {\n                        type: ResponseType.ACTION,\n                        code: action,\n                        output: 'Error: JavaScript execution that modifies the page is currently disabled.',\n                        canceled: true,\n                        rpcId,\n                    };\n                }\n                const sideEffectConfirmationPromiseWithResolvers = this.#confirmSideEffect();\n                if (isDebugMode()) {\n                    window.dispatchEvent(new CustomEvent('freestylersideeffect', { detail: { confirm: sideEffectConfirmationPromiseWithResolvers.resolve } }));\n                }\n                yield {\n                    type: ResponseType.SIDE_EFFECT,\n                    code: action,\n                    confirm: sideEffectConfirmationPromiseWithResolvers.resolve,\n                    rpcId,\n                };\n                result = await this.#generateObservation(action, {\n                    throwOnSideEffect: false,\n                    confirmExecJs: sideEffectConfirmationPromiseWithResolvers.promise,\n                });\n            }\n            return {\n                type: ResponseType.ACTION,\n                code: action,\n                output: result.observation,\n                canceled: result.canceled,\n                rpcId,\n            };\n        }\n        finally {\n            await scope.uninstall();\n        }\n    }\n    async *handleContextDetails(selectedElement) {\n        if (!selectedElement) {\n            return;\n        }\n        yield {\n            type: ResponseType.CONTEXT,\n            title: lockedString(UIStringsNotTranslate.analyzingThePrompt),\n            details: [{\n                    title: lockedString(UIStringsNotTranslate.dataUsed),\n                    text: await FreestylerAgent.describeElement(selectedElement),\n                }],\n        };\n    }\n    async enhanceQuery(query, selectedElement) {\n        const elementEnchantmentQuery = selectedElement ?\n            `# Inspected element\\n\\n${await FreestylerAgent.describeElement(selectedElement)}\\n\\n# User request\\n\\n` :\n            '';\n        return `${elementEnchantmentQuery}QUERY: ${query}`;\n    }\n    addToHistory(options) {\n        const response = options.response;\n        if ('answer' in response) {\n            const answer = `ANSWER: ${response.answer}`;\n            return super.addToHistory({\n                ...options,\n                response: { answer },\n            });\n        }\n        return super.addToHistory(options);\n    }\n}\n//# sourceMappingURL=FreestylerAgent.js.map","// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n// IMPORTANT: this file is auto generated. Please do not edit this file.\n/* istanbul ignore file */\nconst styles = new CSSStyleSheet();\nstyles.replaceSync(\n`/*\n * Copyright 2024 The Chromium Authors. All rights reserved.\n * Use of this source code is governed by a BSD-style license that can be\n * found in the LICENSE file.\n */\n\n.freestyler-toolbar-container {\n  display: flex;\n  background-color: var(--sys-color-cdt-base-container);\n  border-bottom: 1px solid var(--sys-color-divider);\n  flex: 0 0 auto;\n  justify-content: space-between;\n}\n\n.freestyler-chat-ui-container {\n  display: flex;\n  flex-direction: column;\n  width: 100%;\n  height: 100%;\n  align-items: center;\n  overflow: hidden;\n}\n\n/*# sourceURL=./freestylerPanel.css */\n`);\n\nexport default styles;\n","// Copyright 2024 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\nimport * as Common from '../../core/common/common.js';\nimport * as Host from '../../core/host/host.js';\nimport * as i18n from '../../core/i18n/i18n.js';\nimport * as SDK from '../../core/sdk/sdk.js';\nimport * as Trace from '../../models/trace/trace.js';\nimport * as Workspace from '../../models/workspace/workspace.js';\nimport * as NetworkForward from '../../panels/network/forward/forward.js';\nimport * as UI from '../../ui/legacy/legacy.js';\nimport * as LitHtml from '../../ui/lit-html/lit-html.js';\nimport { ResponseType } from './AiAgent.js';\nimport { ChangeManager } from './ChangeManager.js';\nimport { FreestylerChatUi, } from './components/FreestylerChatUi.js';\nimport { DrJonesFileAgent, } from './DrJonesFileAgent.js';\nimport { DrJonesNetworkAgent, } from './DrJonesNetworkAgent.js';\nimport { DrJonesPerformanceAgent } from './DrJonesPerformanceAgent.js';\nimport { FreestylerAgent } from './FreestylerAgent.js';\nimport freestylerPanelStyles from './freestylerPanel.css.js';\nconst { html } = LitHtml;\nconst AI_ASSISTANCE_SEND_FEEDBACK = 'https://crbug.com/364805393';\nconst AI_ASSISTANCE_HELP = 'https://goo.gle/devtools-ai-assistance';\nconst UIStrings = {\n    /**\n     *@description AI assistance UI text for clearing the chat.\n     */\n    clearChat: 'Clear chat',\n    /**\n     *@description AI assistance UI tooltip text for the help button.\n     */\n    help: 'Help',\n    /**\n     *@description AI assistant UI tooltip text for the settings button (gear icon).\n     */\n    settings: 'Settings',\n    /**\n     *@description AI assistant UI tooltip sending feedback.\n     */\n    sendFeedback: 'Send feedback',\n    /**\n     *@description Announcement text for screen readers when the chat is cleared.\n     */\n    chatCleared: 'Chat cleared',\n};\n/*\n* Strings that don't need to be translated at this time.\n*/\nconst UIStringsNotTranslate = {\n    /**\n     *@description Announcement text for screen readers when the conversation starts.\n     */\n    answerLoading: 'Answer loading',\n    /**\n     *@description Announcement text for screen readers when the answer comes.\n     */\n    answerReady: 'Answer ready',\n};\nconst str_ = i18n.i18n.registerUIStrings('panels/freestyler/FreestylerPanel.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nconst lockedString = i18n.i18n.lockedString;\nfunction selectedElementFilter(maybeNode) {\n    if (maybeNode) {\n        return maybeNode.nodeType() === Node.ELEMENT_NODE ? maybeNode : null;\n    }\n    return null;\n}\n// TODO(ergunsh): Use the WidgetElement instead of separately creating the toolbar.\nfunction createToolbar(target, { onClearClick }) {\n    const toolbarContainer = target.createChild('div', 'freestyler-toolbar-container');\n    const leftToolbar = new UI.Toolbar.Toolbar('', toolbarContainer);\n    const rightToolbar = new UI.Toolbar.Toolbar('freestyler-right-toolbar', toolbarContainer);\n    const clearButton = new UI.Toolbar.ToolbarButton(i18nString(UIStrings.clearChat), 'clear', undefined, 'freestyler.clear');\n    clearButton.addEventListener(\"Click\" /* UI.Toolbar.ToolbarButton.Events.CLICK */, onClearClick);\n    leftToolbar.appendToolbarItem(clearButton);\n    const link = UI.XLink.XLink.create(AI_ASSISTANCE_SEND_FEEDBACK, i18nString(UIStrings.sendFeedback), undefined, undefined, 'freestyler.send-feedback');\n    link.style.setProperty('display', null);\n    link.style.setProperty('text-decoration', 'none');\n    link.style.setProperty('padding', '0 var(--sys-size-3)');\n    const linkItem = new UI.Toolbar.ToolbarItem(link);\n    rightToolbar.appendToolbarItem(linkItem);\n    rightToolbar.appendSeparator();\n    const helpButton = new UI.Toolbar.ToolbarButton(i18nString(UIStrings.help), 'help', undefined, 'freestyler.help');\n    helpButton.addEventListener(\"Click\" /* UI.Toolbar.ToolbarButton.Events.CLICK */, () => {\n        Host.InspectorFrontendHost.InspectorFrontendHostInstance.openInNewTab(AI_ASSISTANCE_HELP);\n    });\n    rightToolbar.appendToolbarItem(helpButton);\n    const settingsButton = new UI.Toolbar.ToolbarButton(i18nString(UIStrings.settings), 'gear', undefined, 'freestyler.settings');\n    settingsButton.addEventListener(\"Click\" /* UI.Toolbar.ToolbarButton.Events.CLICK */, () => {\n        void UI.ViewManager.ViewManager.instance().showView('chrome-ai');\n    });\n    rightToolbar.appendToolbarItem(settingsButton);\n}\nfunction defaultView(input, output, target) {\n    // clang-format off\n    LitHtml.render(html `\n    <devtools-freestyler-chat-ui .props=${input} ${LitHtml.Directives.ref((el) => {\n        if (!el || !(el instanceof FreestylerChatUi)) {\n            return;\n        }\n        output.freestylerChatUi = el;\n    })}></devtools-freestyler-chat-ui>\n  `, target, { host: input }); // eslint-disable-line rulesdir/lit_html_host_this\n    // clang-format on\n}\nlet freestylerPanelInstance;\nexport class FreestylerPanel extends UI.Panel.Panel {\n    view;\n    static panelName = 'freestyler';\n    #toggleSearchElementAction;\n    #contentContainer;\n    #aidaClient;\n    #freestylerAgent;\n    #drJonesFileAgent;\n    #drJonesNetworkAgent;\n    #drJonesPerformanceAgent;\n    #viewProps;\n    #viewOutput = {};\n    #serverSideLoggingEnabled = isFreestylerServerSideLoggingEnabled();\n    #freestylerEnabledSetting;\n    #changeManager = new ChangeManager();\n    constructor(view = defaultView, { aidaClient, aidaAvailability, syncInfo }) {\n        super(FreestylerPanel.panelName);\n        this.view = view;\n        this.#freestylerEnabledSetting = this.#getAiAssistanceEnabledSetting();\n        createToolbar(this.contentElement, { onClearClick: this.#clearMessages.bind(this) });\n        this.#toggleSearchElementAction =\n            UI.ActionRegistry.ActionRegistry.instance().getAction('elements.toggle-element-search');\n        this.#aidaClient = aidaClient;\n        this.#contentContainer = this.contentElement.createChild('div', 'freestyler-chat-ui-container');\n        this.#viewProps = {\n            state: this.#getChatUiState(),\n            aidaAvailability,\n            messages: [],\n            inspectElementToggled: this.#toggleSearchElementAction.toggled(),\n            isLoading: false,\n            onTextSubmit: this.#startConversation.bind(this),\n            onInspectElementClick: this.#handleSelectElementClick.bind(this),\n            onFeedbackSubmit: this.#handleFeedbackSubmit.bind(this),\n            onCancelClick: this.#cancel.bind(this),\n            onSelectedNetworkRequestClick: this.#handleSelectedNetworkRequestClick.bind(this),\n            onSelectedFileRequestClick: this.#handleSelectedFileClick.bind(this),\n            canShowFeedbackForm: this.#serverSideLoggingEnabled,\n            userInfo: {\n                accountImage: syncInfo.accountImage,\n                accountFullName: syncInfo.accountFullName,\n            },\n            selectedElement: null,\n            selectedFile: null,\n            selectedNetworkRequest: null,\n            selectedStackTrace: null,\n        };\n        this.#freestylerAgent = this.#createFreestylerAgent();\n        this.#drJonesFileAgent = this.#createDrJonesFileAgent();\n        this.#drJonesNetworkAgent = this.#createDrJonesNetworkAgent();\n        this.#drJonesPerformanceAgent = this.#createDrJonesPerformanceAgent();\n    }\n    #getChatUiState() {\n        const config = Common.Settings.Settings.instance().getHostConfig();\n        const blockedByAge = config.aidaAvailability?.blockedByAge === true;\n        return (this.#freestylerEnabledSetting?.getIfNotDisabled() && !blockedByAge) ? \"chat-view\" /* FreestylerChatUiState.CHAT_VIEW */ :\n            \"consent-view\" /* FreestylerChatUiState.CONSENT_VIEW */;\n    }\n    #getAiAssistanceEnabledSetting() {\n        try {\n            return Common.Settings.moduleSetting('ai-assistance-enabled');\n        }\n        catch {\n            return;\n        }\n    }\n    #createFreestylerAgent() {\n        return new FreestylerAgent({\n            aidaClient: this.#aidaClient,\n            changeManager: this.#changeManager,\n            serverSideLoggingEnabled: this.#serverSideLoggingEnabled,\n        });\n    }\n    #createDrJonesFileAgent() {\n        return new DrJonesFileAgent({\n            aidaClient: this.#aidaClient,\n            serverSideLoggingEnabled: this.#serverSideLoggingEnabled,\n        });\n    }\n    #createDrJonesNetworkAgent() {\n        return new DrJonesNetworkAgent({\n            aidaClient: this.#aidaClient,\n            serverSideLoggingEnabled: this.#serverSideLoggingEnabled,\n        });\n    }\n    #createDrJonesPerformanceAgent() {\n        return new DrJonesPerformanceAgent({\n            aidaClient: this.#aidaClient,\n            serverSideLoggingEnabled: this.#serverSideLoggingEnabled,\n        });\n    }\n    static async instance(opts = { forceNew: null }) {\n        const { forceNew } = opts;\n        if (!freestylerPanelInstance || forceNew) {\n            const aidaClient = new Host.AidaClient.AidaClient();\n            const syncInfoPromise = new Promise(resolve => Host.InspectorFrontendHost.InspectorFrontendHostInstance.getSyncInformation(resolve));\n            const [aidaAvailability, syncInfo] = await Promise.all([Host.AidaClient.AidaClient.checkAccessPreconditions(), syncInfoPromise]);\n            freestylerPanelInstance = new FreestylerPanel(defaultView, { aidaClient, aidaAvailability, syncInfo });\n        }\n        return freestylerPanelInstance;\n    }\n    wasShown() {\n        this.registerCSSFiles([freestylerPanelStyles]);\n        this.#viewOutput.freestylerChatUi?.restoreScrollPosition();\n        this.#viewOutput.freestylerChatUi?.focusTextInput();\n        void this.#handleAidaAvailabilityChange();\n        void this\n            .#handleFreestylerEnabledSettingChanged(); // If the setting was switched on/off while the FreestylerPanel was not shown.\n        this.#viewProps = {\n            ...this.#viewProps,\n            inspectElementToggled: this.#toggleSearchElementAction.toggled(),\n            selectedElement: selectedElementFilter(UI.Context.Context.instance().flavor(SDK.DOMModel.DOMNode)),\n            selectedNetworkRequest: UI.Context.Context.instance().flavor(SDK.NetworkRequest.NetworkRequest),\n            selectedStackTrace: UI.Context.Context.instance().flavor(Trace.Helpers.TreeHelpers.TraceEntryNodeForAI),\n            selectedFile: UI.Context.Context.instance().flavor(Workspace.UISourceCode.UISourceCode),\n        };\n        this.doUpdate();\n        this.#freestylerEnabledSetting?.addChangeListener(this.#handleFreestylerEnabledSettingChanged, this);\n        Host.AidaClient.HostConfigTracker.instance().addEventListener(\"aidaAvailabilityChanged\" /* Host.AidaClient.Events.AIDA_AVAILABILITY_CHANGED */, this.#handleAidaAvailabilityChange);\n        this.#toggleSearchElementAction.addEventListener(\"Toggled\" /* UI.ActionRegistration.Events.TOGGLED */, this.#handleSearchElementActionToggled);\n        UI.Context.Context.instance().addFlavorChangeListener(SDK.DOMModel.DOMNode, this.#handleDOMNodeFlavorChange);\n        UI.Context.Context.instance().addFlavorChangeListener(SDK.NetworkRequest.NetworkRequest, this.#handleNetworkRequestFlavorChange);\n        UI.Context.Context.instance().addFlavorChangeListener(Trace.Helpers.TreeHelpers.TraceEntryNodeForAI, this.#handleTraceEntryNodeFlavorChange);\n        UI.Context.Context.instance().addFlavorChangeListener(Workspace.UISourceCode.UISourceCode, this.#handleUISourceCodeFlavorChange);\n    }\n    willHide() {\n        this.#freestylerEnabledSetting?.removeChangeListener(this.#handleFreestylerEnabledSettingChanged, this);\n        Host.AidaClient.HostConfigTracker.instance().removeEventListener(\"aidaAvailabilityChanged\" /* Host.AidaClient.Events.AIDA_AVAILABILITY_CHANGED */, this.#handleAidaAvailabilityChange);\n        this.#toggleSearchElementAction.removeEventListener(\"Toggled\" /* UI.ActionRegistration.Events.TOGGLED */, this.#handleSearchElementActionToggled);\n        UI.Context.Context.instance().removeFlavorChangeListener(SDK.DOMModel.DOMNode, this.#handleDOMNodeFlavorChange);\n        UI.Context.Context.instance().removeFlavorChangeListener(SDK.NetworkRequest.NetworkRequest, this.#handleNetworkRequestFlavorChange);\n        UI.Context.Context.instance().removeFlavorChangeListener(Trace.Helpers.TreeHelpers.TraceEntryNodeForAI, this.#handleTraceEntryNodeFlavorChange);\n        UI.Context.Context.instance().removeFlavorChangeListener(Workspace.UISourceCode.UISourceCode, this.#handleUISourceCodeFlavorChange);\n    }\n    #handleAidaAvailabilityChange = async () => {\n        const currentAidaAvailability = await Host.AidaClient.AidaClient.checkAccessPreconditions();\n        if (currentAidaAvailability !== this.#viewProps.aidaAvailability) {\n            this.#viewProps.aidaAvailability = currentAidaAvailability;\n            const syncInfo = await new Promise(resolve => Host.InspectorFrontendHost.InspectorFrontendHostInstance.getSyncInformation(resolve));\n            this.#viewProps.userInfo = {\n                accountImage: syncInfo.accountImage,\n                accountFullName: syncInfo.accountFullName,\n            };\n            this.#viewProps.state = this.#getChatUiState();\n            this.doUpdate();\n        }\n    };\n    #handleSearchElementActionToggled = (ev) => {\n        if (this.#viewProps.inspectElementToggled === ev.data) {\n            return;\n        }\n        this.#viewProps.inspectElementToggled = ev.data;\n        this.doUpdate();\n    };\n    #handleDOMNodeFlavorChange = (ev) => {\n        if (this.#viewProps.selectedElement === ev.data) {\n            return;\n        }\n        this.#viewProps.selectedElement = selectedElementFilter(ev.data);\n        this.doUpdate();\n    };\n    #handleNetworkRequestFlavorChange = (ev) => {\n        if (this.#viewProps.selectedNetworkRequest === ev.data) {\n            return;\n        }\n        this.#viewProps.selectedNetworkRequest = Boolean(ev.data) ? ev.data : null;\n        this.doUpdate();\n    };\n    #handleTraceEntryNodeFlavorChange = (ev) => {\n        if (this.#viewProps.selectedStackTrace === ev.data) {\n            return;\n        }\n        this.#viewProps.selectedStackTrace = Boolean(ev.data) ? ev.data : null;\n        this.doUpdate();\n    };\n    #handleUISourceCodeFlavorChange = (ev) => {\n        if (this.#viewProps.selectedFile === ev.data) {\n            return;\n        }\n        this.#viewProps.selectedFile = Boolean(ev.data) ? ev.data : null;\n        this.doUpdate();\n    };\n    #handleFreestylerEnabledSettingChanged = () => {\n        const nextChatUiState = this.#getChatUiState();\n        if (this.#viewProps.state === nextChatUiState) {\n            return;\n        }\n        this.#viewProps.state = nextChatUiState;\n        this.doUpdate();\n    };\n    doUpdate() {\n        this.view(this.#viewProps, this.#viewOutput, this.#contentContainer);\n    }\n    #handleSelectElementClick() {\n        void this.#toggleSearchElementAction.execute();\n    }\n    #handleFeedbackSubmit(rpcId, rating, feedback) {\n        void this.#aidaClient.registerClientEvent({\n            corresponding_aida_rpc_global_id: rpcId,\n            disable_user_content_logging: !this.#serverSideLoggingEnabled,\n            do_conversation_client_event: {\n                user_feedback: {\n                    sentiment: rating,\n                    user_input: {\n                        comment: feedback,\n                    },\n                },\n            },\n        });\n    }\n    #handleSelectedNetworkRequestClick() {\n        if (this.#viewProps.selectedNetworkRequest) {\n            const requestLocation = NetworkForward.UIRequestLocation.UIRequestLocation.tab(this.#viewProps.selectedNetworkRequest, \"headers-component\" /* NetworkForward.UIRequestLocation.UIRequestTabs.HEADERS_COMPONENT */);\n            return Common.Revealer.reveal(requestLocation);\n        }\n    }\n    #handleSelectedFileClick() {\n        if (this.#viewProps.selectedFile) {\n            return Common.Revealer.reveal(this.#viewProps.selectedFile.uiLocation(0, 0));\n        }\n    }\n    handleAction(actionId) {\n        switch (actionId) {\n            case 'freestyler.elements-floating-button': {\n                this.#viewOutput.freestylerChatUi?.focusTextInput();\n                Host.userMetrics.actionTaken(Host.UserMetrics.Action.FreestylerOpenedFromElementsPanelFloatingButton);\n                this.#viewProps.agentType = \"freestyler\" /* AgentType.FREESTYLER */;\n                this.doUpdate();\n                break;\n            }\n            case 'freestyler.element-panel-context': {\n                this.#viewOutput.freestylerChatUi?.focusTextInput();\n                Host.userMetrics.actionTaken(Host.UserMetrics.Action.FreestylerOpenedFromElementsPanel);\n                this.#viewProps.agentType = \"freestyler\" /* AgentType.FREESTYLER */;\n                this.doUpdate();\n                break;\n            }\n            case 'drjones.network-floating-button': {\n                this.#viewOutput.freestylerChatUi?.focusTextInput();\n                Host.userMetrics.actionTaken(Host.UserMetrics.Action.DrJonesOpenedFromNetworkPanelFloatingButton);\n                this.#viewProps.agentType = \"drjones-network-request\" /* AgentType.DRJONES_NETWORK_REQUEST */;\n                this.doUpdate();\n                break;\n            }\n            case 'drjones.network-panel-context': {\n                this.#viewOutput.freestylerChatUi?.focusTextInput();\n                Host.userMetrics.actionTaken(Host.UserMetrics.Action.DrJonesOpenedFromNetworkPanel);\n                this.#viewProps.agentType = \"drjones-network-request\" /* AgentType.DRJONES_NETWORK_REQUEST */;\n                this.doUpdate();\n                break;\n            }\n            case 'drjones.performance-panel-context': {\n                this.#viewOutput.freestylerChatUi?.focusTextInput();\n                Host.userMetrics.actionTaken(Host.UserMetrics.Action.DrJonesOpenedFromPerformancePanel);\n                this.#viewProps.agentType = \"drjones-performance\" /* AgentType.DRJONES_PERFORMANCE */;\n                this.doUpdate();\n                break;\n            }\n            case 'drjones.sources-floating-button': {\n                this.#viewOutput.freestylerChatUi?.focusTextInput();\n                Host.userMetrics.actionTaken(Host.UserMetrics.Action.DrJonesOpenedFromSourcesPanelFloatingButton);\n                this.#viewProps.agentType = \"drjones-file\" /* AgentType.DRJONES_FILE */;\n                this.doUpdate();\n                break;\n            }\n            case 'drjones.sources-panel-context': {\n                this.#viewOutput.freestylerChatUi?.focusTextInput();\n                Host.userMetrics.actionTaken(Host.UserMetrics.Action.DrJonesOpenedFromSourcesPanel);\n                this.#viewProps.agentType = \"drjones-file\" /* AgentType.DRJONES_FILE */;\n                this.doUpdate();\n                break;\n            }\n        }\n    }\n    #clearMessages() {\n        this.#viewProps.messages = [];\n        this.#viewProps.isLoading = false;\n        this.#freestylerAgent = this.#createFreestylerAgent();\n        this.#drJonesFileAgent = this.#createDrJonesFileAgent();\n        this.#drJonesNetworkAgent = this.#createDrJonesNetworkAgent();\n        this.#cancel();\n        this.doUpdate();\n        UI.ARIAUtils.alert(i18nString(UIStrings.chatCleared));\n    }\n    #runAbortController = new AbortController();\n    #cancel() {\n        this.#runAbortController.abort();\n        this.#runAbortController = new AbortController();\n        this.#viewProps.isLoading = false;\n        this.doUpdate();\n    }\n    async #startConversation(text) {\n        this.#viewProps.messages.push({\n            entity: \"user\" /* ChatMessageEntity.USER */,\n            text,\n        });\n        this.#viewProps.isLoading = true;\n        const systemMessage = {\n            entity: \"model\" /* ChatMessageEntity.MODEL */,\n            steps: [],\n        };\n        this.#viewProps.messages.push(systemMessage);\n        this.doUpdate();\n        this.#runAbortController = new AbortController();\n        const signal = this.#runAbortController.signal;\n        let runner;\n        if (this.#viewProps.agentType === \"freestyler\" /* AgentType.FREESTYLER */) {\n            runner = this.#freestylerAgent.run(text, { signal, selected: this.#viewProps.selectedElement });\n        }\n        else if (this.#viewProps.agentType === \"drjones-file\" /* AgentType.DRJONES_FILE */) {\n            runner = this.#drJonesFileAgent.run(text, { signal, selected: this.#viewProps.selectedFile });\n        }\n        else if (this.#viewProps.agentType === \"drjones-network-request\" /* AgentType.DRJONES_NETWORK_REQUEST */) {\n            runner = this.#drJonesNetworkAgent.run(text, { signal, selected: this.#viewProps.selectedNetworkRequest });\n        }\n        else if (this.#viewProps.agentType === \"drjones-performance\" /* AgentType.DRJONES_PERFORMANCE */) {\n            runner = this.#drJonesPerformanceAgent.run(text, { signal, selected: this.#viewProps.selectedStackTrace });\n        }\n        if (!runner) {\n            return;\n        }\n        let step = { isLoading: true };\n        UI.ARIAUtils.alert(lockedString(UIStringsNotTranslate.answerLoading));\n        for await (const data of runner) {\n            step.sideEffect = undefined;\n            switch (data.type) {\n                case ResponseType.QUERYING: {\n                    step = { isLoading: true };\n                    if (!systemMessage.steps.length) {\n                        systemMessage.steps.push(step);\n                    }\n                    break;\n                }\n                case ResponseType.CONTEXT: {\n                    step.title = data.title;\n                    step.contextDetails = data.details;\n                    step.isLoading = false;\n                    if (systemMessage.steps.at(-1) !== step) {\n                        systemMessage.steps.push(step);\n                    }\n                    break;\n                }\n                case ResponseType.TITLE: {\n                    step.title = data.title;\n                    if (systemMessage.steps.at(-1) !== step) {\n                        systemMessage.steps.push(step);\n                    }\n                    break;\n                }\n                case ResponseType.THOUGHT: {\n                    step.isLoading = false;\n                    step.thought = data.thought;\n                    if (systemMessage.steps.at(-1) !== step) {\n                        systemMessage.steps.push(step);\n                    }\n                    break;\n                }\n                case ResponseType.SIDE_EFFECT: {\n                    step.isLoading = false;\n                    step.code = data.code;\n                    step.sideEffect = {\n                        onAnswer: data.confirm,\n                    };\n                    if (systemMessage.steps.at(-1) !== step) {\n                        systemMessage.steps.push(step);\n                    }\n                    break;\n                }\n                case ResponseType.ACTION: {\n                    step.isLoading = false;\n                    step.code = data.code;\n                    step.output = data.output;\n                    step.canceled = data.canceled;\n                    if (systemMessage.steps.at(-1) !== step) {\n                        systemMessage.steps.push(step);\n                    }\n                    break;\n                }\n                case ResponseType.ANSWER: {\n                    systemMessage.suggestions = data.suggestions;\n                    systemMessage.answer = data.text;\n                    systemMessage.rpcId = data.rpcId;\n                    // When there is an answer without any thinking steps, we don't want to show the thinking step.\n                    if (systemMessage.steps.length === 1 && systemMessage.steps[0].isLoading) {\n                        systemMessage.steps.pop();\n                    }\n                    step.isLoading = false;\n                    this.#viewProps.isLoading = false;\n                    break;\n                }\n                case ResponseType.ERROR: {\n                    systemMessage.error = data.error;\n                    systemMessage.rpcId = undefined;\n                    this.#viewProps.isLoading = false;\n                    const lastStep = systemMessage.steps.at(-1);\n                    if (lastStep) {\n                        // Mark the last step as cancelled to make the UI feel better.\n                        if (data.error === \"abort\" /* ErrorType.ABORT */) {\n                            lastStep.canceled = true;\n                            // If error happens while the step is still loading remove it.\n                        }\n                        else if (lastStep.isLoading) {\n                            systemMessage.steps.pop();\n                        }\n                    }\n                }\n            }\n            this.doUpdate();\n            this.#viewOutput.freestylerChatUi?.scrollToLastMessage();\n        }\n        UI.ARIAUtils.alert(lockedString(UIStringsNotTranslate.answerReady));\n    }\n}\nexport class ActionDelegate {\n    handleAction(_context, actionId) {\n        switch (actionId) {\n            case 'freestyler.elements-floating-button':\n            case 'freestyler.element-panel-context':\n            case 'drjones.network-floating-button':\n            case 'drjones.network-panel-context':\n            case 'drjones.performance-panel-context':\n            case 'drjones.sources-floating-button':\n            case 'drjones.sources-panel-context': {\n                void (async () => {\n                    const view = UI.ViewManager.ViewManager.instance().view(FreestylerPanel.panelName);\n                    if (view) {\n                        await UI.ViewManager.ViewManager.instance().showView(FreestylerPanel.panelName);\n                        const widget = (await view.widget());\n                        widget.handleAction(actionId);\n                    }\n                })();\n                return true;\n            }\n        }\n        return false;\n    }\n}\nfunction setFreestylerServerSideLoggingEnabled(enabled) {\n    if (enabled) {\n        localStorage.setItem('freestyler_enableServerSideLogging', 'true');\n    }\n    else {\n        localStorage.setItem('freestyler_enableServerSideLogging', 'false');\n    }\n}\nfunction isFreestylerServerSideLoggingEnabled() {\n    const config = Common.Settings.Settings.instance().getHostConfig();\n    if (config.aidaAvailability?.disallowLogging) {\n        return false;\n    }\n    return localStorage.getItem('freestyler_enableServerSideLogging') !== 'false';\n}\n// @ts-ignore\nglobalThis.setFreestylerServerSideLoggingEnabled = setFreestylerServerSideLoggingEnabled;\n//# sourceMappingURL=FreestylerPanel.js.map"],"names":["ResponseType","MAX_STEP","AiAgent","temperature","#sessionId","#aidaClient","#serverSideLoggingEnabled","#chatHistory","opts","history","id","options","response","#storeHistoryEntries","title","thought","action","query","output","currentRunEntries","Host.AidaClient.Entity","#structuredLog","input","request","rawResponse","rpcId","meta","Host.AidaClient.RecitationAction","debugLog","Host.AidaClient.CLIENT_NAME","Host.AidaClient.convertToUserTierEnum","Host.AidaClient.FunctionalityType","_action","_rpcId","#runId","currentRunId","i","fetchResult","err","Host.AidaClient.AidaAbortError","parsedResponse","answer","suggestions","result","isDebugMode","log","setDebugFreestylerEnabled","enabled","AI_ASSISTANCE_CSS_CLASS_NAME","ChangeManager","#stylesheetMutex","Common.Mutex.Mutex","#cssModelToStylesheetId","#stylesheetChanges","#getStylesheet","cssModel","frameId","frameToStylesheet","SDK.CSSModel.Events","#onCssModelDisposed","stylesheetId","styleSheetHeader","event","stylesheetIds","results","firstFailed","models","model","change","changes","existingChange","c","formatStyles","styles","kebabStyles","Platform.StringUtilities.toKebabCaseKeys","key","value","preamble","UIStringsNotTranslate","lockedString","i18n.i18n.lockedString","MAX_FILE_SIZE","DrJonesFileAgent","Host.AidaClient.ClientFeature","Common.Settings.Settings","config","modelId","selectedFile","createContextDetailsForDrJonesFileAgent","formatFile","MAX_HEADERS_SIZE","DrJonesNetworkAgent","selectedNetworkRequest","createContextDetailsForDrJonesNetworkAgent","formatNetworkRequest","formatLines","lines","maxLength","line","allowHeader","header","normalizedName","formatHeaders","headers","formatNetworkRequestTiming","calculator","Network.NetworkPanel.NetworkPanel","Network.RequestTimingView.RequestTimingView","getDuration","name","r","i18n.TimeUtilities.secondsToString","label","formatRequestInitiated","initiatorChain","lineStart","Logs.NetworkLog.NetworkLog","v","initiatedRequest","formatRequestInitiatorChain","initiators","initator","requestContextDetail","responseContextDetail","timingContextDetail","initiatorChainContextDetail","DrJonesPerformanceAgent","selectedStackTrace","createContextDetailsForDrJonesPerformanceAgent","html","LitHtml","REPORT_URL","ProvideFeedback","#shadow","#props","#isShowingFeedbackForm","#currentRating","props","#render","provideFeedbackStyles","Input.textInputStyles","#handleRateClick","rating","#handleClose","#handleSubmit","ev","#handleReportClick","Host.InspectorFrontendHost.InspectorFrontendHostInstance","#renderButtons","#renderFeedbackForm","VisualLogging.textField","LitHtml.render","LitHtml.nothing","ifDefined","UIStrings","str_","i18n.i18n.registerUIStrings","i18nString","i18n.i18n.getLocalizedString","getInputPlaceholderString","state","agentType","MarkdownRendererWithCodeBlock","MarkdownView.MarkdownView.MarkdownInsightRenderer","token","FreestylerChatUi","#markdownRenderer","#scrollTop","freestylerChatUiStyles","textArea","scrollContainer","message","#setInputText","text","#isTextInputDisabled","isAidaAvailable","isConsentView","showsSideEffects","step","isInputDisabledCheckForFreestylerAgent","isInputDisabledCheckForDrJonesNetworkAgent","isInputDisabledCheckForDrJonesFileAgent","#handleScroll","#handleTextAreaKeyDown","#handleCancel","#handleSuggestionClick","suggestion","#renderRateButtons","feedback","#renderTextAsMarkdown","tokens","Marked.Marked.lexer","#renderTitle","paused","actionTitle","#renderStepCode","codeHeadingText","code","#renderStepDetails","sideEffects","#renderSideEffectConfirmationUi","contextDetails","LitHtml.Directives.repeat","contextDetail","#renderStepBadge","iconName","ariaLabel","role","#renderStep","stepClasses","LitHtml.Directives.classMap","VisualLogging.section","sideEffectAction","#renderError","errorMessage","#renderChatMessage","isLast","image","shouldShowSuggestions","_","index","#renderSelection","#renderSelectAnElement","#renderSelectedFileName","#renderSelectedNetworkRequest","#renderSelectedTask","resourceClass","icon","PanelUtils","LitHtml.Directives.until","Common.Linkifier.Linkifier","selectedNode","Trace.Helpers.TreeHelpers.TraceEntryNodeForAI","displayName","iconData","#renderMessages","array","#renderEmptyState","#getEmptyStateSuggestions","#renderChatInput","#getDisclaimerText","#getConsentViewContents","settingsLink","UI.ARIAUtils.markAsLink","UI.ViewManager.ViewManager","VisualLogging.action","i18n.i18n.getFormatLocalizedString","#getUnavailableAidaAvailabilityContents","aidaAvailability","#renderDisabledState","contents","#renderNoAgentState","#renderMainContents","VisualLogging.link","FOR_TEST","FREESTYLER_WORLD_NAME","FREESTYLER_BINDING_NAME","ExtensionScope","#listeners","#changeManager","#frameId","#target","#bindingMutex","UI.Context.Context","SDK.DOMModel.DOMNode","target","SDK.Target.Target","resourceTreeModel","SDK.ResourceTreeModel.ResourceTreeModel","runtimeModel","SDK.RuntimeModel.RuntimeModel","pageAgent","executionContextId","isolatedWorldContext","handler","#bindingCalled","SDK.RuntimeModel.Events","#simpleEval","freestylerBinding","functions","context","expression","exceptionDescription","executionContext","data","object","arg","selector","className","SDK.CSSModel.CSSModel","ExecutionError","SideEffectError","stringifyObjectOnThePage","seenBefore","idAttribute","classAttribute","stringifyRemoteObject","res","FreestylerEvaluateAction","throwOnSideEffect","executeJsCode","MAX_OBSERVATION_BYTE_LENGTH","FreestylerAgent","Root.Runtime.HostConfigFreestylerExecutionMode","isDefiningInstructionStart","trimmed","isInstructionStart","thoughtLines","trimmedLine","actionLines","lastActionLine","answerLines","j","#execJs","#confirmSideEffect","#changes","#createExtensionScope","SDK.TargetManager.TargetManager","SDK.ResourceTreeModel.Events","#generateObservation","confirm","actionExpression","byteCount","Platform.StringUtilities.countWtf8Bytes","Host.userMetrics","error","element","childNodes","textChildNodes","childNode","elementChildNodes","node","elementOrNodeElementNodeText","parentNode","parentChildrenNodes","childElementNodes","siblingNode","siblingTextNodes","scope","sideEffectConfirmationPromiseWithResolvers","selectedElement","AI_ASSISTANCE_SEND_FEEDBACK","AI_ASSISTANCE_HELP","selectedElementFilter","maybeNode","createToolbar","onClearClick","toolbarContainer","leftToolbar","UI.Toolbar.Toolbar","rightToolbar","clearButton","UI.Toolbar.ToolbarButton","link","UI.XLink.XLink","linkItem","UI.Toolbar.ToolbarItem","helpButton","settingsButton","defaultView","LitHtml.Directives.ref","el","freestylerPanelInstance","FreestylerPanel","UI.Panel.Panel","#toggleSearchElementAction","#contentContainer","#freestylerAgent","#drJonesFileAgent","#drJonesNetworkAgent","#drJonesPerformanceAgent","#viewProps","#viewOutput","isFreestylerServerSideLoggingEnabled","#freestylerEnabledSetting","view","aidaClient","syncInfo","#getAiAssistanceEnabledSetting","#clearMessages","UI.ActionRegistry.ActionRegistry","#getChatUiState","#startConversation","#handleSelectElementClick","#handleFeedbackSubmit","#cancel","#handleSelectedNetworkRequestClick","#handleSelectedFileClick","#createFreestylerAgent","#createDrJonesFileAgent","#createDrJonesNetworkAgent","#createDrJonesPerformanceAgent","blockedByAge","Common.Settings.moduleSetting","forceNew","Host.AidaClient.AidaClient","syncInfoPromise","resolve","freestylerPanelStyles","#handleAidaAvailabilityChange","#handleFreestylerEnabledSettingChanged","SDK.NetworkRequest.NetworkRequest","Workspace.UISourceCode.UISourceCode","Host.AidaClient.HostConfigTracker","#handleSearchElementActionToggled","#handleDOMNodeFlavorChange","#handleNetworkRequestFlavorChange","#handleTraceEntryNodeFlavorChange","#handleUISourceCodeFlavorChange","currentAidaAvailability","nextChatUiState","requestLocation","NetworkForward.UIRequestLocation.UIRequestLocation","Common.Revealer.reveal","actionId","Host.UserMetrics.Action","UI.ARIAUtils.alert","#runAbortController","systemMessage","signal","runner","lastStep","ActionDelegate","_context","setFreestylerServerSideLoggingEnabled"],"mappings":"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AA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA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"}