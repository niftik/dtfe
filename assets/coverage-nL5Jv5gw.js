import{ce as ue,hL as ye,fk as be,aE as Be,i3 as we,fd as Z,ay as z,at as H,a$ as Pe,aq as Re,n$ as ee,aR as U,ak as xe,b as he,g as ge,aU as A,fr as Te,cV as Ie,r as Me,cW as Le,l as T,cY as Ee,cZ as Ue,d$ as pe,f5 as Fe,au as te,iV as ze,bp as ke,bz as Oe,bA as x,dG as se,aj as oe,aJ as j,i as k,d0 as Ae,d2 as Ne,mr as W,bQ as $,u as G,A as _,aS as ie,aF as re,iq as ne,bx as J,d3 as De,dH as Ve,cH as ae,V as ce,dJ as He}from"./inspector-CyOA7R9n.js";var B;(function(u){u.CoverageUpdated="CoverageUpdated",u.CoverageReset="CoverageReset",u.SourceMapResolved="SourceMapResolved"})(B||(B={}));const je=200,We=500;class L extends ue{cpuProfilerModel;cssModel;debuggerModel;coverageByURL;coverageByContentProvider;coverageUpdateTimes;suspensionState;pollTimer;currentPollPromise;shouldResumePollingOnResume;jsBacklog;cssBacklog;performanceTraceRecording;sourceMapManager;willResolveSourceMaps;processSourceMapBacklog;constructor(e){super(e),this.cpuProfilerModel=e.model(ye),this.cssModel=e.model(be),this.debuggerModel=e.model(Be),this.sourceMapManager=this.debuggerModel?.sourceMapManager()||null,this.sourceMapManager?.addEventListener(we.SourceMapAttached,this.sourceMapAttached,this),this.coverageByURL=new Map,this.coverageByContentProvider=new Map,this.coverageUpdateTimes=new Set,this.suspensionState="Active",this.pollTimer=null,this.currentPollPromise=null,this.shouldResumePollingOnResume=!1,this.jsBacklog=[],this.cssBacklog=[],this.performanceTraceRecording=!1,this.willResolveSourceMaps=!1,this.processSourceMapBacklog=[]}async start(e){if(this.suspensionState!=="Active")throw Error("Cannot start CoverageModel while it is not active.");const t=[];return this.cssModel&&(this.clearCSS(),this.cssModel.addEventListener(Z.StyleSheetAdded,this.handleStyleSheetAdded,this),t.push(this.cssModel.startCoverage())),this.cpuProfilerModel&&t.push(this.cpuProfilerModel.startPreciseCoverage(e,this.preciseCoverageDeltaUpdate.bind(this))),await Promise.all(t),!!(this.cssModel||this.cpuProfilerModel)}async sourceMapAttached(e){const t=e.data.client,s=e.data.sourceMap;this.processSourceMapBacklog.push({script:t,sourceMap:s}),this.willResolveSourceMaps||(this.willResolveSourceMaps=!0,setTimeout(this.resolveSourceMapsAndUpdate.bind(this),We))}async resolveSourceMapsAndUpdate(){this.willResolveSourceMaps=!1;const e=this.processSourceMapBacklog;this.processSourceMapBacklog=[],await Promise.all(e.map(({script:t,sourceMap:s})=>this.resolveSourceMap(t,s))),this.dispatchEventToListeners(B.SourceMapResolved)}async resolveSourceMap(e,t){const s=e.sourceURL,o=this.coverageByURL.get(s);if(o&&o.sourcesURLCoverageInfo.size===0){const i=z.contentDataOrEmpty(await e.requestContentData()),[r,n]=this.calculateSizeForSources(t,i.textObj,e.contentLength);o.setSourceSegments(n);for(const a of t.sourceURLs())this.addCoverageForSource(a,r.get(a)||0,o.type(),o)}}async preciseCoverageDeltaUpdate(e,t,s){this.coverageUpdateTimes.add(e);const o=await this.backlogOrProcessJSCoverage(s,e);o.length&&this.dispatchEventToListeners(B.CoverageUpdated,o)}async stop(){await this.stopPolling();const e=[];this.cpuProfilerModel&&e.push(this.cpuProfilerModel.stopPreciseCoverage()),this.cssModel&&(e.push(this.cssModel.stopCoverage()),this.cssModel.removeEventListener(Z.StyleSheetAdded,this.handleStyleSheetAdded,this)),await Promise.all(e)}reset(){this.coverageByURL=new Map,this.coverageByContentProvider=new Map,this.coverageUpdateTimes=new Set,this.dispatchEventToListeners(B.CoverageReset)}async startPolling(){this.currentPollPromise||this.suspensionState!=="Active"||await this.pollLoop()}async pollLoop(){this.clearTimer(),this.currentPollPromise=this.pollAndCallback(),await this.currentPollPromise,(this.suspensionState==="Active"||this.performanceTraceRecording)&&(this.pollTimer=window.setTimeout(()=>this.pollLoop(),je))}async stopPolling(){this.clearTimer(),await this.currentPollPromise,this.currentPollPromise=null,await this.pollAndCallback()}async pollAndCallback(){if(this.suspensionState==="Suspended"&&!this.performanceTraceRecording)return;const e=await this.takeAllCoverage();console.assert(this.suspensionState!=="Suspended"||!!this.performanceTraceRecording,"CoverageModel was suspended while polling."),e.length&&this.dispatchEventToListeners(B.CoverageUpdated,e)}clearTimer(){this.pollTimer&&(clearTimeout(this.pollTimer),this.pollTimer=null)}async preSuspendModel(e){if(this.suspensionState==="Active"){if(this.suspensionState="Suspending",e==="performance-timeline"){this.performanceTraceRecording=!0;return}this.currentPollPromise&&(await this.stopPolling(),this.shouldResumePollingOnResume=!0)}}async suspendModel(e){this.suspensionState="Suspended"}async resumeModel(){}async postResumeModel(){this.suspensionState="Active",this.performanceTraceRecording=!1,this.shouldResumePollingOnResume&&(this.shouldResumePollingOnResume=!1,await this.startPolling())}entries(){return Array.from(this.coverageByURL.values())}getCoverageForUrl(e){return this.coverageByURL.get(e)||null}usageForRange(e,t,s){const o=this.coverageByContentProvider.get(e);return o&&o.usageForRange(t,s)}clearCSS(){for(const e of this.coverageByContentProvider.values()){if(e.type()!==1)continue;const t=e.getContentProvider();this.coverageByContentProvider.delete(t);const s=this.coverageByURL.get(e.url());if(!s)continue;const o=`${t.startLine}:${t.startColumn}`;s.removeCoverageEntry(o,e),s.numberOfEntries()===0&&this.coverageByURL.delete(e.url())}if(this.cssModel)for(const e of this.cssModel.getAllStyleSheetHeaders())this.addStyleSheetToCSSCoverage(e)}async takeAllCoverage(){const[e,t]=await Promise.all([this.takeCSSCoverage(),this.takeJSCoverage()]);return[...e,...t]}async takeJSCoverage(){if(!this.cpuProfilerModel)return[];const{coverage:e,timestamp:t}=await this.cpuProfilerModel.takePreciseCoverage();return this.coverageUpdateTimes.add(t),this.backlogOrProcessJSCoverage(e,t)}getCoverageUpdateTimes(){return this.coverageUpdateTimes}async backlogOrProcessJSCoverage(e,t){if(e.length>0&&this.jsBacklog.push({rawCoverageData:e,stamp:t}),this.suspensionState!=="Active")return[];const s=(i,r)=>i.stamp-r.stamp,o=[];for(const{rawCoverageData:i,stamp:r}of this.jsBacklog.sort(s))o.push(await this.processJSCoverage(i,r));return this.jsBacklog=[],o.flat()}async processJSBacklog(){this.backlogOrProcessJSCoverage([],0)}async processJSCoverage(e,t){if(!this.debuggerModel)return[];const s=[];for(const o of e){const i=this.debuggerModel.scriptForId(o.scriptId);if(!i)continue;const r=[];let n=2;for(const l of o.functions){l.isBlockCoverage===!1&&!(l.ranges.length===1&&!l.ranges[0].count)&&(n|=4);for(const c of l.ranges)r.push(c)}const a=await this.addCoverage(i,i.contentLength,i.lineOffset,i.columnOffset,r,n,t);a&&s.push(...a)}return s}handleStyleSheetAdded(e){this.addStyleSheetToCSSCoverage(e.data)}async takeCSSCoverage(){if(!this.cssModel||this.suspensionState!=="Active")return[];const{coverage:e,timestamp:t}=await this.cssModel.takeCoverageDelta();return this.coverageUpdateTimes.add(t),this.backlogOrProcessCSSCoverage(e,t)}async backlogOrProcessCSSCoverage(e,t){if(e.length>0&&this.cssBacklog.push({rawCoverageData:e,stamp:t}),this.suspensionState!=="Active")return[];const s=(i,r)=>i.stamp-r.stamp,o=[];for(const{rawCoverageData:i,stamp:r}of this.cssBacklog.sort(s))o.push(await this.processCSSCoverage(i,r));return this.cssBacklog=[],o.flat()}async processCSSCoverage(e,t){if(!this.cssModel)return[];const s=[],o=new Map;for(const i of e){const r=this.cssModel.styleSheetHeaderForId(i.styleSheetId);if(!r)continue;let n=o.get(r);n||(n=[],o.set(r,n)),n.push({startOffset:i.startOffset,endOffset:i.endOffset,count:Number(i.used)})}for(const i of o){const r=i[0],n=i[1],a=await this.addCoverage(r,r.contentLength,r.startLine,r.startColumn,n,1,t);a&&s.push(...a)}return s}static convertToDisjointSegments(e,t){e.sort((r,n)=>r.startOffset-n.startOffset);const s=[],o=[];for(const r of e){let n=o[o.length-1];for(;n&&n.endOffset<=r.startOffset;)i(n.endOffset,n.count),o.pop(),n=o[o.length-1];i(r.startOffset,n?n.count:0),o.push(r)}for(let r=o.pop();r;r=o.pop())i(r.endOffset,r.count);function i(r,n){const a=s[s.length-1];if(a){if(a.end===r)return;if(a.count===n){a.end=r;return}}s.push({end:r,count:n,stamp:t})}return s}addStyleSheetToCSSCoverage(e){this.addCoverage(e,e.contentLength,e.startLine,e.startColumn,[],1,Date.now())}calculateSizeForSources(e,t,s){const o=new Map,i=[],r=function(c,d,g,m){if(c===g)return m-d;if(t){const h=t.offsetFromPosition(c,d);return t.offsetFromPosition(g,m)-h}return m},n=e.mappings();if(n.length===0)return[o,i];let a=n[0],l=0;t?l+=t.offsetFromPosition(a.lineNumber,a.columnNumber):l+=r(0,0,a.lineNumber,a.columnNumber),i.push({end:l,sourceUrl:""});for(let c=0;c<n.length;c++){const d=n[c],g=e.findEntryRanges(d.lineNumber,d.columnNumber);if(g){const h=g.range,w=g.sourceURL,C=o.get(w)||0;let y=0;if(c===n.length-1){const b=t.offsetFromPosition(h.startLine,h.startColumn);y=s-b}else y=r(h.startLine,h.startColumn,h.endLine,h.endColumn);o.set(w,C+y)}const m=r(a.lineNumber,a.columnNumber,d.lineNumber,d.columnNumber);if(l+=m,d.sourceURL!==a.sourceURL)if(t){const h=t.offsetFromPosition(d.lineNumber,d.columnNumber);i.push({end:h,sourceUrl:a.sourceURL||""})}else i.push({end:l,sourceUrl:a.sourceURL||""});a=d,c===n.length-1&&i.push({end:s,sourceUrl:d.sourceURL||""})}return[o,i]}async addCoverage(e,t,s,o,i,r,n){const a=[],l=e.contentURL();if(!l)return null;let c=this.coverageByURL.get(l),d=!1;if(!c){d=!0,c=new I(l),this.coverageByURL.set(l,c);const C=await this.sourceMapManager?.sourceMapForClientPromise(e);if(C){const y=z.contentDataOrEmpty(await e.requestContentData()),[b,R]=this.calculateSizeForSources(C,y.textObj,t);c.setSourceSegments(R);for(const P of C.sourceURLs()){const Y=this.addCoverageForSource(P,b.get(P)||0,r,c);Y&&a.push(Y)}}}const g=c.ensureEntry(e,t,s,o,r);this.coverageByContentProvider.set(e,g);const m=L.convertToDisjointSegments(i,n),h=m[m.length-1];h&&h.end<t&&m.push({end:t,stamp:n,count:0});const w=g.mergeCoverage(m);if(!d&&w===0)return null;c.addToSizes(w,0);for(const[C,y]of g.sourceDeltaMap){const b=c.sourcesURLCoverageInfo.get(C);b&&(b.addToSizes(y,0),b.lastSourceUsedRange=g.sourceUsedRangeMap.get(C)||[])}return a.push(g),a}addCoverageForSource(e,t,s,o){const r=H.instance().uiSourceCodeForURL(e),n=new Q(e,o),a=n.ensureEntry(r,t,0,0,s);return o.sourcesURLCoverageInfo.set(e,n),a}async exportReport(e){const t=[],s=Array.from(this.coverageByURL.keys()).sort();for(const o of s){const i=this.coverageByURL.get(o);if(!i)continue;const r=i.url();r.startsWith("extensions::")||Pe(r,"chrome-extension:")||t.push(...await i.entriesForExport())}await e.write(JSON.stringify(t,void 0,2)),e.close()}}ue.register(L,{capabilities:0,autostart:!1});function le(u,e){const[t,s]=u.split(":"),[o,i]=e.split(":");return Number.parseInt(t,10)-Number.parseInt(o,10)||Number.parseInt(s,10)-Number.parseInt(i,10)}class I extends Re{urlInternal;coverageInfoByLocation;sizeInternal;usedSizeInternal;typeInternal;isContentScriptInternal;sourcesURLCoverageInfo=new Map;sourceSegments;constructor(e){super(),this.urlInternal=e,this.coverageInfoByLocation=new Map,this.sizeInternal=0,this.usedSizeInternal=0,this.isContentScriptInternal=!1}url(){return this.urlInternal}type(){return this.typeInternal}size(){return this.sizeInternal}usedSize(){return this.usedSizeInternal}unusedSize(){return this.sizeInternal-this.usedSizeInternal}usedPercentage(){return this.sizeInternal===0||!this.unusedSize()||!this.size()?0:this.usedSize()/this.size()}unusedPercentage(){return this.sizeInternal===0?100:this.unusedSize()/this.size()}isContentScript(){return this.isContentScriptInternal}entries(){return this.coverageInfoByLocation.values()}numberOfEntries(){return this.coverageInfoByLocation.size}removeCoverageEntry(e,t){this.coverageInfoByLocation.delete(e)&&this.addToSizes(-t.getUsedSize(),-t.getSize())}addToSizes(e,t){this.usedSizeInternal+=e,this.sizeInternal+=t,(e!==0||t!==0)&&this.dispatchEventToListeners(I.Events.SizesChanged)}setSourceSegments(e){this.sourceSegments=e}ensureEntry(e,t,s,o,i){const r=`${s}:${o}`;let n=this.coverageInfoByLocation.get(r);return i&2&&!this.coverageInfoByLocation.size&&e instanceof ee&&(this.isContentScriptInternal=e.isContentScript()),this.typeInternal|=i,n?(n.addCoverageType(i),n):(i&2&&!this.coverageInfoByLocation.size&&e instanceof ee&&(this.isContentScriptInternal=e.isContentScript()),n=new ve(e,t,s,o,i,this),this.coverageInfoByLocation.set(r,n),this.addToSizes(0,t),n)}async getFullText(){let e=!1;const t=this.url();for(const i of this.coverageInfoByLocation.values()){const{lineOffset:r,columnOffset:n}=i.getOffsets();if(r||n){e=!!t;break}}if(!e)return null;const s=U.resourceForURL(t);return s?z.contentDataOrEmpty(await s.requestContentData()).textObj:null}entriesForExportBasedOnFullText(e){const t=Array.from(this.coverageInfoByLocation.keys()).sort(le),s={url:this.url(),ranges:[],text:e.value()};for(const o of t){const i=this.coverageInfoByLocation.get(o);if(!i)continue;const{lineOffset:r,columnOffset:n}=i.getOffsets(),a=e?e.offsetFromPosition(r,n):0;s.ranges.push(...i.rangesForExport(a))}return s}async entriesForExportBasedOnContent(){const e=Array.from(this.coverageInfoByLocation.keys()).sort(le),t=[];for(const s of e){const o=this.coverageInfoByLocation.get(s);if(!o)continue;const i={url:this.url(),ranges:o.rangesForExport(),text:z.textOr(await o.getContentProvider().requestContentData(),null)};t.push(i)}return t}async entriesForExport(){const e=await this.getFullText();return e?[await this.entriesForExportBasedOnFullText(e)]:this.entriesForExportBasedOnContent()}}class Q extends I{generatedURLCoverageInfo;lastSourceUsedRange=[];constructor(e,t){super(e),this.generatedURLCoverageInfo=t}}(function(u){(function(e){e.SizesChanged="SizesChanged"})(u.Events||(u.Events={}))})(I||(I={}));const fe=(u,e)=>{const t=[];let s=0,o=0;for(;s<u.length&&o<e.length;){const i=u[s],r=e[o],n=(i.count||0)+(r.count||0),a=Math.min(i.end,r.end),l=t[t.length-1],c=Math.min(i.stamp,r.stamp);!l||l.count!==n||l.stamp!==c?t.push({end:a,count:n,stamp:c}):l.end=a,i.end<=r.end&&s++,i.end>=r.end&&o++}for(;s<u.length;s++)t.push(u[s]);for(;o<e.length;o++)t.push(e[o]);return t};class ve{contentProvider;size;usedSize;statsByTimestamp;lineOffset;columnOffset;coverageType;segments;generatedUrlCoverageInfo;sourceUsedSizeMap=new Map;sourceDeltaMap=new Map;sourceUsedRangeMap=new Map;constructor(e,t,s,o,i,r){this.contentProvider=e,this.size=t,this.usedSize=0,this.statsByTimestamp=new Map,this.lineOffset=s,this.columnOffset=o,this.coverageType=i,this.generatedUrlCoverageInfo=r,this.segments=[]}getContentProvider(){return this.contentProvider}url(){return this.contentProvider.contentURL()}type(){return this.coverageType}addCoverageType(e){this.coverageType|=e}getOffsets(){return{lineOffset:this.lineOffset,columnOffset:this.columnOffset}}mergeCoverage(e){const t=this.usedSize;return this.segments=fe(this.segments,e),this.updateStats(),this.generatedUrlCoverageInfo.sourceSegments&&this.generatedUrlCoverageInfo.sourceSegments.length>0&&this.updateSourceCoverage(),this.usedSize-t}usedByTimestamp(){return this.statsByTimestamp}getSize(){return this.size}getUsedSize(){return this.usedSize}usageForRange(e,t){let s=xe(this.segments,e,(o,i)=>o-i.end);for(;s<this.segments.length&&this.segments[s].end<t;++s)if(this.segments[s].count)return!0;return s<this.segments.length&&!!this.segments[s].count}updateStats(){this.statsByTimestamp=new Map,this.usedSize=0;let e=0;for(const t of this.segments){let s=this.statsByTimestamp.get(t.stamp);if(s===void 0&&(s=0),t.count){const o=t.end-e;this.usedSize+=o,this.statsByTimestamp.set(t.stamp,s+o)}e=t.end}}updateSourceCoverage(){const e=new Map;this.sourceDeltaMap=new Map,this.sourceUsedRangeMap=new Map;const t=this.generatedUrlCoverageInfo.sourceSegments||[];let s=0,o=0;for(const i of this.segments){const r=i.end;if(i.count)for(let n=o;n<t.length;n++){const a=n===0?0:t[n-1].end+1,l=t[n].end,c=Math.max(s,a),d=Math.min(r,l);if(c<=d){const g=d-c+1,m={start:c,end:d};e.has(t[n].sourceUrl)?e.set(t[n].sourceUrl,e.get(t[n].sourceUrl)+g):e.set(t[n].sourceUrl,g),this.sourceUsedRangeMap.has(t[n].sourceUrl)?this.sourceUsedRangeMap.get(t[n].sourceUrl)?.push(m):this.sourceUsedRangeMap.set(t[n].sourceUrl,[m]),o=n}if(r<l)break}s=r+1}for(const[i,r]of e){const n=this.sourceUsedSizeMap.get(i)||0;n!==r&&(this.sourceUsedSizeMap.set(i,r),this.sourceDeltaMap.set(i,r-n))}}rangesForExport(e=0){const t=[];let s=0;for(const o of this.segments){if(o.count){const i=t.length>0?t[t.length-1]:null;i&&i.end===s+e?i.end=o.end+e:t.push({start:s+e,end:o.end+e})}s=o.end}return t}}const $e=Object.freeze(Object.defineProperty({__proto__:null,CoverageInfo:ve,CoverageModel:L,get Events(){return B},SourceURLCoverageInfo:Q,get URLCoverageInfo(){return I},mergeSegments:fe},Symbol.toStringTag,{value:"Module"})),me=new CSSStyleSheet;me.replaceSync(`/*
 * Copyright 2021 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

.data-grid {
  border: none;
}

.data-grid td .url-outer {
  width: 100%;
  display: inline-flex;
  justify-content: flex-start;
}

.data-grid td .url-outer .filter-highlight {
  font-weight: bold;
}

.data-grid td .url-prefix {
  overflow-x: hidden;
  text-overflow: ellipsis;
}

.data-grid td .url-suffix {
  flex: none;
}

.data-grid td .bar {
  display: inline-block;
  height: 8px;
  border: 1px solid transparent;
}

.data-grid td .bar-unused-size {
  background-color: var(--app-color-coverage-unused);
}

.data-grid td .bar-used-size {
  background-color: var(--app-color-coverage-used);
}

.data-grid td .percent-value {
  width: 7ex;
  display: inline-block;
  color: var(--sys-color-on-surface-subtle);
}

@media (forced-colors: active) {
  .data-grid td .bar-container {
    forced-color-adjust: none;
  }

  .data-grid td .bar-unused-size {
    background-color: ButtonText;
  }

  .data-grid td .bar-used-size {
    background-color: ButtonFace;
  }

  .data-grid td .bar {
    border-color: ButtonText;
  }

  .data-grid .selected td .bar {
    border-top-color: HighlightText;
    border-bottom-color: HighlightText;
  }

  .data-grid .selected td .bar:last-child {
    border-right-color: HighlightText;
  }

  .data-grid .selected td .bar:first-child {
    border-left-color: HighlightText;
  }

  .data-grid:focus tr.selected span.percent-value {
    color: HighlightText;
  }
}

/*# sourceURL=coverageListView.css */
`);const p={css:"CSS",jsPerFunction:"JS (per function)",jsPerBlock:"JS (per block)",url:"URL",type:"Type",totalBytes:"Total Bytes",unusedBytes:"Unused Bytes",usageVisualization:"Usage Visualization",codeCoverage:"Code Coverage",jsCoverageWithPerFunction:"JS coverage with per function granularity: Once a function was executed, the whole function is marked as covered.",jsCoverageWithPerBlock:"JS coverage with per block granularity: Once a block of JavaScript was executed, that block is marked as covered.",sBytes:"{n, plural, =1 {# byte} other {# bytes}}",sBytesS:"{n, plural, =1 {# byte, {percentage}} other {# bytes, {percentage}}}",sBytesSBelongToFunctionsThatHave:"{PH1} bytes ({PH2}) belong to functions that have not (yet) been executed.",sBytesSBelongToBlocksOf:"{PH1} bytes ({PH2}) belong to blocks of JavaScript that have not (yet) been executed.",sBytesSBelongToFunctionsThatHaveExecuted:"{PH1} bytes ({PH2}) belong to functions that have executed at least once.",sBytesSBelongToBlocksOfJavascript:"{PH1} bytes ({PH2}) belong to blocks of JavaScript that have executed at least once.",sOfFileUnusedSOfFileUsed:"{PH1} % of file unused, {PH2} % of file used"},Ge=he("panels/coverage/CoverageListView.ts",p),v=ge.bind(void 0,Ge);function N(u){const e=[];return u&1&&e.push(v(p.css)),u&4?e.push(v(p.jsPerFunction)):u&2&&e.push(v(p.jsPerBlock)),e.join("+")}class Se extends A{nodeForCoverageInfo;isVisibleFilter;highlightRegExp;dataGrid;constructor(e){super(!0),this.nodeForCoverageInfo=new Map,this.isVisibleFilter=e,this.highlightRegExp=null;const t=[{id:"url",title:v(p.url),width:"250px",weight:3,fixedWidth:!1,sortable:!0,disclosure:!0},{id:"type",title:v(p.type),width:"45px",weight:1,fixedWidth:!0,sortable:!0},{id:"size",title:v(p.totalBytes),width:"60px",fixedWidth:!0,sortable:!0,align:"right",weight:1},{id:"unused-size",title:v(p.unusedBytes),width:"100px",fixedWidth:!0,sortable:!0,align:"right",sort:Te.Descending,weight:1},{id:"bars",title:v(p.usageVisualization),width:"250px",fixedWidth:!1,sortable:!0,weight:1}];this.dataGrid=new Ie({displayName:v(p.codeCoverage),columns:t,editCallback:void 0,refreshCallback:void 0,deleteCallback:void 0}),this.dataGrid.setResizeMethod("last"),this.dataGrid.setStriped(!0),this.dataGrid.element.classList.add("flex-auto"),this.dataGrid.addEventListener("OpenedNode",this.onOpenedNode,this),this.dataGrid.addEventListener("SortingChanged",this.sortingChanged,this);const s=this.dataGrid.asWidget();s.show(this.contentElement),this.setDefaultFocusedChild(s)}update(e){let t=!1;const s=e.reduce((i,r)=>Math.max(i,r.size()),0),o=this.dataGrid.rootNode();for(const i of e){let r=this.nodeForCoverageInfo.get(i);if(r){this.isVisibleFilter(r.coverageInfo)&&(t=r.refreshIfNeeded(s)||t,i.sourcesURLCoverageInfo.size>0&&this.updateSourceNodes(i.sourcesURLCoverageInfo,s,r));continue}r=new D(i,s),this.nodeForCoverageInfo.set(i,r),this.isVisibleFilter(r.coverageInfo)&&(o.appendChild(r),i.sourcesURLCoverageInfo.size>0&&this.createSourceNodes(i.sourcesURLCoverageInfo,s,r),t=!0)}t&&this.sortingChanged()}updateSourceNodes(e,t,s){let o=!1;for(const i of e.values()){const r=this.nodeForCoverageInfo.get(i);if(r)r.refreshIfNeeded(t);else{o=!0;break}}o&&this.createSourceNodes(e,t,s)}async createSourceNodes(e,t,s){for(const o of e.values()){const i=new D(o,t);s.appendChild(i),this.nodeForCoverageInfo.set(o,i)}}reset(){this.nodeForCoverageInfo.clear(),this.dataGrid.rootNode().removeChildren()}updateFilterAndHighlight(e){this.highlightRegExp=e;let t=!1;for(const s of this.nodeForCoverageInfo.values()){const o=this.isVisibleFilter(s.coverageInfo),i=!!s.parent;o&&s.setHighlight(this.highlightRegExp),o!==i&&(t=!0,o?this.appendNodeByType(s):s.remove())}t&&this.sortingChanged()}appendNodeByType(e){e.coverageInfo instanceof Q?this.nodeForCoverageInfo.get(e.coverageInfo.generatedURLCoverageInfo)?.appendChild(e):this.dataGrid.rootNode().appendChild(e)}selectByUrl(e){for(const[t,s]of this.nodeForCoverageInfo.entries())if(t.url()===e){s.revealAndSelect();break}}onOpenedNode(){this.revealSourceForSelectedNode()}async revealSourceForSelectedNode(){const e=this.dataGrid.selectedNode;if(!e)return;const t=e.coverageInfo,s=H.instance().uiSourceCodeForURL(t.url());s&&this.dataGrid.selectedNode===e&&Me(s)}sortingChanged(){const e=this.dataGrid.sortColumnId();if(!e)return;const t=D.sortFunctionForColumn(e);t&&this.dataGrid.sortNodes(t,!this.dataGrid.isSortOrderAscending())}wasShown(){super.wasShown(),this.registerCSSFiles([me])}}let q=null;function K(){return q||(q=new Intl.NumberFormat(pe.instance().locale,{style:"percent",maximumFractionDigits:1})),q}let X=null;function de(){return X||(X=new Intl.NumberFormat(pe.instance().locale)),X}class D extends Le{coverageInfo;lastUsedSize;url;maxSize;highlightRegExp;constructor(e,t){super(),this.coverageInfo=e,this.url=e.url(),this.maxSize=t,this.highlightRegExp=null}setHighlight(e){this.highlightRegExp!==e&&(this.highlightRegExp=e,this.refresh())}refreshIfNeeded(e){return this.lastUsedSize===this.coverageInfo.usedSize()&&e===this.maxSize?!1:(this.lastUsedSize=this.coverageInfo.usedSize(),this.maxSize=e,this.refresh(),!0)}createCell(e){const t=this.createTD(e);switch(e){case"url":{T.install(t,this.url);const s=t.createChild("div","url-outer"),o=s.createChild("div","url-prefix"),i=s.createChild("div","url-suffix"),r=/^(.*)(\/[^/]*)$/.exec(this.url);o.textContent=r?r[1]:this.url,i.textContent=r?r[2]:"",this.highlightRegExp&&this.highlight(s,this.url),this.setCellAccessibleName(this.url,t,e);break}case"type":{t.textContent=N(this.coverageInfo.type()),this.coverageInfo.type()&4?T.install(t,v(p.jsCoverageWithPerFunction)):this.coverageInfo.type()&2&&T.install(t,v(p.jsCoverageWithPerBlock));break}case"size":{const s=this.coverageInfo.size()||0,o=t.createChild("span"),i=de().format(s);o.textContent=i;const r=v(p.sBytes,{n:s});this.setCellAccessibleName(r,t,e);break}case"unused-size":{const s=this.coverageInfo.unusedSize()||0,o=t.createChild("span"),i=t.createChild("span","percent-value"),r=de().format(s);o.textContent=r;const n=K().format(this.coverageInfo.unusedPercentage());i.textContent=n;const a=v(p.sBytesS,{n:s,percentage:n});this.setCellAccessibleName(a,t,e);break}case"bars":{const s=t.createChild("div","bar-container"),o=K().format(this.coverageInfo.unusedPercentage()),i=K().format(this.coverageInfo.usedPercentage());if(this.coverageInfo.unusedSize()>0){const r=s.createChild("div","bar bar-unused-size");r.style.width=(this.coverageInfo.unusedSize()/this.maxSize*100||0)+"%",this.coverageInfo.type()&4?T.install(r,v(p.sBytesSBelongToFunctionsThatHave,{PH1:this.coverageInfo.unusedSize(),PH2:o})):this.coverageInfo.type()&2&&T.install(r,v(p.sBytesSBelongToBlocksOf,{PH1:this.coverageInfo.unusedSize(),PH2:o}))}if(this.coverageInfo.usedSize()>0){const r=s.createChild("div","bar bar-used-size");r.style.width=(this.coverageInfo.usedSize()/this.maxSize*100||0)+"%",this.coverageInfo.type()&4?T.install(r,v(p.sBytesSBelongToFunctionsThatHaveExecuted,{PH1:this.coverageInfo.usedSize(),PH2:i})):this.coverageInfo.type()&2&&T.install(r,v(p.sBytesSBelongToBlocksOfJavascript,{PH1:this.coverageInfo.usedSize(),PH2:i}))}this.setCellAccessibleName(v(p.sOfFileUnusedSOfFileUsed,{PH1:o,PH2:i}),t,e)}}return t}highlight(e,t){if(!this.highlightRegExp)return;const s=this.highlightRegExp.exec(t);if(!s||!s.length)return;const o=new Ee(s.index,s[0].length);Ue(e,[o],"filter-highlight")}static sortFunctionForColumn(e){const t=(s,o)=>s.url.localeCompare(o.url);switch(e){case"url":return t;case"type":return(s,o)=>{const i=N(s.coverageInfo.type()),r=N(o.coverageInfo.type());return i.localeCompare(r)||t(s,o)};case"size":return(s,o)=>s.coverageInfo.size()-o.coverageInfo.size()||t(s,o);case"bars":case"unused-size":return(s,o)=>s.coverageInfo.unusedSize()-o.coverageInfo.unusedSize()||t(s,o);default:return console.assert(!1,"Unknown sort field: "+e),null}}}const _e=Object.freeze(Object.defineProperty({__proto__:null,CoverageListView:Se,GridNode:D,coverageTypeToString:N},Symbol.toStringTag,{value:"Module"})),F="coverage";class E{coverageModel;textByProvider;uiSourceCodeByContentProvider;#e;#t;#s;constructor(e,t,s,o){this.coverageModel=e,this.#e=t,this.#t=s,this.#s=o,this.textByProvider=new Map,this.uiSourceCodeByContentProvider=new Fe;for(const i of this.#e.uiSourceCodes())i.setDecorationData(F,this);this.#e.addEventListener(te.UISourceCodeAdded,this.onUISourceCodeAdded,this)}reset(){for(const e of this.#e.uiSourceCodes())e.setDecorationData(F,void 0)}dispose(){this.reset(),this.#e.removeEventListener(te.UISourceCodeAdded,this.onUISourceCodeAdded,this)}update(e){for(const t of e)for(const s of this.uiSourceCodeByContentProvider.get(t.getContentProvider()))s.setDecorationData(F,this)}async usageByLine(e,t){const s=[];await this.updateTexts(e,t);for(const{startLine:o,startColumn:i,endLine:r,endColumn:n}of t){const a=this.rawLocationsForSourceLocation(e,o,i),l=this.rawLocationsForSourceLocation(e,r,n),[c,d]=await Promise.all([a,l]);let g;for(let m=0,h=0;m<c.length;++m){const w=c[m];for(;h<d.length&&E.compareLocations(w,d[h])>=0;)++h;if(h>=d.length||d[h].id!==w.id)continue;const C=d[h++],y=this.textByProvider.get(C.contentProvider);if(!y)continue;const b=y.value();let R=Math.min(y.offsetFromPosition(w.line,w.column),b.length-1),P=Math.min(y.offsetFromPosition(C.line,C.column),b.length-1);for(;R<=P&&/\s/.test(b[R]);)++R;for(;R<=P&&/\s/.test(b[P]);)--P;if(R<=P&&(g=this.coverageModel.usageForRange(C.contentProvider,R,P)),g)break}s.push(g)}return s}async updateTexts(e,t){const s=[];for(const o of t)for(const i of await this.rawLocationsForSourceLocation(e,o.startLine,0))this.textByProvider.has(i.contentProvider)||(this.textByProvider.set(i.contentProvider,null),this.uiSourceCodeByContentProvider.set(i.contentProvider,e),s.push(this.updateTextForProvider(i.contentProvider)));await Promise.all(s)}async updateTextForProvider(e){const t=z.contentDataOrEmpty(await e.requestContentData());this.textByProvider.set(e,t.textObj)}async rawLocationsForSourceLocation(e,t,s){const o=[],i=e.contentType();if(i.hasScripts()){let r=await this.#t.uiLocationToRawLocations(e,t,s);r=r.filter(n=>!!n.script());for(const n of r){const a=n.script();a&&(a.isInlineScript()&&i.isDocument()&&(n.lineNumber-=a.lineOffset,n.lineNumber||(n.columnNumber-=a.columnOffset)),o.push({id:`js:${n.scriptId}`,contentProvider:a,line:n.lineNumber,column:n.columnNumber}))}}if(i.isStyleSheet()||i.isDocument()){const r=this.#s.uiLocationToRawLocations(new ze(e,t,s));for(const n of r){const a=n.header();a&&(a.isInline&&i.isDocument()&&(n.lineNumber-=a.startLine,n.lineNumber||(n.columnNumber-=a.startColumn)),o.push({id:`css:${n.styleSheetId}`,contentProvider:a,line:n.lineNumber,column:n.columnNumber}))}}return o.sort(E.compareLocations)}static compareLocations(e,t){return e.id.localeCompare(t.id)||e.line-t.line||e.column-t.column}onUISourceCodeAdded(e){e.data.setDecorationData(F,this)}}const Je=Object.freeze(Object.defineProperty({__proto__:null,CoverageDecorationManager:E,decoratorType:F},Symbol.toStringTag,{value:"Module"})),Ce=new CSSStyleSheet;Ce.replaceSync(`/*
 * Copyright (c) 2016 The Chromium Authors. All rights reserved.
 * Use of this source code is governed by a BSD-style license that can be
 * found in the LICENSE file.
 */

:host {
  overflow: hidden;
}

.coverage-toolbar-container {
  display: flex;
  border-bottom: 1px solid var(--sys-color-divider);
  flex: 0 0 auto;
}

.coverage-toolbar {
  display: inline-block;
  width: 100%;
}

.coverage-toolbar-summary {
  background-color: var(--sys-color-cdt-base-container);
  border-top: 1px solid var(--sys-color-divider);
  padding-left: 5px;
  flex: 0 0 19px;
  display: flex;
  padding-right: 5px;
}

.coverage-toolbar-summary .coverage-message {
  padding-top: 2px;
  padding-left: 1ex;
  text-overflow: ellipsis;
  white-space: nowrap;
  overflow: hidden;
}

.coverage-results {
  overflow-y: auto;
  display: flex;
  flex: auto;
}

.landing-page,
.bfcache-page,
.prerender-page {
  justify-content: center;
  align-items: center;
  padding: 20px;
}

.landing-page .message,
.bfcache-page .message,
.prerender-page .message {
  white-space: pre-line;
  text-align: center;
}

/*# sourceURL=coverageView.css */
`);const f={chooseCoverageGranularityPer:"Choose coverage granularity: Per function has low overhead, per block has significant overhead.",perFunction:"Per function",perBlock:"Per block",filterByUrl:"Filter by URL",filterCoverageByType:"Filter coverage by type",all:"All",css:"CSS",javascript:"JavaScript",includeExtensionContentScripts:"Include extension content scripts",contentScripts:"Content scripts",clickTheReloadButtonSToReloadAnd:"Click the reload button {PH1} to reload and start capturing coverage.",clickTheRecordButtonSToStart:"Click the record button {PH1} to start capturing coverage.",bfcacheNoCapture:"Could not capture coverage info because the page was served from the back/forward cache.",activationNoCapture:"Could not capture coverage info because the page was prerendered in the background.",reloadPrompt:"Click the reload button {PH1} to reload and get coverage.",filteredSTotalS:"Filtered: {PH1}  Total: {PH2}",sOfSSUsedSoFarSUnused:"{PH1} of {PH2} ({PH3}%) used so far, {PH4} unused."},V=he("panels/coverage/CoverageView.ts",f),S=ge.bind(void 0,V);let O;class M extends A{model;decorationManager;coverageTypeComboBox;coverageTypeComboBoxSetting;toggleRecordAction;toggleRecordButton;inlineReloadButton;startWithReloadButton;clearAction;exportAction;textFilterRegExp;filterInput;typeFilterValue;filterByTypeComboBox;showContentScriptsSetting;contentScriptsCheckbox;coverageResultsElement;landingPage;bfcacheReloadPromptPage;activationReloadPromptPage;listView;statusToolbarElement;statusMessageElement;constructor(){super(!0),this.element.setAttribute("jslog",`${ke("coverage").track({resize:!0})}`),this.model=null,this.decorationManager=null;const e=this.contentElement.createChild("div","coverage-toolbar-container");e.setAttribute("jslog",`${Oe()}`);const t=new x("coverage-toolbar",e);t.makeWrappable(!0),this.coverageTypeComboBox=new se(this.onCoverageTypeComboBoxSelectionChanged.bind(this),S(f.chooseCoverageGranularityPer),void 0,"coverage-type");const s=[{label:S(f.perFunction),value:6},{label:S(f.perBlock),value:2}];for(const n of s)this.coverageTypeComboBox.addOption(this.coverageTypeComboBox.createOption(n.label,`${n.value}`));this.coverageTypeComboBoxSetting=oe.instance().createSetting("coverage-view-coverage-type",0),this.coverageTypeComboBox.setSelectedIndex(this.coverageTypeComboBoxSetting.get()),this.coverageTypeComboBox.setEnabled(!0),t.appendToolbarItem(this.coverageTypeComboBox),this.toggleRecordAction=j.instance().getAction("coverage.toggle-recording"),this.toggleRecordButton=x.createActionButton(this.toggleRecordAction),t.appendToolbarItem(this.toggleRecordButton);const o=k.instance().primaryPageTarget(),i=o&&o.model(U);this.inlineReloadButton=null,i&&(this.startWithReloadButton=x.createActionButtonForId("coverage.start-with-reload"),t.appendToolbarItem(this.startWithReloadButton),this.toggleRecordButton.setEnabled(!1),this.toggleRecordButton.setVisible(!1)),this.clearAction=j.instance().getAction("coverage.clear"),this.clearAction.setEnabled(!1),t.appendToolbarItem(x.createActionButton(this.clearAction)),t.appendSeparator(),this.exportAction=j.instance().getAction("coverage.export"),this.exportAction.setEnabled(!1),t.appendToolbarItem(x.createActionButton(this.exportAction)),this.textFilterRegExp=null,t.appendSeparator(),this.filterInput=new Ae(S(f.filterByUrl),.4,1),this.filterInput.setEnabled(!1),this.filterInput.addEventListener("TextChanged",this.onFilterChanged,this),t.appendToolbarItem(this.filterInput),t.appendSeparator(),this.typeFilterValue=null,this.filterByTypeComboBox=new se(this.onFilterByTypeChanged.bind(this),S(f.filterCoverageByType),void 0,"coverage-by-type");const r=[{label:S(f.all),value:""},{label:S(f.css),value:1},{label:S(f.javascript),value:6}];for(const n of r)this.filterByTypeComboBox.addOption(this.filterByTypeComboBox.createOption(n.label,`${n.value}`));this.filterByTypeComboBox.setSelectedIndex(0),this.filterByTypeComboBox.setEnabled(!1),t.appendToolbarItem(this.filterByTypeComboBox),t.appendSeparator(),this.showContentScriptsSetting=oe.instance().createSetting("show-content-scripts",!1),this.showContentScriptsSetting.addChangeListener(this.onFilterChanged,this),this.contentScriptsCheckbox=new Ne(this.showContentScriptsSetting,S(f.includeExtensionContentScripts),S(f.contentScripts)),this.contentScriptsCheckbox.setEnabled(!1),t.appendToolbarItem(this.contentScriptsCheckbox),this.coverageResultsElement=this.contentElement.createChild("div","coverage-results"),this.landingPage=this.buildLandingPage(),this.bfcacheReloadPromptPage=this.buildReloadPromptPage(S(f.bfcacheNoCapture),"bfcache-page"),this.activationReloadPromptPage=this.buildReloadPromptPage(S(f.activationNoCapture),"prerender-page"),this.listView=new Se(this.isVisible.bind(this,!1)),this.statusToolbarElement=this.contentElement.createChild("div","coverage-toolbar-summary"),this.statusMessageElement=this.statusToolbarElement.createChild("div","coverage-message"),this.landingPage.show(this.coverageResultsElement)}static instance(){return O||(O=new M),O}static removeInstance(){O=void 0}buildLandingPage(){const e=new A;let t;if(this.startWithReloadButton)this.inlineReloadButton=W(x.createActionButtonForId("coverage.start-with-reload")),t=$(V,f.clickTheReloadButtonSToReloadAnd,{PH1:this.inlineReloadButton});else{const s=W(x.createActionButton(this.toggleRecordAction));t=$(V,f.clickTheRecordButtonSToStart,{PH1:s})}return t.classList.add("message"),e.contentElement.appendChild(t),e.element.classList.add("landing-page"),e}buildReloadPromptPage(e,t){const s=new A,o=document.createElement("div");o.classList.add("message"),o.textContent=e,s.contentElement.appendChild(o),this.inlineReloadButton=W(x.createActionButtonForId("inspector-main.reload"));const i=$(V,f.reloadPrompt,{PH1:this.inlineReloadButton});return i.classList.add("message"),s.contentElement.appendChild(i),s.element.classList.add(t),s}clear(){this.model&&this.model.reset(),this.reset()}reset(){this.decorationManager&&(this.decorationManager.dispose(),this.decorationManager=null),this.listView.reset(),this.listView.detach(),this.landingPage.show(this.coverageResultsElement),this.statusMessageElement.textContent="",this.filterInput.setEnabled(!1),this.filterByTypeComboBox.setEnabled(!1),this.contentScriptsCheckbox.setEnabled(!1),this.exportAction.setEnabled(!1)}toggleRecording(){!this.toggleRecordAction.toggled()?this.startRecording({reload:!1,jsCoveragePerBlock:this.isBlockCoverageSelected()}):this.stopRecording()}isBlockCoverageSelected(){const e=this.coverageTypeComboBox.selectedOption();return Number(e?e.value:Number.NaN)===2}selectCoverageType(e){const t=e?1:0;this.coverageTypeComboBox.setSelectedIndex(t)}onCoverageTypeComboBoxSelectionChanged(){this.coverageTypeComboBoxSetting.set(this.coverageTypeComboBox.selectedIndex())}async ensureRecordingStarted(){this.toggleRecordAction.toggled()&&await this.stopRecording(),await this.startRecording({reload:!1,jsCoveragePerBlock:!1})}async startRecording(e){let t,s;this.startWithReloadButton&&this.startWithReloadButton.element.hasFocus()||this.inlineReloadButton&&this.inlineReloadButton.hasFocus()?s=!0:this.hasFocus()&&(t=!0),this.reset();const o=k.instance().primaryPageTarget();if(!o)return;const{reload:i,jsCoveragePerBlock:r}={reload:!1,jsCoveragePerBlock:!1,...e};if((!this.model||i)&&(this.model=o.model(L)),!this.model||(G.actionTaken(_.CoverageStarted),r&&G.actionTaken(_.CoverageStartedPerBlock),!await this.model.start(!!r)))return;this.selectCoverageType(!!r),this.model.addEventListener(B.CoverageUpdated,this.onCoverageDataReceived,this),this.model.addEventListener(B.SourceMapResolved,this.updateListView,this);const a=o.model(U);k.instance().addModelListener(U,ie.PrimaryPageChanged,this.onPrimaryPageChanged,this),this.decorationManager=new E(this.model,H.instance(),re.instance(),ne.instance()),this.toggleRecordAction.setToggled(!0),this.clearAction.setEnabled(!1),this.startWithReloadButton&&(this.startWithReloadButton.setEnabled(!1),this.startWithReloadButton.setVisible(!1),this.toggleRecordButton.setEnabled(!0),this.toggleRecordButton.setVisible(!0),s&&this.toggleRecordButton.focus()),this.coverageTypeComboBox.setEnabled(!1),this.filterInput.setEnabled(!0),this.filterByTypeComboBox.setEnabled(!0),this.contentScriptsCheckbox.setEnabled(!0),this.landingPage.isShowing()&&this.landingPage.detach(),this.listView.show(this.coverageResultsElement),t&&!s&&this.listView.focus(),i&&a?a.reloadPage():this.model.startPolling()}onCoverageDataReceived(e){const t=e.data;this.updateViews(t)}updateListView(){this.listView.update(this.model&&this.model.entries()||[])}async stopRecording(){k.instance().removeModelListener(U,ie.PrimaryPageChanged,this.onPrimaryPageChanged,this),this.hasFocus()&&this.listView.focus(),this.model&&(await this.model.stop(),this.model.removeEventListener(B.CoverageUpdated,this.onCoverageDataReceived,this)),this.toggleRecordAction.setToggled(!1),this.coverageTypeComboBox.setEnabled(!0),this.startWithReloadButton&&(this.startWithReloadButton.setEnabled(!0),this.startWithReloadButton.setVisible(!0),this.toggleRecordButton.setEnabled(!1),this.toggleRecordButton.setVisible(!1)),this.clearAction.setEnabled(!0)}processBacklog(){this.model&&this.model.processJSBacklog()}async onPrimaryPageChanged(e){const t=e.data.frame,s=t.resourceTreeModel().target().model(L);if(s){if(this.model!==s){if(this.model&&(await this.model.stop(),this.model.removeEventListener(B.CoverageUpdated,this.onCoverageDataReceived,this)),this.model=s,!await this.model.start(this.isBlockCoverageSelected()))return;this.model.addEventListener(B.CoverageUpdated,this.onCoverageDataReceived,this),this.decorationManager=new E(this.model,H.instance(),re.instance(),ne.instance())}this.bfcacheReloadPromptPage.isShowing()&&(this.bfcacheReloadPromptPage.detach(),this.listView.show(this.coverageResultsElement)),this.activationReloadPromptPage.isShowing()&&(this.activationReloadPromptPage.detach(),this.listView.show(this.coverageResultsElement)),t.backForwardCacheDetails.restoredFromCache&&(this.listView.detach(),this.bfcacheReloadPromptPage.show(this.coverageResultsElement)),e.data.type==="Activation"&&(this.listView.detach(),this.activationReloadPromptPage.show(this.coverageResultsElement)),this.model.reset(),this.decorationManager&&this.decorationManager.reset(),this.listView.reset(),this.model.startPolling()}}updateViews(e){this.updateStats(),this.listView.update(this.model&&this.model.entries()||[]),this.exportAction.setEnabled(this.model!==null&&this.model.entries().length>0),this.decorationManager&&this.decorationManager.update(e)}updateStats(){const e={total:0,unused:0},t={total:0,unused:0},s=this.textFilterRegExp!==null;if(this.model){for(const i of this.model.entries())if(e.total+=i.size(),e.unused+=i.unusedSize(),this.isVisible(!1,i))if(this.textFilterRegExp?.test(i.url()))t.total+=i.size(),t.unused+=i.unusedSize();else for(const r of i.sourcesURLCoverageInfo.values())this.isVisible(!1,r)&&(t.total+=r.size(),t.unused+=r.unusedSize())}this.statusMessageElement.textContent=s?S(f.filteredSTotalS,{PH1:o(t),PH2:o(e)}):o(e);function o({total:i,unused:r}){const n=i-r,a=i?Math.round(100*n/i):0;return S(f.sOfSSUsedSoFarSUnused,{PH1:J(n),PH2:J(i),PH3:a,PH4:J(r)})}}onFilterChanged(){if(!this.listView)return;const e=this.filterInput.value();this.textFilterRegExp=e?De(e,"i"):null,this.listView.updateFilterAndHighlight(this.textFilterRegExp),this.updateStats()}onFilterByTypeChanged(){if(!this.listView)return;G.actionTaken(_.CoverageReportFiltered);const e=this.filterByTypeComboBox.selectedOption(),t=e&&e.value;this.typeFilterValue=parseInt(t||"",10)||null,this.listView.updateFilterAndHighlight(this.textFilterRegExp),this.updateStats()}isVisible(e,t){const s=t.url();if(s.startsWith(M.EXTENSION_BINDINGS_URL_PREFIX)||t.isContentScript()&&!this.showContentScriptsSetting.get()||this.typeFilterValue&&!(t.type()&this.typeFilterValue))return!1;if(t.sourcesURLCoverageInfo.size>0){for(const o of t.sourcesURLCoverageInfo.values())if(this.isVisible(e,o))return!0}return e||!this.textFilterRegExp||this.textFilterRegExp.test(s)}async exportReport(){const e=new He,t=`Coverage-${Ve(new Date)}.json`;await e.open(t)&&this.model&&await this.model.exportReport(e)}selectCoverageItemByUrl(e){this.listView.selectByUrl(e)}static EXTENSION_BINDINGS_URL_PREFIX="extensions::";wasShown(){ae.instance().setFlavor(M,this),super.wasShown(),this.registerCSSFiles([Ce])}willHide(){super.willHide(),ae.instance().setFlavor(M,null)}}class qe{handleAction(e,t){const s="coverage";return ce.instance().showView(s,!1,!0).then(()=>{const o=ce.instance().view(s);return o&&o.widget()}).then(o=>this.innerHandleAction(o,t)),!0}innerHandleAction(e,t){switch(t){case"coverage.toggle-recording":e.toggleRecording();break;case"coverage.start-with-reload":e.startRecording({reload:!0,jsCoveragePerBlock:e.isBlockCoverageSelected()});break;case"coverage.clear":e.clear();break;case"coverage.export":e.exportReport();break;default:console.assert(!1,`Unknown action: ${t}`)}}}const Ke=Object.freeze(Object.defineProperty({__proto__:null,ActionDelegate:qe,CoverageView:M},Symbol.toStringTag,{value:"Module"})),Qe=Object.freeze(Object.defineProperty({__proto__:null,CoverageDecorationManager:Je,CoverageListView:_e,CoverageModel:$e,CoverageView:Ke},Symbol.toStringTag,{value:"Module"}));export{L as C,B as E,I as U,Qe as c};
//# sourceMappingURL=coverage-nL5Jv5gw.js.map
